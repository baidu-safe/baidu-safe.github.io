_.Module.define({path:"tbmall/widget/TbeanSafe",requires:["tbmall/component/captcha_payment","tbmall/widget/paykey_dialog","tbmall/widget/paykey_mobile"],sub:{ERROR:{},initial:function(t){this._initParam(t),this._handleErr()},needCheck:function(){return!!this.type},getType:function(){return this.type},_initParam:function(t){t=$.extend({json:{},sucCallback:function(){},errCallback:function(){}},t),this.type=0,this._json=t.json||{},this._no=this._json.no||this._json.errno,this._msg=this._json.msg,this._data=this._json.data||{},this._content=t.content,this._sucCall=$.isFunction(t.sucCallback)?t.sucCallback:function(){},this._errCall=$.isFunction(t.errCallback)?t.errCallback:function(){},this._mobileMsg="undefined"!=typeof t.tbeanOptions?t.tbeanOptions.mobileMsg:""},_handleErr:function(){switch(this._no){case 360007:case 2150040:this._initCaptcha(),this.type=1;break;case 2270018:case 1990005:case 2190005:this._initPaykey(2),this.type=2;break;case 2270066:this._initPaykey(1),this.type=2;break;case 2270040:this._initFirstMobile("bind"),this.type=3;break;case 2270041:this._initMobile("bind"),this.type=3;break;case 2270042:this._initMobile("check"),this.type=3;break;case 2270072:this._initFrozen(),this.type=4}},_initCaptcha:function(){var t=this.use("tbmall/component/captcha_payment",{data:this._json});t.showCaptcha(this._sucCall,this._content,this._errCall)},_initPaykey:function(t){var i=this.use("tbmall/widget/paykey_dialog",{showType:t,errType:this._no,errTime:this._data.wrongtime});i.showDialog(this._sucCall,this._errCall,this._content)},_initMobile:function(t){var i=this,e=this.use("tbmall/widget/paykey_mobile",{token:i._data.token,type:t});e.show(this._sucCall,this._errCall,this._content,this._mobileMsg)},_initFirstMobile:function(t){var i=this,e=this.use("tbmall/widget/paykey_mobile",{token:i._data.token,type:t,firstFlag:!0});e.show(this._sucCall,this._sucCall,this._content)},_FROZEN_TPL:['<div id="tdou_frozen_dialog" class="tdou_frozen_dialog clearfix">',"<p>\u60A8\u7684\u8D26\u53F7\u5904\u4E8E\u5F02\u5E38\u72B6\u6001\uFF0C\u6682\u65F6\u4E0D\u80FD\u6D88\u8D39T\u8C46\uFF0C\u7ED9\u60A8\u9020\u6210\u7684\u4E0D\u4FBF\u656C\u8BF7\u8C05\u89E3\u3002</p>",'<div class="tdou_frozen_btn_area clearfix">','<a href="#" target="_blank" class="tdou_frozen_accept_btn tdou_frozen_btn" id="tdou_frozen_accept_btn">\u786E\u5B9A</a>','<a href="#" class="tdou_frozen_cancel_btn tdou_frozen_btn" id="tdou_frozen_cancel_btn">\u53D6\u6D88</a>',"</div>","</div>"].join(""),_initFrozen:function(){var t=this,i=new $.dialog({html:t._FROZEN_TPL,title:"T\u8C46\u51BB\u7ED3\u63D0\u793A"});$(i.element).find(".tdou_frozen_btn").click(function(t){t.preventDefault(),i.close()}),i.onclose(function(){"function"==typeof t._errCall&&t._errCall()})}}});_.Module.define({path:"pcommon/widget/ParamsXssHandler",requires:[],sub:{_escapeKeyArray:["title","prefix","kw","word"],initial:function(e){e&&e.escapeKeyArray&&e.escapeKeyArray.length>0&&(this._escapeKeyArray=e.escapeKeyArray)},xssFilter:function(e){var r=$.extend({},e),a=$.tb.escapeHTML,s=this._escapeKeyArray;return $.each(s,function(i){var t=s[i],n=e[t];void 0!==n&&(r[t]=a(n))}),r}}});_.Module.define({path:"common/widget/PostService/PostResultHandlerManager",requires:[],sub:{initial:function(){this.isBlock=PageData&&PageData.user&&PageData.user.is_block,this.isBlockBySys=this.isBlock&&PageData.user.balv&&PageData.user.balv.is_by_pm,this._initHandlerMap()},_initHandlerMap:function(){function t(t,e){var r=this;_.Module.use("common/component/CaptchaDialog",{message:t.data.vcode.str_reason,vCode:t.data.vcode.captcha_vcode_str,vCodeType:t.data.vcode.captcha_code_type,exceptionalAccount:1==t.data.vcode.userstatevcode,forumName:e.kw,forumId:e.fid,postType:e.__type__,paramsCallback:function(){return{content:e.content,title:e.title,tid:e.tid}}},function(t){t.bind("onclose",function(){return t.hide(),r.trigger("complete"),!1}),t.bind("onaccept",function(){e.vcode=t.getInputValue(),e.vcode_md5=t.getVCode(),r.trigger("retry",e)}),t.show()})}function e(){var t=this,e=l.messageMap[224010];null==e&&(e="\u672A\u77E5\u9519\u8BEF");$.tb.alert({title:"\u53D1\u8D34\u5931\u8D25",message:e,buttons:[{text:"\u7ED1\u5B9A\u624B\u673A",callback:function(){var e=$.tb.location,r=e.getHost()+e.getPathname()+e.getSearch(),a="http://passport.baidu.com/v2/?accountbindphone&tpl=tb&u="+encodeURIComponent(r+"#sub");t.trigger("complete"),$.tb.location.setHref(a)}}]});this.trigger("error")}function r(t){var e=this,r=l.auditMessageMap[t.bdauditreason];null==r&&(r=l.auditMessageMap["default"]);$.tb.alert({iconSrc:"http://static.tieba.baidu.com/tb/img/messageFace.gif",title:"\u7B49\u5F85\u5BA1\u6838",heading:"\u7B49\u5F85\u5BA1\u6838...",message:r,buttons:{text:"\u786E\u5B9A",callback:function(){e.trigger("complete"),$.tb.location.reload()}}});this.trigger("error")}function a(){{var t=this;$.tb.alert({iconSrc:"http://static.tieba.baidu.com/tb/img/errorFace.gif",title:"\u53D1\u8D34\u5931\u8D25",heading:"\u53D1\u8D34\u5931\u8D25",message:c,buttons:{text:"\u786E\u5B9A",callback:function(){t.trigger("complete")}}})}this.trigger("error")}function i(t,e){{var r=this,a=function(){$.tb.alert({title:"T\u8C46\u5145\u503C",message:"\u6211\u5DF2\u6210\u529F\u5145\u503CT\u8C46",holderClassName:"tdou_notenough_dialog",buttons:{text:"\u91CD\u65B0\u53D1\u8868",callback:function(){r.trigger("retry",e)}}})};$.tb.alert({title:"T\u8C46\u4F59\u989D\u4E0D\u8DB3",message:"\u60A8\u7684T\u8C46\u4F59\u989D\u4E0D\u8DB3\uFF0C\u53D1\u8868\u8D34\u5B50\u5931\u8D25\uFF0C\u8BF7\u5145\u503C\u540E\u91CD\u8BD5",holderClassName:"tdou_notenough_dialog",onclose:function(){r.trigger("complete")},buttons:{text:"\u5145\u503CT\u8C46",callback:function(){_.Module.use("common/widget/tcharge_dialog"),r.trigger("complete"),a()}}})}}function s(){{var t=this;$.tb.alert({title:"\u63D0\u793A\u4FE1\u606F",message:"<p>\u4EB2\uFF0C\u60A8\u53CD\u9988\u7684\u95EE\u9898\u53EF\u80FD\u4E0E\u5220\u5E16\u6216\u5C01\u7981\u6709\u5173\u3002</p>\u8BF7\u786E\u8BA4\u53CD\u9988\u5185\u5BB9\u4E2D\u5305\u542B<strong>\u88AB\u5C01\u8D26\u53F7</strong>\u3001<strong>\u88AB\u5220\u5E16\u94FE\u63A5</strong>\u3001<strong>\u9875\u9762\u622A\u56FE</strong>\uFF0C\u4EE5\u4FBF\u4E8E\u6211\u4EEC\u66F4\u5FEB\u5E2E\u60A8\u89E3\u51B3\u95EE\u9898\u54E6~",holderClassName:"ueg_confirm_note_dialog",onclose:function(){t.trigger("complete")},buttons:[{text:"\u786E\u8BA4\u53D1\u8868",callback:function(){t.trigger("complete"),t.trigger("retryPost")}},{text:"\u6211\u518D\u6539\u6539",callback:function(){t.trigger("complete")}}]})}t.trigger("uegPostParameter")}function n(){{var t=this;$.tb.alert({title:"\u63D0\u793A\u4FE1\u606F",message:"<p>\u7EBF\u8DEF\u5347\u7EA7\u6539\u9020\uFF0C\u6682\u65F6\u65E0\u6CD5\u53D1\u8D34\uFF0C\u8BF7\u8010\u5FC3\u7B49\u5F85\uFF0C\u7ED9\u60A8\u5E26\u6765\u4E0D\u4FBF\u8868\u793A\u62B1\u6B49~</p>",holderClassName:"ueg_confirm_note_dialog",onclose:function(){t.trigger("complete")},buttons:[{text:"\u5173\u95ED",callback:function(){t.trigger("complete")}}]})}}function o(t,e){{var r=this;r.use("tbmall/widget/TbeanSafe",{json:t,sucCallback:function(t){var a=$.extend(e,t);r.trigger("retry",a)},errCallback:function(){r.trigger("complete")},content:r})}}var c,l=this;_.Module.use("ueglibs/widget/Ban",[],function(t){c=t.render("richPoster")}),this.registerHandler(0,function(t,e){var r=this;"thread"==e.__type__&&t.data.balv&&t.data.balv.member_status?($.stats.sendRequest("fr=tb0_forum&st_page=frs&st_mod=like&st_type=thread"),r.use("ucenter/widget/LikeTip","\u53D1\u8D34\u6210\u529F",!1,{index:t.data.balv.member_index})):e.file_id?$.tb.alert({iconSrc:"http://tb1.bdstatic.com/tb/img/messageFace.gif",title:"\u53D1\u8868\u8D34\u5B50",heading:"\u89C6\u9891\u8F6C\u7801\u4E2D",message:"\u7A0D\u540E\u8F6C\u7801\u5B8C\u6210\u540E\u8D34\u5B50\u5C06\u81EA\u52A8\u53D1\u8868\u3002\u8BF7\u8010\u5FC3\u7B49\u5F85\uFF0C\u8C22\u8C22",buttons:[{text:"\u786E\u5B9A",callback:function(){r.trigger("complete"),r.trigger("success")}}]}):r.trigger("success",t)}),this.registerHandler(224011,t),this.registerHandler(40,t),this.registerHandler(224010,e),this.registerHandler(4010,e),this.registerHandler(220009,r),this.registerHandler(9,r),this.registerHandler(12,a),this.registerHandler(220012,a),this.registerHandler(2270005,i),this.registerHandler(220902,s),this.registerHandler(220903,n),this.registerHandler(360007,o),this.registerHandler(2150040,o),this.registerHandler(2270018,o),this.registerHandler(1990005,o),this.registerHandler(2190005,o),this.registerHandler(2270043,o),this.registerHandler(2270040,o),this.registerHandler(2270041,o),this.registerHandler(2270042,o)},registerHandler:function(t,e){this.handlerMap[t]=e},getHandler:function(t){var e=this,r=e.handlerMap[t];if(null==r){var a=e.messageMap[t];null==a&&(a="\u672A\u77E5\u9519\u8BEF\uFF0C\u9519\u8BEF\u53F7\uFF1A"+t),r=function(){{var t=this;$.tb.alert({iconSrc:"http://static.tieba.baidu.com/tb/img/errorFace.gif",title:"\u53D1\u8D34\u5931\u8D25",heading:"\u53D1\u8D34\u5931\u8D25",message:a,buttons:{text:"\u786E\u5B9A",callback:function(){t.trigger("complete")}}})}this.trigger("error")}}return r},messageMap:{220001:"\u53C2\u6570\u9519\u8BEF",220008:"\u5148\u53D1\u540E\u5BA1",220009:"",220011:"\u8D34\u5B50\u6807\u9898\u548C\u5185\u5BB9\u592A\u957F",220013:"\u64CD\u4F5C\u5931\u8D25\uFF0C\u60A8\u7684\u7F51\u7EDC\u5730\u5740\u7531\u4E8E\u975E\u6CD5\u64CD\u4F5C\u88AB\u5C01<br/><a href='/upc/userinfo?fid=fid' target=\"_blank\">\u67E5\u770B\u5C01\u7981\u4FE1\u606F</a>",220015:"\u8BF7\u4E0D\u8981\u53D1\u8868\u542B\u6709\u4E0D\u9002\u5F53\u5185\u5BB9\u7684\u7559\u8A00<br>\u8BF7\u4E0D\u8981\u53D1\u8868\u5E7F\u544A\u8D34",220034:"\u60A8\u8BF4\u8BDD\u592A\u5FEB\u4E86:) \u8BF7\u5148\u505C\u4E0B\u6765\u559D\u676F\u8336\u5427\uFF0C\u6216\u8005\u53EF\u4EE5\u53BB\u522B\u7684\u5427\u770B\u770B\u54E6\uFF0C\u4E00\u5B9A\u4F1A\u53D1\u73B0\u8FD8\u6709\u60A8\u611F\u5174\u8DA3\u7684\u8BDD\u9898",220035:"\u4EB2\uFF0C\u5DF2@\u4E0D\u5C11\u4EBA\u4E86\uFF0C\u4EE5\u514D\u6253\u6405\u66F4\u591A\u4EBA\uFF0C\u6B47\u4E00\u4F1A\u5427~",220037:"\u60A8\u5DF2\u5C1D\u8BD5\u63D0\u4EA4\u591A\u6B21\u4E86\uFF0C\u8BF7\u8FD4\u56DE\u540E\u5237\u65B0\u9875\u9762\uFF0C\u65B9\u53EF\u91CD\u65B0\u53D1\u8D34",220038:"\u9A8C\u8BC1\u7801\u8D85\u65F6\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165",220040:"\u9A8C\u8BC1\u7801\u8F93\u5165\u9519\u8BEF\uFF0C\u8BF7\u60A8\u8FD4\u56DE\u540E\u91CD\u65B0\u8F93\u5165",220119:"\u5BF9\u4E0D\u8D77\uFF0C\u672C\u4E3B\u9898\u7684\u56DE\u590D\u6570\u5DF2\u7ECF\u8FBE\u5230\u4E0A\u9650\uFF0C\u611F\u8C22\u60A8\u7684\u53C2\u4E0E\uFF0C\u6B22\u8FCE\u60A8\u6D4F\u89C8\u672C\u5427\u7684\u5176\u5B83\u4E3B\u9898",220901:"",224009:"\u8D34\u5B50\u5DF2\u88AB\u9501\u5B9A\uFF0C\u65E0\u6CD5\u8FDB\u884C\u8BE5\u64CD\u4F5C",224010:"\u60A8\u7684\u8D26\u53F7\u5B58\u5728\u5B89\u5168\u98CE\u9669\u6682\u4E0D\u80FD\u53D1\u8D34\uFF0C\u8BF7\u5148\u8FDB\u884C\u624B\u673A\u7ED1\u5B9A\u540E\u518D\u53D1\u8D34\u5427\u3002",230004:"\u60A8\u672A\u767B\u5F55\u6216\u5DF2\u9000\u51FA\u767B\u5F55\u72B6\u6001\uFF0C\u8BF7\u5148\u767B\u5F55\u518D\u8FDB\u884C\u64CD\u4F5C\u3002",230008:"\u60A8\u7684\u5185\u5BB9\u5DF2\u63D0\u4EA4\u6210\u529F\uFF0C\u6B63\u5728\u8FDB\u884C\u5BA1\u6838\uFF0C\u8BF7\u8010\u5FC3\u7B49\u5F85\u3002",230013:"\u64CD\u4F5C\u5931\u8D25\uFF0C\u60A8\u7684\u5E10\u53F7\u56E0\u8FDD\u89C4\u64CD\u4F5C\u800C\u88AB\u5C01\u7981",230020:"\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u7684\u6807\u9898\u6216\u6B63\u6587\u5305\u542B\u592A\u5C11\u7684\u6587\u5B57\uFF0C\u8BF7\u4FEE\u6539\u540E\u518D\u53D1\u8868",230044:"\u5EFA\u5427\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u5C1D\u8BD5",230045:"\u62B1\u6B49\uFF0C\u60A8\u63D0\u4EA4\u7684\u8D34\u5427\u540D\u79F0\u542B\u7279\u6B8A\u5B57\u7B26\uFF0C\u76EE\u524D\u65E0\u6CD5\u521B\u5EFA\uFF0C\u63A8\u8350\u60A8\u4F7F\u7528\u6C49\u5B57\u3001\u5B57\u6BCD\u6216\u6570\u5B57\u4F5C\u4E3A\u8D34\u5427\u540D\u79F0",230046:"\u62B1\u6B49\uFF0C\u60A8\u7684\u8D34\u5B50\u8FC7\u957F\uFF0C\u65E0\u6CD5\u6B63\u5E38\u63D0\u4EA4\u3002\u5EFA\u8BAE\u60A8\u7CBE\u7B80\u6216\u5206\u6BB5\u540E\u91CD\u65B0\u63D0\u4EA4\uFF0C\u8C22\u8C22!",230265:"\u60A8\u672A\u767B\u5F55\u6216\u5DF2\u9000\u51FA\u767B\u5F55\u72B6\u6001\uFF0C\u8BF7\u5148\u767B\u5F55\u518D\u8FDB\u884C\u64CD\u4F5C\u3002",230273:"\u64CD\u4F5C\u5931\u8D25\uFF0C\u8BE5\u5E16\u5B50\u5DF2\u4E0D\u5B58\u5728",230308:"\u62B1\u6B49\uFF0C\u60A8\u6CA1\u6709\u6743\u9650\u8FDB\u884C\u8BE5\u9879\u64CD\u4F5C\u3002",230705:"\u672C\u5427\u5F53\u524D\u53EA\u80FD\u6D4F\u89C8\uFF0C\u4E0D\u80FD\u53D1\u8D34\uFF01",230808:"\u62B1\u6B49\uFF0C\u6BCF\u5C42\u697C\u63D2\u5165\u7684\u89C6\u9891\u4E0D\u80FD\u8D85\u8FC71\u4E2A\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4",230809:"\u62B1\u6B49\uFF0C\u6BCF\u5C42\u697C\u63D2\u5165\u7684\u56FE\u7247\u4E0D\u80FD\u8D85\u8FC710\u5F20\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4",230814:"\u62B1\u6B49\uFF0C\u6BCF\u5C42\u697C\u63D2\u5165\u7684\u8868\u60C5\u4E0D\u80FD\u8D85\u8FC710\u5F20\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4",230815:"\u62B1\u6B49\uFF0C\u6BCF\u5C42\u697C\u63D2\u5165\u7684\u97F3\u4E50\u4E0D\u80FD\u8D85\u8FC710\u4E2A\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4",230850:"\u5427\u540D\u5DF2\u5B58\u5728\uFF0C\u8BF7\u52FF\u91CD\u590D\u521B\u5EFA",230870:"\u672C\u5E16\u5B50\u56DE\u590D\u8F83\u591A\uFF0C\u4E0D\u652F\u6301\u5220\u9664",230871:"\u53D1\u8D34\u592A\u9891\u7E41\uFF0C\u505C\u4E0B\u6765\u559D\u676F\u8336\u4F11\u606F\u4E0B\u5427",230887:"\u53D1\u8868\u5931\u8D25\u4E86\uFF0C\u8BF7\u91CD\u65B0\u5C1D\u8BD5",230889:"\u60A8\u5DF2\u88AB\u52A0\u5165\u5C0F\u9ED1\u5C4B\uFF0C\u65E0\u6CD5\u8FDB\u884C\u8BE5\u64CD\u4F5C\u3002",230900:"\u4E3A\u62B5\u5FA1\u6316\u575F\u5371\u5BB3\uFF0C\u672C\u5427\u5427\u4E3B\u5DF2\u653E\u51FA\u8D34\u5427\u795E\u517D--\u8D85\u7EA7\u9759\u6B62\u86D9\uFF0C\u672C\u8D34\u6682\u65F6\u65E0\u6CD5\u56DE\u590D\u3002",230901:"\u8BE5\u697C\u56DE\u590D\u5DF2\u8FBE\u4E0A\u9650\uFF0C\u8BF7\u5230\u522B\u7684\u697C\u5C42\u53C2\u4E0E\u4E92\u52A8\u5427",230902:"\u60A8\u8F93\u5165\u7684\u5185\u5BB9\u8FC7\u957F\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4\u3002",230903:"\u60A8\u8F93\u5165\u7684\u5185\u5BB9\u4E0D\u5408\u6CD5\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4\u3002",230961:"\u53D1\u8D34\u5931\u8D25\uFF0C\u60A8\u8F93\u5165\u7684\u56FE\u7247\u5730\u5740\u6709\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u66F4\u6B63\u540E\u518D\u6B21\u53D1\u5E03\uFF1A\uFF09",230962:"\u60A8\u8F93\u5165\u7684\u5185\u5BB9\u4E0D\u5408\u6CD5\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4\u3002",230963:"\u60A8\u8F93\u5165\u7684\u5185\u5BB9\u4E0D\u5408\u6CD5\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4\u3002",231120:"\u62B1\u6B49\uFF0C\u60A8\u8F93\u5165\u7684\u56FE\u7247\u3001\u89C6\u9891\u94FE\u63A5\u5730\u5740\u9519\u8BEF\uFF0C\u60A8\u53EF\u4EE5\u70B9\u51FB<a href='http://www.baidu.com/search/post_img.html' target='_blank'>\u67E5\u770B\u76F8\u5173\u5E2E\u52A9</a>\u6216\u8FD4\u56DE\u4FEE\u6539",232e3:"\u60A8\u8F93\u5165\u7684\u5185\u5BB9\u4E0D\u5408\u6CD5\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4\u3002",232001:"\u60A8\u8F93\u5165\u7684\u5185\u5BB9\u4E0D\u5408\u6CD5\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4\u3002",232007:"\u60A8\u8F93\u5165\u7684\u5185\u5BB9\u4E0D\u5408\u6CD5\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4\u3002",232101:"\u60A8\u8F93\u5165\u7684\u5185\u5BB9\u4E0D\u5408\u6CD5\uFF0C\u8BF7\u4FEE\u6539\u540E\u91CD\u65B0\u63D0\u4EA4\u3002",233001:"\u53D1\u8868\u5931\u8D25\u4E86\uFF0C\u8BF7\u91CD\u65B0\u518D\u8BD5\u3002",233003:"\u53D1\u8868\u5931\u8D25\u4E86\uFF0C\u8BF7\u91CD\u65B0\u518D\u8BD5\u3002",233004:"\u53D1\u8868\u5931\u8D25\u4E86\uFF0C\u8BF7\u91CD\u65B0\u518D\u8BD5\u3002",233005:"\u53D1\u8868\u5931\u8D25\u4E86\uFF0C\u8BF7\u91CD\u65B0\u518D\u8BD5\u3002",233006:"\u53D1\u8868\u5931\u8D25\u4E86\uFF0C\u8BF7\u91CD\u65B0\u518D\u8BD5\u3002",233007:"\u53D1\u8868\u5931\u8D25\u4E86\uFF0C\u8BF7\u91CD\u65B0\u518D\u8BD5\u3002",233010:"\u672C\u5427\u4EC5\u5141\u8BB8\u5B98\u65B9\u7C89\u4E1D\u56E2\u6210\u5458\u56DE\u590D\u54E6\uFF0C\u8D76\u5FEB\u52A0\u5165\u5427\uFF01",220903:"\u7EBF\u8DEF\u5347\u7EA7\u6539\u9020\uFF0C\u6682\u65F6\u65E0\u6CD5\u53D1\u8D34\uFF0C\u8BF7\u8010\u5FC3\u7B49\u5F85\uFF0C\u7ED9\u60A8\u5E26\u6765\u4E0D\u4FBF\u8868\u793A\u62B1\u6B49~",234031:"\u4E0A\u4F20\u6587\u4EF6\u5931\u8D25\uFF0C\u8BF7\u91CD\u65B0\u4E0A\u4F20\u3002",235004:"\u4F7F\u7528\u9053\u5177\u9519\u8BEF\uFF0C\u8BE5\u9053\u5177\u8981\u8D2D\u4E70\u540E\u624D\u80FD\u4F7F\u7528\u3002",235005:"\u65E0\u6743\u9650\u4F7F\u7528\u8BE5\u9053\u5177\uFF0C\u8BF7\u53BB\u8D2D\u4E70\u3002",239e3:"\u60A8\u8FD8\u6CA1\u6709\u7528\u6237\u540D\uFF0C\u4E0D\u80FD\u5728\u672C\u5427\u53D1\u8D34\u3002\u8BF7\u5148\u586B\u5199\u7528\u6237\u540D\u3002",239001:"\u7531\u4E8E\u533F\u540D\u72B6\u6001\u6216\u672C\u5427\u8BBE\u7F6E\uFF0C\u65E0\u6CD5\u53D1\u8868\u5E26\u6709\u56FE\u7247\u7684\u4E3B\u9898\u3002",2270028:"\u9644\u52A0\u5956\u54C1\u7684\u989D\u5EA6\u4E0D\u80FD\u5C11\u4E8E10000T\u8C46",2270029:"\u4E3B\u9898\u53D1\u9001\u6210\u529F\uFF0C\u5956\u52B1\u6DFB\u52A0\u5931\u8D25",2270018:"\u62B1\u6B49\uFF0C\u60A8\u6CA1\u6709\u6743\u9650\u53D1\u5956\u52B1\u8D34",2270027:"\u611F\u8A00\u8BF7\u63A7\u5236\u5728140\u4E2A\u5B57\u4E4B\u5185",10:"\u8D34\u5B50\u5185\u5BB9\u5305\u542B\u592A\u5C11\u7684\u6587\u5B57",11:"\u8D34\u5B50\u6807\u9898\u548C\u5185\u5BB9\u592A\u957F",13:"\u64CD\u4F5C\u5931\u8D25\uFF0C\u60A8\u7684\u7F51\u7EDC\u5730\u5740\u7531\u4E8E\u975E\u6CD5\u64CD\u4F5C\u88AB\u5C01<br/><a href='/upc/userinfo?fid=fid' target=\"_blank\">\u67E5\u770B\u5C01\u7981\u4FE1\u606F</a>",14:"\u60A8\u53D1\u5E03\u7684\u8D34\u5B50\u5DF2\u7ECF\u5B58\u5728",15:"\u8BF7\u4E0D\u8981\u53D1\u8868\u542B\u6709\u4E0D\u9002\u5F53\u5185\u5BB9\u7684\u7559\u8A00<br>\u8BF7\u4E0D\u8981\u53D1\u8868\u5E7F\u544A\u8D34",501:"\u8BF7\u4E0D\u8981\u53D1\u8868\u542B\u6709\u4E0D\u9002\u5F53\u5185\u5BB9\u7684\u7559\u8A00<br>\u8BF7\u4E0D\u8981\u53D1\u8868\u5E7F\u544A\u8D34",16:"\u5BF9\u4E0D\u8D77\uFF0C\u60A8\u6240\u8F93\u5165\u7684\u8D34\u5427\u4E0D\u5B58\u5728\u3002\u7531\u4E8E\u7CFB\u7EDF\u5347\u7EA7\u7EF4\u62A4\uFF0C\u65B0\u5EFA\u8D34\u5427\u529F\u80FD\u6682\u505C\uFF0C\u5E0C\u671B\u5F97\u5230\u60A8\u7684\u8C05\u89E3\uFF01",17:"\u672C\u5427\u5F53\u524D\u53EA\u80FD\u6D4F\u89C8\uFF0C\u4E0D\u80FD\u53D1\u8D34\uFF01",19:"\u60A8\u7684\u7528\u6237\u540D\u6216\u8005\u5BC6\u7801\u586B\u5199\u6709\u8BEF\uFF0C\u8BF7\u786E\u8BA4\u540E\u518D\u53D1\u8868",200:"\u60A8\u7684\u7528\u6237\u540D\u6216\u8005\u5BC6\u7801\u586B\u5199\u6709\u8BEF\uFF0C\u8BF7\u786E\u8BA4\u540E\u518D\u53D1\u8868",201:"\u60A8\u7684\u7528\u6237\u540D\u6216\u8005\u5BC6\u7801\u586B\u5199\u6709\u8BEF\uFF0C\u8BF7\u786E\u8BA4\u540E\u518D\u53D1\u8868",202:"\u60A8\u7684\u7528\u6237\u540D\u6216\u8005\u5BC6\u7801\u586B\u5199\u6709\u8BEF\uFF0C\u8BF7\u786E\u8BA4\u540E\u518D\u53D1\u8868",20:"\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u7684\u6807\u9898\u6216\u6B63\u6587\u5305\u542B\u592A\u5C11\u7684\u6587\u5B57\uFF0C\u8BF7\u4FEE\u6539\u540E\u518D\u53D1\u8868",22:"\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u7531\u4E8E\u7279\u6B8A\u539F\u56E0\u6211\u4EEC\u9700\u8981\u6838\u5B9E\u8BE5\u8D34\u5185\u5BB9\u662F\u5426\u542B\u6709\u4E0D\u826F\u4FE1\u606F\uFF0C\u6211\u4EEC\u4F1A\u572810\u5206\u949F\u5185\u786E\u8BA4\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85\uFF01",23:"\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u9700\u8981\u7CFB\u7EDF\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u5EFA\u7ACB\u8D34\u5427",33:"\u60A8\u53D1\u8D34\u592A\u5FEB\u4E86:) \u8BF7\u7A0D\u540E\u518D\u53D1",34:"\u60A8\u8BF4\u8BDD\u592A\u5FEB\u4E86:) \u8BF7\u5148\u505C\u4E0B\u6765\u559D\u676F\u8336\u5427\uFF0C\u6216\u8005\u53EF\u4EE5\u53BB\u522B\u7684\u5427\u770B\u770B\u54E6\uFF0C\u4E00\u5B9A\u4F1A\u53D1\u73B0\u8FD8\u6709\u60A8\u611F\u5174\u8DA3\u7684\u8BDD\u9898",35:"\u4EB2\uFF0C\u5DF2@\u4E0D\u5C11\u4EBA\u4E86\uFF0C\u4EE5\u514D\u6253\u6405\u66F4\u591A\u4EBA\uFF0C\u6B47\u4E00\u4F1A\u5427~",36:"\u8BF7\u4E0D\u8981\u53D1\u5E7F\u544A\u8D34\uFF01",37:"\u60A8\u5DF2\u5C1D\u8BD5\u63D0\u4EA4\u591A\u6B21\u4E86\uFF0C\u8BF7\u8FD4\u56DE\u540E\u5237\u65B0\u9875\u9762\uFF0C\u65B9\u53EF\u91CD\u65B0\u53D1\u8D34",38:"\u9A8C\u8BC1\u7801\u8D85\u65F6\uFF0C\u8BF7\u91CD\u65B0\u8F93\u5165",39:"\u7531\u4E8E\u60A8\u591A\u6B21\u8F93\u9519\u9A8C\u8BC1\u7801\uFF0C\u8BF7\u60A8\u8FD4\u56DE\u540E\u5237\u65B0\u9875\u9762\uFF0C\u65B9\u53EF\u91CD\u65B0\u53D1\u8D34",40:"\u9A8C\u8BC1\u7801\u8F93\u5165\u9519\u8BEF\uFF0C\u8BF7\u60A8\u8FD4\u56DE\u540E\u91CD\u65B0\u8F93\u5165",41:"\u60A8\u7684\u8D34\u5B50\u53EF\u80FD\u5305\u542B\u4E0D\u5408\u9002\u7684\u5185\u5BB9\uFF0C\u8BF7\u60A8\u786E\u5B9A\u540E\u518D\u63D0\u4EA4",42:"\u60A8\u7684\u53D1\u8D34\u884C\u4E3A\u88AB\u7CFB\u7EDF\u8BA4\u4E3A\u6709\u53D1\u5E7F\u544A\u5ACC\u7591\uFF0C\u8BF7\u60A8\u7A0D\u540E\u518D\u53D1",43:"\u60A8\u7684\u53D1\u8D34\u884C\u4E3A\u6216\u8D34\u5B50\u5185\u5BB9\u6709\u5E7F\u544A\u6216\u4E0D\u5408\u9002\u7684\u7279\u5F81\uFF0C\u8BF7\u60A8\u786E\u5B9A\u540E\u518D\u53D1\u9001",44:"\u5BF9\u4E0D\u8D77\uFF0C\u672C\u5427\u6682\u65F6\u9650\u5236\u90E8\u5206\u7528\u6237\u53D1\u8868\u4E3B\u9898\u8D34\u5B50\uFF0C\u60A8\u53EF\u4EE5\u6D4F\u89C8\u6216\u56DE\u590D\u672C\u5427\u5176\u5B83\u5185\u5BB9\uFF0C\u7ED9\u60A8\u5E26\u6765\u4E0D\u4FBF\u5E0C\u671B\u5F97\u5230\u60A8\u7684\u8C05\u89E3\u3002",119:"\u5BF9\u4E0D\u8D77\uFF0C\u672C\u4E3B\u9898\u7684\u56DE\u590D\u6570\u5DF2\u7ECF\u8FBE\u5230\u4E0A\u9650\uFF0C\u611F\u8C22\u60A8\u7684\u53C2\u4E0E\uFF0C\u6B22\u8FCE\u60A8\u6D4F\u89C8\u672C\u5427\u7684\u5176\u5B83\u4E3B\u9898",1120:"\u62B1\u6B49\uFF0C\u60A8\u8F93\u5165\u7684\u56FE\u7247\u3001\u89C6\u9891\u94FE\u63A5\u5730\u5740\u9519\u8BEF\uFF0C\u60A8\u53EF\u4EE5\u70B9\u51FB<a href='http://www.baidu.com/search/post_img.html' target='_blank'>\u67E5\u770B\u76F8\u5173\u5E2E\u52A9</a>\u6216\u8FD4\u56DE\u4FEE\u6539",1121:"\u62B1\u6B49\uFF0C\u89C6\u9891\u670D\u52A1\u5347\u7EA7\u4E2D\uFF0C\u60A8\u6682\u65F6\u65E0\u6CD5\u53D1\u8868\u5E26\u6709\u89C6\u9891\u7684\u8D34\u5B50\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u8BF7\u539F\u8C05",100:"\u5BF9\u4E0D\u8D77\uFF0C\u672C\u5427\u6682\u65F6\u9650\u5236\u90E8\u5206\u7528\u6237\u4F7F\u7528\u5B8C\u6574\u7684\u8D34\u5427\u529F\u80FD\uFF0C\u60A8\u53EF\u4EE5\u6D4F\u89C8\u672C\u5427\u5176\u5B83\u5185\u5BB9\uFF0C\u7ED9\u60A8\u5E26\u6765\u4E0D\u4FBF\u5E0C\u671B\u5F97\u5230\u60A8\u7684\u8C05\u89E3\u3002",701:"\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u4E0D\u5141\u8BB8\u672A\u767B\u5F55\u7528\u6237\u53D1\u8D34\uFF0C\u767B\u5F55\u7528\u6237\u4E0D\u53D7\u5F71\u54CD\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F",702:"\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u9650\u5236\u90E8\u5206\u7528\u6237\u53D1\u8D34\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F",703:"\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u88AB\u8BBE\u7F6E\u4E3A\u4EC5\u672C\u5427\u4F1A\u5458\u624D\u80FD\u53D1\u8D34\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F\u3002<a href='/f?kw=this.bdQueryWordEnc#1' target=_blank>\u70B9\u6B64\u7533\u8BF7\u52A0\u5165</a>\u672C\u5427\u4F1A\u5458",704:"\u4E3A\u4E86\u51CF\u5C11\u6076\u610F\u704C\u6C34\u548C\u5E7F\u544A\u5E16\uFF0C\u672C\u5427\u88AB\u8BBE\u7F6E\u4E3A\u4EC5\u672C\u5427\u7BA1\u7406\u56E2\u961F\u624D\u80FD\u53D1\u8D34\uFF0C\u7ED9\u60A8\u5E26\u6765\u7684\u4E0D\u4FBF\u6DF1\u8868\u6B49\u610F",705:"\u672C\u5427\u5F53\u524D\u53EA\u80FD\u6D4F\u89C8\uFF0C\u4E0D\u80FD\u53D1\u8D34\uFF01",706:"\u62B1\u6B49\uFF0C\u672C\u8D34\u6682\u65F6\u65E0\u6CD5\u56DE\u590D\u3002",45:"\u62B1\u6B49\uFF0C\u60A8\u63D0\u4EA4\u7684\u8D34\u5427\u540D\u79F0\u542B\u7279\u6B8A\u5B57\u7B26\uFF0C\u76EE\u524D\u65E0\u6CD5\u521B\u5EFA\uFF0C\u63A8\u8350\u60A8\u4F7F\u7528\u6C49\u5B57\u3001\u5B57\u6BCD\u6216\u6570\u5B57\u4F5C\u4E3A\u8D34\u5427\u540D\u79F0",46:"\u62B1\u6B49\uFF0C\u60A8\u7684\u8D34\u5B50\u8FC7\u957F\uFF0C\u65E0\u6CD5\u6B63\u5E38\u63D0\u4EA4\u3002\u5EFA\u8BAE\u60A8\u7CBE\u7B80\u6216\u5206\u6BB5\u540E\u91CD\u65B0\u63D0\u4EA4\uFF0C\u8C22\u8C22!",815:"\u62B1\u6B49\uFF0C\u60A8\u5DF2\u9000\u51FA\u767B\u5F55\u6216\u672A\u8D2D\u4E70\u97F3\u4E50\u9053\u5177\uFF0C\u8BF7\u5237\u65B0\u9875\u9762\u91CD\u8BD5",900:"\u4E3A\u62B5\u5FA1\u6316\u575F\u5371\u5BB3\uFF0C\u672C\u5427\u5427\u4E3B\u5DF2\u653E\u51FA\u8D34\u5427\u795E\u517D--\u8D85\u7EA7\u9759\u6B62\u86D9\uFF0C\u672C\u8D34\u6682\u65F6\u65E0\u6CD5\u56DE\u590D\u3002",961:"\u53D1\u8D34\u5931\u8D25\uFF0C\u60A8\u8F93\u5165\u7684\u56FE\u7247\u5730\u5740\u6709\u9519\u8BEF\uFF0C\u8BF7\u68C0\u67E5\u66F4\u6B63\u540E\u518D\u6B21\u53D1\u5E03\uFF1A\uFF09",9001:"\u7531\u4E8E\u533F\u540D\u72B6\u6001\u6216\u672C\u5427\u8BBE\u7F6E\uFF0C\u65E0\u6CD5\u53D1\u8868\u5E26\u6709\u56FE\u7247\u7684\u4E3B\u9898\u3002",2100:"\u5185\u5BB9\u542B\u6709\u9AD8\u7EA7\u5B57\u4F53\u6548\u679C\uFF0C\u4FDD\u6301\u8FDE\u7EED\u7B7E\u5230\u5C31\u80FD\u4F7F\u7528\u54E6~~",4010:"\u60A8\u7684\u8D26\u53F7\u5B58\u5728\u5B89\u5168\u98CE\u9669\u6682\u4E0D\u80FD\u53D1\u8D34\uFF0C\u8BF7\u5148\u8FDB\u884C\u624B\u673A\u7ED1\u5B9A\u540E\u518D\u53D1\u8D34\u5427\u3002",9e3:"\u60A8\u8FD8\u6CA1\u6709\u7528\u6237\u540D\uFF0C\u4E0D\u80FD\u5728\u672C\u5427\u53D1\u8D34\u3002\u8BF7\u5148\u586B\u5199\u7528\u6237\u540D\u3002",402011:"\u56FE\u7247\u5BBD\u5EA6\u8D85\u51FA\u9650\u5236",402012:"\u56FE\u7247\u9AD8\u5EA6\u8D85\u51FA\u9650\u5236",402013:"\u56FE\u7247\u6807\u7B7E\u65E0\u6548",220900:"\u7981\u6B62\u6316\u575F"},auditMessageMap:{"-61":"\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u4E3A\u4E86\u4FDD\u8BC1\u8D34\u5B50\u8D28\u91CF\uFF0C\u672C\u5427\u6240\u53D1\u7684\u8D34\u5B50\u5F85\u7CFB\u7EDF\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85","-62":"\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u4E3A\u4E86\u4FDD\u8BC1\u8D34\u5B50\u8D28\u91CF\uFF0C\u672C\u5427\u8D34\u56FE\u7684\u8D34\u5B50\u9700\u8981\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85","-74":"\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u7CFB\u7EDF\u9700\u8981\u6838\u5B9E\u8BE5\u8D34\u5B50\u5185\u5BB9\u662F\u5426\u542B\u6709\u4E0D\u826F\u4FE1\u606F\uFF0C\u8D34\u5B50\u5728\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85","-75":"\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u7CFB\u7EDF\u9700\u8981\u6838\u5B9E\u8BE5\u8D34\u5B50\u5185\u5BB9\u662F\u5426\u542B\u6709\u4E0D\u826F\u4FE1\u606F\uFF0C\u8D34\u5B50\u5728\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85","-60":"\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u7CFB\u7EDF\u9700\u8981\u6838\u5B9E\u8BE5\u8D34\u5B50\u5185\u5BB9\u662F\u5426\u542B\u6709\u4E0D\u826F\u4FE1\u606F\uFF0C\u8D34\u5B50\u5728\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85","-70":"\u60A8\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u4E3A\u4E86\u63A7\u5236\u5E7F\u544A\u8D34\uFF0C\u9700\u8981\u901A\u8FC7\u5BA1\u6838\u540E\u624D\u80FD\u53D1\u5E03\u3002\u767B\u9646\u7F72\u540D\u53D1\u8D34\u4E0D\u53D7\u6B64\u9650\u5236\u3002","-71":"\u60A8\u53D1\u8868\u7684\u5E16\u5B50\u592A\u957F\u4E86\u3002\u4E3A\u4E86\u9632\u6B62\u704C\u6C34\uFF0C\u9700\u7CFB\u7EDF\u5BA1\u6838\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u7A0D\u540E\u67E5\u770B","default":"\u60A8\u53D1\u8868\u7684\u8D34\u5B50\u5DF2\u7ECF\u6210\u529F\u63D0\u4EA4\uFF0C\u4F46\u7CFB\u7EDF\u9700\u8981\u6838\u5B9E\u8BE5\u8D34\u5B50\u5185\u5BB9\u662F\u5426\u542B\u6709\u4E0D\u826F\u4FE1\u606F\uFF0C\u8D34\u5B50\u5728\u5BA1\u6838\u901A\u8FC7\u540E\u624D\u80FD\u663E\u793A\uFF0C\u8BF7\u60A8\u8010\u5FC3\u7B49\u5F85"},handlerMap:{}}});
;_.Module.define({path:"common/widget/PostService",requires:["PostResultHandlerManager","ucenter/widget/LikeTip","tbmall/widget/TbeanSafe","pcommon/widget/ParamsXssHandler"],sub:{_defaultData:{ie:"utf-8",kw:"",fid:"",tid:"",vcode_md5:"",floor_num:0,rich_text:1,tbs:0,content:""},posting:!1,submitUrl:{thread:"/f/commit/thread/add",reply:"/f/commit/post/add",vpostThread:"/vpost/addthread",vpostReply:"/vpost/addpost",timeaxisThread:"/frsstar/commit/agency/addTimeline",timeaxisVpostThread:"",repost:"/relay/commit",guessingThreadNew:"/tbmall/guess/add",repostNew:"/relay/commitNew"},initial:function(){var t=this;this.resultHandlerManager=this.use("PostResultHandlerManager"),this.paramsXssHandler=this.requireInstance("pcommon/widget/ParamsXssHandler"),this.bind("retry",function(e,s){t._retryHandler(s)}),this.bind("retryPost",function(e,s){t.retryPost(s)}),this.bind("uegPostParameter",function(){t.uegPostParameter()})},isPosting:function(){return this.posting},post:function(t,e,s){this.postDataCache=e,this.postContextCache=s,this.postTypeCache=t;var r=this;if(this.posting)return this;this.posting=!0;var i=$.extend({},this._defaultData);s&&$.extend(i,this._extractDataFromContext(s)),$.extend(i,e),i.__type__=t;var a=this.submitUrl[t];return $.ajax({type:"post",url:a,data:this.paramsXssHandler.xssFilter(i),success:function(t){var e=r.resultHandlerManager.getHandler(t.err_code||t.no);e.call(r,t,i)},error:function(){$.tb.alert({title:"\u53D1\u8D34\u5931\u8D25",message:"\u7F51\u901F\u6709\u70B9\u4E0D\u7ED9\u529B\u54E6~\u8BF7\u5C1D\u8BD5\u91CD\u65B0\u63D0\u4EA4\u4E00\u4E0B\u5427\uFF01",buttons:[{text:"\u786E\u5B9A",callback:function(){r.trigger("complete")}}]})},complete:function(){r.posting=!1},dataType:"json"}),this},_extractDataFromContext:function(t){return{kw:t.forum.name,fid:t.forum.id,tid:t.thread?t.thread.id:0,tbs:t.tbs,floor_num:t.floor}},_retryHandler:function(t){this.post(t.__type__,t)},success:function(t){return this.bind("success",t),this},error:function(t){return this.bind("error",t),this},complete:function(t){return this.bind("complete",t),this},uegPostParameter:function(){$.extend(this._defaultData,{ueg_complain_flag:1})},retryPost:function(){this.post(this.postTypeCache,this.postDataCache,this.postContextCache)},retry:function(t){return this._retryHandler=t,this}}});_.Module.define({path:"common/component/image_exif",requires:[],sub:{initial:function(){},getOrientation:function(t){if(null==t)return 0;for(var e=0,r=0;e+3<t.length&&255==(255&t[e++]);){var i=255&t[e];if(255!=i&&(e++,216!=i&&1!=i)){if(217==i||218==i)break;if(r=this.pack(t,e,2,!1),2>r||e+r>t.length)return 0;if(225==i&&r>=8&&1165519206==this.pack(t,e+2,4,!1)&&0==this.pack(t,e+6,2,!1)){e+=8,r-=8;break}e+=r,r=0}}if(r>8){var a=this.pack(t,e,4,!1);if(1229531648!=a&&1296891946!=a)return 0;var n=1229531648==a,s=this.pack(t,e+4,4,n)+2;if(10>s||s>r)return 0;e+=s,r-=s;for(var o=this.pack(t,e-2,2,n);o-->0&&r>=12;){if(a=this.pack(t,e,2,n),274==a){var c=this.pack(t,e+4,4,n),h=this.pack(t,e+8,c,n);switch(h){case 1:return 0;case 3:return 180;case 6:return 90;case 8:return 270}return 0}e+=12,r-=12}}return 0},pack:function(t,e,r,i){var a=1;i&&(e+=r-1,a=-1);for(var n=0;r-->0;)n=n<<8|255&t[e],e+=a;return n},rotateByorientation:function(t,e){var r=new FileReader,i=this;t.size||this.trigger("success",t),r.onload=function(){var r=this.result,a=new Uint8Array(r),n=i.getOrientation(a);i.trigger("degreeloaded",n),e||i.rotateFile(t,n)},r.readAsArrayBuffer(t)},rotateFile:function(t,e){if(90!=e&&180!=e&&270!=e)return this.trigger("success",t),void 0;var r=new FileReader,i=this;r.onload=function(){var t=this.result,r=new Image;r.onload=function(){i.rotateImage(r,e)},r.src=t},r.readAsDataURL(t)},rotateImage:function(t,e){var r=document.createElement("canvas"),i=r.getContext("2d"),a=t.width,n=t.height;i.save(),90==e||270==e?(r.width=n,r.height=a,90==e?i.translate(r.width,0):i.translate(0,r.height)):(r.width=a,r.height=n,i.translate(r.width,r.height)),i.rotate(e*Math.PI/180),i.drawImage(t,0,0,a,n),i.restore(),this.trigger("success",r)}}});_.Module.define({path:"common/component/ImageUploader",requires:["common/component/image_exif"],sub:{_url:"",_xhr:null,_active:!1,_successFilter:null,_variable:null,_MAX_SIZE:3145728,initial:function(t,e,i){this._url=t,this._successFilter=e||null,i=i||{},this._compressWidth=i.maxWidth||3e3,this._compressHeight=i.maxHeight||3e3},_createHXR:function(){var t=this,e=this._successFilter;this._xhr=new XMLHttpRequest,this._xhr.onload=function(){var i;try{i=$.parseJSON(t._xhr.responseText)}catch(r){i=t._xhr.responseText}e?e(i)?t.trigger("success",t._xhr,i):t.trigger("error",t._xhr,i):t.trigger("success",t._xhr,i)},this._xhr.onerror=function(){t.trigger("error",t._xhr)},this._xhr.onabort=function(){t.trigger("abort",t._xhr)},this._xhr.upload.onprogress=function(e){t.trigger("progress",e.loaded,e.total)}},_dataURLtoBlob:function(t){for(var e=atob(t.split(",")[1]),i=t.split(",")[0].split(":")[1].split(";")[0],r=new ArrayBuffer(e.length),o=new Uint8Array(r),s=0;s<e.length;s++)o[s]=e.charCodeAt(s);var n=window.MozBlobBuilder||window.WebKitBlobBuilder||window.BlobBuilder;if(n){var a=new n;return a.append(r),a.getBlob(i)}return Blob?new Blob([r],{type:i}):null},_compressFormDataURI:function(t,e){var i=this._dataURLtoBlob(t),r=i.size,o=this;if(e>=r)o._uploadBlob(i);else{var s=new Image,n=document.createElement("canvas");s.onload=function(){var t=o._getCompressSize(s.width,s.height);n.width=t.width,n.height=t.height,n.getContext("2d").drawImage(s,0,0,s.width,s.height,0,0,t.width,t.height),s.onload=null,s.src="about:blank",s=null;var a=n.toDataURL("image/jpeg",(e/r).toFixed(1));n.getContext("2d").clearRect(0,0,t.width,t.height),n.width=n.height=0,n=null,i=o._dataURLtoBlob(a),i.size>e?o.trigger("error"):o._uploadBlob(i)},s.src=t}},_uploadBlob:function(t){var e=new FormData,i=this._variables;if(i&&"object"==typeof i)for(var r in i)e.append(r,i[r]);e.append("file",t),this._active=!0,this._xhr||this._createHXR(),this._xhr.open("POST",this._url,!0),this._xhr.withCredentials=!0,this._xhr.send(e),i&&i.html5stat&&$.stats.sendRequest("fr=tb0&st_type=html5upload&st_value=send")},_getCompressSize:function(t,e){var i=this._compressWidth,r=this._compressHeight,o=t/e,s={};return t>i||e>r?o>i/r?(s.width=i,s.height=i/o):(s.height=r,s.width=r*o):s={width:t,height:e},s},setVariable:function(t){this._variables=t},upload:function(t,e,i){if(t){e="undefined"==typeof e?this._MAX_SIZE:e;var r,o=this;if(t.getContext)r=i?t.toDataURL(i):t.toDataURL("image/jpeg",.8),t.getContext("2d").clearRect(0,0,t.width,t.height),t.width=t.height=0,t=null,o._compressFormDataURI(r,e);else if(t.size){var s=this.use("common/component/image_exif");s.bind("success",function(s,n){if(n.getContext)o.upload(n,e,i);else if(t.size>e){var a=new FileReader;a.onload=function(t){a.onload=null,r=t.target.result,o._compressFormDataURI(r,e)},a.readAsDataURL(n)}else o._uploadBlob(n)}),s.rotateByorientation(t)}}},abort:function(){this._active&&(this._xhr.abort(),this._active=!1)},distroy:function(){this.abort(),this.unbind("success"),this.unbind("error"),this.unbind("abort"),this.unbind("progress"),this._xhr=null}}});_.Module.define({path:"common/widget/image_uploader_manager/uploader_flash",requires:[],sub:{initial:function(t){var a={container:null,width:200,height:50,isAutoUp:!1,queueLen:10,maxParallel:2,maxSize:3145728,maxWidth:1e3,maxHeight:1e3,uploadUrl:"",getUploadParams:null};this._options=$.extend(a,t||{}),this._token=this._makeToken(),this._flashVars="",this._version="1_0_1_3",this._EVENTS=["onFileSelected","onStartUpload","onProgressListen","onComplete","onError"],this._reset()},_reset:function(){this._initFlashvars(),this._generateCallBack(),this._initUI()},_initFlashvars:function(){this._flashVars=["maxSize="+encodeURIComponent(this._options.maxSize),"maxWidth="+encodeURIComponent(this._options.maxWidth),"maxHeight="+encodeURIComponent(this._options.maxHeight),"isAutoUp="+encodeURIComponent(this._options.isAutoUp),"queueLen="+encodeURIComponent(this._options.queueLen),"maxParallel="+encodeURIComponent(this._options.maxParallel),"useWorker=false","uploadURL="+encodeURIComponent(this._options.uploadUrl),"get_upload_params="+(this._options.get_upload_params?encodeURIComponent(this._options.get_upload_params):"")].join("&")},_initUI:function(){var t,a=this._flashChecker(),e=a.version,o="flashUploader"+this._token;a.hasFlash||this._flashError(),t=e[0]<11||e[1]<4?"http://tb2.bdstatic.com/tb/static-common/img/uploader/uploaderwithoutworker_ade2e66.swf":"http://tb2.bdstatic.com/tb/static-common/img/uploader/uploader_66720f8.swf";var i='<object id="'+o+'" name="'+o+'" classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000" codebase="https://download.macromedia.com/pub/shockwave/cabs/flash/swflash.cab#version=9,0,0,0" width="'+this._options.width+'" height="'+this._options.height+'"><param name="allowScriptAccess" value="always" /><param value="transparent" name="wmode"><param name="flashvars" value="'+this._flashVars+'" /><param name="allowFullScreen" value="false" /><param name="movie" value="'+t+'" /></object>',n='<object id="'+o+'" type="application/x-shockwave-flash" data="'+t+'" width="'+this._options.width+'" height="'+this._options.height+'"><param name="allowScriptAccess" value="always" /><param value="transparent" name="wmode"><param name="flashvars" value="'+this._flashVars+'" /></object>';this._options.container||(this._options.container=$("<div>").appendTo(document.body).css({position:"absolute",width:"1px",height:"1px",overflow:"hidden",left:1,bottom:1})),-1!=navigator.appName.indexOf("Microsoft")?this._options.container.html(i):this._options.container.html(n),this.flash=document[o]||window[o]},_generateCallBack:function(){for(var t=this,a=0;a<this._EVENTS.length;a++){var e=this._EVENTS[a],o=e+this._token;window[o]=function(a){return function(){var e=Array.prototype.slice.call(arguments,0);e.unshift(a),t.trigger.apply(t,e)}}(e),this._flashVars+="&"+this._decodeCamel(e)+"="+o}},_decodeCamel:function(t){return t.replace(/([A-Z])/g,function(t,a){return"_"+a.toLowerCase()})},start:function(){this.flash.startUpload()},stop:function(){this.flash.pauseUpload()},deleteFile:function(t){this.flash.deleteFile(t)},clearList:function(){this.flash.clearList()},reUploadError:function(t){this.flash.resetErrorStatus(t)},_flashChecker:function(){var t,a,e=!1,o=$.browser.msie;return o?(a=new ActiveXObject("ShockwaveFlash.ShockwaveFlash"),a&&(e=!0,t=a.GetVariable("$version"))):navigator.plugins&&navigator.plugins.length>0&&(a=navigator.plugins["Shockwave Flash"],a&&(e=!0,t=a.description)),{hasFlash:e,version:t.match(/\d+/g)}},_flashError:function(){$.dialog.alert('\u68C0\u6D4B\u5230\u60A8\u7684\u6D4F\u89C8\u5668\u6CA1\u6709\u5B89\u88C5\u6700\u65B0Adobe Flash Player\u63D2\u4EF6\uFF0C\u8FD9\u4F1A\u5F71\u54CD\u60A8\u8BBF\u95EE\u672C\u9875\u9762\u7684\u90E8\u5206\u529F\u80FD\u3002<br /><center>\u8BF7<a href="http://get.adobe.com/cn/flashplayer/" target="_blank">\u70B9\u6B64</a>\u5B89\u88C5</center>')},_makeToken:function(){var t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return t()+t()+"_"+t()+t()+t()},uploadBase64:function(t,a){var e="flashUploadBase64_"+this._makeToken();window[e]=function(t){return function(a){t(a)}}(a),this.flash.uploadBase64(t,e)}}});
;_.Module.define({path:"common/widget/image_uploader_manager/uploader_html5",requires:["common/component/ImageUploader"],sub:{initial:function(e){var t={container:null,width:200,height:50,isAutoUp:!1,queueLen:10,maxParallel:16,maxSize:3145728,limitSize:10485760,maxWidth:1e3,maxHeight:1e3,uploadUrl:"",getUploadParams:null};this._options=$.extend(t,e||{}),this._uploadQueue=[],this._fileStatusArr=[],this._currentUploadNum=0,this._uploadTimer=null,this._activeTotal=0,this._typeFilter="image/jpeg, image/jpg, image/png, image/gif, image/bmp",this._reset()},start:function(){this._trigger("onStartUpload"),this._startProgress()},stop:function(){this._stopProgress()},deleteFile:function(e){for(var t=0;t<this._uploadQueue.length;t++){var i=this._uploadQueue[t];if(i&&i.id==e){i.uploader.distroy(),i.isStarted&&i.percent<100&&this._activeTotal--,this._uploadQueue.splice(t,1);break}}},clearList:function(){this._uploadQueue.length=0},reUploadError:function(e){this._resetErrorStatus(e),this.start()},_reset:function(){this._initUI(),this._bindEvents()},_initUI:function(){this._fileInput=$('<input type="file" id="multi_file" style="display:none" multiple accept="'+this._typeFilter+'" />').get(0)},_bindEvents:function(){var e=this;this._fileInput.onclick=function(){e._fileInput.value=""},this._fileInput.onchange=function(){e._selectFile(e._fileInput.files)},this._options.container&&this._options.container.bind("click",function(){e._fileInput.value="",e._fileInput.click()})},_selectFile:function(e){for(var t=[],i=0,r=e.length;r>i&&i<this._options.queueLen;i++){var n=e[i];""!=n.type&&this._typeFilter.indexOf(n.type)>=0&&t.push(this._add(n))}this._trigger("onFileSelected",{imageList:t,percent:0})},_add:function(e){var t,i=this,r=i._uploadQueue,n={name:e.name,size:e.size,id:"img_"+this._makeToken()+"_"+r.length+"_"+e.type,percent:0,status:"",errorCode:0,errorMessage:null,source:e,isStarted:!1};return r.push(n),e.size>this._options.limitSize?(n.errorCode=1,n.errorMessage="\u6587\u4EF6\u5927\u5C0F\u8D85\u51FA\u9650\u5236",this._trigger("error",n),n.percent=100,n.isStarted=!0,n):(t=i.use("common/component/ImageUploader",this._options.uploadUrl,null,{maxWidth:this._options.maxWidth,maxHeight:this._options.maxHeight}),n.uploader=t,t.id=n.id,t.bind("success",this._uploadedHandler,this),t.bind("error",this._uploadedHandler,this),t.bind("progress",function(e){return function(t,i,r){e.percent=Math.min(e.percent+parseInt(20*i/r,10),99)}}(n)),n)},_upload:function(){for(var e=0,t=!0,i=0;i<this._uploadQueue.length;i++){var r=this._uploadQueue[i];r&&(r.percent<100&&(t=!1),this._activeTotal<this._options.maxParallel&&!r.isStarted&&(r.isStarted=!0,r.percent=5,this.getUploadParams&&r.uploader.setVariable(this.getUploadParams(r.id)),r.uploader.upload(r.source,this._options.maxSize),this._activeTotal++),r.percent<50&&(r.percent+=5),e+=r.percent/this._uploadQueue.length)}t?(this._percent=100,this.stop(),this._trigger("onComplete")):(this._percent=parseInt(e,10),this._trigger("onProgressListen"))},_uploadedHandler:function(e,t,i){var r=e.target.id;this._activeTotal--;var n=this._getFileById(r);return n?("error"==e.type&&(n.errorCode=2,n.errorMessage="\u7F51\u7EDC\u9519\u8BEF",this._trigger("error",n),n.percent=100),"success"==e.type&&(n.response=i.data||i||null,n.percent=100),e.target.unbind("success",this._uploadedHandler),e.target.unbind("error",this._uploadedHandler),void 0):!1},_trigger:function(e,t){this.trigger(e,t||{imageList:this._uploadQueue,percent:this._percent})},_getFileById:function(e){for(var t=0;t<this._uploadQueue.length;t++){var i=this._uploadQueue[t];if(i&&i.id==e)return i}return null},_resetErrorStatus:function(e){for(var t=0;t<this._uploadQueue.length;t++){var i=this._uploadQueue[t];if(i&&0!==i.errorCode&&(!e||e&&i.id==e)&&(i.percent=0,i.errorCode=0,i.errorMessage=null,i.isStarted=!1,i.response=null,e))break}},_startProgress:function(){if(!this._uploadTimer){var e=this;this._uploadTimer=setInterval(function(){e._upload()},1e3)}},_stopProgress:function(){clearInterval(this._uploadTimer),this._uploadTimer=null},_makeToken:function(){var e=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)};return e()+e()+"_"+e()+e()+e()}}});
;_.Module.define({path:"common/widget/image_uploader_manager",requires:["common/widget/image_uploader_manager/uploader_flash","common/widget/image_uploader_manager/uploader_html5"],sub:{initial:function(t){var e={container:null,width:200,height:50,isAutoUp:!1,queueLen:10,needWatermark:!1,fid:"",maxSize:3145728,maxWidth:3e3,maxHeight:3e3,uploadUrl:"http://upload.tieba.baidu.com/upload/pic",getUploadParams:null,tbsUrl:"http://tieba.baidu.com/dc/common/imgtbs",isFlash:!1,save_yun_album:0};this._options=$.extend(e,t||{}),this.uploader=null,this.EVENTS=["onFileSelected","onStartUpload","onProgressListen","onComplete","onError"],this._reset()},_initUploadUrl:function(t){var e=this;if(this._options.uploadUrl.indexOf("tbs")>0)return t&&t.apply(e),void 0;var o=$.ajax({url:this._options.tbsUrl,dataType:"json"});o.done(function(o){0===Number(o.no)?(e._options.uploadUrl+="?tbs="+o.data.tbs+(e._options.isWater?"&is_wm=1":"")+"&fid="+(e._options.fid||"")+"&save_yun_album="+e._options.save_yun_album,t&&t.apply(e)):t&&e._error()}).fail(function(){t&&e._error()})},_reset:function(){var t=navigator.userAgent.toLowerCase().match(/chrome\/([\d]+)/);t&&parseInt(t[1])>=21||$.browser.mozilla||$.browser.safari||(this._options.isFlash=!0),this._initUploadUrl(this._startImageUploader)},_startImageUploader:function(){this._options.isFlash?this.uploader=this.use("common/widget/image_uploader_manager/uploader_flash",this._options):this._options.container&&(this.uploader=this.use("common/widget/image_uploader_manager/uploader_html5",this._options)),this._options.container&&this._generateCallBack()},_generateCallBack:function(){for(var t=this,e=0;e<this.EVENTS.length;e++){var o=this.EVENTS[e];this.uploader.bind(o,function(e){return function(o,a){t.trigger(e,a||o)}}(o))}},start:function(){this.uploader.start()},startUpload:function(){this.uploader.start()},stop:function(){this.uploader.stop()},stopUpload:function(){this.uploader.stop()},deleteFile:function(t){this.uploader.deleteFile(t)},clearList:function(){this.uploader.clearList()},reUploadError:function(t){this.uploader.resetErrorStatus(t)},uploadBase64:function(t,e){var o=this;this._options.isFlash?this._flashUploadBase64(t,e):this._initUploadUrl(function(){o._ajaxUploadBase64(t,e)})},_ajaxUploadBase64:function(t,e){var o=this;$.ajax({url:o._options.uploadUrl+"&_token="+(new Date).getTime(),data:{filetype:"base64",file:t},type:"POST",success:function(t){e.call(o,{errorCode:0,errorMessage:"",response:t})},error:function(t){e.call(o,{errorCode:1,errorMessage:"\u4E0A\u4F20\u5931\u8D25",response:t})},dataType:"json"})},_flashUploadBase64:function(t,e){var o=this;this.uploader&&this.uploader.uploadBase64?this.uploader.uploadBase64(t,e):setTimeout(function(){o._flashUploadBase64(t,e)},100)},_error:function(t){t=$.extend({percent:0,errorCode:400,errorMessage:"\u521D\u59CB\u5316\u51FA\u9519",imageList:{}},t||{}),this.trigger("onError",t)}}});_.Module.define({path:"common/widget/tchargeDialog",requires:[],sub:{initial:function(t){var e=this;e.requireInstanceAsync("common/widget/Tdou",[],function(a){t&&t.chargeType&&"platform"==t.chargeType?a.factory("payment",t):(t&&(e.consumption_path=t.consumption_path,e.desc=t.desc,e.current_need_tdou=t.current_need_tdou,e.is_direct_cashier=t.is_direct_cashier),t&&e.is_direct_cashier?a.factory("auto_direct",t):a.factory("get_icon",e.consumption_path||""))})},_tbmallCashier:function(){var t=window.open("");$.get("/tbmall/getPayUrl?terminal=pc&pay_type=2",function(e){e.data&&(t.location.href=e.data)})}}});_.Module.define({path:"user/widget/Icons",requires:["IconCard","IconsBookView","IconsBookTip","IconsBookControl","IconsBookCommon"],sub:{initial:function(){this._buySlot=$(".j_icon_slot_buy"),this._icon_book_wrap=$(".j_book_icon"),this.common=this.use("IconsBookCommon"),PageUnit.load("icons_category")},getPreIconHtml:function(e,i){var t,a=["\u8D34\u5427\u4F1A\u5458","\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458"],n="",r=Math.round((new Date).getTime()/1e3);return Env.server_time>13962816e5&&Env.server_time<1396368e6&&4!=i?(n='<div class="pre_icon_wrap pre_icon_wrap_theme1">',t=2,n+='<a class="icon_tbworld tbworld_lv'+t+'" href="/tbmall/home" target="_blank" title="'+a[t-1]+'"></a>',n+="</div>"):(e&&e.level&&e.level.end_time>r&&(n='<div class="pre_icon_wrap pre_icon_wrap_theme1">',t=e.level.props_id,n+='<a class="icon_tbworld tbworld_lv'+t+'" href="/tbmall/home" target="_blank" title="'+a[t-1]+'"></a>',n+="</div>"),n)},getIconsHtml:function(e,i,t){var t=t?t:5,a=e.new_iconinfo,n=0;for(var r in a)n++;var l='<span class="icon_wrap  icon_wrap_theme1">',o=0;if(!a){var s=e.iconinfo;if(s){var _=s[0];l+=this._getOldHtml(_,1)}}for(var c in a){var m=a[c];if(o==t)break;if($.isEmptyObject(m)){if("1"==c){var s=e.iconinfo;if(!$.isEmptyObject(s)){var _=this._getReplaceIcon(s,a);if(!_)continue;l+=this._getOldHtml(_,1),o++}}}else this.common.isShowDurationIcon(m)&&(l+=this._getIconHtml(m,1),o++)}return l+="</span>"},_getReplaceIcon:function(e,i){if($.isEmptyObject(i))return e[0];for(var t=0;t<e.length;t++){var a=e[t];if(!this._judgeIconInNewiconinfo(i,a))return a}return null},_judgeIconInNewiconinfo:function(e,i){if($.isEmptyObject(e))return!1;if($.isEmptyObject(i))return!1;for(var t in e){var a=e[t];if(a&&a.name==i.name)return!0}return!1},_imgSize:{1:14,2:18},_oldIconTitle:{is_lottery_1:"\u94C1\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_lottery_2:"\u94DC\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_lottery_3:"\u94F6\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_lottery_4:"\u91D1\u724C\u4E16\u754C\u676F\u8FBE\u4EBA",is_coreuser_1:"\u8D34\u5427\u6838\u5FC3\u7528\u6237",is_verify_1:"\u767E\u5EA6\u8D34\u5427\u5B98\u65B9\u5E73\u53F0\u8BA4\u8BC1",user_type_1:"\u8D34\u5427\u5B9E\u540D\u8BA4\u8BC1",is_battle_1:"\u8D34\u5427\u62F3\u738B",is_welfare_1:"\u798F\u5229\u5370\u8BB0"},_getOldHtml:function(e,i){var t="",a=e.sprite[e.value];if(!a)for(var n in e.sprite){if(e.sprite[n]&&(0!=e.value||"meizhi_level"==e.name)){a=e.sprite[n];break}return t}var r=e.icon+"?stamp="+a.split(",")[0];switch(background='style="background: url('+r+") no-repeat center center; filter: progid:DXImageTransform.Microsoft.AlphaImageLoader(src="+r+',sizingMethod=scale); background-size: 14px 14px"',e.name){case"meizhi_level":var l=e.value;l=l?l:0,l>=2&&(l-=2,t+='<a class="old_icon_size" '+background+' class="maizhi_link" href="/p/'+e.meizhi_thread_id+'" target="_blank" title="\u8D34\u5427\u59B9\u7EB8\u8BA4\u8BC1"><span class="icon_meizhi meizhi_level_'+l+'"></span></a>');break;case"is_member":t+='<a class="old_icon_size" '+background+' target="_blank"  class=" icon_fanclub"  title="\u7C89\u4E1D\u4F1A\u5458"></a>';break;default:t+=e.title_url?'<a class="old_icon_size" '+background+' target="_blank"  href="'+e.title_url+'"  title="'+e.title+'"  locate="'+e.name+"_"+e.value+'"> </a>':'<span class="old_icon_size" '+background+' title="'+this._oldIconTitle[e.name+"_"+e.value]+'"  locate="'+e.name+"_"+e.value+'"></span>'}return t},_getIconHtml:function(e,i){var t,a,n,r,l,i=i||1,o=50,s="",_="http://tb1.bdstatic.com/tb/cms/com/icon/";if(t=e.sprite[e.value],!t)for(var c in e.sprite){if(e.sprite[c]&&(0!=e.value||"meizhi_level"==e.name)){t=e.sprite[c];break}return s}a=t.split(","),n=a[0],r=a[1];var m=_+e.category_id+"_"+this._imgSize[i]+".png?stamp="+n;switch(l='style="background: url('+m+") no-repeat -"+r*o+"px  -"+(i-1)*o+'px;"',e.name){case"meizhi_level":var u=e.value;u=u?u:0,u>=2&&(u-=2,s+="<a "+l+' class="maizhi_link" href="/p/'+e.meizhi_thread_id+'" target="_blank" title="\u8D34\u5427\u59B9\u7EB8\u8BA4\u8BC1"><span class="icon_meizhi meizhi_level_'+u+'"></span></a>');break;case"is_member":s+="<a "+l+' target="_blank"  class=" icon_fanclub" ></a>';break;default:if(e.title_url)s+="<a "+l+' target="_blank"  href="'+e.title_url+'"  title="'+e.title+'"  locate="'+e.name+"_"+e.value+'"> </a>';else{{e.title}s+="<span "+l+' title="'+e.title+'"  locate="'+e.name+"_"+e.value+'"></span>'}}return s}}});
;_.Module.define({path:"user/widget/Icons/IconsBookControl",requires:["IconsBookView","IconsBookTip","IconCard","IconsBookMessagebox","IconsBookGetIcon"],sub:{_icon_book:null,_icon_book_ajax:null,_icon_user_action:"",_icon_tab_loaded:{},_tip:null,_messagebox:null,tabLen:0,_slot_no:0,_icon_info:{},_current_tab_index:0,_selected_icon_name:"",_target_ele:null,_option:{width:655},_slot_buy_price:[0,0,100,1e4,3e4,5e4,1e4,2e4,1e5],initial:function(){var o=this;o._wrap=$("body"),o._view=o.use("user/widget/Icons/IconsBookView");var e=PageData.category_info,t=e.category_list||[{category_id:"101",category_name:"\u8DB3\u7403"},{category_id:"102",category_name:"\u661F\u5EA7"},{category_id:"104",category_name:"\u5176\u4ED6"}];o.defaultCategoryId=o._getDefaultCategoryId(e.default_category),o.bindIconBookHookEvents(t)},bindIconBookHookEvents:function(o){var e=this;e._wrap.delegate(".j_icon_slot_buy","mouseenter",function(){e.__timeoutId&&clearTimeout(e.__timeoutId),e.closeAllCard(),e._icon_user_action="buy_slot",e._target_ele=$(this),e._selected_icon_name="";var o=$(".j_icon_slot").length;return e._slot_no=1,e.buySlot({add_slot_no:o+1,price:e._slot_buy_price[o+1],action:"buy_slot"},$(this)),!1}),e._wrap.delegate(".j_icon_slot_buy","mouseleave",function(){return e.__timeoutId&&clearTimeout(e.__timeoutId),e.__timeoutId=setTimeout(function(){e._messagebox&&e._messagebox.hideBox()},200),!1}),e._wrap.delegate(".j_icon_slot","click",function(t){e.closeAllCard(),e._setIconRefresh($(this)),e._icon_user_action="replace_icon",e._target_ele=$(this);var _=$(this).tbattr("data-slot"),a=$(this).tbattr("data-name");e._selected_icon_name=a,e._slot_no=_;var i="",n={};for(var c in n)n[c].name==a&&(i=n[c].category_id);e.initIconBook({slot_no:_,category_info:o,icon_id:a,action:"replace_icon",category_id:i},$(this)),t.preventDefault()}),e._wrap.delegate(".j_slot_null_icon","click",function(t){t.preventDefault(),e.closeAllCard(),e._selected_icon_name="",e._setIconRefresh($(this)),e._icon_user_action="buy_icon",e._target_ele=$(this);var _=$(this).tbattr("data-slot");e._slot_no=_;e.initIconBook({slot_no:_,category_info:o,icon_id:"",action:"buy_icon"},$(this))}),e._wrap.delegate(".j_icon_slot","hover",function(o){var e=$(this);if(!e.hasClass("j_slot_null_icon")){var t=$(this).tbattr("data-name"),_=($(this).tbattr("data-slot"),{});if(_){var a=null;for(var i in _)if(_[i].name==t){a=_[i];break}if(a&&a["level_"+a.value]){var n=a["level_"+a.value],c="url("+n.icon_1+") no-repeat",r=o||event;if("mouseenter"==r.type){var s={background:c},l=e.css("background");l||(l=e[0].style.background),e.data({bg:l}),e.css(s),e.addClass("icon_slot_hover"),e.children(".j_icon_slot_refresh").addClass("icon_slot_refresh_hover")}else{var l=e.data("bg"),s={background:l};e.css(s),e.removeClass("icon_slot_hover"),e.children(".j_icon_slot_refresh").removeClass("icon_slot_refresh_hover")}}}}})},buySlot:function(o,e){var t=this;t._messagebox||(t._messagebox=t.use("user/widget/Icons/IconsBookMessagebox")),t._messagebox.is_leave_close=!0,t._messagebox.showBox(o,e)},initIconBook:function(o,e){var t=this,_=o.category_info;t.closeIconBook();var a=t._view.getTabItem(_),i={content:a,card_css:{width:t._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:e,attr:"id='icon_book_tab'",wrap:$("body")};if(t._icon_book=t.use("user/widget/Icons/IconCard",i),t._icon_book.showCard({type:"delayShow",time:200}),t.initTab(),o.icon_id){var n=t._getTabIdByCategory(o.category_id);t._selected_icon_name=o.icon_id,t._showTab(n,o.icon_id)}else t._showTab(t._getDefaultIndex(t.defaultCategoryId));$.stats.track("\u5370\u8BB0\u4E2D\u5FC3\u6D6E\u5C42","icon_system")},closeIconBook:function(){var o=this;o._tip&&o._tip.closeTip(),o._icon_book&&(o._icon_book.closeCard(),o._icon_book=null)},initTab:function(){var o=this;o.tabLen=$(".icon_book_tab_head li").length,o._bindHeadEvents()},_bindHeadEvents:function(){var o=this;$(".icon_book_tab_head").delegate("li","click",function(){var e=$(this).index();o._showTab(e),o._tip&&o._tip.hideTip()}),$(".icon_book_close").click(function(){return $("#icon_book_tab").remove(),o._tip&&(o._tip.hideTip(),o._tip=null),$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh"),!1}),$(".icon_book_close").hover(function(){$(this).addClass("icon_book_close_hover")},function(){$(this).removeClass("icon_book_close_hover")})},_showTab:function(o,e){var t=this;$(".icon_book_tab_head .head_inner").each(function(){!$(this).hasClass("space")&&$(this).parent().index()<t.tabLen-1&&$(this).addClass("space")}),0>o?"0":$("#tab_head_"+(o-1)+" div.space").removeClass("space"),$(".icon_book_tab_head li.tab_active").removeClass("tab_active").addClass("tab_deactive"),$("#tab_head_"+o).removeClass("tab_deactive").addClass("tab_active"),$(".icon_book_tab_body div.tab_body_item_active").removeClass("tab_body_item_active"),$("#tab_content_"+o).addClass("tab_body_item_active"),e=e||t._selected_icon_name,t._loadTabContent(o,e),t._current_tab_index=e},_loadTabContent:function(o,e){var t=this,_='<div class="icon_book_error">\u6B63\u5728\u52AA\u529B\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E...</div>';$("#tab_content_"+o).html(_);var a={ie:"utf-8"},i=$("#tab_head_"+o).tbattr("data-categoryId");a.tbs=PageData.tbs,a.category_id=i,t._icon_book_ajax&&t._icon_book_ajax.abort(),t._icon_book_ajax=$.ajax({type:"post",url:"/icon/submit/icon",data:a,dataType:"json"}).success(function(_){if(_&&0===_.no){var a=_.data,n=a.icon_info,c=t._view.getTabContent(n,e,i);$("#tab_content_"+o).html(c),t._bindTabContenEvent(o),t.initScroll(o),t._icon_tab_loaded[o]=!0,t._icon_info["category_"+o]=a.icon_info}else{var c='<div class="icon_book_error">\u672A\u77E5\u9519\u8BEF<a href="javascript:void(0)" id="icon_book_reload" class="icon_book_reload">\u5237\u65B0</a></div>';$("#tab_content_"+o).html(c),$("#icon_book_reload").on("click",function(){return t._loadTabContent(o),!1})}})},_bindTabContenEvent:function(){var o=this;o._tip||(o._tip=o.use("user/widget/Icons/IconsBookTip",[o]));var e=$("#icon_book_wrap");e.on("mouseenter",".tab_body_item_active .icon_box_place",function(){$(this).children(".icon_border").addClass("icon_border_hover")}).on("mouseleave",".tab_body_item_active .icon_box_place",function(){$(this).children(".icon_border").removeClass("icon_border_hover")}),e.delegate(".icon_wrap .icon_box_place","mouseenter",function(){var e=o._target_ele.tbattr("data-name"),t=$(this).tbattr("data-id"),_=$(this).tbattr("data-level"),a=$(this).hasClass("icon_not_use"),i=$(".icon_book .tab_body_item_active")[0].id.replace("tab_content_",""),n=o._icon_info["category_"+i],c=null,r=null;if(n){n=n.normal||[];for(var s=0;s<n.length;s++)n[s].name==t&&(c=n[s]),e&&n[s].name==e&&(r=n[s])}var l={icon_id:t,in_use:!a,slot_no:o._slot_no,value:_,icon_info:c,old_icon_id:e,old_icon_info:r};o._tip.showTip(l,$(this))}),e.delegate(".icon_view","mouseleave",function(){setTimeout(function(){o._tip&&o._tip.hideTip&&o._tip.hideTip()},1500)}),e.delegate(".collect_icon_wrap .icon_box_place","mouseenter",function(){if(!($(this).children(".icon_locked").length>0)){var e=o._target_ele.tbattr("data-name"),t=$(this).tbattr("data-id"),_=$(this).tbattr("data-level"),a=$(this).hasClass("icon_not_use"),i=$(".icon_book .tab_body_item_active")[0].id.replace("tab_content_",""),n=o._icon_info["category_"+i],c=null,r=null;if(n){n=n.advanced||[];for(var s=0;s<n.length;s++)n[s].name==t&&(c=n[s]),e&&n[s].name==e&&(r=n[s])}var l={icon_id:t,in_use:!a,slot_no:o._slot_no,value:_,icon_info:c,old_icon_id:e,old_icon_info:r};o._tip.showTip(l,$(this))}}),e.delegate(".collect_icon_wrap .icon_box_place","mouseleave",function(){setTimeout(function(){o._tip.hideTip()},6e3)})},_getTabIdByCategory:function(o){for(var e=this,t=$(".icon_book_tab_head li"),_=0;_<t.length;_++)if($(t[_]).tbattr("data-categoryId")==o)return _;return e._getDefaultIndex(e.defaultCategoryId)},_getDefaultCategoryId:function(o){var e="";for(var t in o)e=t;return e},_getDefaultIndex:function(o){for(var e=$(".icon_book_tab_head li"),t=0;t<e.length;t++)if($(e[t]).tbattr("data-categoryId")==o)return t},initScroll:function(o){var e=this,t=$("#tab_content_"+o+" .icon_wrap");t&&t.length>0&&e.bindArrowScrollEvent("icon_wrap");var _=$("#tab_content_"+o+" .collect_icon_wrap");_&&_.length>0&&e.bindArrowScrollEvent("collect_icon_wrap")},bindArrowScrollEvent:function(o){var e=this;$("."+o).delegate(".icon_wrap_scroll_arrow","hover",function(){$(this).hasClass("arrow_disable")||$(this).toggleClass("arrow_hover")}),$("."+o).delegate(".right_arrow","click",function(){e._move("left",o),e._tip&&e._tip.hideTip()}),$("."+o).delegate(".left_arrow","click",function(){e._move("right",o),e._tip&&e._tip.hideTip()})},_move:function(o,e){var t=this,_=0,a=$($(".tab_body_item_active ."+e+" .icon_view")[0]).tbattr("total-col");switch(a=parseInt(a),o){case"left":_=t._moveLeft(a,e);break;case"right":_=t._moveRight(a,e)}_&&$(".tab_body_item_active .icon_wrap .icon_list").animate({left:_},300);var i=55*a;_&&(_=Math.abs(parseInt(_)),_+550>=i?($(".tab_body_item_active ."+e+" .icon_wrap_right_arrow").addClass("arrow_disable"),$(".tab_body_item_active ."+e+" .icon_wrap_left_arrow").removeClass("arrow_disable")):($(".tab_body_item_active ."+e+" .icon_wrap_right_arrow").removeClass("arrow_disable"),$(".tab_body_item_active ."+e+" .icon_wrap_left_arrow").removeClass("arrow_disable")),0==_&&($(".tab_body_item_active ."+e+" .icon_wrap_right_arrow").removeClass("arrow_disable"),$(".tab_body_item_active ."+e+" .icon_wrap_left_arrow").addClass("arrow_disable")))},_moveLeft:function(o,e){var t=0,_=o;if(!(10>=_)){var a=55*_,i=$(".tab_body_item_active ."+e+" .icon_list").css("left"),n=Math.abs(parseInt(i));n%55!=0&&(n=n%55*55);var c=a-n;if(c>550)return t=n+165,"-"+t+"px"}},_moveRight:function(o,e){var t=0,_=o;if(!(10>=_)){var a=$(".tab_body_item_active ."+e+" .icon_list").css("left"),i=parseInt(a);if(!(i>=0))return t=Math.abs(i)-165,0>t&&(t=0),"-"+t+"px"}},closeAllCard:function(){var o=this;o._tip&&o._tip.closeTip(),o._messagebox&&o._messagebox.hideBox(),o.closeIconBook(),o._removeIconRefresh()},_setIconRefresh:function(o){$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh"),o.children(".j_icon_slot_refresh").addClass("icon_slot_refresh")},_removeIconRefresh:function(){$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh")}}});
;_.Module.define({path:"user/widget/Icons/IconsBookGetIcon",requires:["IconsBookCommon"],sub:{_dialog:null,initial:function(){this.common=this.use("IconsBookCommon")},get:function(){return this._dialog},show:function(){this._dialog.show()},hide:function(){this._dialog.hide()},close:function(){this._dialog.close()},_init:function(o){var i={modal:!0,showTitle:!1,fixed:!0,width:290,height:180},n=this;i.html='<div class="icon_book_dialog_wrap">'+o+"</div>",this._dialog=new $.dialog(i),this._dialog.element.find(".icon_book_dialog_wrap .icon_book_msgbox_close").click(function(o){o.preventDefault(),n._dialog.close()}),this._dialog.element.find(".icon_book_dialog_wrap .icon_book_msgbox_close").hover(function(){$(this).addClass("icon_book_msgbox_close_hover")},function(){$(this).removeClass("icon_book_msgbox_close_hover")})},getOneIcon:function(o){var i=this;if(!o)return i._handleError(),void 0;var n={ie:"utf-8"};n.tbs=PageData.tbs,n.icon_name=o,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/seticon",data:n,dataType:"json"}).success(function(o){if(o&&0===o.no){var n=o.data;if(!n.icon_info)return i._handleError(),void 0;i.showOneIcon(n.icon_info)}else o&&2270028===o.no||i._handleError()})},_handleError:function(){var o=this,i=o._getErrorTpl();o._init(i),o.show(),this._dialog.element.find(".icon_book_dialog_wrap .ui_btn").click(function(){$.tb.location.reload()})},showOneIcon:function(o){var i=this,n=i._getOneIconTpl(o);i._init(n),i.show()},_getOneIconTpl:function(o){if(o){var i=this._getIconStyle(o),n={styleBg:i,iconTitle:o.title},s=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u606D\u559C\u4F60\u83B7\u5F97\u4E86#{iconTitle}</div>','<div class="icon_msgbox_get_icon">','<div class="msg_icon_get_one" style="left:110px;background: #{styleBg}"></div>','<div class="msg_icon_get_two"></div>','<div class="msg_icon_get_three"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u5FEB\u53BB\u770B\u770B\u6211\u7684\u56FE\u9274</em></span>","</a>","</div>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return $.tb.format(s,n)}},showDurationIcon:function(o,i){var n=[];n.push(o),this.showIconList(n,i,"duration")},showIconList:function(o,i,n){var s=this,t={hide_btn:!1,close_callback:function(){},close_time:0};t=$.extend(t,i);var c=s._getIconListTpl(o,t.hide_btn,n);s._init(c),s.show(),t.close_time&&parseInt(t.close_time)>0&&setTimeout(function(){s._dialog.close()},parseInt(t.close_time)),t.close_callback&&"function"==typeof t.close_callback&&s._dialog.onclose(function(){t.close_callback()})},_getIconListTpl:function(o,i,n){var s=this,t=PageData.user.portrait;if(o||$.isArray(o)){for(var c=[],e=[],a="",_=i?"":['<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u5FEB\u53BB\u770B\u770B\u6211\u7684\u56FE\u9274</em></span>","</a>","</div>"].join(""),l=0;l<o.length;l++){var d=s._getIconFormatInfo(o[l],o.length);c.push(d.iconTitle),e.push(d.iconTpl)}if(c=c.join(","),e=e.join(""),n&&"duration"==n){var r=this.common.getIconExpired(o[0]);r>-1&&(a="<span>\u6709\u6548\u5929\u6570\uFF1A"+r+"</span><br>")}var v=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u606D\u559C\u4F60\u83B7\u5F97\u4E86'+c+"</div>",'<div class="icon_msgbox_get_icon clearfix">',e,"</div>",_,'<p class="icon_book_go_home">',a,'<a href="/home/main?id='+t+'&fr=icon" target="_blank">\u53BB\u6211\u7684\u4E2A\u4EBA\u4E2D\u5FC3\u67E5\u770B>></a>',"</p>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return v}},_getIconFormatInfo:function(o,i){var n=this._getIconStyle(o),s={iconTpl:'<div class="msg_icon_get msg_icon_get_'+parseInt(i)+'" style="left:110px;'+n+'"></div>',styleBg:n,iconTitle:o.title};return s},_getIconStyle:function(o){var i=0,n=0,s="http://tb1.bdstatic.com/tb/cms/com/icon/icon_sprite.png",t=o.sprite[o.value].split(","),c=50,e=t[0],a=t[1];i=2*c,n=a*c;var _="background: url("+s+"?stamp="+e+") no-repeat -"+n+"px -"+i+"px;";return _},_getErrorTpl:function(){var o=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">','<div class="icon_msgbox_title">\u672A\u77E5\u9519\u8BEF</div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;">',"<span><em>\u5237\u65B0</em></span>","</a>","</div>","</div>",'<div class="icon_book_msgbox_close"></div>',"</div>","</div>"].join("");return o}}});
;_.Module.define({path:"user/widget/Icons/IconsBookTip",requires:["IconCard","IconsBookMessagebox","IconsBookCommon"],sub:{_icon_book_tip:null,_icon_data:null,_ajax:null,_control:null,_msgbox:null,_option:{width:"535px"},_is_show:!1,spriteImgSize:36,initial:function(o){var i=this;i.common=this.use("IconsBookCommon"),i._control=o[0]},getControl:function(){return this._control},showTip:function(o,i){if(o){var n=this,e=$("#icon_book_tip");0==e.length&&$(".icon_card_wrap").append(this._getWrapTpl()),e=$("#icon_book_tip"),n._setContent(o);var t=$(".j_icon_book_tip .j_tip_up_arrow"),s=i.position(),c=s.top,a=s.left-5,r=i.parents(".icon_view"),p=r.position(),l=parseInt(p.left)+15,d=c+106;i.parents(".collect_wrap").length>0&&(d+=146),e.css({display:"block",visibility:"visible",top:d+"px",left:l+"px","z-index":2e4});var u=parseInt(a)+25;t.css({left:u+"px"}),n._bindEvents(),$(".icon_book_tip .j_tip_icon_price").html("\u6D88\u8017"+o.icon_info.price+"T\u8C46"),n._icon_data=o,$("#j_icon_book_action_btn").one("click",function(){var i=!0,e=0,t=PageData.user.Parr_scores;t&&(e=t.scores_other+t.scores_money);var s=-1;if(s=n._icon_data.price?n._icon_data.price:n._icon_data.icon_info.price,s>0&&0>e-s&&(i=!1,$(".icon_book_tip .icon_action_wrap").html(n._getNoRemainTip()),$("#j_icon_book_recharge_btn").click(function(){_.Module.use("common/widget/TchargeDialog")})),o.in_use)1==parseInt(o.slot_no)?n._replaceIcon4FirstSlot(o):n._replaceIcon4OtherSlot(o);else if(i){var c=$("#j_icon_book_action_btn em");c.length>0&&c.html("\u8D2D\u4E70\u4E2D"),n._buyIconRequest(o)}})}},hideTip:function(){var o=this;o._is_show||o.closeTip()},closeTip:function(){tip=$("#icon_book_tip"),(tip||0!=tip.length)&&tip.remove()},_bindEvents:function(){var o=$("#icon_book_tip"),i=this;o.bind("mouseenter",function(){i._is_show=!0}).bind("mouseleave",function(){i._is_show=!1,i.hideTip()})},_replaceIcon4FirstSlot:function(o){var i=this;i._control.closeIconBook(),i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox"));var n=$(".icon_wrap .icon_slot_refresh");i._msgbox.showReplaceFirstSlotBox(o,n,i._replaceIcon4OtherSlot,i)},_replaceIcon4OtherSlot:function(o){var i=this,n={ie:"utf-8"};n.tbs=PageData.tbs,n.icon_name=o.icon_id,n.slot_no=o.slot_no,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/seticon",data:n,dataType:"json"}).success(function(o){if(o&&0===o.no){var n=o.data;i._refreshAfterReplace(n.icon_info)}else if(o&&2270028===o.no)i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox")),i._msgbox.hasNotEnoughTdou();else;})},_refreshAfterReplace:function(){var o=this;setTimeout(function(){o.closeTip()},0),o._msgbox||(o._msgbox=o.use("user/widget/Icons/IconsBookMessagebox")),o._msgbox.replaceIconSuccess(o)},_buyIcon:function(o){var i=this;i._control.closeIconBook(),i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox"));var n=$(".icon_wrap .icon_slot_refresh");i._msgbox.showBuyIconBox(o,n,i._buyIconRequest,i)},_buyIconRequest:function(o){var i=this,n={ie:"utf-8"};n.tbs=PageData.tbs,n.icon_name=o.icon_id,n.level=o.value,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/buyIcon",data:n,dataType:"json"}).success(function(o){if(o&&0===o.no){var n=o.data;parr=PageData.user.Parr_scores,parr.scores_fetch=n.scores_fetch||0,parr.scores_money=n.scores_money||0,parr.scores_other=n.scores_other||0,parr.scores_total=n.scores_total,$(".j_userinfo_scores_num").html(parr.scores_money+parr.scores_other);for(var e=$(".tab_body_item_active .icon_view .icon_box_place"),t=0;t<e.length;t++){var s=$(e[t]);if(s.tbattr("data-id")==n.icon_name){s.removeClass("icon_not_use"),s.find(".j_icon_subscript").removeClass("icon_locked"),i.closeTip();break}}}else if(o&&2270028===o.no)i._msgbox||(i._msgbox=i.use("user/widget/Icons/IconsBookMessagebox")),i._msgbox.hasNotEnoughTdou();else;})},_refreshAfterBuy:function(o){this._refreshAfterReplace(o)},_setContent:function(o){var i=this._getTpl(o);$("#icon_book_tip").html(i)},_getWrapTpl:function(){var o=['<div id="icon_book_tip" class="icon_tip_card_wrap">',"</div>"].join("");return o},_getNoRemainTip:function(){var o=['<div class="icon_action" style="padding-top: 10px">','<div class="j_tip_icon_price tip_icon_price" style="height: 12px; margin-bottom:5px;display: block">T\u8C46\u4E0D\u8DB3</div>','<a href="javascript:void(0)" id="j_icon_book_recharge_btn" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;"><span><em>\u5145\u503C</em></span></a>',"</div>"].join("");return o},_getTpl:function(o){var i=this,n=o.icon_info,e=n.sprite[n.value].split(","),t=50,s=e[0],_=e[1],c=0,a=_*t,r="http://tb1.bdstatic.com/tb/cms/com/icon/"+n.category_id+"_"+i.spriteImgSize+".png",p=" background:url("+r+"?stamp="+s+") no-repeat -"+a+"px -"+c+"px;",l="",d=i.common.getIconExpired(n);d>-1&&(l='<span style="margin-left: 20px;">\u5269\u4F59\u65F6\u95F4\uFF1A'+d+"\u5929</span>");var u=n.title,b=n.intro,m=n.intro_url,v={background_img:p,desc_title:u+l||"\u5370\u8BB0",desc_detail:b||"",desc_link:m||"http://tieba.baidu.com/",btn_value:o.in_use?"\u66FF\u6362":"\u8D2D\u4E70",price_info_display:1==o.in_use?"none":"block",padding_top:o.in_use?"20":"10",in_use_display:"none",in_use_text:"",button_display:0==o.in_use&&0==n.price?"none":"block"};i._judgeCommIconInSlot(o.icon_id)&&(v.button_display="none"),"none"==v.button_display&&(v.in_use_display="display",v.in_use_text="\u4F7F\u7528\u4E2D",v.price_info_display="none"),0==o.in_use&&0==n.price&&(v.in_use_text="\u6D3B\u52A8\u83B7\u53D6");var g=['<div class="icon_book_tip j_icon_book_tip">','<div class="tip_up_arrow j_tip_up_arrow"></div>','<div class="tip_body">','<div class="tip_icon">','<div class="tip_icon_img" style="#{background_img}}"></div>',"</div>",'<div class="icon_desc">','<div class="icon_desc_title"><span>#{desc_title}</span></div>','<div class="icon_desc_detail"><span>#{desc_detail}</span><a href="#{desc_link}"  target="_blank"><span style="padding-left:5px;">\u8BE6\u60C5 >></span></a></div>',"</div>",'<div class="icon_action_wrap">','<div class="icon_action" style="padding-top:#{padding_top}px">','<div class="j_tip_icon_price tip_icon_price" style="height: 12px; margin-bottom:5px;display: #{price_info_display}"></div>','<div class="j_tip_icon_use tip_icon_use" style=" margin-bottom:5px;display: #{in_use_display}">#{in_use_text}</div>','<a href="javascript:void(0)" id="j_icon_book_action_btn" class="ui_btn ui_btn_m icon_book_action_btn" style="height: 27px; border-radius: 3px;display: #{button_display}"><span><em>#{btn_value}</em></span></a>',"</div>","</div>","</div>","</div>"].join("");return $.tb.format(g,v)},_judgeCommIconInSlot:function(o){var i={};for(var n in i){var e=this.common.isShowDurationIcon(i[n]);if(i[n].name==o&&e)return!0}return!1}}});
;_.Module.define({path:"user/widget/Icons/IconsBookView",requires:["IconsBookTip","IconsBookCommon"],sub:{tabIconsContentCongfig:{},_collect_icon_title:{101:"\u96C6\u9F5032\u4E2A\u56FD\u65D7\u5370\u8BB0\u5956\u52B1\u3010\u8D34\u5427\u4E16\u754C\u676F\u3011\u5370\u8BB0",102:"\u96C6\u9F5012\u4E2A\u661F\u5EA7\u5370\u8BB0\u53EF\u4EE5\u83B7\u5F9712\u4E2A\u9EC4\u91D1\u7248\u661F\u5EA7\u5370\u8BB0",103:"",104:""},spriteImgSize:36,initial:function(){},_getTabPanelTpl:function(){var o=['<div id="icon_book_wrap" class="_j_icon_book_wrap">','<div  class="icon_book">','<div class="icon_book_tab">','<ul  class="icon_book_tab_head">',"#{tabHead}","</ul>",'<div id="tab_body"  class="icon_book_tab_body">',"#{tabContent}","</div>","</div>","</div>",'<div class="icon_book_close"></div>',"</div>"].join("");return o},getTabItem:function(o){var i=this,t=['<li id="tab_head_#{index}" data-categoryId="#{category_id}" class="tab_deactive">','<div class="head_inner #{separator_cls}">','<button type="button" class="tab_button" hidefocus="true"  > ','<a href="javascript:void(0)">#{title}</a></button></div></li>'].join(""),n=['<div id="tab_content_#{index}" class=" tab_body_item ">',"</div>"].join(""),a="",c="",l=0;for(var e in o)l++;var r=0;for(var e in o){var s={index:r,category_id:e,title:o[e].name,separator_cls:r==l-1?"":"space"};r++,a+=$.tb.format(t,s),c+=$.tb.format(n,s)}var _={tabHead:a,tabContent:c},d=i._getTabPanelTpl();return $.tb.format(d,_)},getTabContent:function(o,i,t){var n="",a="",c=this,l=0,e=0;if(o=o||{},o.normal&&!o.advanced){var r=o.normal||[],s=r.length;return l=5,e=1>=s/50?10:s%l==0?Math.floor(s/l):Math.floor(s/l)+1,n+=c._getPositionIconListHtml(r,e,i,t),a=c._getCommIconWrap(null,l,e,n),c.tabIconsContentCongfig.comm={row:l,col:10,total_col:e},a}if(o.advanced&&o.advanced){var r=o.normal||[],_=o.advanced||[],s=r.length,d=_.length,v="";return l=2,e=1>=s/20?10:s%l==0?Math.floor(s/l):Math.floor(s/l)+1,n+=c._getPositionIconListHtml(r,e,i,t),a=c._getCommIconWrap(null,l,e,n),c.tabIconsContentCongfig.comm={row:l,col:10,total_col:e},a+=c._getDownArrowHtml(),e=1>=d/20?10:s%2==0?Math.floor(d/2):Math.floor(d/2)+1,v+=c._getPositionIconListHtml(_,e,null,t),a+=c._getAdvancedIconWrap(null,l,e,v,t),c.tabIconsContentCongfig.adv={row:l,col:10,total_col:e},a}return a},_getCommIconWrap:function(o,i,t,n){var a={arrow_top:5==i?100:45,arrow_visiblity:t>10?"visible":"hidden",height_cls:5==i?"icon_wrap_5":"",icon_list:n,total_col:t},c=['<div class="icon_wrap #{height_cls}">','<div class="icon_wrap_scroll_arrow icon_wrap_left_arrow arrow_disable" style="visibility: #{arrow_visiblity}">','<div class="left_arrow arrow_block" style=" top:#{arrow_top}px;"></div></div>','<div class="icon_view"  total-col="#{total_col}">','<div class="icon_list_wrap" >','<ul class="icon_list" style="left: 0px;" >',"#{icon_list}","</ul>","</div>","</div>",'<div class="icon_wrap_scroll_arrow icon_wrap_right_arrow " style="visibility: #{arrow_visiblity}">','<div class=" right_arrow arrow_block "  style=" top:#{arrow_top}px;"></div></div>',"</div>"].join("");return $.tb.format(c,a)},_getAdvancedIconWrap:function(o,i,t,n,a){var c=this,l={title:c._collect_icon_title[a],arrow_visiblity:t>10?"visible":"hidden",icon_list:n,total_col:t},e=['<div class="collect_icon_wrap">','<div class="collect_icon_title"><span>#{title}</span></div>','<div class="collect_wrap">','<div class="icon_wrap_scroll_arrow icon_wrap_left_arrow arrow_disable" style="visibility: #{arrow_visiblity}">','<div class="  left_arrow arrow_block" style="top:45px;"></div></div>','<div class="icon_view" total-col="#{total_col}">','<div class="icon_list_wrap" >','<ul class="icon_list" style="left: 0px;" >',"#{icon_list}","</ul>","</div>","</div>",'<div class="icon_wrap_scroll_arrow icon_wrap_right_arrow  " style="visibility: #{arrow_visiblity}">','<div class=" right_arrow arrow_block "  style=" top:45px;"></div></div>',"</div>","</div>"].join("");return $.tb.format(e,l)},_getDownArrowHtml:function(){return'<div class="wrap_donw_arrow"></div>'},_getPositionIconListHtml:function(o,i,t,n){for(var a="",c=this,l=!1,e=o.length,r=0,s=0,_=0;e>_;_++){r=Math.floor(_/i),s=_%i;var d=55*r,v=55*s;l=t&&t==o[_].name?!0:!1;var b="";b=0==o[_].is_advanced?c._getCommonIconTpl(o[_],d,v,n,l):c._getAdvIconTpl(o[_],d,v,n),a+=b}return a},_getCommonIconTpl:function(o,i,t,n,a){var c=this,l=o.sprite[o.value].split(","),e="http://tb1.bdstatic.com/tb/cms/com/icon/"+n+"_"+c.spriteImgSize+".png",r=50,s=l[0],_=l[1],d=0,v=_*r,b="background: url("+e+"?stamp="+s+") no-repeat -"+v+"px -"+d+"px;",p={icon_top:i,icon_left:t,name:o.name,in_use:o.in_use,in_use_cls:1==o.in_use?"":" icon_not_use",selected_cls:a?" icon_selected":"",level:o.value,background:b,locked_cls:0==o.in_use?" icon_locked":""};c._judgeCommIconInSlot(o)&&(p.selected_cls="icon_selected");var u=["<li>",'<div id="icon_book_id_#{name}" data-id="#{name}" data-level="#{level}" class="icon_box_place #{in_use_cls}" style="top: #{icon_top}px; left: #{icon_left}px;">','<div class="icon_box icon_border "></div>','<div class="icon_box icon_icon" style="#{background}"></div>','<div class="j_icon_subscript icon_subscript #{selected_cls} #{locked_cls}" ></div>',"</div>","</li>"].join("");return $.tb.format(u,p)},_judgeCommIconInSlot:function(o){var i=this,t=o.name,n={};for(var a in n){if("1"==a&&$.isEmptyObject(n[a])){var c=this._getOldIconinfoInSlot();if(t==c)return!0}if(n[a].name==t){i.common=this.use("IconsBookCommon");var l=i.common.isShowDurationIcon(o);return l?!0:!1}}return!1},_getOldIconinfoInSlot:function(){var o=$(".j_icon_slot").first();if(o){var i=o.tbattr("data-slot");return i}return null},_getAdvIconTpl:function(o,i,t,n){var a=this,c=o.sprite[o.value].split(","),l=50,e=c[0],r=c[1],s=2*l,s=0,_=r*l,d="http://tb1.bdstatic.com/tb/cms/com/icon/"+n+"_"+a.spriteImgSize+".png",v="background: url("+d+"?stamp="+e+") no-repeat -"+_+"px -"+s+"px;",b=o.is_collected,p={icon_top:i,icon_left:t,name:o.name,in_use:o.in_use,clocked_cls:1==b?" ":" icon_locked",level:o.value,background:v},u=["<li>",'<div id="icon_book_id_#{name}" data-id="#{name}" data-level="#{level}" class="icon_box_place " style="top: #{icon_top}px; left: #{icon_left}px;">','<div class="icon_box icon_border "></div>','<div class="icon_box icon_icon" style="#{background}"></div>','<div class="icon_subscript #{clocked_cls}" ></div>',"</div>","</li>"].join("");return $.tb.format(u,p)},_judgeAdvIconLocked:function(o,i){var t=!1;switch(i=parseInt(i)){case 101:break;case 102:if(o){for(var n=0;n<o.length;n++)if(!o[n].in_use){t=!0;break}t=12==n&&0==t?!1:!0}else t=!0;break;case 103:break;case 104:}return t}}});
;_.Module.define({path:"user/widget/Icons/IconsBookMessagebox",requires:["IconCard","IconsBookCommon"],sub:{_icon_book_message_box:null,_icon_data:null,_is_show:!1,_option:{width:290},is_leave_close:!1,spriteImgSize:36,setLeaveClose:function(o){this.is_leave_close=o},initial:function(){this.common=this.use("IconsBookCommon")},showBox:function(o,i){var s=this;s._showBox(i),s.generatorBuySlot(o),s._bindEvents()},hideBox:function(){var o=this;o._is_show||o._icon_book_message_box&&(o._icon_book_message_box.closeCard(),o._icon_book_message_box=null)},_bindEvents:function(){var o=this,i=$(".icon_card_wrap");i.bind("mouseenter",function(){o.is_leave_close&&(o._is_show=!0)}),i.bind("mouseleave",function(){o.is_leave_close&&(o._is_show=!1,o.hideBox())})},generatorBuySlot:function(o){var i=this,s=i._getBuySlotTpl(o);$(".icon_book_msgbox_body").html(s),$(".icon_book_msgbox .ui_btn").one("click",function(){i.buySlot(o)})},showReplaceFirstSlotBox:function(o,i,s,n){var _=this;setTimeout(function(){n.closeTip()},0),_._showBox(i);var c=_._getReplaceFirstSlotTipTpl(o);$(".icon_book_msgbox_body").html(c),$(".icon_book_msgbox .ui_btn").click(function(){s.call(n,o)})},showBuyIconBox:function(o,i,s,n){var c=this;setTimeout(function(){n.closeTip()},0),c._showBox(i);var e=c._getBuyIconTpl(o);$(".icon_book_msgbox_body").html(e),$(".icon_book_msgbox .ui_btn").click(function(){var i=0,e=PageData.user.Parr_scores;if(e&&(i=e.scores_other+e.scores_money),i-o.icon_info.price<0){var t=c._hasNotEnoughTdou();return $(".icon_book_msgbox_body").html(t),$(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")}),void 0}s.call(n,o.icon_info,function(){var o=c._buyIconSuccess();$(".icon_book_msgbox_body").html(o)})})},buySlot:function(o){var i=this,s=0,n=PageData.user.Parr_scores;n&&(s=n.scores_other+n.scores_money+n.scores_fetch);var c=-1;if(c=o.price?o.price:o.icon_info.price,c>0&&0>s-c){var e=i._hasNotEnoughTdou();return $(".icon_book_msgbox_body").html(e),$(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")}),void 0}var t={ie:"utf-8",slot_no:o.add_slot_no||1};t.tbs=PageData.tbs,i._ajax&&i._ajax.abort(),i._ajax=$.ajax({type:"post",url:"/icon/addslot",data:t,dataType:"json"}).success(function(o){if(o&&0===o.no){var s=o.data,n=i._addSuccess();$(".icon_book_msgbox_body").html(n),i._refreshSlotList();{s.scores_other||0,s.scores_money||0}i._updateTdouAccount(s.scores_other,s.scores_money,s.scores_fetch)}else if(o&&2270028===o.no)i.hasNotEnoughTdou();else{var _='<div class="icon_book_error">\u672A\u77E5\u9519\u8BEF<a href="javascript:void(0)" id="icon_book_reload" class="icon_book_reload">\u5237\u65B0</a></div>';$(".icon_book_msgbox_body").html(_),$("#icon_book_reload").on("click",function(){return $.tb.location.reload(),!1})}})},_updateTdouAccount:function(o,i,s){var n=PageData.user.Parr_scores;n&&(n.scores_other=o,n.scores_money=i,n.scores_fetch=s,$(".j_userinfo_scores_num").html(o+i))},_showBox:function(o){var i=this;i.hideBox();var s=i._getTpl(),n={content:s,card_css:{width:i._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:o,attr:"id='icon_book_message_box'",wrap:$("body")};i._icon_book_message_box=i.use("user/widget/Icons/IconCard",n),i._icon_book_message_box.showCard({type:"delayShow",time:200}),i._bindCloseEvent()},_bindCloseEvent:function(){var o=this;$(".icon_book_msgbox .icon_book_msgbox_close").click(function(){o._icon_book_message_box?(o._icon_book_message_box.closeCard(),o._icon_book_message_box=null):$("#icon_book_message_box").length>0&&$("#icon_book_message_box").remove(),$(".icon_wrap .j_icon_slot_refresh").removeClass("icon_slot_refresh")}),$(".icon_book_msgbox .icon_book_msgbox_close").hover(function(){$(this).addClass("icon_book_msgbox_close_hover")},function(){$(this).removeClass("icon_book_msgbox_close_hover")})},_getTpl:function(){var o=['<div class="icon_book_msgbox">','<div class="icon_book_msgbox_wrap">','<div class="icon_book_msgbox_body">',"</div>",'<div class="icon_book_msgbox_close"></div>',"</div>",'<div class="icon_book_down_arrow"></div>',"</div>"].join("");return o},_refreshSlotList:function(){var o=$(".j_icon_slot").length,i=28*o,s='<a href="javascript:void(0)" data-slot="'+(o+1)+'" data-name="" title="\u70B9\u51FB\u6DFB\u52A0\u5370\u8BB0" class="j_slot_null_icon j_icon_slot icon_slot_null_icon" style="top:0px;left:'+i+'px"><div class=" j_icon_slot_refresh"></div></a>';$(".icon_slot_wrap .icon_add_solt").css({left:28*(o+1)}),$(".icon_slot_wrap .icon_add_solt").before(s),8==$(".j_icon_slot").length&&$(".icon_add_solt").remove()},_addSuccess:function(){var o=['<div class="icon_msgbox_title"></div>','<div class="icon_msgbox_detail">\u606D\u559C\u60A8\u83B7\u5F97\u4E86\u4E00\u679A\u5370\u8BB0\u63D2\u69FD</div>'].join("");return o},_buyIconSuccess:function(){var o=['<div class="icon_msgbox_title">\u606D\u559C\u60A8\u83B7\u5F97\u4E86\u4E00\u679A\u65B0\u5370\u8BB0</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m j_tdou_not_enough" style="height: 27px; border-radius: 3px;"><span><em>\u5FEB\u53BB\u56FE\u9274\u770B\u770B\u5427</em></span></a>',"</div>"].join("");return o},_replaceIconSuccess:function(){var o=['<div class="icon_msgbox_title">\u5370\u8BB0\u66FF\u6362\u6210\u529F</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a  href="javascript:void(0)" class="ui_btn ui_btn_m j_replace_ok" style="height: 27px; border-radius: 3px;"><span><em>\u786E\u5B9A</em></span></a>',"</div>"].join("");return o},_hasNotEnoughTdou:function(){var o=['<div class="icon_msgbox_title">T\u8C46\u4E0D\u8DB3</div>','<div class="icon_msgbox_detail"></div>','<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m j_tdou_not_enough" style="height: 27px; border-radius: 3px;"><span><em>\u7ACB\u5373\u5145\u503C</em></span></a>',"</div>"].join("");return o},_getBuySlotTpl:function(o){var i={price:o.price},s=['<div class="icon_msgbox_title">\u9700\u8981\u6D88\u8017#{price}T\u8C46\u5F00\u542F\u5370\u8BB0\u63D2\u69FD</div>','<div class="icon_msgbox_detail" style="padding-top:15px;">(\u5F00\u542F\u540E\u514D\u8D39\u66F4\u6362\u5370\u8BB0)</div>','<div class="icon_msgbox_action" style="padding-top: 25px;">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px;"><span><em>\u5F00\u542F</em></span></a>',"</div>"].join("");return $.tb.format(s,i)},_getReplaceFirstSlotTipTpl:function(o){var i=this,s=o.old_icon_info,n=o.icon_info,_=this.common.isShowDurationIcon(s),c=_?i._getIconBackground(s):"",e=i._getIconBackground(n),t={old_background:c,background:e},a=['<div class="icon_msgbox_title">\u70B9\u51FB\u66FF\u6362\u5F53\u524D\u5370\u8BB0</div>','<div class="icon_msgbox_icon_replace_detail">','<div class="msg_icon_replace_current" style="#{old_background}"></div>','<div class="msg_icon_replace_arrow"></div>','<div class="msg_icon_replace_new" style="#{background}"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m" style="height: 27px; border-radius: 3px"><span><em>\u66FF\u6362</em></span></a>',"</div>"].join("");return $.tb.format(a,t)},_getIconBackground:function(o){var i=0,s=0,n="http://tb1.bdstatic.com/tb/cms/com/icon/"+o.category_id+"_"+this.spriteImgSize+".png";if(o){var _=o.sprite[o.value].split(","),c=50,e=_[0],t=_[1];i=0,s=t*c;var a="background: url("+n+"?stamp="+e+") no-repeat -"+s+"px -"+i+"px;";return a}return""},_getBuyIconTpl:function(o){var i=this,s=i._getIconBackground(o.icon_info),n={price:o.icon_info.price,background:s},_=['<div class="icon_msgbox_title">\u9700\u8981\u6D88\u801710000T\u8C46\u8D2D\u4E70\u8BE5\u5370\u8BB0</div>','<div class="icon_msgbox_icon_buy">','<div class="msg_icon_buy_icon" style="#{background}}"></div>',"</div>",'<div class="icon_msgbox_action">','<a href="javascript:void(0)" class="ui_btn ui_btn_m">',"<span><em>\u8D2D\u4E70</em></span>","</a>","</div>"].join("");return $.tb.format(_,n)},hasNotEnoughTdou:function(o){var i=this;o||(o=$(".icon_wrap .j_icon_slot_refresh")),i._showBox(o);var s=i._hasNotEnoughTdou();$(".icon_book_msgbox_body").html(s),$(".j_tdou_not_enough").on("click",function(){_.Module.use("common/widget/TchargeDialog")})},replaceIconSuccess:function(o){var i=this,s=$(".icon_wrap .icon_slot_refresh");s&&(s=s.parent()),i._showBox(s);var n=i._replaceIconSuccess();if($(".icon_book_msgbox_body").html(n),$(".icon_book_msgbox_body .j_replace_ok").on("click",function(){$.tb.location.reload()}),$(".icon_book_msgbox .icon_book_msgbox_close").click(function(){$.tb.location.reload()}),o){var _=o.getControl();_&&_.closeIconBook()}}}});
;_.Module.define({path:"user/widget/Icons/IconsBookCommon",requires:[],sub:{initial:function(){},isDurationIcon:function(e){return e?4==e.type?!0:!1:!1},getIconExpired:function(e){var n=-1;if(!e)return n;var r=e.type,t=e.end_time,i=Env.server_time/1e3;return 4==r&&t>=i&&(n=((t-i)/86400).toFixed(1)),n},isShowDurationIcon:function(e){if(!e)return!1;var n=e.type,r=e.end_time,t=Env.server_time/1e3;return 4!=n?!0:r>=t?!0:!1}}});
;_.Module.define({path:"user/widget/Icons/IconCard",sub:{_option:{},_j_card:null,_open_timer:null,_close_timer:null,_is_show:!1,_is_first_show:!0,_default_option:{content:"",arrow_dir:"down",arrow_pos:{},card_css:{width:170,"z-index":1001},arrow_req:!0,auto_positon:!1,event_target:null,offset:{x:0,y:0},card_leave_display:!1,card_hover_show:!0,card_leave_hide:!1,attr:"",wrap:$("body")},initial:function(t){var i=this;i._option=$.extend(!0,{},i._default_option,t),this._buildCard()},_buildCard:function(){var t=this._option,i=this._genericTpl(),e=t.wrap;this._j_card=$(i),this._j_card.find(".j_content").html(t.content),e.append(this._j_card),delete t.card_css.height,this._j_card.css(t.card_css),t.card_css.height=this._j_card.find(".j_content").outerHeight(!0),this._arrow=this._j_card.find(".j_ui_white_arrow"),void 0===t.arrow_pos.left&&(this._arrow_left=t.card_css.width/2-10,this._arrow.css({left:this._arrow_left})),this._arrow.css(t.arrow_pos),t.arrow_req||this._j_card.find(".j_ui_white_arrow").hide(),t.auto_positon&&this._autoPosition()},_autoPosition:function(){var t=this._option,i={},e=$(window).height(),_=$(window).width(),o=($(document).scrollLeft(),$(document).scrollTop()),r=(t.event_target.innerWidth(),t.event_target.innerHeight()),s="",a={x:t.event_target.offset().left-t.card_css.width/2+t.event_target.outerWidth(!0)/2,y:t.event_target.offset().top-t.card_css.height-10,width:this._j_card.innerWidth(),height:this._j_card.innerHeight()+this._arrow.innerHeight()};i.left=a.x,i.top=a.y;var n=t.arrow_pos.left||this._arrow_left,d=15,h=_;_<$(document).width()&&(h=$(document).width());var c=h-(t.card_css.width+d);i.left<d?(n+=i.left-d,i.left=d):i.left>c&&(n+=i.left-c,i.left=c),i.top<o?(s="up",i.top+=r+(a.height||0),i.top-=t.offset.y):(i.top+=i.top+r>o+e?-r-(a.height||0):0,s="down",i.top+=t.offset.y),this._arrow.removeClass("icon_white_down").removeClass("icon_white_up").addClass("icon_white_"+s).css({left:n}),this._j_card.css(i)},_genericTpl:function(){var t=this._option.attr,i=this._option.arrow_dir,e=['<div class="icon_card_wrap" '+t+' style="visibility: hidden">','<div class="j_content icon_card_content ">',"</div>",'<span class="j_ui_white_arrow arrow icon_white_'+i+'"></span>',"</div>"].join("");return e},showCard:function(t){var i=this;i._close_timer&&clearTimeout(i._close_timer),t&&"delayShow"==t.type?(i._open_timer&&clearTimeout(i._open_timer),i._open_timer=setTimeout(function(){i._showCardDo()},t.time)):i._showCardDo()},closeCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayClose"==t.type?i._close_timer=setTimeout(function(){i._closeCardDo()},t.time):i._closeCardDo()},hideCard:function(t){var i=this;i._open_timer&&clearTimeout(i._open_timer),t&&"delayHide"==t.type?i._close_timer=setTimeout(function(){i._hideCardDo()},t.time):i._hideCardDo()},_showCardDo:function(){var t=this;t._is_first_show,this._j_card.css({visibility:"visible"})},_closeCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.remove()},_hideCardDo:function(){var t=this;this._j_card&&!this._is_show&&t._j_card.css({visibility:"hidden"})},setContent:function(t){var i=this._option;if(null!==this._j_card){var e=this._j_card.find(".j_content");e.html(t),i.card_css.height=e.outerHeight(!0),this._j_card.css({height:i.card_css.height}),i.auto_positon&&this._autoPosition()}}}});_.Module.define({path:"common/widget/MemberApi",sub:{initial:function(){},getMemberNameClass:function(e,i){var r="";return Env.server_time>13962816e5&&Env.server_time<1396368e6&&4!=i?r=" vip_red ":(e&&e.level&&e.level.end_time>Env.server_time/1e3&&(r=" vip_red "),r)}}});_.Module.define({path:"user/widget/myCurrentForum",sub:{initial:function(e){this._opt=e,this.forum=PageData.forum,this.bindEvents()},bindEvents:function(){var e=this;$(".user_level .badge, .user_level .badge_block").bind("click",function(){return window.open("/f/like/level?kw="+e.forum.name_url+"&lv_t=lv_nav_intro"),!1}),$(".user_level .exp_bar").bind("click",function(){return window.open("/f/like/level?kw="+e.forum.name_url+"&lv_t=lv_nav_who"),!1})}}});_.Module.define({path:"user/widget/tbSpam",requires:[],sub:{initial:function(){$("body").append($("#tb_spam_notice_html").html())}}});_.Module.define({path:"user/widget/myTieba",requires:["common/widget/wallet_dialog","common/widget/Card","common/widget/tcharge_dialog"],sub:{config:{url:{dolike:"/f/like/commit/add",undolike:"/f/like/commit/delete",closetip:"/f/like/commit/notice/delete"}},initial:function(e){var i=this,t=e||{};i.user=PageData.user,i.forum=PageData.forum,i.balvInfo=t.balvInfo,i.style=t.style||"",i.isBySys=t.isBySys||!0,i.scoreTip=null,i.daysTofree=0,i.block_bubble=null,i.product=t.product||null},init:function(){var e=this;e.user.forbidden?e.daysTofree=e.user.forbidden.days_to_free:e.user.balv&&(e.daysTofree=e.user.balv.days_tofree),-1!=$.inArray(e.product,["frs","pb"])&&(_.Module.use("ueglibs/widget/Ban",[],function(i){e.BanLib=i}),this.user.is_login&&e.showOfflineCard()),this.user.is_login&&(this.bindEvents(),$(".user_profile .sign_highlight").length>0&&this.show_orange_tip(),this.showNewpropsTip()),this.dolikeEvent()},showOfflineCard:function(){var e=this,i=1*new Date;i>1408032e6||$.tb.Storage.get("balv_tdou_update")>i||(this.offline_card=this.use("common/widget/Card",{content:'<span style="cursor:pointer;position: absolute;width: 10px; height: 10px; right: 5px; top: 6px;" class="j_close"></span><a target="_blank" class="j_link" href="/p/3199708402"><img style="margin: 4px 4px 0;" src="http://tb1.bdstatic.com/tb/static-ucenter/img/offline1.png"></a>',clazz:"doupiao_offline",arrow_dir:"left",card_css:{width:172,"z-index":1010,left:198,top:9},arrow_pos:{left:-7,top:20},wrap:$(".user_profile"),card_leave_display:!0}),this.offline_card._j_card.on("click",".j_close",function(){$.tb.Storage.set("balv_tdou_update",i+864e5),e.offline_card._j_card.remove()}).on("click",".j_link",function(){$.tb.Storage.set("balv_tdou_update",i+864e5),e.offline_card._j_card.remove()}),this.offline_card.showCard())},bindEvents:function(){var e=this;if($("#user_info").on("click",".j_score_num",function(i){i.preventDefault(),e.requireInstance("common/widget/wallet_dialog").show()}),$(".userliked_ban_content").on("click.bawuAppealLink",".j_appealLink",function(){$.stats.track("balvAppealLink","uegCount","bawuAppeal","click")}),$(".userlike_blacked").bind("mouseover",function(){e.show_black_tip($(this))}),$(".userlike_prisoned").bind("mouseover",function(){e.daysTofree>0&&e.daysTofree<360?e.show_shortblock_tip($(this),e.daysTofree,e.isBySys?"\u7CFB\u7EDF":"\u5427\u4E3B",e.isBySys?"system":"bawu"):e.show_block_tip($(this))}),$("body").delegate(".tbmall_tip_close","click",function(){return $("#tbmall_tip_card").remove(),e.tbmallTip=null,$.cookie("close_tbmall_tip","1",{expires:365}),!1}),$("#j_tcharge_dialog").on("click",function(){$.stats.track(e.formatForm(),"\u4F1A\u5458\u5B98\u7F51\u7EDF\u8BA1"),e.use("common/widget/tcharge_dialog")}),this.user.balv&&this.user.balv.has_liked||this.user.is_like)if(PageData.is_ipad)$("a.p_balv_btnmanager").show();else{var i=$(".p_balv_btnmanager");$(".my_tieba_mod").hover(function(){i.show()},function(){i.hide()})}$("#my_tieba_mod").find(".user_name").find(".icon_tbworld").on("click",function(){switch(e.product){case"frs":e._postTrack("\u7687\u51A0","\u4F1A\u5458\u5065\u5EB7\u7EDF\u8BA1","click",{obj_name:"FRS\u6211\u5728\u8D34\u5427\u7687\u51A0\u70B9\u51FB"});break;case"pb":e._postTrack("\u7687\u51A0","\u4F1A\u5458\u5065\u5EB7\u7EDF\u8BA1","click",{obj_name:"PB\u53F3\u4FA7\u6211\u5728\u8D34\u5427\u7687\u51A0\u70B9\u51FB"});break;case"index":e._postTrack("\u7687\u51A0","\u4F1A\u5458\u5065\u5EB7\u7EDF\u8BA1","click",{obj_name:"\u9996\u9875\u5DE6\u4FA7\u6211\u5728\u8D34\u5427\u7687\u51A0\u70B9\u51FB"})}})},formatForm:function(){var e=this,i="";return i=e.product?e.product:e.urlFormat(),i+"\u83B7\u53D6T\u8C46"},urlFormat:function(){return location.href.split("/").pop()},dolikeEvent:function(){var e=this;$(".balv_dolike_comforum,.balv_dolike_star").bind("click",function(){return e.user.is_login?e.user.balv&&e.user.balv.is_block||e.user.forbidden&&e.user.forbidden.isForbid?e.showAlert(e.BanLib.render("balvLike")):e.user.balv&&e.user.balv.is_black||e.user.is_black?e.showAlert("\u4F60\u88AB\u5427\u4E3B\u52A0\u5165\u672C\u5427\u9ED1\u540D\u5355\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C"):e.dolike():_.Module.use("common/widget/LoginDialog",["","ilike"]),!1})},showAlert:function(e){var i='<div style="padding:20px 20px; text-align:cente; line-height:20px;font-size:13px;">'+e+"</div>";$.dialog.open(i,{title:"\u64CD\u4F5C\u5931\u8D25",width:380})},howtojoin:function(){$.dialog.alert("<div style='padding:20px;line-height:30px;padding-bottom:0px;'>\u70B9\u51FB\u53F3\u4FA7\u4E0A\u65B9\u201C<img align='absmiddle' src='"+PageData.staticDomain+"tb/static-member/img/whatlevel.png'></img>\u201D<br/>\u5373\u53EF\u52A0\u5165\u672C\u5427\uFF0C\u70B9\u4EAE\u5934\u8854\uFF0C\u4ECE\u521D\u7EA7\u7C89\u4E1D\u5F00\u59CB\u6210\u957F\uFF01</div>",{title:"\u5982\u4F55\u52A0\u5165",width:325})},dolike:function(){var e=this;if(this.user.is_login&&this.user.no_un)return TbCom.process("User","buildUnameFrame","\u586B\u5199\u7528\u6237\u540D","\u6709\u7528\u6237\u540D\u624D\u80FD\u70B9\u4EAE\u201C\u6211\u5173\u6CE8\u201D\uFF0C\u8D76\u5FEB\u7ED9\u81EA\u5DF1\u8D77\u4E00\u4E2A\u5427~"),!1;var i={fid:this.forum.forum_id,fname:$.tb.escapeHTML(this.forum.forum_name),uid:this.user.name_url,ie:"gbk",tbs:PageData.tbs};$.post(this.config.url.dolike,i,function(i){if(i&&0==i.no)_.Module.use("ucenter/widget/LikeTip",["",!1,{index:i.data.ret.index,like_no:i.like_no}]);else{var t="";t=8==i.no||9==i.no?e.BanLib.render("balvLike"):220==i.no?"\u4F60\u88AB\u5427\u4E3B\u52A0\u5165\u9ED1\u540D\u5355\uFF0C\u6682\u65F6\u4E0D\u80FD\u8FDB\u884C\u64CD\u4F5C":221==i.no?"\u4F60\u5DF2like\u4E86\u672C\u5427,\u8BF7\u4E0D\u8981\u91CD\u590D\u64CD\u4F5C":"\u62B1\u6B49\uFF0C\u5F02\u5E38\u9519\u8BEF\uFF0C\u5EFA\u8BAE\u5237\u65B0\u9875\u9762\u91CD\u8BD5\u4E00\u4E0B",e.showAlert(t)}},"json")},undolike:function(){var e={fid:this.forum.forum_id,fname:$.tb.escapeHTML(this.forum.forum_name),uid:this.user.name_url,ie:"utf-8",tbs:PageData.tbs};$.tb.post(this.config.url.undolike,e,function(e){e&&0==e.no&&$.tb.location.reload(!0)})},show_shortblock_tip:function(e){this.block_render(e,this.BanLib.render("balvAside"))},show_block_tip:function(e){this.block_render(e,this.BanLib.render("balvAside"))},show_black_tip:function(e){var i=new Array;i.push("<div style='width:180px;text-align:left;margin:6px 0px 6px 10px;'>"),i.push("<span>\u4F60\u5DF2\u88AB\u5427\u4E3B\u62C9\u5165\u9ED1\u540D\u5355\uFF0C</span></br><span>\u4F60\u5728\u672C\u5427\u7684\u5934\u8854\u548C\u6743\u9650\u4E5F\u88AB\u6536\u56DE\u3002</span>"),i.push("</div>"),this.block_render(e,i.join(""))},show_lvup_tip:function(e,i){var t=this,o=new Array;if(o.push("<div class='lvup_tip_container'>"),o.push("<div class='lvlup_con_msg'>\u5347\u7EA7\u5566!\u4F60\u5DF2\u62E5\u6709\u672C\u5427"+e+"\u7EA7\u5934\u8854!</div>"),o.push('<div class="lvlup_pop_rights">'+i+"</div>"),"\u52A0\u6CB9~\u7EE7\u7EED\u6512\u7ECF\u9A8C\uFF01"==i)o.push("<a style='float:left;' href='/f/like/level?kw="+this.forum.name_url+"' target='_blank'>\u67E5\u770B\u5347\u7EA7\u79D8\u7B08</a>");else{var s='Stats.sendRequest("fr=tb0_forum&st_mod=frs&st_type=balvupguide&lv='+e+'")';o.push("<a href='#sub' style='float:left;' onclick='rich_postor.jumpToTry("+e+");"+s+"'>\u73B0\u5728\u53BB\u8BD5\u8BD5~~</a>")}o.push("</div>");var l=o.join(""),n={content:l,arrow_dir:"up",bubble_css:{top:4,right:-5,width:232,"z-index":9999},arrow_pos:{left:209},attr:"lvup_tip_table",wrap:$("#userlike_info_tip"),closeBtn:!0},r=new UiBubbleTipBase(n);r.j_bubble.find(".j_content").css("padding","2px").addClass("lvup_tip_table"),r.showBubble(),r.bind("onclose",function(){t.close_lvup_tip()},!0),this.user.is_block||setTimeout(function(){r.closeBubble(),t.close_lvup_tip()},8e3)},block_render:function(e,i){if(!this.block_bubble){var t=this,o={content:i,arrow_dir:"up",bubble_css:{top:36,right:4,width:232,"z-index":9999},arrow_pos:{left:209},attr:"",wrap:e,closeBtn:!0};this.block_bubble=new UiBubbleTipBase(o),this.block_bubble.j_bubble.find(".j_content").css("padding","2px"),this.block_bubble.showBubble(),this.block_bubble.bind("onclose",function(){t.block_bubble.closeBubble(),t.block_bubble=null});{setTimeout(function(){t.block_bubble&&(t.block_bubble.closeBubble(),t.block_bubble=null)},5e3)}}},close_lvup_tip:function(){var e={fid:this.forum.forum_id,fname:this.forum.name_url,uid:this.user.name_url,ie:"utf-8",tbs:PageData.tbs,type:2};$.tb.post(this.config.url.closetip,e,function(e){e&&0==e.no})},show_orange_tip:function(){if("false"!=$.cookie("close_sign_tip_o")){$.cookie("close_sign_tip_o",!0,{expires:14});var e={content:"\u8FDE\u7EED\u7B7E\u523030\u5929ID\u5373\u53EF\u9AD8\u4EAE\u5C55\u793A\uFF0C\u4E00\u8D77\u95EA\u8000\u5427\uFF01",arrow_dir:"down",bubble_css:{top:3,right:25,width:145,"z-index":9999},arrow_pos:{left:88},attr:" ",wrap:$(".user_profile .user_name"),closeBtn:!0},i=new UiBubbleTipBase(e);i.j_bubble.find(".j_body").css("padding-right","3px"),i.showBubble(),i.bind("onclose",function(){$.cookie("close_sign_tip_o",!1,{expires:14})},!0);{setTimeout(function(){$(".j_wrap .j_close").click()},8e3)}}},showNewpropsTip:function(){var e=$.cookie("NEWS_PROPS_NOTICE"),i=this.user.global&&this.user.global.tbmall_newprops||"";(!e&&i>0||e&&i>e)&&this.buildNewpropsTip()},buildNewpropsTip:function(){var e=this,i={content:'<a class="j_newprops_tip" href="/tbmall/home?sn=1" target="_blank" style="text-align:center;display:block;">\u6709\u65B0\u9053\u5177\u4E0A\u7EBF\u54E6~</a>',arrow_dir:"up",arrow_pos:{left:40},bubble_css:{top:-35,left:100,width:100},wrap:$("#j_profile_pop"),closeBtn:!0},t=new UiBubbleTipBase(i),o="";t.bind("onclose",function(){t.closeBubble(),o=e.user.global&&e.user.global.tbmall_newprops||"",$.cookie("NEWS_PROPS_NOTICE",o,{expires:30,path:"/"})}),t.showBubble(),t.j_bubble.find(".j_newprops_tip").on("click",function(){$.post("/tbmall/post/addpropstoucenter",null,function(){}),t.closeBubble(),o=e.user.global&&e.user.global.tbmall_newprops||"",$.cookie("NEWS_PROPS_NOTICE",o,{expires:30,path:"/"})})},hasLevel:function(){var e=Math.floor((new Date).getTime()/1e3);return this.user.Parr_props&&this.user.Parr_props.level&&this.user.Parr_props.level.end_time>e},_postTrack:function(e,i,t,o){t=t||"click",o=o||{},$.stats.track(e,i,"",t,o)}}});_.Module.define({path:"pb/widget/pic_act_poster",requires:["common/component/force_login","common/widget/PostService","common/widget/image_uploader_manager","user/widget/myTieba"],sub:{ORIGINAL_PIC_URL_PREFIX:"http://imgsrc.baidu.com/forum/pic/item/",THUMBNAIL_PIC_URL_PREFIX:"http://imgsrc.baidu.com/forum/abpic/item/",initial:function(t){try{this.option=t,this.actDesc=t.act_desc,this.activityId=t.activity_id,this.threadId=t.thread_id,this.threadTitle=t.thread_title,this.myTieba=this.requireInstance("user/widget/myTieba"),this._showPostDialog()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pic_act_poster/pic_act_poster.js",method:"",ln:25}),e}},_showPostDialog:function(){var t=this,e=['<div class="pic_join_dialog">','<p class="pic_act_rule">\u89C4\u5219\uFF1A',"<span>"+t.actDesc+"</span>","</p>",'<p class="img_bad_tip">\u6CE8\uFF1A\u4E3A\u4FDD\u8BC1\u6548\u679C\uFF0C\u8BF7\u4E0A\u4F20\u5927\u4E8E200&times;200\u7684\u56FE\u7247</p>','<div class="pic_act_photo">','<div class="pic_prev_wrapper">','<div class="pic_act_upload_btn act_red_btn">\u4E0A\u4F20\u56FE\u7247','<div class="photo_up_container"></div>',"</div>",'<img src="/tb/static-common/editor_img/layer/i.gif" class="pic_previewer ele_hidden" />',"</div>",'<textarea cols="30" rows="10" class="ui_textfield pic_act_img_desc" maxlength="140" placeholder="\u8BF7\u8F93\u5165\u56FE\u7247\u63CF\u8FF0\uFF08\u9009\u586B\uFF09,140\u5B57\u4EE5\u5185"></textarea>',"</div>",'<div class="post_btn_group">','<a href="#" id="pic_act_post_btn" class="ui_btn_disable ui_btn_m_disable"><span><em>\u786E\u8BA4</em></span></a>','<a href="#" id="pic_act_cancel_btn" class="ui_btn ui_btn_sub_m"><span><em>\u53D6\u6D88</em></span></a>',"</div>","</div>"].join("");if(t.dialog=new $.dialog({html:e,title:"\u6652\u56FE\u53C2\u52A0\u6D3B\u52A8",width:428,draggable:!0,closeable:!0,show:!1}),$.browser.msie&&_.Module.use("common/widget/Placeholder",[t.dialog.element.find(".pic_act_img_desc"),"\u8BF7\u8F93\u5165\u56FE\u7247\u63CF\u8FF0\uFF08\u9009\u586B\uFF09,140\u5B57\u4EE5\u5185"]),!PageData.user.is_login){var i=$.tb.unescapeHTML($.tb.location.getHref());return t.use("common/component/force_login",i,"userbar","dialog","pic_act_poster"),!1}PageData.user.is_like?(t.dialog.show(),t._uploadImg(t.dialog.element.find(".pic_prev_wrapper")),t.dialog.element.on("click","#pic_act_post_btn",function(e){try{if(e.preventDefault(),$(this).hasClass("ui_btn_disable"))return!1;t._postPhoto()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/pic_act_poster/pic_act_poster.js",method:"",ln:76}),i}}).on("click","#pic_act_cancel_btn",function(e){try{e.preventDefault(),t.dialog.close()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/pic_act_poster/pic_act_poster.js",method:"",ln:79}),i}})):t._doLike()},_doLike:function(){var t=this,e=new $.dialog({html:'<p>\u53C2\u4E0E\u6652\u56FE\u9700\u8981\u5148\u5173\u6CE8\u672C\u5427\u54E6~</p><br><a href="#" class="ui_btn ui_btn_m j_like"><span><em>\u5173\u6CE8\u672C\u5427</em></span></a>',width:420,holderClassName:"dialog_tip_holder"});e.element.on("click",".j_like",function(i){try{i.preventDefault(),t.myTieba.dolike(),$.stats.track("spic","plat_like","pb","click",{obj_id:t.activityId}),e.close()}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/pic_act_poster/pic_act_poster.js",method:"",ln:97}),a}})},_uploadImg:function(t){var e=this,i=$(new Image),a=t.find(".photo_up_container"),o=t.find(".pic_previewer"),c=t.find(".pic_act_upload_btn"),s=$("#pic_act_post_btn"),n=e.use("common/widget/image_uploader_manager",{container:a,width:a.width(),height:a.height(),isFlash:!1,isAutoUp:!1});n.bind("onFileSelected",function(){n.startUpload()}),n.bind("onStartUpload",function(){c.css("top","-9999px"),o.show(),o.tbattr("src","http://tb1.bdstatic.com/tb/static-pb/img/pic_act/pic_loading.gif")}),n.bind("onComplete",function(t,a){var n=a.imageList[a.imageList.length-1].response;if(null!=n&&0==n.error_code){var _=n.info,p=_.pic_id_encode,d=_.fullpic_width,l=_.fullpic_height,r=e.THUMBNAIL_PIC_URL_PREFIX+p+".jpg",h=e.ORIGINAL_PIC_URL_PREFIX+p+".jpg";if(200>d||200>l)$(".img_bad_tip").css("color","red"),c.css("top","38px"),o.hide();else{var g=new Image;g.src=r,g.onload=function(){o.tbattr("src","http://tb1.bdstatic.com/tb/static-common/editor_img/layer/i.gif"),o.css("background-image","url("+r+")"),(g.width<110||g.height<100)&&o.css("background-size","auto")},$(".img_bad_tip").css("color","#666"),c.css("top","-9999px"),o.show(),s.removeClass("ui_btn_disable ui_btn_m_disable").addClass("ui_btn ui_btn_m"),i.addClass("BDE_Image"),i.tbattr({width:d>560?560:d,height:d>560?parseInt(560*l/d):l,src:h,unselectable:"on",pic_type:0}),e.orgImg=i.get(0).outerHTML,e.pic_encode=p}}else c.css("top","38px"),o.hide(),e._uploadErrorHandler()})},_uploadErrorHandler:function(){$.dialog.alert("\u54E6\uFF0C\u7C97\u4E86\u70B9\u95EE\u9898\uFF0C\u56FE\u7247\u4E0A\u4F20\u5931\u8D25\u4E86",{title:"\u5931\u8D25\u63D0\u793A",acceptValue:"\u518D\u8BD5\u4E00\u6B21",holderClassName:"alert_holder",onaccept:function(){return!0}})},_postPhoto:function(){var t=this,e="",i=PosterContext.getContext(),a=t.use("common/widget/PostService");return $(this).hasClass("ui_btn_disable")?!1:(a.success(function(e,i){var a={activity_id:t.activityId,post_id:i.data.post_id,thread_id:t.threadId,user_name:PageData.user.user_name,pic_encode:t.pic_encode,thread_title:t.threadTitle,canva_from:"poster"};t.dialog.close(),t._showCanvaDialog(a)}),e=t.dialog.element.find(".pic_act_img_desc").val(),a.post("reply",{tid:t.threadId,content:$.tb.escapeHTML(UE.utils.html2ubb(e,!0))+UE.utils.html2ubb("<br>"+t.orgImg),ptype:4},i),void 0)},_showCanvaDialog:function(t){var e=this,i=['<div id="poster_canva_dialog" class="canva_dlg_wrap">','<h3 class="canva_msg_title">\u53D1\u8868\u6210\u529F</h3>','<p class="canva_msg_cnt">\u8F6C\u53D1\u5230\u4F60\u5E38\u53BB\u7684\u5427\u62C9\u7968\uFF0C\u8BA9\u5C0F\u4F19\u4F34\u4EEC\u52A9\u4F60\u83B7\u5956\u5427~</p>','<div class="canva_btn_group">','<a href="#" id="canva_repost_btn" '+$.tb.dataField(t)+' class="ui_btn ui_btn_m j_pic_act_repost"><span><em>\u8F6C\u53D1\u62C9\u7968</em></span></a>','<a href="#" id="canva_cancel_btn" class="ui_btn ui_btn_sub_m"><span><em>\u4E0B\u6B21\u518D\u8BF4</em></span></a>',"</div>","</div>"].join(""),a=new $.dialog({html:i,width:380,draggable:!0,closeable:!0,holderClassName:"pat-noTitle"});a.bind("onclose",function(){"pb"==PageData.product?setTimeout(function(){var t=$.tb.location.getHash(),i=$.tb.location.getPathname();i=="/p/"+e.threadId?"#pic_sort_new"!=t?($.tb.location.setHref("/p/"+e.threadId+"#pic_sort_new"),$.tb.location.reload()):$.tb.location.reload():$.tb.location.setHref("/p/"+e.threadId+"#pic_sort_new")},500):setTimeout(function(){$.tb.location.reload()},500)}),a.element.on("click","#canva_repost_btn",function(t){try{t.preventDefault(),a.hide()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pic_act_poster/pic_act_poster.js",method:"",ln:248}),e}}).on("click","#canva_cancel_btn",function(t){try{t.preventDefault(),a.close()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/pic_act_poster/pic_act_poster.js",method:"",ln:251}),e}})}}});_.Module.define({path:"common/component/Follower",sub:{initial:function(i){var t={timeout:0};this.options=$.extend(t,i),this.ctn=this.options.ctn,this.timer=null,$.isFunction(this.options.getLimitTop)||(this.minTop=this.options.getLimitTop.minTop,this.maxTop=this.options.getLimitTop.maxTop),this.ctn&&(this.bindScrollEvent(),this.bindResizeEvent())},bindScrollEvent:function(){var i=this;$(window).scroll(function(){0==i.options.timeout?i.scroller():(i.timer&&clearTimeout(i.timer),i.timer=setTimeout(function(){i.scroller()},i.options.timeout))})},bindResizeEvent:function(){var i=this;$(window).on("resize",function(){i.resizer()})},resizer:function(){},scroller:function(){var i,t,o=$(window).scrollTop()+10;i=this.minTop?this.minTop:this.options.getLimitTop().minTop,t=this.maxTop?this.maxTop:this.options.getLimitTop().maxTop,i>o?(this.ctn.data("isFixed")&&(this.ctn.removeClass("tbui_follow_fixed"),this.ctn.data("isFixed",!1),this.trigger("normal")),this.ctn.show()):o>=i&&t>=o?(this.ctn.data("isFixed")||(this.ctn.addClass("tbui_follow_fixed"),this.ctn.data("isFixed",!0),this.trigger("fixed")),this.ctn.show()):(this.trigger("hide"),this.ctn.hide())}}});_.Module.define({path:"user/widget/userApi",requires:[],sub:{initial:function(){},checkUniversalMembershipOf:function(e){return $.getPageData("mParr_props.level.props_id",0,e)>0&&1e3*$.getPageData("mParr_props.level.end_time",0,e)>1*new Date},checkSuperMemberShipOf:function(e){return 2==this.getUniversalMemberLevelOf(e)},checkSingleForumMembershipOf:function(e,r){var t=$.getPageData("mParr_props.forum_member",0,e);return t?t[r]&&1e3*t[r].end_time>1*new Date:!1},getUniversalMemberLevelOf:function(e){return this.checkUniversalMembershipOf(e)?$.getPageData("mParr_props.level.props_id",0,e):0}}});_.Module.define({path:"common/widget/UserHead",sub:{initial:function(){this.initOptions()},initOptions:function(){this.options={gif:["1100001","1100002","1100003","1100013","1100015","1100016","1100017","1100019"],filter:[]}},getImgFormat:function(t){var r="png";return-1!=$.inArray(t,this.options.gif)&&(r="gif"),r},getHeadUrl:function(t){var r=t.mParr_props&&t.mParr_props.portrait||"",i="";return i=r.end_time>Env.server_time/1e3?r.url:"http://tb.himg.baidu.com/sys/portrait/item/"+t.portrait},getHeadFrameStyle:function(t,r){var i=t.mParr_props&&t.mParr_props.avatarframe||"",e="",n=null,o={hasFrame:!1,stylestr:""};return i.end_time>Env.server_time/1e3&&(e=i.props_id,n=["width:"+r+"px","height:"+r+"px","padding:10px","background:url(/tb/static-common/img/props/"+r+"/"+e+"."+this.getImgFormat(e)+") no-repeat","border:none","left:-6px","top:-6px"],o={hasFrame:!0,stylestr:n.join(";")}),o}}});function showattip(e){var n=$(e),t="@"==n.text()[0]?n.text().substring(1):n.text().substring(),a=$(e).tbattr("username"),r="/home/main?un="+a+"&fr=pb";n.addClass("j_user_card").bindData({un:t}).tbattr("href",r).trigger("mouseenter"),e.onmouseover=null}function hideattip(e){e.onmouseout=null}_.Module.define({path:"user/widget/pbUserBase",requires:["common/widget/Card","common/widget/UserHead","common/widget/MemberApi","user/widget/icons"],sub:{initial:function(){this._userHead=this.getInstance("common/widget/UserHead"),this._memberApi=this.getInstance("common/widget/MemberApi"),this._icons=this.getInstance("user/widget/icons")},face_link:function(e){var n="",t="/home/main?un="+encodeURIComponent(e.user_name)+"&ie=utf-8&fr=pb",a='src="'+this._userHead.getHeadUrl(e)+'"',r="<img "+a+"/>";return n="<a data-field=\"{'un':'"+e.user_name+'\'}" target="_blank" class="j_user_card lzl_p_p" href="'+t+'" username="'+e.user_name+'">'+r+"</a>"},name_link:function(e){var n=e.profession_manager_nick_name||e.nickname;return'<a class="at j_user_card '+this._memberApi.getMemberNameClass(e.mParr_props)+"\" data-field=\"{'un':'"+e.user_name+'\'}" alog-group="p_author" target="_blank" href="/home/main?un='+encodeURIComponent(e.user_name)+'&ie=utf-8&fr=pb" username="'+e.user_name+'">'+n+"</a>"}}});_.Module.define({requires:["pb/widget/Favthread","pb/widget/pic_act_poster","common/component/Follower"],path:"pb/widget/ForumTitle",sub:{initial:function(t){try{this.dataObj=t,this.requireInstance("pb/widget/Favthread"),this.bindEvents()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/forum_title/forum_title.js",method:"",ln:16}),e}},bindEvents:function(){var t=this,e=$("#j_core_title_wrap");e.on("click","#lzonly_cntn",function(){try{if(!PageData.user.is_login){var e="http://tieba.baidu.com"+$.tb.unescapeHTML($(this).tbattr("href"));return t.requireInstanceAsync("common/component/force_login",[e,"userbar","dialog","pb_see_lz"]),!1}}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/forum_title/forum_title.js",method:"",ln:27}),i}}),this.j_core_title_wrap=e,this.j_thread_pager=$("#thread_theme_5"),this.addScrollListener(),t.dataObj.is_pic_act_underway&&e.on("click",".pic_act_join_btn",function(e){try{e.preventDefault(),t.requireInstance("pb/widget/pic_act_poster",$(this).getData())}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/forum_title/forum_title.js",method:"",ln:38}),i}})},updateLimitTop:function(){var t=this,e=$(".left_section"),i=$(".right_section"),o=e.height()>i.height()?e.height():i.height(),r=$("#pb_content"),a=(t.j_core_title_wrap.offset().top+10,r.offset().top+o-t.j_core_title_wrap.height());this.follwer.maxTop=a},addScrollListener:function(){var t=this,e=$(".left_section"),i=$("#pb_content"),o=$(".right_section"),r=(t.j_core_title_wrap.height(),t.j_core_title_wrap.offset().top+10,i.offset().top,e.height()>o.height()?e.height():o.height());this.follwer=this.requireInstance("common/component/Follower",{ctn:t.j_core_title_wrap,timer:30,getLimitTop:{minTop:t.j_core_title_wrap.parent().offset().top+10,maxTop:i.offset().top+r-t.j_core_title_wrap.height()}}),this.follwer.bind("normal",function(){t.j_core_title_wrap.removeClass("core_title_absolute_bright").css({top:0}),t.j_thread_pager.removeClass("thread_theme_bright_absolute"),t.j_core_title_wrap.find(".pic_act_toolbar").removeClass("toolbar_fixed").hide()}),this.follwer.bind("fixed",function(){var e=$(".app_forum_top_nav"),i=0;e.length>0&&(i=40),t.j_core_title_wrap.addClass("core_title_absolute_bright").css({top:i}),t.j_thread_pager.addClass("thread_theme_bright_absolute"),t.j_core_title_wrap.find(".pic_act_toolbar").addClass("toolbar_fixed").show()})}}});_.Module.define({path:"pb/widget/saveFace",requires:[],sub:{url:"/tbmall/post/useSavefaceProps",opt:{tbs:0,props_id:"",thread_id:"",forum_id:"",target_user_id:"",target_user_name:""},curPost:null,ajaxing:!1,tmp:['<div class="save_face_dialog">','<div class="save_face_detail clearfix">#{save_cards}</div>','<div class="save_face_use">','<div class="save_face_split"></div>','<p class="save_face_tip"><span>\u8981\u4F7F\u7528\u8FD9\u5F20\u633D\u5C0A\u5361\u5417\uFF1F</span>','<a class="j_save_face_buy" target="_blank" href="/tbmall/propslist?category=117">>>\u7ACB\u5373\u8D2D\u4E70</a>',"</p>","<p>",'<a href="#" onclick="return false;" class="j_save_face ui_btn ui_btn_m">',"<span><em>\u786E\u5B9A</em></span>","</a>",'<a href="#" onclick="return false;" class="j_save_face_cancel ui_btn ui_btn_sub_m">',"<span><em>\u53D6\u6D88</em></span>","</a>","</p>","</div>","</div>"].join(""),initial:function(e){try{if(window.Page&&Page.checkLoadedModules("saveface"))return;this.props=e.props,this.isLogin=e.isLogin,this.dialog=null,this.opt.forum_id=e.forumId,this.opt.thread_id=e.threadId,this.opt.tbs=PageData.tbs,this.bindEvents()}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/save_face/save_face.js",method:"",ln:57}),a}},bindEvents:function(){var e=this;$(".save_face_card").live("click",function(){try{if(!e.isLogin)return _.Module.use("common/widget/LoginDialog",[],function(){}),!1;var a=$(this).closest(".j_l_post").getData();e.opt.target_user_id=a.author.user_id,e.opt.target_user_name=a.author.user_name,e.curPost=$(this).closest(".save_face_bg"),e.initDialog()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/save_face/save_face.js",method:"",ln:71}),t}}),$("body").on("mouseenter",".save_card",function(){return $(this).closest(".save_face_detail").find(".save_card").removeClass("hover"),$(this).hasClass("sel")?!1:($(this).addClass("hover"),void 0)}).on("mouseleave",".save_face_detail",function(){$(this).find(".save_card").removeClass("hover")}).on("click",".save_card",function(){try{var a=!!$(this).getData("data-num"),t=$(".j_save_face_buy").removeClass("emph");return $(this).closest(".save_face_detail").find(".save_card").removeClass("sel").removeClass("unsel"),a?($(this).addClass("sel"),t.hide(),e.opt.props_id=$(this).getData("data-id")):($(this).addClass("unsel"),t.show(),e.opt.props_id=0),!1}catch(s){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:s.message||s.description,path:"pb:widget/save_face/save_face.js",method:"",ln:100}),s}}).on("click",".j_save_face_cancel",function(){try{return e.dialog.close(),e.dialog=null,e.opt.props_id="",!1}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/save_face/save_face.js",method:"",ln:105}),a}}).on("click",".j_save_face",function(){try{e.postHandle()}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/save_face/save_face.js",method:"",ln:107}),a}}).on("click",".j_save_face_buy",function(){try{e.showBuyDialog(this.href)}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/save_face/save_face.js",method:"",ln:109}),a}}).on("click",".j_save_face_buy_1",function(){try{e.showBuyDialog(this.href)}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/save_face/save_face.js",method:"",ln:111}),a}})},initSaveCards:function(){for(var e=0,a={},t="",s=(this.props,['<div class="save_card" title="#{card_desc}" data-id="#{card_id}" data-num="#{card_num}">','<img src="#{card_img}"/>',"<p>x#{card_num}</p>","</div>"].join("")),i={},c=[{key:"1170001",img:"http://tb1.bdstatic.com/tb/cms/save_face/level_1.png",desc:"\u7834\u65E7\u7684\u633D\u5C0A\u5361(\u589E\u52A0\u7ECF\u9A8C\u503C-1~2)"},{key:"1170002",img:"http://tb1.bdstatic.com/tb/cms/save_face/level_2.png",desc:"\u666E\u901A\u7684\u633D\u5C0A\u5361(\u589E\u52A0\u7ECF\u9A8C\u503C0~3)"},{key:"1170003",img:"http://tb1.bdstatic.com/tb/cms/save_face/level_3.png",desc:"\u95EA\u5149\u7684\u633D\u5C0A\u5361(\u589E\u52A0\u7ECF\u9A8C\u503C2~5)"},{key:"1170004",img:"http://tb1.bdstatic.com/tb/cms/save_face/level_4.png",desc:"\u8000\u773C\u7684\u633D\u5C0A\u5361(\u589E\u52A0\u7ECF\u9A8C\u503C5~8)"},{key:"1170005",img:"http://tb1.bdstatic.com/tb/cms/save_face/level_5.png",desc:"\u795E\u5723\u7684\u633D\u5C0A\u5361(\u589E\u52A0\u7ECF\u9A8C\u503C10~15)"}];e<c.length;e++)a=c[e],i={card_id:a.key,card_img:a.img,card_desc:a.desc,card_num:this.getPropNum(a.key)},t+=$.tb.format(s,i);return t},getPropNum:function(e){var a=this.props;return a&&a["117"]&&a["117"][e]?a["117"][e].left_num:0},initDialog:function(){var e=$.tb.format(this.tmp,{save_cards:this.initSaveCards()});this.dialog=new $.dialog({title:"\u4F7F\u7528\u633D\u5C0A\u5361",html:e,draggable:!1,width:640}),this.dialog.show()},postHandle:function(){var e=this;if(!e.ajaxing){if(0==e.opt.props_id)return $(".j_save_face_buy").show().addClass("emph"),void 0;e.ajaxing=!0,$.post(e.url,e.opt,function(a){e.ajaxing=!1,e.resHandle(a)})}},resHandle:function(e){var a=this;if(0==e.no){this.dialog.close();var t=setTimeout(function(){a.addScoreAni(e.data.exp),clearTimeout(t),t=null},200)}else{var s={210009:"\u4E0D\u80FD\u5BF9\u81EA\u5DF1\u4F7F\u7528\u633D\u5C0A\u5361\u54E6",2270026:"\u633D\u5C0A\u5361\u53EA\u80FD\u5BF9\u52CB\u7AE0\u7528\u6237\u4F7F\u7528",2190008:"4\u5C0F\u65F6\u5185\u53EA\u80FD\u5BF9\u540C\u4E00\u4E2A\u7528\u6237\u4F7F\u7528\u4E00\u6B21\u633D\u5C0A\u5361",2270019:'\u60A8\u7684\u633D\u5C0A\u5361\u4E0D\u591F\u4E86<a class="j_save_face_buy_1" target="_blank" href="/tbmall/propslist?category=117">>>\u7ACB\u5373\u8D2D\u4E70</a>',"else":"\u670D\u52A1\u5668\u6253\u4E86\u4E2A\u76F9\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5"},i=['<p class="save_face_alert">',e&&e.no in s?s[e.no]:s["else"],"</p>",'<p class="save_face_alert">','<a href="" onclick="return false;" class="j_save_face_cancel ui_btn ui_btn_m">',"<span><em>\u786E\u5B9A</em></span>","</a>","</p>"].join("");this.dialog.close(),this.dialog=new $.dialog({title:"\u63D0\u793A",html:i,draggable:!1}),this.dialog.show()}},addScoreAni:function(e){var a=['<div class="save_face_ani">','<span class="ani_1">@'+$.tb.subByte(this.opt.target_user_name,10)+"</span>",'<span class="ani_2">+'+parseInt(e)+"\u7ECF\u9A8C\u503C</span>","</div>"].join("");$(a).css({top:130,left:350}).insertAfter(this.curPost).animate({top:"-=70",left:"-=200",opacity:.2},1500,function(){$(this).remove(),$.tb.location.reload()})},showBuyDialog:function(e){var a='<p class="buy_txt">\u9053\u5177\u8D2D\u4E70\u6210\u529F\u540E\u5373\u53EF\u4F7F\u7528\uFF01</p><div class="buy_dialog_btns"><a href="#" class="ui_btn ui_btn_m btn_success"><span><em>\u8D2D\u4E70\u6210\u529F</em></span></a><a href="#{href}" target="_blank"  class="ui_btn ui_btn_sub_m btn_failure"><span><em>\u8D2D\u4E70\u5931\u8D25\uFF0C\u91CD\u65B0\u8D2D\u4E70</em></span></a></div>',t=new $.dialog({title:"\u63D0\u793A",html:$.tb.format(a,{href:$.tb.unescapeHTML(e)}),width:400,height:80});t.bind("onclose",function(){$.tb.location.reload()}),t.element.find(".btn_success").on("click",function(e){try{e.preventDefault(),$.tb.location.reload()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/save_face/save_face.js",method:"",ln:271}),e}})}}});_.Module.define({path:"pb/widget/Posts",sub:{initial:function(){try{var e=this;e._bindEvents()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/posts/posts.js",method:"",ln:13}),t}},_bindEvents:function(){if(!Page.checkLoadedModules("pbPost")){var e=this;$("#j_p_postlist").delegate(".p_post_del_my","click",function(){try{var t=$(this),a=t.getData()||{},s=a.delete_mine,o=a.user_name,n=a.index;if(s&&1==s){var i=n&&1==n?"\u4E3B\u9898":"\u56DE\u590D",r=r=$.dialog.confirm('<div style="margin:15px auto 0;text-align:center;">\u786E\u8BA4\u5220\u9664\u8FD9\u6761'+i+"?<div>",{showTitle:!1});n&&1==n?r.bind("onaccept",function(){e._delete_thread(o)}):r.bind("onaccept",function(){var a=e._get_delete_paras(t,!1);a.user_name=o,e._delete_post(a)})}return!1}catch(d){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:d.message||d.description,path:"pb:widget/posts/posts.js",method:"",ln:43}),d}}).delegate(".lzl_jb_in","click",function(){try{{var t=$(this),a=t.getData()||{},s=a.user_name;a.delete_mine}if(1!=a.delete_mine){var o=$(this).parents(".lzl_single_post").getData(),n=$(this).parents(".j_l_post").getData().content.post_id;return window.open("http://tieba.baidu.com/complaint/info?type=0&tid="+PageData.thread.thread_id+"&pid="+n+"&cid="+o.spid,"newwindow","height=900, width=800, toolbar =no, menubar=no, scrollbars=yes, resizable=yes, location=no, status=no"),!1}var i=$.dialog.confirm('<div style="margin:15px auto 0;text-align:center;">\u786E\u8BA4\u5220\u9664\u8FD9\u6761\u56DE\u590D?<div>',{showTitle:!1});return i.bind("onaccept",function(){var a=e._get_delete_paras(t,!0);a.user_name=s,e._delete_post(a,!0)}),!1}catch(r){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:r.message||r.description,path:"pb:widget/posts/posts.js",method:"",ln:65}),r}}).delegate(".apc_src_wrapper a","mousedown",function(e){var t=e.currentTarget.href,a=t.replace(/\w*(:\/\/)?([^\/]+).*/g,"$2");$.stats.sendRequest("fr=tb0_forum&st_type=shenqi_pb_link&st_value="+encodeURIComponent(a))}).delegate(".j_user_card","click",function(){try{if(PageData.user.is_login)return;var e="";e=$(this).hasClass("lzl_p_p")?"pb_user_lzl":"pb_user_lc";var t="http://tieba.baidu.com"+$.tb.unescapeHTML($(this).tbattr("href"));return window.open("/f/user/passport?jumpUrl="+t+"&statsInfo="+e+"#login_anchor"),!1}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/posts/posts.js",method:"",ln:76}),a}}).delegate(".j_jb_ele","mouseover",function(){$(this).find(".super_jubao").show()}).delegate(".j_jb_ele","mouseout",function(){$(this).find(".super_jubao").hide()})}},_delete_thread:function(e,t){var a=this,s=PageData,o={ie:"utf-8",tbs:s.tbs,kw:s.forum.forum_name,fid:s.forum.forum_id,tid:s.thread.thread_id,user_name:e,delete_my_post:0,delete_my_thread:1};t&&(o=$.extend(o,a._captcha)),PostHandler.execute("threadDelete",o,function(t){var s="";switch(t.no){case 0:$.tb.location.setHref("/f?kw="+PageData.forum.name_encode);break;case 308:s=PageData.user.forbidden?"\u62B1\u6B49\uFF0C\u60A8\u5DF2\u88AB\u672C\u5427\u5C01\u7981\u6216\u8005\u52A0\u5165\u9ED1\u540D\u5355\uFF0C\u6682\u4E0D\u80FD\u5220\u8D34":"";break;case 871:s="\u62B1\u6B49\uFF0C\u4ECA\u5929\u5DF2\u8FBE\u60A8\u5220\u8D34\u7684\u6700\u5927\u9650\u989D\uFF0C\u660E\u5929\u518D\u6765\u8BD5\u8BD5\u5427~";break;case 34:s="\u4EB2\u7231\u7684\u5C0F\u4F19\u4F34\uFF0C\u4F60\u4ECA\u5929\u7684\u5220\u8D34\u6570\u91CF\u5DF2\u7ECF\u8FBE\u5230\u6700\u5927\u9650\u989D("+t.data.reason+"\u6761/\u5929\uFF09\uFF0C\u660E\u5929\u518D\u6765\u8BD5\u8BD5\u5427~";break;case 4009:s="\u4EB2\uFF0C\u7531\u4E8E\u672C\u8D34\u5B50\u7684\u5185\u5BB9\u975E\u5E38\u8D5E\u6240\u4EE5\u88AB\u4FDD\u62A4\u8D77\u6765\u5566\uFF0C\u60F3\u8981\u5220\u9664\u7684\u8BDD\u8BF7\u8054\u7CFB\u697C\u4E3B\u672C\u4EBA\u54E6~";break;case 4011:a._getCaptcha.call(a,t,e);break;default:s="\u62B1\u6B49\uFF0C\u7CFB\u7EDF\u7E41\u5FD9\uFF0C\u8D34\u5B50\u5220\u9664\u5931\u8D25\u3002"}""!=s&&(a.message?a.message.showMessage(s,"",!1):_.Module.getInstance("pb/widget/Message",function(e){a.message=e,e.showMessage(s,"",!1)}))})},_delete_post:function(e,t,a){var s=this,o=PageData,n={ie:"utf-8",tbs:o.tbs,kw:o.forum.forum_name,fid:o.forum.forum_id,tid:o.thread.thread_id,user_name:e.user_name,delete_my_post:1,delete_my_thread:0,is_vipdel:o.power.lz_del?1:0};a&&(n=$.extend(n,s._captcha)),t?(n.pid=e.spid,n.is_finf=1):(n.pid=e.content_id,n.is_finf=!1),PostHandler.execute("postDelete",n,function(a){var o="";switch(a.no){case 0:$.tb.location.reload();break;case 308:o="\u62B1\u6B49\uFF0C\u60A8\u5DF2\u88AB\u672C\u5427\u5C01\u7981\u6216\u8005\u52A0\u5165\u9ED1\u540D\u5355\uFF0C\u6682\u4E0D\u80FD\u5220\u8D34";break;case 871:o="\u62B1\u6B49\uFF0C\u4ECA\u5929\u5DF2\u8FBE\u60A8\u5220\u8D34\u7684\u6700\u5927\u9650\u989D\uFF0C\u660E\u5929\u518D\u6765\u8BD5\u8BD5\u5427~";break;case 877:o="\u8BE5\u8D34\u4E3A\u4ED8\u8D39\u53EF\u89C1\u8D34\uFF0C\u65E0\u6CD5\u5220\u9664";break;case 34:o="\u4EB2\u7231\u7684\u5C0F\u4F19\u4F34\uFF0C\u4F60\u4ECA\u5929\u7684\u5220\u8D34\u6570\u91CF\u5DF2\u7ECF\u8FBE\u5230\u6700\u5927\u9650\u989D("+a.data.reason+"\u6761/\u5929\uFF09\uFF0C\u660E\u5929\u518D\u6765\u8BD5\u8BD5\u5427~";break;case 4009:o="\u4EB2\uFF0C\u7531\u4E8E\u672C\u8D34\u5B50\u7684\u5185\u5BB9\u975E\u5E38\u8D5E\u6240\u4EE5\u88AB\u4FDD\u62A4\u8D77\u6765\u5566\uFF0C\u60F3\u8981\u5220\u9664\u7684\u8BDD\u8BF7\u8054\u7CFB\u697C\u4E3B\u672C\u4EBA\u54E6~";break;case 4011:s._getCaptcha.call(s,a,e,t);break;default:o="\u62B1\u6B49\uFF0C\u7CFB\u7EDF\u7E41\u5FD9\uFF0C\u8D34\u5B50\u5220\u9664\u5931\u8D25\u3002"}""!=o&&(s.message?s.message.showMessage(o,"",!1):_.Module.getInstance("pb/widget/Message",function(e){s.message=e,e.showMessage(o,"",!1)}))})},_captcha:{},_getCaptcha:function(e,t,a){var s=this,o=1;"string"==typeof t&&(o=0),_.Module.use("common/component/CaptchaDialog",{title:"\u5220\u9664\u8D34\u5B50",message:"\u5220\u4E86\u90A3\u4E48\u591A\u8D34\u5B50\uFF0C\u8F93\u4E2A\u7801\u9A8C\u8BC1\u4E0B\u8EAB\u4EFD\u5427~",vCode:e.data.vcode.captcha_vcode_str,vCodeType:e.data.vcode.captcha_code_type,forumName:PageData.forum.forum_name,forumId:PageData.forum.forum_id,postType:"thread",paramsCallback:function(){return{}}},function(e){s.captchaDialog=e,e.bind("onclose",function(){return e.hide(),!1}),e.bind("onaccept",function(){s._captcha.vcode=e.getInputValue(),s._captcha.vcode_md5=e.getVCode(),o?s._delete_post.call(s,t,a,1):s._delete_thread.call(s,t,1)}),e.show()})},_get_delete_paras:function(e,t){var a,s,o={};return t?(a=e.parents("li.j_lzl_s_p"),o=a.getData()):(a=e.parents(".j_l_post"),s=a.getData(),o={author_name:s.author.user_name,content_id:s.content.post_id}),o}}});_.Module.define({path:"tbmall/widget/TbeanSafeAjax",requires:["tbmall/widget/TbeanSafe"],sub:{initial:function(a){this.options=a||{}},ajax:function(a){var t=this,e=a.success||function(){},n=a.data||{},s=function(s){var i=t.use("tbmall/widget/TbeanSafe",{json:s,sucCallback:function(e){var s=$.extend({},n,e),i=$.extend({},a);i.data=s,t.ajax(i)},tbeanOptions:t.options});i.needCheck()||e(s)};return a.success=s,a.type=a.type||"post",a.dataType=a.dataType||"json",$.ajax(a)},post:function(a,t,e){var n={url:a,data:t,success:e};return this.ajax(n)}}});_.Module.define({path:"encourage/widget/pb_marry",requires:[],sub:{URL:{getGift:"/marriage/gift/getSceneGiftList",sendGift:"/marriage/gift/sendGift",sendPostInPb:"/marriage/gift/sendPostInPb",sendGiftInPost:"/marriage/gift/sendGiftInPost",saveOrder:"/marriage/gift/saveOrder",getThreadGiftList:"/marriage/gift/getThreadGiftList",accept:"/marriage/accept",refuse:"/marriage/refuse"},sceneId:2000138,initial:function(t){this.opt=t,this.gift={},this.loadMarriageGiftList(),this.bindEvent()},bindEvent:function(){var t=this;$(".marry-post-section").on("click","[j-marry-post-btn-send]",function(){var i=$(this);return t.checkLogin()?(t.gift.user_name=i.tbattr("data-username"),t.buildInFloat(),void 0):!1}).on("click","[j-marry-post-btn-refuse]",function(){var i=$(this);return t.checkLogin()?(t.relation_id=i.tbattr("data-id"),t.post_id=i.tbattr("data-post-id"),t.thread_id=i.tbattr("data-thread-id"),t.user_name=i.tbattr("data-username"),t.showRefuseDialog(t.user_name),void 0):!1}).on("click","[j-marry-post-btn-agree]",function(){var i=$(this);return t.checkLogin()?(t.relation_id=i.tbattr("data-id"),t.post_id=i.tbattr("data-post-id"),t.thread_id=i.tbattr("data-thread-id"),t.user_name=i.tbattr("data-username"),t.showAgreeDialog(t.user_name),void 0):!1})},bindTemplateEvent:function(){var t=this,i=5;this.$root.find('[name="gift-selection-gift-word"]').focus(),this.$root.on("click","[j-gift-selection-gift-list-left]",function(){var e=t.$root.find(".gift-selection-gift-list-wrapper ul"),a=e.find("li").first();a.animate({marginLeft:-a.width()},function(){a.appendTo(e),a.css({marginLeft:i})})}).on("click","[j-gift-selection-gift-list-right]",function(){var e=t.$root.find(".gift-selection-gift-list-wrapper ul"),a=e.find("li").last();a.css({marginLeft:-a.width()}),a.prependTo(e);var s=e.find("li").first();s.animate({marginLeft:i})}).on("click",".gift-selection-gift-item",function(){var i=$(this);t.$root.find(".gift-selection-gift-list-wrapper ul li").removeClass("gift-selection-gift-item-active"),i.addClass("gift-selection-gift-item-active"),t.gift.gift_id=i.tbattr("data-id"),t.gift.price=i.tbattr("data-price")}).on("click","[j-gift-selection-send-gift-btn]",function(){var i=$("[j-gift-selection-form]");if(!t.checkLogin())return!1;var e=i.find('[name="gift-selection-gift-word"]').val();if(!t.gift.gift_id)return t.showAlert("\u8BF7\u9009\u62E9\u793C\u7269! "),!1;if(!e)return t.showAlert("\u8BF7\u586B\u5199\u56DE\u8D34\u4FE1\u606F! "),!1;var a=null==e.match(/[^ -~]/g)?e.length:e.length+e.match(/[^ -~]/g).length;if(a>280)return t.showAlert("\u795D\u798F\u7684\u8BDD\u957F\u5EA6\u4E0D\u80FD\u8D85\u8FC7140\u4E2A\u6C49\u5B57,\u73B0\u5728\u662F"+Math.ceil(a/2)+"\u5B57"),!1;var s={content:e,user_name:t.gift.user_name,gift_id:t.gift.gift_id,forum_id:PageData.forum.forum_id,thread_id:PageData.thread.thread_id,tbs:PageData.tbs};return $.post(t.URL.sendPostInPb,s,function(i){if(i)switch(i.no){case 0:s.post={},s.post.thread_id=i.data.thread_id,s.post.post_id=i.data.post_id,t.genOrder(s),t.dialog.close();break;default:t.showAlert("\u793C\u7269\u53D1\u9001\u5931\u8D25! "),setTimeout(function(){$.tb.location.reload()},1e3)}else t.showAlert("\u670D\u52A1\u5668\u62BD\u98CE\u4E86! ")}),!1})},loadMarriageGiftList:function(){var t={thread_id:PageData.thread.thread_id,user_id:$("[j-marry-post-gift-list]").tbattr("data-userid")},i=$("[j-marry-post-gift-list]");$.get(this.URL.getThreadGiftList,t,function(t){if(t)switch(t.no){case 0:var e="<ul>",a=t.data;for(var s in a){var r=a[s];e+=['<li class="marry-post-gift-item ">','<a class="marry-post-gift-username">'+r.user_name+"</a> ","\u9001\u6765\u7684\u793C\u7269",'<a class="marry-post-gift-giftname">'+r.gift_name+"</a>",'<img  class="marry-post-gift-img" src='+r.img+" />","</li>"].join("")}e+="</ul>",i.html(e);break;default:i.html('<span class="marry-post-gift-item ">\u65E0</span>')}})},loadTemplate:function(t){this.template='<div id="gift-selection" class="gift-selection" >         <form class="gift-selection-form" j-gift-selection-form>      <div class="gift-selection-wrapper" >          <div class="gift-selection-row gift-selection-gift" >              <div class="gift-selection-gift-list clearfix">                  <% if (giftList.length > 7 ){ %>                      <div class="gift-selection-gift-list-left" j-gift-selection-gift-list-left ></div>                  <% } %>                  <div class="gift-selection-gift-list-wrapper clearfix" >                      <ul>                          <% for (var i in giftList) {                               var item = giftList[i];                          %>                               <li class="gift-selection-gift-item" data-price="<%=item.price %>"  data-id="<%=item.gift_id %>" >                                                                    <div class="gift-selection-gift-item-wrapper" >                                      <img src="<%=item.large_thumbnail_url %>" />                                      <span class="gift-selection-gift-worth orange-text"><i class="icon-tbean"></i><%=item.price %></span>                                      <div  class="gift-selection-gift-item-check" ></div>                                                                                                              </div>                                  <p class="gift-selection-gift-item-name" ><%=item.gift_name %></p>                                                                </li>                          <% } %>                                                                         </ul>                  </div>                  <% if (giftList.length > 7 ){ %>                      <div class="gift-selection-gift-list-right"  j-gift-selection-gift-list-right ></div>                  <% } %>                                </div>          </div>          <div class="gift-selection-row gift-selection-gift-word-wrapper" >              <label class="gift-selection-label" >\u634E\u53E5\u795D\u798F\u7684\u8BDD</label>              <textarea class="gift-selection-gift-word" name=\'gift-selection-gift-word\' placeholder="\u56F4\u89C2\u6C42\u5A5A\uFF0C\u4E5F\u8981\u5406\u559D\u4E24\u53E5,\u4E0D\u8D85\u8FC7140\u5B57"></textarea>              <div class="gift-selection-gift-buttons" >                  <button type="button" class="btn-default btn-middle gift-selection-send-gift-btn " j-gift-selection-send-gift-btn >\u9001\u51FA\u793C\u7269</button>                 <!--  <label class="gift-selection-gift-word-wrapper"><input type="checkbox" name="gift-selection-user-sign" /> \u4F7F\u7528\u7B7E\u540D\u6863</label> -->              </div>              <div class="gift-selection-gift-tip" >                  \u88AB\u6C42\u5A5A\u4EBA\u540C\u610F\u6C42\u5A5A\u7684\u65F6\u523B\uFF0C\u9001\u793C\u7269\u6700\u591A\u7684\u5427\u53CB\u5C06\u83B7\u5F97<a >\u6708\u8001\u6210\u5C31</a>12\u4E2A\u6708\u3002              </div>                        </div>`        </div>        </form>  </div>';var i=[],e=this,a={scene_id:this.sceneId};$.get(this.URL.getGift,a,function(a){if(a)switch(a.no){case 0:i=a.data.gift_list,e.$root=$(_.template(e.template)({giftList:i})),e.bindTemplateEvent(),"function"==typeof t&&t();break;default:e.showAlert("\u793C\u7269\u5217\u8868\u83B7\u53D6\u5931\u8D25\uFF0C\u8BF7\u5237\u65B0\u91CD\u8BD5"),i=[]}else i=[]})},hide:function(){this.dialog.hide()},show:function(){this.dialog.show()},buildInFloat:function(){this.dialog&&this.dialog.close();var t=this;this.loadTemplate(function(){t.dialog=new $.dialog({html:t.$root,title:'<img class="gift-selection-dialog-title-img" src="http://tb2.bdstatic.com/tb/static-encourage/widget/pb_marry/img/gift_icon_0a6e722.png" />\u9001\u793C\u7269\uFF0C\u8D62\u6708\u8001\u6210\u5C31',width:700,holderClassName:"gift-selection-dialog"})})},checkLogin:function(){return PageData.user.is_login?!0:(this.requireInstanceAsync("common/widget/LoginDialog"),!1)},genOrder:function(t){var i=this.requireInstance("tbmall/widget/TbeanSafeAjax"),e=this,a=t;a.tbs=window.PageData.tbs,i.post(this.URL.sendGiftInPost,a,function(i){if(0==i.no&&i.data){var a=i.data,s={order_id:i.data.order_id,thread_id:t.post.thread_id,post_id:t.post.post_id,gift_from:2,price:e.gift.price,tbs:window.PageData.tbs};$.post(e.URL.saveOrder,s,function(){var t=e.requireInstance("common/widget/Tdou/TdouViewPay",function(t){t.data&&!t.data.no&&(e.showAlert("\u793C\u7269\u8D60\u9001\u6210\u529F\uFF01","\u793C\u7269\u8D60\u9001"),$.tb.location.reload())});t.createMain(a)})}else e.showAlert("\u8BA2\u5355\u51FA\u9519\uFF0C\u8BF7\u91CD\u8BD5","\u793C\u7269\u8D60\u9001"),$.tb.location.reload()})},showRefuseDialog:function(t){var i={title:"\u62D2\u7EDD\u6C42\u5A5A",content:"\u4F60\u786E\u5B9A\u8981\u62D2\u7EDD"+t+"\u7684\u6C42\u5A5A\uFF1F",tip:"",btns:'<a class="btn-middle btn-default" j-marry-refuse >\u786E\u5B9A</a>'};this.showDialog(i);var e=this;this.marryAttitudeDialog.element.on("click","[j-marry-refuse]",function(){var t={post_id:e.post_id,thread_id:e.thread_id,forum_id:PageData.forum.forum_id,user_name:e.user_name,tbs:PageData.tbs};$.post(e.URL.refuse,t,function(t){if(t){switch(t.no){case 0:e.showAlert("\u62D2\u7EDD\u6C42\u5A5A\u6210\u529F! ");break;case 2670010:e.showAlert("\u4F60\u4EEC\u5176\u4E2D\u4E00\u4E2A\u4EBA\u5DF2\u7ECF\u7ED3\u5A5A\uFF0C\u6C42\u5A5A\u5931\u8D25! ");break;default:e.showAlert("\u62D2\u7EDD\u6C42\u5A5A\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5! ")}setTimeout(function(){$.tb.location.reload()},1e3)}else e.showAlert("\u670D\u52A1\u5668\u62BD\u98CE\u4E86\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5! ")})})},showAgreeDialog:function(t){var i={title:"\u63A5\u53D7\u6C42\u5A5A",content:"\u60A8\u613F\u610F\u6210\u4E3A"+t+"\u7684\u7231\u4EBA\u5417\uFF1F",tip:"\u7B54\u5E94TA\u7684\u6C42\u5A5A\u540E\uFF0C\u5728\u4E2A\u4EBA\u4E2D\u5FC3\u4F1A\u51FA\u73B0\u7231\u4EBA\u6807\u8BC6\uFF0C\u8BC1\u660E\u60A8\u5DF2\u6210\u5A5A\u3002",btns:'<a class="btn-middle btn-default"  j-marry-agree >\u6211\u613F\u610F</a>'};this.showDialog(i);var e=this;this.marryAttitudeDialog.element.on("click","[j-marry-agree]",function(){var t={post_id:e.post_id,thread_id:e.thread_id,forum_id:PageData.forum.forum_id,user_name:e.user_name,tbs:PageData.tbs};$.post(e.URL.accept,t,function(t){if(t){switch(t.no){case 0:e.showAlert("\u63A5\u53D7\u6C42\u5A5A\u6210\u529F! ");break;case 2670010:e.showAlert("\u4F60\u4EEC\u5176\u4E2D\u4E00\u4E2A\u4EBA\u5DF2\u7ECF\u7ED3\u5A5A\uFF0C\u6C42\u5A5A\u5931\u8D25! ");break;default:e.showAlert("\u63A5\u53D7\u6C42\u5A5A\u5931\u8D25\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5! ")}setTimeout(function(){$.tb.location.reload()},1e3)}else e.showAlert("\u670D\u52A1\u5668\u62BD\u98CE\u4E86\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5! ")})})},showDialog:function(t){var i=this;this.marryAttitudeDialog&&this.marryAttitudeDialog.close(),this.marryAttitudeDialog=null,this.marryAttitudeDialog=new $.dialog({title:t.title,html:'<p class="marry-dialog-content" >'+t.content+'<p><p class="marry-dialog-tip" >'+t.tip+'</p><div class="marry-dialog-btn-wrapper" ><a class="btn-middle btn-sub" j-marry-dialog-close >\u518D\u60F3\u60F3</a>'+t.btns+"</div>",width:500,holderClassName:"marry-dialog"}),this.marryAttitudeDialog.element.on("click","[j-marry-dialog-close]",function(){i.marryAttitudeDialog.close()})},showAlert:function(t,i){new $.dialog({title:i?i:"\u63D0\u793A",html:'<p style="text-align:center" >'+t+"</p>"})}}});_.Module.define({path:"props/widget/Residual",requires:[],sub:{initial:function(i){this.dataObj=i,this.initOptions()},initOptions:function(){this.options={1070001:"worship",1070002:"egg"}},getResidualKey:function(i){for(var e=i.props||{},s=null,n="",t=["1070002","1070001"],a=0;a<t.length;a++)if(s=e[t[a]],s&&s.num>0&&s.end_time>Env.server_time/1e3){n=this.options[t[a]];break}return n},showUI:function(i){var e=i.wrap,s="",n=null,t=i.key||this.getResidualKey(i);t&&(s="residual_wrap residual_wrap_"+t,n=e.find(".residual_wrap"),n[0]?n.removeClass().addClass(s):(n=$('<div class="'+s+'"></div>'),e.append(n)))}}});_.Module.define({path:"user/widget/SingleIcons",requires:["common/widget/Card"],sub:{_card:null,initial:function(){this._wrap=$("body"),this._bindEvents()},_bindEvents:function(){var t=this;t._wrap.on("mouseenter",".j_singleforum_show",function(o){o.currentTarget===this&&t._buildCard(this)}).on("mouseleave",".j_singleforum_show",function(){return t._card&&t._card.closeCard(),t._card=null,!1})},_buildCard:function(t){var o=$(t),e=o.getData(),n=this;e&&$.post("/icon/getForumNameByForumId",{forum_id:e.forum_id,tbs:PageData.tbs,ie:"utf-8"}).success(function(t){0==t.no&&n._buildPop(o,t.data)})},_getAllForumName:function(t){var o=[];for(var e in t)t.hasOwnProperty(e)&&o.push(t[e].forum_name);return o.join(",")},_buildPop:function(t,o){var e=this,n=e._getAllForumName(o),i="\u53EA\u5728"+n+"\u5427\u5C55\u793A",r=t.offset().left-50+t.width()/2,a=t.offset().top-18-12;this._card=this.use("common/widget/Card",{content:i,card_css:{top:a,left:r,width:100},clazz:"single_icon_class",auto_positon:!1,event_target:t,wrap:$("body")}),this._card.showCard({type:"delayShow",time:200})}}});!function(t){function a(a){if(PageData.user.is_login){t.stats.sendRequest("fr=tb0_forum&st_mod=idisk&st_type=download");var e=t(a);return t.post("/data/filepost?method=update_file_statistic",{fs_id:e.data("fsId"),thread_id:PageData.thread.thread_id,forum_id:PageData.forum.forum_id,stat_kind:0,tbs:PageData.tbs}),!0}return TbCom.process("User","buildLoginFrame"),!1}function e(a){if(PageData.user.is_login){t.stats.sendRequest("fr=tb0_forum&st_mod=idisk&st_type=forward");var e={31061:"\u6587\u4EF6\u5DF2\u5B58\u5728",31112:"\u767E\u5EA6\u4E91\u7A7A\u95F4\u4E0D\u8DB3&nbsp;<a href='http://pan.baidu.com' target='_blank'>\u6574\u7406\u7F51\u76D8</a> "},d=t(a);t.post("/data/filepost",{method:"archiveFile",src_uk:d.data("uk"),src_path:d.data("filePath"),dst_path:"/"+d.data("fileName"),tbs:PageData.tbs},function(a){var i;return a.status&&"-3"==a.status?(t.dialog.alert("<div style='padding: 20px 30px; text-align: center;'>\u64CD\u4F5C\u5931\u8D25\u4E86\uFF0C\u5237\u65B0\u4E00\u4E0B\u8BD5\u8BD5</div>",{width:300}),void 0):(a.error_code?(i=e[a.error_code],i||(i="\u8F6C\u5B58\u5931\u8D25"),t.dialog.alert("<div style='padding: 20px 30px; text-align: center;'>"+i+"</div>",{width:300})):d.hide().after("<a class='file_link' target='_blank' href='http://pan.baidu.com'>\u5DF2\u8F6C\u5B58</a>"),void 0)},"json"),t.post("/data/filepost?method=update_file_statistic",{fs_id:d.data("fsId"),thread_id:PageData.thread.thread_id,forum_id:PageData.forum.forum_id,stat_kind:1,tbs:PageData.tbs})}else TbCom.process("User","buildLoginFrame");return!1}window.diskmanager={};var d=window.diskmanager;d.onClickDownload=a,d.onClickSaveToMine=e}(jQuery);_.Module.define({path:"encourage/widget/paypost_guide",sub:{_options:{},initial:function(i){this._guideClassName="paypost_guide_"+i.position,this._guideStorageName="pg-"+i.position,this._payType=i.payType,this._options=i,this._render(),"link"==i.position?this._linkGuide():this._showGuide()},_render:function(){$.tb.Storage.get(this._guideStorageName)||this._options.$root.addClass(this._guideClassName)},_showGuide:function(){$.tb.Storage.set(this._guideStorageName,1)},_linkGuide:function(){var i=this;this._options.$root.on("click",function(){$.tb.Storage.set(i._guideStorageName,1),window.open("http://tieba.baidu.com/p/3702205481")})}}});_.Module.define({path:"pb/widget/paypost",requires:["tbmall/widget/TbeanSafeAjax","common/widget/Tdou/TdouViewPay"],sub:{$root:null,isRefresh:!1,API:{genOrder:"/diamond/submit/paypost/pay",appraise:"/diamond/submit/paypost/appraise",getThreadInfo:"/diamond/paypost/getThreadInfo"},initial:function(a){try{this.$root=a.$root,this.thread_id=a.thread_id,this.postHidden=a.postHidden,this._loadData(),this._bindEvents()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/paypost/paypost.js",method:"",ln:24}),t}},_loadData:function(){var a=this;$.get(this.API.getThreadInfo,{tbs:PageData.tbs,thread_id:this.thread_id,t:(new Date).getTime()},function(t){0==t.errno?a._show(t.data):a.$root.hide()})},_show:function(a){this._renderBuyer(a.evaluation.buyers),this.postHidden&&this._renderHiddenTip(a.score),this._renderEvaluation(a)},_render:function(a,t,o){var e=baidu.template(t,o);this.isRefresh?a.html(e):a.append(e)},_renderBuyer:function(a){var t="<p>\u5DF2\u6709<b><%=buyers%></b>\u4EBA\u67E5\u770B</p>";this._render(this.$root.find(".j_paypost_buyer"),t,{buyers:a})},_renderHiddenTip:function(a){var t='<div class="col2_left">   \u672C\u8D34\u5305\u542B\u9690\u85CF\u5185\u5BB9\uFF0C<br/>   \u5411\u697C\u4E3B\u652F\u4ED8<i class="icon_tdou"></i><span class="orange_text"><%=score%></span>\u5373\u53EF\u67E5\u770B\u3002 </div> <div class="col2_right">   <a href="javascript:;" class="ui_btn ui_btn_m j_paypost_pay">     <span><em>\u67E5 \u770B</em></span>   </a> </div>';this._render(this.$root.find(".j_paypost_hidden_tip"),t,{score:a})},_renderEvaluation:function(a){var t='<span class="e_evaluation_tip">\u8BC4\u4EF7\uFF1A</span> <% if (evaluation.support > 0 || evaluation.oppose > 0 || typeof opinion!= \'undefined\') { %> <span class="e_support"><%=evaluation.support%>\u4EBA</span> <span class="e_oppose"><%=evaluation.oppose%>\u4EBA</span> <span class="e_support_desc">\u7B26\u5408\u63CF\u8FF0</span> <span class="e_oppose_desc">\u4E0D\u7B26\u5408\u63CF\u8FF0</span> <%if (evaluation.support > 0) {%> <span class="e_support_tra"></span> <% } %> <%if (evaluation.oppose > 0) {%> <span class="e_oppose_tra"></span> <% } %> <div class="paypost_evaluation_color <% if (evaluation.oppose != 0 || evaluation.support != 0) { %>paypost_evaluation_color_disabled<% } %>">   <div class="support" style="width: <%= (evaluation.oppose + evaluation.support === 0) ? 50 : 100 * evaluation.support/(evaluation.oppose + evaluation.support)%>%"></div><div class="oppose" style="width: <%=(evaluation.oppose + evaluation.support === 0) ? 50 : 100 * evaluation.oppose/(evaluation.oppose + evaluation.support)%>%"></div> </div> <% } else { %> <div class="paypost_evaluation_empty"><i class="icon_evaluation_empty"></i></div> <% } %> <% if (typeof opinion!= \'undefined\') { %> <a href="javascript:;" class="j_paypost_appraise icon_appraise_1 <% if (opinion == 1) {%>icon_appraise_1_active<% } if (opinion > 0) {%> icon_appraise_disabled<% } %>" data-opinion="1"></a> <a href="javascript:;" class="j_paypost_appraise icon_appraise_2 <% if (opinion == 2) {%>icon_appraise_2_active<% } if (opinion > 0) {%> icon_appraise_disabled<% } %>"" data-opinion="2"></a> <% } %>';this._render(this.$root.find(".j_paypost_evaluation"),t,a)},_bindEvents:function(){var a=this;this.$root.on("click",".j_paypost_pay",function(){try{a._checkLogin()&&a._genOrder(a._tdouPay)}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/paypost/paypost.js",method:"",ln:71}),t}}),this.$root.on("click",".j_paypost_appraise",function(){try{if(a._checkLogin()){var t=this,o=$(t).data("opinion");$.post(a.API.appraise,{tbs:PageData.tbs,thread_id:a.thread_id,opinion:o},function(e){0==e.errno&&($(t).addClass("icon_appraise_"+o+"_active"),a.isRefresh=!0,a._show(e.data),a._showAnimation(o))})}}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/paypost/paypost.js",method:"",ln:92}),e}})},_showAnimation:function(a){var t,o={1:{desc:"support",txt:"+1"},2:{desc:"oppose",txt:"-1"}},e=this.$root.find(".icon_appraise_"+a).offset();t=$('<div class="paypost_animate_'+o[a].desc+'" />').text(o[a].txt).appendTo($("body")).css({top:e.top-10,left:e.left}).animate({top:e.top-40,left:e.left,opacity:0},function(){t.remove()})},_checkLogin:function(){return PageData.user.is_login?!0:(this.requireInstanceAsync("common/widget/LoginDialog"),!1)},_genOrder:function(a){var t=this.requireInstance("tbmall/widget/TbeanSafeAjax"),o=this;t.post(this.API.genOrder,{tbs:PageData.tbs,thread_id:o.thread_id},function(t){0==t.errno&&a.call(o,t.data)})},_tdouPay:function(a){var t=this,o=t.requireInstance("common/widget/Tdou/TdouViewPay",function(a){a.data.no||$.tb.location.reload()});o.createMain(a)}}});_.Module.define({path:"props/component/PropsApi",requires:["common/component/JsPager"],sub:{initial:function(t){this.dataObj=t,this.initOptions(),this.bindEvents()},initOptions:function(){this.titleMap={"1070001_0":"\u4ED6\u4EEC\u5BF9\u6211\u4F7F\u7528\u4E86\u201C\u9B54\u62DC\u201D","1070001_1":"\u4ED6\u4EEC\u5BF9\u8D34\u4F7F\u7528\u4E86\u201C\u9B54\u62DC\u201D","1070002_0":"\u4ED6\u4EEC\u5BF9\u6211\u4F7F\u7528\u4E86\u201C\u9B54\u86CB\u201D","1070002_1":"\u4ED6\u4EEC\u5BF9\u8D34\u4F7F\u7528\u4E86\u201C\u9B54\u86CB\u201D"},this.urlMap={0:"/tbmall/getUserAppraise",1:"/tbmall/getPostAppraise"}},bindEvents:function(){var t=this,i=t.dataObj;$(".props_item_tail").live("click",function(){return t.propsData={props_id:$(this).data("propsid"),props_type:i.props_type},"0"==i.props_type&&(t.propsData.user_id=$(this).data("userid"),t.propsData.user_sex=$(this).data("usersex")),"1"==i.props_type&&(t.propsData.post_id=$(this).data("postid")),t.initPager=!0,t.showDialog(),!1})},getAttrsHtml:function(t){for(var i=null,s=[],a="",p=["user_id","user_sex","post_id","props_id"],e=0;e<p.length;e++)i=p[e],t[i]&&(a="data-"+i.replace(/_/,"")+'="'+t[i]+'"',s.push(a));return s.join(" ")},showUIHtml:function(t){for(var i=[],s=t.props||{},a=null,p=0,e=["1070001","1070002"],r=0;r<e.length;r++)t.props_id=e[r],a=s[e[r]],a&&(i.push('<li class="props_item_split"><span class="userinfo_split"></span></li>'),i.push('<li class="props_item props_item_'+e[r]+'">'),i.push('<a href="#" '+this.getAttrsHtml(t)+' class="props_item_tail">'),i.push('<span class="props_item_icon"></span>'),i.push('<span class="props_item_plus">'+String.fromCharCode(215)+"</span>"),i.push('<span class="props_item_num">'+a.num+"</span></li>"),i.push("</a>"),p++);return 0>p?"":i.join("")},showUI:function(t){var i=this.showUIHtml(t);i&&t.wrap.html(i)},showDialog:function(){this.initDialogData(),this.initDialogUI(),this.showOrUpdateList()},initDialogData:function(){var t=this.propsData,i=t.props_id+"_"+t.props_type,s=this.titleMap[i];if(t.user_id!==PageData.user.id){var a=t.user_sex;s=s.replace(/\u6211/,a)}this.dialogTitle=s,this.dataurl=this.urlMap[t.props_type],this.pn=0,this.pageSize=10,this.pageCount=8},initDialogUI:function(){var t=this;this.$wrap=$('<div class="props_userlist_wrap"></div>'),this.$userlist=$('<div class="props_userlist_main"></div>'),this.$wrap.append(this.$userlist),this.dialog=new $.dialog({title:t.dialogTitle,width:554,height:340,show:!1,html:this.$wrap})},showOrUpdateList:function(){var t=this,i=t.propsData,s={props_id:i.props_id,look_user_id:i.user_id||"",post_id:i.post_id||"",pn:t.pn,c:t.pageSize};$.tb.get(t.dataurl,s,function(i){i&&0==i.no?(t.list=i.data.list,t.updateList(),t.initPager&&i.data.total>1&&(t.initPager=!1,t.total=Math.ceil(i.data.total/t.pageSize),t.buildPager()),t.dialog.show()):t.showErrorDialog()})},showErrorDialog:function(){new $.dialog({title:"\u63D0\u793A",width:300,height:50,html:'<p style="text-align:center;font-size:14px;line-height:40px;">\u7F51\u7EDC\u9519\u8BEF\uFF0C\u8BF7\u91CD\u8BD5</p>'})},buildPager:function(){var t=$('<div class="props_userlist_pager"></div>');this.$wrap.append(t);var i=this,s=this.use("common/component/JsPager",{container:t,current:1,amount:i.pageCount,total:i.total});s.bind("pageChange",function(t,a){s.initial({current:a}),i.pn=a,i.showOrUpdateList()}),this.pager=s},updateList:function(){var t=this.list,i=[],s=null;i.push('<ul class="props_userlist">');for(var a=0;a<t.length;a++)s=t[a],i.push('<li class="userlist_item">'),i.push('<a class="userlist_head" href="/home/main?id='+s.portrait+'&fr=props" target="_blank"><img src="http://tb.himg.baidu.com/sys/portrait/item/'+s.portrait+'"/></a>'),i.push('<a class="userlist_name" href="/home/main?id='+s.portrait+'&fr=props" target="_blank">'+s.user_name+"</a>"),i.push('<p class="userlist_time">'+this.getShowtime(s.create_time)+"</p>"),i.push("</li>");i.push("</ul>"),this.$userlist.html(i.join(""))},getShowtime:function(t){t*=1e3;var i=new Date($.dateFormat(new Date(Env.server_time),"yyyy-MM-dd 00:00:00")).getTime();return t=t>i?$.dateFormat(new Date(t),"HH:mm"):$.dateFormat(new Date(t),"yyyy-MM-dd")}}});_.Module.define({path:"pb/widget/complientThread",requires:[],sub:{initial:function(){try{if(Page.checkLoadedModules("hot_thread_zhaohanyu"))return;var t=this;t.bindEvents()}catch(n){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:n.message||n.description,path:"pb:widget/complient_thread/complient_thread.js",method:"",ln:15}),n}},bindEvents:function(){var t=this;t.bindZan()},bindZan:function(){var t=this;$("#j_p_postlist").on("click",".j_niceThread",function(n){try{n=n||window.event;var e=n.target||n.srcElement,a=t.bindThreadData(e);$(e).hasClass("not_complient_thread")?t.sendThreadZan(e,a):$(e).hasClass("complient_thread")?t.sendCancelZan(e,a):alert("error")}catch(n){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:n.message||n.description,path:"pb:widget/complient_thread/complient_thread.js",method:"",ln:37}),n}})},sendThreadZan:function(t,n){var e=this,a=n.forum_id,i=n.thread_id,s=n.post_id,o=1==$(t).parent().hasClass("hot_complient_container")?2:n.post_no,r=n.user_id,d=n.user_name,l=n.content;$.ajax({url:"/godthread/likePost",data:{forum_id:a,thread_id:i,post_id:s,post_no:o,dstuid:r,dstuname:d,content:l,tbs:PageData.tbs},async:!1,type:"post",datatype:"json",success:function(n){0==n.no?e.changeTextAndClass(t,"add","not_complient_thread","complient_thread"):2==n.no||1==n.no?e.confirmAlert("\u77ED\u65F6\u95F4\u5185\u591A\u6B21\u63D0\u4EA4\uFF0C\u70B9\u8D5E\u65E0\u6548","\u8D34\u5427\u63D0\u793A"):110001==n.no?e.confirmAlert("\u767B\u9646\u540E\u624D\u53EF\u4EE5\u70B9\u8D5E\u54E6","\u8D34\u5427\u63D0\u793A"):3==n.no?e.confirmAlert("\u5F53\u524D\u8D26\u53F7\u6CA1\u6709\u70B9\u8D5E\u6743\u9650","\u8D34\u5427\u63D0\u793A"):161001==n.no?e.confirmAlert("\u4E0D\u80FD\u91CD\u590D\u70B9\u8D5E\u54E6","\u8D34\u5427\u63D0\u793A"):e.confirmAlert("\u70B9\u8D5E\u5931\u8D25","\u8D34\u5427\u63D0\u793A")},error:function(){e.confirmAlert("\u70B9\u8D5E\u5931\u8D25","\u8D34\u5427\u63D0\u793A")}})},sendCancelZan:function(t,n){var e=this,a=n.thread_id,i=n.post_id,s=n.user_id,o=n.user_name,r=n.content;$.ajax({url:"/godthread/unlikePost",data:{thread_id:a,post_id:i,dstuid:s,dstuname:o,content:r,tbs:PageData.tbs},type:"post",async:!1,datatype:"json",success:function(n){0==n.no?e.changeTextAndClass(t,"minus","complient_thread","not_complient_thread"):2==n.no||1==n.no?e.confirmAlert("\u77ED\u65F6\u95F4\u5185\u591A\u6B21\u63D0\u4EA4\uFF0C\u70B9\u8D5E\u65E0\u6548","\u8D34\u5427\u63D0\u793A"):110001==n.no?e.confirmAlert("\u767B\u9646\u540E\u624D\u53EF\u4EE5\u70B9\u8D5E\u54E6","\u8D34\u5427\u63D0\u793A"):3==n.no?e.confirmAlert("\u5F53\u524D\u8D26\u53F7\u6CA1\u6709\u70B9\u8D5E\u6743\u9650","\u8D34\u5427\u63D0\u793A"):161001==n.no?e.confirmAlert("\u4E0D\u80FD\u91CD\u590D\u53D6\u6D88\u70B9\u8D5E\u54E6","\u8D34\u5427\u63D0\u793A"):e.confirmAlert("\u53D6\u6D88\u70B9\u8D5E\u5931\u8D25","\u8D34\u5427\u63D0\u793A")},error:function(){e.confirmAlert("\u53D6\u6D88\u70B9\u8D5E\u5931\u8D25","\u8D34\u5427\u63D0\u793A")}})},bindThreadData:function(t){return $(t).parent().getData()},changeTextAndClass:function(t,n,e,a){var i=this,s=$(t).siblings(".j_complient_number"),o=s.tbattr("title");"add"==n?(o=parseInt(o)+1,s.tbattr("title",o),$("#j_p_postlist").off("click",".j_niceThread"),1==o?$(t).removeClass(e).addClass(a).siblings(".j_complient_number").find(".j_zan_word").css("display","none").siblings(".total_count_number").text(o).css("display","inline-block"):o>=1e3?$(t).removeClass(e).addClass(a).siblings(".j_complient_number").find(".total_count_number").text(parseInt(o/1e3)+"k"):$(t).removeClass(e).addClass(a).siblings(".j_complient_number").find(".total_count_number").text(o),i.bindZan()):"minus"==n&&(o=parseInt(o)-1,s.tbattr("title",o),$("#j_p_postlist").off("click",".j_niceThread"),0==o?$(t).removeClass(e).addClass(a).siblings(".j_complient_number").find(".total_count_number").css("display","none").siblings(".j_zan_word").css("display","inline-block"):o>=1e3?$(t).removeClass(e).addClass(a).siblings(".j_complient_number").find(".total_count_number").text(parseInt(o/1e3)+"k"):$(t).removeClass(e).addClass(a).siblings(".j_complient_number").find(".total_count_number").text(o),i.bindZan())},confirmAlert:function(t,n){$.dialog.alert(t,{title:n,acceptValue:"\u786E\u5B9A"})}}});