_.Module.define({path:"pb/widget/sub_list/postTail",requires:["props/component/PropsApi"],sub:{thread:{},power:{},initial:function(a){try{this.tailList=a.tailList,this.thread=PageData.thread,this.power=PageData.power,this.user=PageData.user,this.tailList=a.tailList,this.isLocal58=a.isLocal58,this.propsapi=this.use("props/component/PropsApi",{props_type:"1"})}catch(s){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:s.message||s.description,path:"pb:widget/sub_list/post_tail.js",method:"",ln:20}),s}},getPostTailTpl:function(a,s){var t='<div class="core_reply_tail '+(a.is_saveface?"save_card_reply_tail":"")+(a.is_reward?" reward_reply_tail ":"")+'">';return this.isLocal58||(t+=1==a.post_no?'<ul class="p_reply"><li><a href="#" class="p_reply_first">\u56DE\u590D</a></li></ul>':["<div class=\"j_lzl_r p_reply\" data-field=\"{'pid':'"+a.post_id+"','total_num':'"+a.comment_num+"'}\">",'<a href="#" class="lzl_link_unfold" style="display:'+(a.comment_num>0?"none":"")+';">\u56DE\u590D',a.comment_num>0?"("+a.comment_num+")":"","</a>",'<span class="lzl_link_fold" style="display:'+(a.comment_num>0?"":"none")+'">\u6536\u8D77\u56DE\u590D</span>',"</div>"].join("")),t+='<ul class="p_tail">'+this.showFloorNumAndDate(a)+"</ul>",t+=this.isLocal58?'<ul class="p_58cp"><li><a class="j_58_cp" href="#" onclick="return false;">\u6295\u8BC9</a></li></ul>':['<ul class="p_mtail">',this.getJubaoHtml(a,s,1),this.showTail(a),this.loadAdmin(a,s),"</ul>"].join(""),this.power.can_op_as_4thmgr&&(t+='<ul class="p_print_flower"><li data-uid="'+s.user_id+'" data-pid="'+a.post_id+'" class="print_reward j_print_reward">\u5370\u82B1\u5956\u52B1 <span class="print_seperator">|</span></li></ul>'),t+='<ul class="p_props_tail props_appraise_wrap">',t+=this.propsapi.showUIHtml({props:a.props||{},post_id:a.post_id}),t+="</ul>",t+=this.showMallTail(a),t+="</div>"},showFloorNumAndDate:function(a){var s=a.post_no+"\u697C",t="";return t+="1"==this.thread.thread_type?'<li class="lzl_time">'+s+"</li>":"<li><span>"+s+"</span></li>",t+="<li><span>"+a.date+"</span></li>"},getJubaoHtml:function(a,s){var t="",l=this.thread,i=this.power,e=this.user;if(!(1==l.thread_type&&1==a.post_no||(i.can_mask_delete||i.lz_del)&&1!=a.post_no)){var p=i.can_vip_jubao?"vip\u4E3E\u62A5":"\u4E3E\u62A5";if(e.user_id!=s.user_id||a.is_anonym){var n="window.open('http://tieba.baidu.com/complaint/info?type={type}&cid=0&tid="+l.thread_id+"&pid="+a.post_id+"','newwindow', 'height=900, width=800, toolbar =no, menubar=no, scrollbars=yes, resizable=yes, location=no, status=no');return false;";t='<li class="j_jb_ele"><a href="#" onclick="'+n.replace("{type}",0)+'" class="complaint complaint-opened" data-checkun="un">'+p+'</a>&nbsp;|<span class="super_jubao" style="display:none"><a href="#" onclick="'+n.replace("{type}",1)+'">\u4E2A\u4EBA\u4F01\u4E1A\u4E3E\u62A5</a><a href="#" onclick="'+n.replace("{type}",2)+'">\u5783\u573E\u4FE1\u606F\u4E3E\u62A5</a></span></li>'}else{var _="{'delete_mine':'1','index':'2','user_name':'"+s.user_name+"'}";p="\u5220\u9664",t='<li class="j_jb_ele"><a href="#" data-field='+_+' class="jb_in p_post_del_my post_del_href" data-checkun="un">'+p+"</a>&nbsp;|</li>"}}return t},showTail:function(a){var s=a.open_id,t=a.open_type,l=this.tailList,i={1:"1",4:"1",5:"1",6:"1",youliao:"1"};"wap"!==s||i.openType||"sharexc"==t||"webipad"==t||(t="phone");var e=s+"_"+t,p=l[e]?l[e]:[],n=p[0],_=p[1],o=p[2],r="";return n&&(r="xiangce"===t?'<li><span class="p_tail_txt">\u901A\u8FC7</span><a class="p_tail_wap" data-tip="'+o+'" href="'+_+'" target="_blank">'+n+'</a><span class="p_tail_txt">\u4E0A\u4F20</span></li>':"shenqi"===t?'<li><span class="p_tail_txt">\u901A\u8FC7</span><a class="p_tail_wap" data-tip="'+o+'" href="'+_+'" target="_blank">'+n+'</a><span class="p_tail_txt">\u4E0A\u4F20</span></li>':_&&o?'<li><span class="p_tail_txt">\u6765\u81EA</span><span class="tip_bubble_con"></span><a data-tip="'+o+'" class="p_tail_wap" href="'+_+'" target="_blank">'+n+"</a></li>":_?'<li><span class="p_tail_txt">\u6765\u81EA</span><a class="p_tail_wap" data-tip="'+o+'" href="'+_+'" target="_blank">'+n+"</a></li>":o?'<li><span class="p_tail_txt"></span><span class="tip_bubble_con"></span><a data-tip="'+o+'" class="p_tail_font"  >\u672C\u697C\u542B\u6709'+n+"</a></li>":'<li><span class="p_tail_txt">\u6765\u81EA</span>'+n+"</li>"),r},loadAdmin:function(a,s){var t=this.power,l=this.user,i="",e="&nbsp;|",t=this.power,l=this.user;return a.is_anonym?t.can_filter_ip&&(i+='<li><a class="p_post_ban_anonym" href="#">\u5C01</a>'+e+"</li>"):t.can_filter_id&&(i+='<li><a class="p_post_ban" href="#">\u5C01</a>'+e+"</li>"),1!=a.post_no&&(t.can_mask_delete||t.lz_del&&!l.forbidden.isForbid&&!l.is_black)&&(i+='<li><a class="p_post_del" href="#">\u5220\u9664</a>'+e+"</li>"),t.can_super&&!a.is_anonym&&(i+='<li><a class="p_tieba_manage" href="/f?ct=503316480&cm=6000&tn=bdUserManager&un='+encodeURIComponent(s.user_name)+'" target="_blank">\u8D34\u5427\u7BA1\u7406</a>&nbsp;|</li>'),i},showMallTail:function(a){var s="",t={1019001:"1",1019002:"1",1019003:"1",1049001:"1",1049002:"1",1049003:"1"};return(a.is_bub||a.ptype&&7==a.ptype.length&&!t[a.ptype])&&(s='<a href="/tbmall/home" class="p_mall_tail" target="_blank"></a>'),s}}});
;_.Module.define({path:"pb/widget/postList/Lzl",requires:["pb/widget/Admin","user/widget/Icons"],sub:{editor_entry:null,_reach_limit:!1,_new_reply_num:0,initial:function(t){try{if(Page.checkLoadedModules("lzlHasLoad"))return;this.postJdom=t,this.wapperDOM=$("#j_p_postlist"),this.icons=this.use("user/widget/Icons"),this._admin=this.use("pb/widget/Admin"),this._init()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:29}),e}},_init:function(){this._showJubao(),this._bindEditorEntry(),this._bindFoldClick(),this._bindClick()},_showLzlJubao:function(t){if(!PageData.power.can_mask_delete&&!PageData.power.lz_del){var e,e=(PageData.power.can_vip_jubao?"vip\u4E3E\u62A5":"\u4E3E\u62A5",t.find("li.j_lzl_s_p"));e.each(function(){var t=$(this).find("a").filter(function(){return $(this).tbattr("username")}).tbattr("username"),e="";if(PageData.user.user_name==t)var i="\u5220\u9664",e="{'delete_mine': 1, 'user_name' : '"+t+"'}",l='<a href="#" class="lzl_jb_in" data-field="'+e+'">'+i+"</a>&nbsp;|&nbsp;";else{var o=$(this).data("field");if(o)var i=PageData.power.can_vip_jubao?"vip\u4E3E\u62A5":"\u4E3E\u62A5",a="",l='<a href="#" class="lzl_jb_in" onclick="'+a.replace("{type}",0)+'">'+i+"</a>&nbsp;|&nbsp;";else l=""}$(this).find(".lzl_jb").html(l)})}},_bindFoldClick:function(){var t=this;this.wapperDOM.delegate(".lzl_link_unfold","click",function(e){try{var i=e.srcElement||e.target;return PageData.user.is_login?(t._loadLzlContent($(i)),t._unfoldLzl($(i))):TbCom.process("User","buildLoginFrame",null,null,null,"lzl_reply"),!1}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:84}),e}}).delegate(".lzl_link_fold","click",function(e){try{var i=e.srcElement||e.target;t._foldLzl($(i))}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:87}),e}})},_loadLzlContent:function(t){var e=t.parents(".j_l_post");LzlEditor.cur_optdom.postJdom=e;e.find(".j_lazy_lzl");LzlEditor.cur_optdom.jdom=e.find(".j_lzl_wrapper"),LzlEditor.cur_optdom.mainDom=LzlEditor.cur_optdom.jdom.find("div.j_lzl_container"),LzlEditor.cur_optdom.tailDom=LzlEditor.cur_optdom.jdom.find("div.j_lzl_r"),LzlEditor.cur_optdom.mainData=LzlEditor.cur_optdom.mainDom.getData(),LzlEditor.cur_optdom.tailData=LzlEditor.cur_optdom.tailDom.getData(),AntiAnswerLzl=new CaptchaReqCom({forumName:PageData.forum.name_url,forumId:PageData.forum.forum_id,tid:PageData.thread.thread_id,postType:"reply"})},_updateReplyNum:function(t){var e=0;if(t)e=t;else{this._new_reply_num++;var e=1*this.mainData.total_num+this._new_reply_num}this.tailDom.find("a.lzl_link_unfold").html("\u56DE\u590D("+e+")")},_foldLzl:function(t){var e=t.parents(".j_l_post").find(".j_lzl_container");if(LzlEditor.cur_sec){var i=LzlEditor.cur_sec;i.find("span.close").click(),LzlEditor._s_p._ie6RelativeHack()}e.slideUp("normal",function(){t.hide(),t.parent().find("a.lzl_link_unfold").show(),$(document).trigger("sub_list_reply_toggled")})},_unfoldLzl:function(t){var e=this;if(e.target=t,t.hide(),t.parent().find("span.lzl_link_fold").show(),LzlEditor._lzl&&LzlEditor._lzl.mainData.pid==LzlEditor.cur_optdom.mainData.pid){var i="";LzlEditor._s_p._se&&(i=LzlEditor._s_p._se.getContent()),LzlEditor._lzl=null,LzlEditor._hide(),LzlEditor.cur_sec.empty(),LzlEditor.init(e),LzlEditor._s_p._se&&LzlEditor._s_p._se.ready(function(){LzlEditor._s_p._se.execCommand("inserthtml",i)}),LzlEditor._s_p._ie6RelativeHack(),CaptchaLzl&&!CaptchaLzl.needUpdate&&CaptchaLzl.reload(),LzlEditor.cur_sec.parent().show(),e.mainDom.slideDown("normal",function(){LzlEditor._s_p._ie6RelativeRecover(),$(document).trigger("sub_list_reply_toggled")})}else LzlEditor.init(e),LzlEditor._s_p._ie6RelativeHack(),LzlEditor.cur_sec.parent().show(),e.mainDom.slideDown("normal",function(){LzlEditor._s_p._ie6RelativeRecover(),$(document).trigger("sub_list_reply_toggled")});LzlEditor._s_p._se&&LzlEditor._s_p._se.focus(),$.stats.sendRequest("fr=tb0_forum&st_type=lzl_unfold")},_showJubao:function(){this.wapperDOM.delegate(".j_lzl_s_p","mouseover",function(){$(this).find(".lzl_jb").show()}).delegate(".j_lzl_s_p","mouseout",function(){$(this).find(".lzl_jb").hide()})},asyncImage:function(t,e){var i=t.find("img."+e);return 0==i.length?!1:($.each(i,function(t,e){e.src=e.getAttribute("data-passive")||e.getAttribute("src")}),void 0)},_bindClick:function(){var t=this;this.wapperDOM.delegate(".j_lzl_m","click",function(){try{if(PageData.user.is_login){var e=$(this).parents(".j_lzl_m_w");return t.asyncImage($("#"+$(this).tbattr("lzlid")),"forasync"),e.find(".lzl_post_hidden").slideDown("normal",function(){$(document).trigger("sub_list_reply_toggled")}),e.find(".j_pager").show(),e.find(".lzl_more").hide(),$.stats.sendRequest("fr=tb0_forum&st_type=lzl_more"),!1}return _.Module.use("common/component/force_login",["","userbar","dialog","pb_lzl_more"]),!1}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:232}),i}}).delegate(".lzl_s_r","click",function(e){try{var i=e.target||e.srcElement;return PageData.user.is_login?(t._loadLzlContent($(i)),t._fastReply($(i)),LzlEditor._s_p._se&&LzlEditor._s_p._se.focus()):TbCom.process("User","buildLoginFrame",null,null,null,"lzl_interact"),!1}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:246}),e}}).delegate(".j_pager","click",function(e){try{if("A"==e.target.tagName){window.global&&"function"==typeof window.global.shieldPost&&window.global.shieldPost();var i=$(e.target),l=$.tb.unescapeHTML(i.tbattr("index"));if(!l){var o=$.tb.unescapeHTML(i.tbattr("href")).split("#");l=parseInt(o[1])}return t.mainDom=i.parents(".j_lzl_container"),t.mainData=t.mainDom.getData(),t.postJdom=i.parents(".j_l_post"),t._turnPage(t,l,i.parents(".core_reply_content")),!1}}catch(a){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:a.message||a.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:263}),a}})},_bindEditorEntry:function(){var t=this;t.wapperDOM.delegate(".j_lzl_p","click",function(){try{return t.editor_entry=$(this),PageData.user.is_login?(LzlEditor._lzl&&LzlEditor._lzl.mainData.pid==LzlEditor.cur_optdom.mainData.pid&&"none"!=LzlEditor.cur_sec.css("display")?LzlEditor._s_p._getHtml()?LzlEditor._s_p._se.setContent(""):LzlEditor._hide():(t._loadLzlContent($(this)),LzlEditor.init(t)),LzlEditor._s_p._se&&LzlEditor._s_p._se.focus(),!1):(TbCom.process("User","buildLoginFrame",null,null,null,"too_reply"),!1)}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/sub_list/sub_list_main.js",method:"",ln:294}),e}})},_fastReply:function(t){var e=t.parents(".j_lzl_s_p"),i=e.getData(),l="\u56DE\u590D&nbsp;"+i.user_name+"&nbsp;:";LzlEditor._lzl&&LzlEditor._lzl.mainData.pid==LzlEditor.cur_optdom.mainData.pid?LzlEditor._s_p._se&&(LzlEditor._s_p._se.$body.html(""),LzlEditor._show(),LzlEditor._s_p._se.execCommand("inserthtml",l)):(LzlEditor.init(this),LzlEditor._s_p._se&&LzlEditor._s_p._se.execCommand("inserthtml",l)),LzlEditor._s_p._setData(i)},_turnPage:function(t,e,i){var l=new Date;l=l.getTime(),$.ajax({url:"/p/comment",data:{tid:PageData.thread.thread_id,pid:t.mainData.pid,pn:e,t:l},dataType:"html",success:function(e){t._ajaxSucc(e,i),$.tb.location.setHash("noExistHash"),$.tb.location.setHash(t.mainData.pid+"l")},error:function(e){t._ajaxErr(e)}})},_ajaxSucc:function(t,e){var i=this;if(t&&t.length>200){var l=$(t);l.find(".voice_player .time").each(function(){$(window).trigger("initvoicelength",this)}),l.find(".voice_player_desc").remove(),this.mainDom.find("ul.j_lzl_m_w").html(l),i._showLzlJubao(e),this._admin.loadLzlAdmin(e),l.find(".lzl_cnt").each(function(){var t=$(this),e=t.getData().iconArr,l=t.getData().free_flag,o=e?i.icons.getPreIconHtml(e,l):"";t.prepend(o)}),$.browser.msie&&$.browser.version<=7&&this.postJdom.tbattr("class",$.tb.unescapeHTML(this.postJdom.tbattr("class")))}else{var o='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: &quot;\u5B8B\u4F53&quot;;"><table style="width:90%"><tbody><tr><td width="60"><img style="border:none;" src="http://tb2.bdstatic.com/tb/img/errorFace.gif"></td><td valign="middle" style="font-size:20px;line-height:22px;font-family: &quot;\u9ED1\u4F53&quot;;">\u670D\u52A1\u5668\u5F88\u5FD9</td></tr></tbody></table>\u8BF7\u5237\u65B0\u9875\u9762\uFF0C\u7A0D\u540E\u518D\u8BD5</div>',a=$.dialog.alert(o,{width:410,height:95,title:"\u9519\u8BEF\u63D0\u793A"});a.bind("onclose",function(){return!0})}},_ajaxErr:function(){var t='<div style="margin: 0px 30px 0px 30px;font-size:14px;line-height:20px;text-align:left;font-family: &quot;\u5B8B\u4F53&quot;;"><table style="width:90%"><tbody><tr><td width="60"><img style="border:none;" src="http://tb2.bdstatic.com/tb/img/errorFace.gif"></td><td valign="middle" style="font-size:20px;line-height:22px;font-family: &quot;\u9ED1\u4F53&quot;;">\u670D\u52A1\u5668\u5F88\u5FD9</td></tr></tbody></table>\u8BF7\u5237\u65B0\u9875\u9762\uFF0C\u7A0D\u540E\u518D\u8BD5</div>',e=$.dialog.alert(t,{width:410,height:95,title:"\u9519\u8BEF\u63D0\u793A"});e.bind("onclose",function(){return!0})}}});
;var LzlEditor={_lzl:null,default_options:{autoFocus:!0,autoEnable:!0,height:"40px",width:"527px",maxHeight:"40",wrapperClassName:"lzl_simple_wrapper",enableRefer:!0},options:{},cur_sec:null,cur_optdom:{},_s_p:null,init:function(i,l){LzlEditor.options={},$.extend(LzlEditor.options,LzlEditor.default_options),l&&$.extend(LzlEditor.options,l),LzlEditor._buildEditor(i)},_buildEditor:function(i){if(LzlEditor._lzl){if(LzlEditor._lzl.mainData.pid==LzlEditor.cur_optdom.mainData.pid)return LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").length>0&&1==$.tb.Storage.get("VoicePostorAdClosed")&&LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").remove(),LzlEditor.cur_sec.show(),LzlEditor._s_p._se&&LzlEditor._s_p._se.focus(),!1;var l=LzlEditor.cur_sec;l.find("span.close").click();var t=l.find(".tb-editor-editarea");t[0]&&t.html().length>0&&l.bindData({txt:t.html()}),LzlEditor._hide(),LzlEditor.cur_sec.empty(),LzlEditor._s_p=null;var o=LzlEditor._lzl.mainDom.find("li.j_lzl_s_p");0==o.length&&(LzlEditor._lzl.tailDom.find(".lzl_link_fold").hide(),LzlEditor._lzl.tailDom.find(".lzl_link_unfold").show(),LzlEditor._lzl.mainDom.hide())}LzlEditor._lzl=i,$.extend(LzlEditor._lzl,LzlEditor.cur_optdom);var l=i.jdom.find("div.j_lzl_e_c"),e=PageData.thread.topic;LzlEditor.cur_sec=l;var r=$.extend({container:l[0],uid:PageData.user.user_id},LzlEditor.options);LzlEditor._lzl._reach_limit=LzlEditor._limitCheck()||LzlEditor._lzl._reach_limit?!0:!1;var d={_can_post:PageData.power.can_post,_forum_type:PageData.forum_type,_no_un:PageData.user.no_un,_is_block:PageData.user.forbidden.isForbid?!0:!1,_reach_limit:LzlEditor._lzl._reach_limit,_login:PageData.user.is_login,_thread_topic_type:e.is_topic?"1":"0",_thread_topic_subtype:e.is_topic&&"2"==e.topic_type?"3":"0",data:LzlEditor._lzl.mainData,tpl_id:"j_simpleeditor_tpl"};_.Module.use("common/widget/SimplePoster",{op:d,edOp:r},function(i){i.bind("toTop",function(){$(window).scrollTop(0)},!0),i.bind("onsuccess",function(){LzlPostor._appendNew()},!0),i.bind("onclose",function(){LzlEditor._lzl._updateReplyNum(2e4),LzlEditor._lzl._reach_limit=!0,LzlEditor.init(LzlEditor._lzl)},!0),i.bind("hide",function(){LzlEditor._hide()},!0),LzlEditor._s_p=i});var n=l.getData();if(null!=n){var t=l.find(".tb-editor-editarea");t.html(n.txt)}LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").length>0&&1==$.tb.Storage.get("VoicePostorAdClosed")&&LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").remove(),l.show(),l.parent().find("input.j_lzl_e_f_h").show().focus().hide()},_limitCheck:function(){var i=!1,l=LzlEditor._lzl.jdom.find("li.j_lzl_l_p");if(0==l.length)return i;var t=l.getData();return t.total_num>=2e4&&(i=!0),i},_hide:function(){LzlEditor.cur_sec&&(LzlEditor.cur_sec.find("span.close").click(),LzlEditor.cur_sec.hide()),LzlEditor._lzl&&LzlEditor._lzl.editor_entry&&LzlEditor._lzl.editor_entry.show()},_show:function(){LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").length>0&&1==$.tb.Storage.get("VoicePostorAdClosed")&&LzlEditor.cur_sec.find(".j_lzl_p_sv .new_icon").remove(),LzlEditor.cur_sec&&LzlEditor.cur_sec.show()}};
;var LzlPostor={_appendNew:function(){var e=LzlEditor._lzl.jdom.find("ul.j_lzl_m_w");if(0==e.length){var a=LzlEditor._lzl.jdom.find("div.j_lzl_c_b_a");a.prepend($('<div class="lzl_big_splitline"></div>')),e=$('<ul class="j_lzl_m_w"></ul>'),a.prepend(e)}e.show();var t=$('<li class="lzl_single_post j_lzl_s_p"></li>');t.bindData({user_name:PageData.user.user_name});var s=$.tb.dataField({un:PageData.user.user_name}),l=' username="'+PageData.user.user_name+'"'+s,r="/home/main/?un="+encodeURIComponent(PageData.user.user_name)+"&fr=pb&ie=utf-8",i="";i+='<div class="lzl_p_p">',i+='  <a class="j_user_card" href="'+r+'" '+l+'><img src="http://tb.himg.baidu.com/sys/portrait/item/'+PageData.user.portrait+'" style="visibility:hidden;" onload="Page.resizePic(this, 32, 32, true);"/></a>',i+="</div>",i+='<div class="lzl_cnt">',_.Module.use("user/widget/Icons",null,function(e){i+=e.getPreIconHtml(PageData.user.mParr_props,PageData.user.free_flag)}),i+='  <a class="at j_user_card" href="'+r+'" '+l+">"+(PageData.user.profession_manager_nick_name||("1"==PageData.user.is_verify?PageData.user.user_nickname:PageData.user.user_name))+"</a>",i+="1"==PageData.user.is_verify||0!==PageData.user.user_type?'<img style="vertical-align: middle;margin-top: -3px;" src="http://tb2.bdstatic.com/tb/img/itieba_vip.gif" title="\u8D34\u5427\u5B98\u65B9\u8BA4\u8BC1" width="11" height="18" class="verified_icon">':"",i+='   :<span class="lzl_content_main">',i+=LzlEditor._s_p._getHtml(),i+="    </span>",i+='  <div class="lzl_content_reply">',i+='    <span class="lzl_time">'+LzlPostor.getCurrentTime()+"</span>",i+='    <a href="#" class="lzl_s_r">\u56DE\u590D</a>',i+="  </div>",i+="</div>",t.html(i),t.insertBefore(e.find("li.j_lzl_l_p")),LzlEditor._lzl._updateReplyNum()},getCurrentTime:function(){function e(e){return 10>1*e?"0"+e:e}var a=new Date,t="";return t+=a.getFullYear()+"-",t+=a.getMonth()+1+"-",t+=a.getDate()+"&nbsp;",t+=e(a.getHours())+":",t+=e(a.getMinutes())}},AntiAnswerLzl,CaptchaLzl;
;_.Module.define({path:"pb/widget/sub_list/subListTotal",requires:["user/widget/pbUserBase","user/widget/Icons","common/component/JsPager","props/component/PropsApi"],sub:{initial:function(e){try{this._searchCid=e.searchCid,this._commentList=e.commentData.comment_list,this._userList=e.commentData.user_list,this._icons=this.requireInstance("user/widget/Icons"),this._user=this.requireInstance("user/widget/pbUserBase"),this.propsapi=this.requireInstance("props/component/PropsApi",[{props_type:"1"}])}catch(s){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:s.message||s.description,path:"pb:widget/sub_list/sub_list_total.js",method:"",ln:25}),s}},showLzlPost:function(e){var s=this,t=$(e),i=t.closest(".j_l_post").getData().content;0==i.comment_num&&t.hide(),t.bindData({pid:i.post_id,floor_num:i.post_no,total_num:i.comment_num}).html(s._getSubContent(i)).css("minHeight",0);var n=i,a=this.propsapi.showUIHtml({props:n.props||{},post_id:n.post_id});t.closest(".j_lzl_wrapper").find(".props_appraise_wrap").html(a),t.closest(".j_lzl_wrapper").find(".voice_player .time").each(function(){$(window).trigger("initvoicelength",this)})},_getSubContent:function(e){var s=e.comment_num>0?"":"none";e.page={total_page:Math.floor((e.comment_num-1)/10)+1,cur_page:1};var t=['<div class="core_reply_border_top"></div>','<div class="j_lzl_c_b_a core_reply_content">','<ul class="j_lzl_m_w" style="display:'+s+'">',this._getSubPostList(e),"</ul>",'<div class="lzl_editor_container j_lzl_e_c lzl_editor_container_s" style="display:none;"></div>','<input type="text" class="j_lzl_e_f_h" style="display:none;" />',"</div>",'<div class="core_reply_border_bottom"></div>'].join("");return t},_getSubPostList:function(e){for(var s,t,i="",n=this._commentList[e.post_id],a="",l="",_=n&&n.comment_info?n.comment_info:[],r=0;r<_.length;r++)s=_[r],t=this._userList[s.user_id]||{},5==r&&(l="lzl_hidden_"+e.post_index,a+='<ul class="lzl_post_hidden" id="'+l+'">',i=!0),t.nickname=t.is_verify||t.is_official?t.nickname:t.user_name,a+=['<li class="lzl_single_post j_lzl_s_p '+(0==r?"first_no_border":"")+"\" data-field=\"{'pid':'"+e.post_id+"','spid':'"+s.comment_id+"','user_name':'"+t.user_name+"','portrait':'"+t.portrait+"'}\" >",this._user.face_link(t),'<div class="lzl_cnt">',this._icons.getPreIconHtml(t.mParr_props),this._user.name_link(t),"1"==t.is_verify||"1"==t.is_official||0!==t.user_type?'<img style="vertical-align: middle;margin-top: -3px;" src="http://tb2.bdstatic.com/tb/img/itieba_vip.gif" title="\u8D34\u5427\u5B9E\u540D\u8BA4\u8BC1" width="11" height="18" class="verified_icon" />':"",':&nbsp;<span class="lzl_content_main">',this._searchCid==s.comment_id?"<b>"+s.content+"</b>":s.content,this._getVoiceHtml(s),"</span>",this._getReplyHtml(s,t),"</div>","</li>"].join("");return a+=i?"</ul>":"",a+=this._getLzlPager(e,l),delete this._commentList[e.post_id],a},_getLzlPager:function(e,s){var t='<li class="lzl_li_pager j_lzl_l_p lzl_li_pager_s" data-field="{total_num:'+e.comment_num+",total_page:"+e.page.total_page+'}" >';return t+='<a class="j_lzl_p btn-sub btn-small pull-right" href="##"><i class="icon-reply"></i>\u6211\u4E5F\u8BF4\u4E00\u53E5</a>',e.comment_num>5?(t+='<p class="lzl_more">',t+="<span>\u8FD8\u6709"+(e.comment_num-5)+"\u6761\u56DE\u590D\uFF0C</span>",t+='<a href="#" class="j_lzl_m" lzlid="'+(s?s:"")+'">\u70B9\u51FB\u67E5\u770B</a>',t+="</p>",t+='<p class="j_pager l_pager pager_theme_2 lzl_pager" style="display:none">',e.comment_num>10?(this._pager=this.requireInstance("common/component/JsPager",[{current:1,total:e.page.total_page,mode:1,url:"#",isHtml:!0,classname:{current:"tP"}}]),t+=this._pager._render()):t+="&nbsp",t+="</p>"):t+="<p>&nbsp;</p>",t+="</li>"},_getForbiddenTip:function(e){var s="";return e.exist_forbidden_tip&&(s='<p class="lzl_thread_forbidden_tip j_lzl_thread_forbidden_tip" >\u672C\u697C\u5305\u542B\u90E8\u5206\u5E7F\u544A\u7B49\u8FDD\u89C4\u5185\u5BB9\u7684\u56DE\u590D\uFF0C\u5DF2\u7ECF\u88AB\u5C4F\u853D\uFF0C\u6682\u4E0D\u53EF\u89C1\u3002<span class="lzl_forbidden_tip_close j_lzl_forbidden_tip_close">x</span></p>'),s},_getVoiceHtml:function(e){var s,t,i="";return e.ptype&&(s=e.during_time?Math.floor(e.during_time/60):"0",t=e.during_time?e.during_time%60:"0",i=['<br/><div class="voice_player voice_player_mini voice_player_lzl">','<a href="#" class="voice_player_inner">','<span class="before">&nbsp;</span><span class="middle"><span class="speaker speaker_animate">&nbsp;</span>','<span class="time">',s>0?'<span class="minute">'+s+"</span>&#039;":"",t>0||s>0?'<span class="second">'+t+"</span>&quot;":"","</span>","</span>",'<span class="after">&nbsp;</span>',"</a>","</div>"].join("")),i},_getReplyHtml:function(e,s){var t="",i=PageData.power,n=PageData.user;return t+='<div class="lzl_content_reply"><span class="lzl_jb"  style="display:none">',i.can_mask_delete||i.lz_del||(t+=s.user_name==n.user_name?"<a href=\"#\" data-field=\"{'delete_mine':'1','user_name':'"+s.user_name+'\'}" class="lzl_jb_in" >\u5220\u9664</a>&nbsp;|':"<a href=\"#\" data-field=\"{'delete_mine':'0','user_name':'"+s.user_name+'\'}" class="lzl_jb_in" >'+(i.can_vip_jubao?"vip\u4E3E\u62A5":"\u4E3E\u62A5")+"</a>&nbsp;|&nbsp;"),t+='</span><span class="lzl_op_list j_lzl_o_l">',t+=this._loadLzlAdmin(s,i,n),t+='</span><span class="lzl_time">'+this._getTime(e.now_time)+'</span><a href="#" class="lzl_s_r">\u56DE\u590D</a>',t+="</div>"},_loadLzlAdmin:function(e,s,t){var i="",n="&nbsp;|&nbsp;";return(s.can_filter_ip||s.can_filter_id)&&(i+='<a href="#" class="j_lzl_ban">\u5C01</a>'+n),(s.can_mask_delete||s.lz_del&&!t.forbidden.isForbid&&!t.is_black)&&(i+='<a href="#" class="j_lzl_del">\u5220\u9664</a>'+n),s.can_super&&(i+='<a href="/f?ct=503316480&cm=6000&tn=bdUserManager&un="'+e.user_name+' class="j_lzl_manage p_tieba_manage" target="_blank">\u8D34\u5427\u7BA1\u7406</a>'+n),i},_getTime:function(e){function s(e){return 10>1*e?"0"+e:e}var t;t=void 0==e?new Date:new Date(1e3*e);var i="";return i+=t.getFullYear()+"-",i+=t.getMonth()+1+"-",i+=t.getDate()+"&nbsp;",i+=s(t.getHours())+":",i+=s(t.getMinutes())}}});_.Module.define({path:"encourage/widget/deepread",requires:[],sub:{wrap:null,timeout:null,initial:function(){var e=window.PageData;0===$(".deepread-btn").length&&e&&e.product&&"pb"===e.product&&this.bindEvent()},bindEvent:function(){var e,a=this;e=$('<a class="deepread-btn" ></a>'),$(".core_title_wrap_bright").prepend(e),e.on("click",function(){a.deepRead(),$.stats.track("\u6C89\u6D78\u9605\u8BFB","\u65B0\u8D34\u5427\u5B9E\u9A8C\u5BA4","pb","click")})},buildHtml:function(e){var a=this,d=$(['<div  id="creative-platform-deepread-wrap">','<div id="deepread-wrap-background" class="deepread-wrap-background" ></div>','<div id="deepread-wrap" class="deepread-wrap">','<div id="deepread-nav" class="deepread-nav" >','<a j-deepread-nav-close class="deepread-nav-close">X</a>','<a j-deepread-nav-small class="deepread-nav-small">A</a> | ','<a  j-deepread-nav-big class="deepread-nav-big">A</a>',"</div>",'<div j-deepread-content class="deepread-content" >','<h2 class="deepread-title">'+PageData.thread.title+"</h2>",'<p class="deepread-author">'+PageData.thread.author+"</p>",e+"</div>","</div></div>"].join(""));this.wrap=d;var t=$(window).height(),n=$(window).width(),r=$(document).height();d.css({zIndex:$.getzIndex()}),d.find("#deepread-wrap-background").css({width:n+"px",height:r+"px",zIndex:$.getzIndex()}),d.find("#deepread-wrap").css({zIndex:$.getzIndex()}),d.find("[j-deepread-content]").css({height:t-60+"px"}),$("body").append(d),this.wrap.on("click","[j-deepread-nav-small]",function(e){e.preventDefault(),a.wrap.find("[j-deepread-content]").css({"font-size":"16px","line-height":"24px"})}).on("click","[j-deepread-nav-big]",function(e){e.preventDefault(),a.wrap.find("[j-deepread-content]").css({"font-size":"18px","line-height":"30px"})}).on("click","[j-deepread-nav-close]",function(e){e.preventDefault(),a.wrap.remove()}).on("click","#deepread-wrap-background",function(e){e.preventDefault(),a.wrap.remove()})},deepRead:function(){this.wrap&&this.wrap.remove();var e=$(".p_postlist").find(".j_d_post_content,.novel-post-content"),a="";e.each(function(e,d){var t=$(d),n=t.parents(".j_l_post,.l_post").eq(0).getData();n&&n.author&&n.author.user_name===PageData.thread.author&&(a+="<br /><br />"+t.html())}),this.buildHtml(a)}}});_.Module.define({requires:["tbmall/widget/TbeanSafeAjax","common/widget/Tdou/TdouViewPay"],path:"encourage/widget/novel_award_pb",sub:{URLS:{rewardNovelThread:"/novel/rewardNovelThread",getNextChapterThread:"/novel/getNextChapterThread",getLastChapterThread:"/novel/getLastChapterThread",getThreadByChapter:"/novel/getThreadByChapter"},expKey:.004,awardMap:{1000:{ticket:0},5000:{ticket:1},25000:{ticket:5},50000:{ticket:11}},bubble:!1,initial:function(a){this.novelDialog=null,this.novelAwardId=0,this.novel_intro_url=a.novel_intro_url,this.threadId=0,this.$root=$(".novel-post-section"),this.showNovelAwardTip(),this.bindEvent()},bindEvent:function(){var a=this,e={content:"\u6708\u7968\u662F\u5F71\u54CD\u529B\u6700\u5927\u7684\u4E00\u79CD\u7968\uFF0C\u80FD\u5F71\u54CD\u4F5C\u8005\u6C5F\u6E56\u5730\u4F4D\uFF0C\u4EBA\u6C14\u4EE5\u53CA\u6536\u5165\u3002",arrow_dir:"down",bubble_css:{top:2,right:-73,width:150},arrow_pos:{left:60},attr:" id='tb_message_tip_n' ",wrap:$(".j-novel-award-question-icon"),level:1,arrowReq:!0};this.$root.on("click",".novel-post-award-tip-btn",function(){$.cookie("already_click_novel_post_award_tip","1",{expires:365,path:"/"}),a.$root.find(".novel-post-award-tip").remove()}),$(".j-novel-next-chapter-btn").on("click",function(){var e=$(this).tbattr("data-pid"),t=$(this).tbattr("data-forumid");a._readNextChapter(e,t)}),this.$root.on("click",".j-novel-award-pb-btn",function(){if(!PageData.user.user_name)return new $.dialog({html:"\u8BF7\u8865\u5145\u7528\u6237\u540D\u540E\u518D\u6765\u6367\u573A\u54E6~"}),!1;$.stats.track(PageData.forum.forum_name,"\u767E\u5EA6\u6587\u5B66"),a.threadId=$(this).tbattr("data-threadid");var t=_.template('<div class="novel-award-dialog">     <div class="novel-award-title">         \u6367\u573A          <span class="novel-award-dialog-close-btn j-novel-award-dialog-close"></span>     </div>     <div class="novel-award-list clearfix">         <ul>             <% for(var i in awardList) {                  var item = awardList[i];              %>                 <li class="novel-award-item">                     <div class="novel-award-item-main" data-id="<%=item[\'id\'] %>">                         <img src="<%=item[\'img\'] %>">                         <div class="check"></div>                         <p>                             <i class="icon_tbean"></i>                             <%=item[\'id\'] %>                         </p>                     </div>                 </li>              <% } %>                          </ul>     </div>     <div class="novel-award-bottom">         <div>             <a class=" novel-ward-confim-btn j-novel-ward-confim-btn">\u786E\u5B9A\u6367\u573A</a>         </div>         <div>             <p class="novel-award-bttom-tip">                 *\u6BCF\u6367\u573A\u4E00\u6B21\uFF0C\u4F60\u5C06\u6536\u5230                 <span class="orange_text">5</span>                 \u5F20\u6708\u7968                 <span class="novel-award-question-icon j-novel-award-question-icon">?</span>                  +                 <span class="orange">20</span>                 \u672C\u5427\u7ECF\u9A8C             </p>         </div>     </div> </div>')({awardList:{1000:{id:1e3,img:"http://tb1.bdstatic.com/tb/cms/novel/novel_award_img_1.jpg"},5000:{id:5e3,img:"http://tb1.bdstatic.com/tb/cms/novel/novel_award_img_2.jpg"},25000:{id:25e3,img:"http://tb1.bdstatic.com/tb/cms/novel/novel_award_img_3.jpg"},50000:{id:5e4,img:"http://tb1.bdstatic.com/tb/cms/novel/novel_award_img_4.jpg"}}});a.novelDialog=new $.dialog({showTitle:!1,html:t,width:560}),a.novelDialog.element.on("click",".j-novel-ward-confim-btn",function(){a._checkLogin()&&a._genOrder(a._tdouPay)}).on("click",".novel-award-item-main",function(){a.bubble&&a.bubble.closeBubble(),a.novelAwardId=$(this).tbattr("data-id"),a.novelDialog.element.find(".novel-award-item-main").removeClass("active"),$(this).addClass("active");var t='*\u6BCF\u6367\u573A\u4E00\u6B21\uFF0C\u4F60\u5C06\u83B7\u5F97<span class="orange_text">'+a.novelAwardId*a.expKey+'</span>\u672C\u5427\u7ECF\u9A8C\uFF0C\u5E76\u6709\u673A\u4F1A\u62BD\u4E2D\u6708\u7968<span class="novel-award-question-icon j-novel-award-question-icon">?</span>';1e3!=a.novelAwardId&&(t='*\u6BCF\u6367\u573A\u4E00\u6B21\uFF0C\u4F60\u5C06\u6536\u5230<span class="orange_text">'+a.awardMap[a.novelAwardId].ticket+'</span> \u5F20\u6708\u7968<span class="novel-award-question-icon j-novel-award-question-icon">?</span> +<span class="orange">'+a.novelAwardId*a.expKey+"</span>\u672C\u5427\u7ECF\u9A8C");var n=$(".novel-award-bttom-tip");n.html(t),e.wrap=$(".j-novel-award-question-icon"),a.bubble=new UiBubbleTipBase(e)}).on("click",".j-novel-award-dialog-close",function(){a.novelDialog.close()}).on("mouseenter",".novel-award-question-icon",function(){a.bubble&&a.bubble.showBubble()}).on("mouseleave",".novel-award-question-icon",function(){a.bubble&&a.bubble.hideBubble()}),a.novelDialog.element.find(".novel-award-item-main").first().trigger("click")})},showNovelAwardTip:function(){var a=this.novel_intro_url;if(""!=a&&!$.cookie("already_click_novel_post_award_tip")){var e=['<div class="novel-post-award-tip">','    <a target="_blank" href="'+a+'" class="novel-post-award-tip-btn" >','<img src="',"http://tb2.bdstatic.com/tb/static-encourage/widget/novel_award_pb/img/novel_image_tip_67de1bf.png",'" /></a>',"   </div>"].join("");this.$root.find(".novel-post-award-section").append(e)}},_genOrder:function(a){var e=this.requireInstance("tbmall/widget/TbeanSafeAjax"),t=this;e.post("/novel/rewardNovelThread",{tbs:PageData.tbs,reward_tdou:t.novelAwardId,thread_id:t.threadId},function(e){0==e.no&&e.data?a.call(t,e.data):(new $.dialog({html:"\u8BA2\u5355\u51FA\u9519\uFF0C\u8BF7\u91CD\u8BD5\uFF08\u7CFB\u7EDF\u81EA\u52A8\u5237\u65B0)"}),$.tb.location.reload())})},_tdouPay:function(a){var e=this.requireInstance("common/widget/Tdou/TdouViewPay",function(a){a.data.no||$.tb.location.reload()});e.createMain(a)},_readNextChapter:function(a,e){var t=new $.dialog({showTitle:!1,html:"<p>\u4E0B\u4E00\u7AE0\u8DF3\u8F6C\u4E2D..</p>"}),n={forum_id:e,thread_id:a};$.get(this.URLS.getNextChapterThread,n,function(a){a&&0==a.no&&a.data?$.tb.location.setHref(a.data.thread_id):(t.setContent("\u5DF2\u7ECF\u662F\u6700\u540E\u4E00\u7AE0"),setTimeout(function(){t.close()},1e3))})},_checkLogin:function(){return PageData.user.is_login?!0:(this.requireInstanceAsync("common/widget/LoginDialog"),!1)}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,_=t.Parr_scores,u=0;_&&(u=_.scores_money+_.scores_other);var s=u>=e.tdou_num,c=0;s||(c=e.tdou_num-u);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,_=0;d||(_=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this,o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain()})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"user/widget/icon_tip",requires:["common/widget/Card"],sub:{_icon_tip:null,_icon_tip_ajax:null,_dialog:null,_iconData:{},_option:{width:300},initial:function(t){this.pageType=t.pageType,this.myIcons=t.myIcons,this.bindEvents()},bindEvents:function(){var t=this,i=$("body");i.find(".j_icon_slot").on("mouseenter",function(){t._icon_tip&&t._icon_tip.closeCard(),t.buildCard($(this))}).on("mouseleave",function(){t._icon_tip&&t._icon_tip.closeCard({type:"delayClose",time:200}),t._icon_tip=null}),i.on("click",".j_buy_icon_btn",function(i){i.preventDefault(),t.getOneIcon(t._iconData)}).on("click",".j_manage_icon_btn",function(i){i.preventDefault(),t.jumpToIhome()})},buildCard:function(t){var i=this;i._icon_tip&&(i._icon_tip.closeCard(),i._icon_tip=null);var n=t.getData();this._iconData=n;var e,a,o,r,c,l,_=_||1,s=50,p="http://tb1.bdstatic.com/tb/cms/com/icon/";if(n.sprite){if(e=n.sprite[n.value],!e)for(var u in n.sprite)if(n.sprite[u]&&(0!=n.value||"meizhi_level"==n.name)){e=n.sprite[u];break}a=e.split(","),o=a[0],r=a[1],l=p+n.category_id+"_36.png?stamp="+o,c='style="background: url('+l+") no-repeat -"+r*s+"px  -"+(_-1)*s+'px;"'}else c=t.css("background");var d=this.getIconTipHtml(n);if(!d)return!1;null==n.title&&(n.title=t.tbattr("title"));var f=['<div class="icon_tip_wrapper">','<div class="icon_tip_img" '+c+" />",'<div class="icon_tip_info">','<div class="icon_tip_title">'+n.title+(d.expired?d.expired:"")+"</div>",'<div class="icon_tip_intro">'+d.intro+"</div>",'<div class="icon_tip_btns">',d.btn,"</div>","</div>","</div>"].join(""),g={content:f,card_css:{width:i._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:t,attr:"id='icon_tip'",wrap:$("body")};i._icon_tip=i.requireInstance("common/widget/Card",g),i._icon_tip.showCard({type:"delayShow",time:200})},getOneIcon:function(t){var i=this,n=t.name;if(n){var e=$.dialog.confirm("\u786E\u5B9A\u8D2D\u4E70\u3010"+t.title+"\u3011\u5370\u8BB0\u561B\uFF1F\u5C06\u6D88\u8017\u60A8"+t.price+"T\u8C46",{title:"\u8D2D\u4E70\u5370\u8BB0\u63D0\u793A",acceptValue:"\u786E\u5B9A",cancelValue:"\u53D6\u6D88"});e.bind("onaccept",function(t){t.stopImmediatePropagation();var e={ie:"utf-8"};e.tbs=PageData.tbs,e.icon_name=n,e.level=1,i._icon_tip_ajax&&i._icon_tip_ajax.abort(),i._icon_tip_ajax=$.ajax({type:"post",url:"/icon/buyIcon",data:e,dataType:"json"}).success(function(t){if(t&&0===t.no){var n=t.data;return n.icon_info?(i.showDialog("\u8D2D\u4E70\u6210\u529F"),$.tb.location.reload(),void 0):(i.showDialog("\u8D2D\u4E70\u51FA\u9519\uFF0C\u8BF7\u67E5\u770B\u8D2D\u4E70\u8BB0\u5F55\u786E\u8BA4\u662F\u5426\u8D2D\u4E70\u6210\u529F"),void 0)}t&&2270028===t.no?i.showDialog("T\u8C46\u4E0D\u8DB3"):i.showDialog("\u8D2D\u4E70\u51FA\u9519\uFF0C\u6CA1\u6709\u8D2D\u4E70\u6210\u529F")})}).bind("oncancel",function(){})}},getIconTipHtml:function(t){if(null==t.intro||null==t.intro_url)return!1;if(this.whetherIHaveTheIcon(t,this.myIcons))return{intro:"<p>"+t.intro+' <a target="_blank" href="'+t.intro_url+'">\u8BE6\u60C5\u300B</a></p>',btn:'<a class="btn_default btn_small j_manage_icon_btn " href="" target="_blank" >\u7BA1\u7406\u5370\u8BB0</a>'};if(null!=t.price&&0!=t.price){var i='<p>\u4EF7\u683C:<i class="icon_tbean" style="vertical-align:middle;"></i><span class="orange_text " >'+t.price+'</span> <a target="_blank" href="'+t.intro_url+'">\u8BE6\u60C5\u300B</a></p>';return{intro:i,btn:'<a class="btn_default btn_small j_buy_icon_btn"  >\u8D2D\u4E70\u5370\u8BB0</a>'}}return{intro:"<p>"+t.intro+' <a target="_blank" href="'+t.intro_url+'">\u8BE6\u60C5\u300B</a></p>',btn:'<a class="btn_default btn_small" target="_blank" href="'+t.intro_url+'" >\u83B7\u53D6\u5370\u8BB0</a>'}},jumpToIhome:function(){var t=$(".userinfo_honor"),i=t.find(".j_icon_slot");$.tb.location.getHref().match("/home/")&&t&&i?i.first().trigger("click"):window.open("/home/main?id="+PageData.user.portrait+"&fr=icon_tip#manage_icon")},whetherIHaveTheIcon:function(t,i){var n,e;for(e in i)if(n=i[e],t.name==n)return!0;return!1},showDialog:function(t){this._dialog&&this._dialog.close(),this._dialog=null,this._dialog=new $.dialog({title:"\u5370\u8BB0\u63D0\u793A",html:t})},formateDate:function(t){var i=new Date(1e3*parseInt(t));return i.getFullYear()+"-"+(i.getMonth()+1)+"-"+i.getDate()}}});_.Module.define({path:"album/component/initApiConfig",sub:{appid:"314406",xiangceUrl:"http://favo.xiangce.baidu.com/",uploadUrl:"http://up.xiangce.baidu.com/",tags:null,descript:null,cache:{},imgUrl:null,sourceURL:null,offset:{x:-72,y:6},likeButton:null,timer:null,currentQueryImgUrl:null,currentUpImgUrl:null,currentIndex:0,hasLogin:!1,hasNoUn:!1,area:[],descript:"",no_pic_pb:!1,sourceURL:"",tags:"",initial:function(t){var e=this;e.hasLogin=t.isLogin,e.hasNoUn=t.hasNoUn,e.area=t.conf.area,e.descript=t.conf.descript,e.no_pic_pb=t.conf.no_pic_pb,e.sourceURL=t.conf.sourceURL,e.tags=t.conf.tags},isImgMarked:function(t){return t in this.cache&&1==this.cache[t]},checkImgSize:function(t,e){return e.width>=$(t).width()||e.height>=$(t).height()?!1:!0},loginEvent:function(){TbCom.process("User","buildLoginFrame",null,null,null,"fav_img")},showLikeButton:function(){this.likeButton&&this.likeButton.show()},hideLikeButton:function(){this.likeButton&&this.likeButton.hide()},setLikeButtonPosition:function(t,e){{var i,n,o=this,r=$(t),s=r.offset(),u=s.left,a=s.top,c=r.outerHeight(),l=r.outerWidth(),d=o.likeButton;o.area[e]}d.find(".download").show();var h=d.outerHeight(),g=d.outerWidth();return(h+20>c||g+20>l)&&(d.find(".download").hide(),h=d.outerHeight(),g=d.outerWidth(),h+20>c||g+20>l)?!1:(i=a-parseInt(d.css("padding-top")),n=u+l-g+d.width(),d.css({top:i,left:n}),!0)},setImgConf:function(t){var e=this;if("IMG"!=t.tagName){var i=($(t).find("img")[0],$.parseJSON($(t).tbattr("favData")));if(!i.src)return!1;e.imgUrl=i.src,e.sourceURL=i.sourceURL,e.tags=i.tags,e.descript=i.descript}else e.imgUrl=t.src||"";var n=e.imgUrl.lastIndexOf(".webp");return-1!=n&&(e.imgUrl=e.imgUrl.slice(0,n)+".jpg"),!0},resetAndshowLikeButton:function(t,e){var i=this;return i.currentIndex=e,i.setImgConf(t)?i.setLikeButtonPosition(t,e)?(i.imgUrl in i.cache?(i.likeButton[i.isImgMarked(i.imgUrl)?"addClass":"removeClass"]("done"),i.showLikeButton()):i.queryAndshowLikeButton(),void 0):!1:!1},queryAndshowLikeButton:function(){var t=this,e=t.cache,i=t.imgUrl,n=t.likeButton;return t.hasLogin?t.currentQueryImgUrl==i?!1:(t.timer&&clearTimeout(t.timer),t.timer=setTimeout(function(){var o=t.xiangceUrl+"opencom/picture/fav/query?app_id="+t.appid+"&url="+encodeURIComponent(i)+"&callback=?";$.stats.sendRequest("st_mod=fav_img&fr=tb0_forum&st_type=fav_btn_request&from=pic_forums"),t.currentQueryImgUrl=i,$.getJSON(o,function(o){0==o.errno&&o.data&&0!=o.data.status?(e[i]=1,n.addClass("done")):(e[i]=0,n.removeClass("done")),t.showLikeButton()})},200),void 0):(this.showLikeButton(),void 0)},setAreaConf:function(t,e,i){var n=this,o=n.area,r=null;for(var s in o)o[s].tag===t&&(r=o[s]);r[e]=i}}});_.Module.define({path:"common/widget/tbcopy/ZeroClipboard",sub:{get:function(){return this.ZeroClipboard},getClient:function(e){return new this.ZeroClipboard(e)},initial:function(){var e=this;!function(t,n){"use strict";var r,a=t,i=a.document,o=a.navigator,l=a.setTimeout,s=a.Number.parseInt||a.parseInt,u=a.Number.parseFloat||a.parseFloat,c=a.Number.isNaN||a.isNaN,f=a.encodeURIComponent,p=a.Math,d=a.Date,h=a.ActiveXObject,y=a.Array.prototype.slice,v=a.Object.keys,g=a.Object.prototype.hasOwnProperty,m=function(){return"function"==typeof a.Object.defineProperty&&function(){try{var e={};return a.Object.defineProperty(e,"y",{value:"z"}),"z"===e.y}catch(t){return!1}}()?a.Object.defineProperty:void 0}(),b=function(e){return y.call(e,0)},w=function(e,t,n){if("function"==typeof t.indexOf)return t.indexOf(e,n);var r,a=t.length;for("undefined"==typeof n?n=0:0>n&&(n=a+n),r=n;a>r;r++)if(g.call(t,r)&&t[r]===e)return r;return-1},C=function(){var e,t,r,a,i,o,l=b(arguments),s=l[0]||{};for(e=1,t=l.length;t>e;e++)if(null!=(r=l[e]))for(a in r)if(g.call(r,a)){if(i=s[a],o=r[a],s===o)continue;o!==n&&(s[a]=o)}return s},x=function(e){var t,n,r,a;if("object"!=typeof e||null==e)t=e;else if("number"==typeof e.length)for(t=[],n=0,r=e.length;r>n;n++)g.call(e,n)&&(t[n]=x(e[n]));else{t={};for(a in e)g.call(e,a)&&(t[a]=x(e[a]))}return t},E=function(e,t){for(var n={},r=0,a=t.length;a>r;r++)t[r]in e&&(n[t[r]]=e[t[r]]);return n},T=function(e,t){var n={};for(var r in e)-1===w(r,t)&&(n[r]=e[r]);return n},j=function(e){if(null==e)return[];if(v)return v(e);var t=[];for(var n in e)g.call(e,n)&&t.push(n);return t},D=function(e){if(e)for(var t in e)g.call(e,t)&&delete e[t];return e},I=function(e,t){t in e&&"function"==typeof m&&m(e,t,{value:e[t],writable:!1,configurable:!0,enumerable:!0})},k=function(e){return function(){var t;return t=e.now?e.now():(new e).getTime()}}(d),O={bridge:null,version:"0.0.0",pluginType:"unknown",disabled:null,outdated:null,unavailable:null,deactivated:null,overdue:null,ready:null},N="11.0.0",L={},z={},_=null,S={ready:"Flash communication is established",error:{"flash-disabled":"Flash is disabled or not installed","flash-outdated":"Flash is too outdated to support ZeroClipboard","flash-unavailable":"Flash is unable to communicate bidirectionally with JavaScript","flash-deactivated":"Flash is too outdated for your browser and/or is configured as click-to-activate","flash-overdue":"Flash communication was established but NOT within the acceptable time limit"}},F=(function(){var e,t,n,r,a="ZeroClipboard.swf";if(!i.currentScript||!(r=i.currentScript.src)){var o=i.getElementsByTagName("script");if("readyState"in o[0])for(e=o.length;e--&&("interactive"!==o[e].readyState||!(r=o[e].src)););else if("loading"===i.readyState)r=o[o.length-1].src;else{for(e=o.length;e--;){if(n=o[e].src,!n){t=null;break}if(n=n.split("#")[0].split("?")[0],n=n.slice(0,n.lastIndexOf("/")+1),null==t)t=n;else if(t!==n){t=null;break}}null!==t&&(r=t)}}return r&&(r=r.split("#")[0].split("?")[0],a=r.slice(0,r.lastIndexOf("/")+1)+a),a}(),{swfPath:"http://tb2.bdstatic.com/tb/static-common/widget/tbcopy/ZCB_8fd7d9f.swf",trustedDomains:t.location.host?[t.location.host]:[],cacheBust:!0,forceEnhancedClipboard:!1,flashLoadTimeout:3e4,autoActivate:!0,bubbleEvents:!0,containerId:"global-zeroclipboard-html-bridge",containerClass:"global-zeroclipboard-container",swfObjectId:"global-zeroclipboard-flash-bridge",hoverClass:"zeroclipboard-is-hover",activeClass:"zeroclipboard-is-active",forceHandCursor:!1,title:null,zIndex:999999999}),X=function(e){if("object"==typeof e&&null!==e)for(var t in e)if(g.call(e,t))if(/^(?:forceHandCursor|title|zIndex|bubbleEvents)$/.test(t))F[t]=e[t];else if(null==O.bridge)if("containerId"===t||"swfObjectId"===t){if(!G(e[t]))throw new Error("The specified `"+t+"` value is not valid as an HTML4 Element ID");F[t]=e[t]}else F[t]=e[t];{if("string"!=typeof e||!e)return x(F);if(g.call(F,e))return F[e]}},A=function(){return{browser:E(o,["userAgent","platform","appName"]),flash:T(O,["bridge"]),zeroclipboard:{version:jt.version,config:jt.config()}}},Y=function(){return!!(O.disabled||O.outdated||O.unavailable||O.deactivated)},$=function(e,t){var n,r,a,i={};if("string"==typeof e&&e)a=e.toLowerCase().split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)g.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&jt.on(n,e[n]);if(a&&a.length){for(n=0,r=a.length;r>n;n++)e=a[n].replace(/^on/,""),i[e]=!0,L[e]||(L[e]=[]),L[e].push(t);if(i.ready&&O.ready&&jt.emit({type:"ready"}),i.error){var o=["disabled","outdated","unavailable","deactivated","overdue"];for(n=0,r=o.length;r>n;n++)if(O[o[n]]===!0){jt.emit({type:"error",name:"flash-"+o[n]});break}}}return jt},B=function(e,t){var n,r,a,i,o;if(0===arguments.length)i=j(L);else if("string"==typeof e&&e)i=e.split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)g.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&jt.off(n,e[n]);if(i&&i.length)for(n=0,r=i.length;r>n;n++)if(e=i[n].toLowerCase().replace(/^on/,""),o=L[e],o&&o.length)if(t)for(a=w(t,o);-1!==a;)o.splice(a,1),a=w(t,o,a);else o.length=0;return jt},M=function(e){var t;return t="string"==typeof e&&e?x(L[e])||null:x(L)},H=function(e){var t,n,r;return e=J(e),e&&!nt(e)?"ready"===e.type&&O.overdue===!0?jt.emit({type:"error",name:"flash-overdue"}):(t=C({},e),tt.call(this,t),"copy"===e.type&&(r=st(z),n=r.data,_=r.formatMap),n):void 0},P=function(){if("boolean"!=typeof O.ready&&(O.ready=!1),!jt.isFlashUnusable()&&null===O.bridge){var e=F.flashLoadTimeout;"number"==typeof e&&e>=0&&l(function(){"boolean"!=typeof O.deactivated&&(O.deactivated=!0),O.deactivated===!0&&jt.emit({type:"error",name:"flash-deactivated"})},e),O.overdue=!1,ot()}},Z=function(){jt.clearData(),jt.deactivate(),jt.emit("destroy"),lt(),jt.off()},R=function(e,t){var n;if("object"==typeof e&&e&&"undefined"==typeof t)n=e,jt.clearData();else{if("string"!=typeof e||!e)return;n={},n[e]=t}for(var r in n)"string"==typeof r&&r&&g.call(n,r)&&"string"==typeof n[r]&&n[r]&&(z[r]=n[r])},V=function(e){"undefined"==typeof e?(D(z),_=null):"string"==typeof e&&g.call(z,e)&&delete z[e]},K=function(e){if(e&&1===e.nodeType){r&&(vt(r,F.activeClass),r!==e&&vt(r,F.hoverClass)),r=e,yt(e,F.hoverClass);var t=e.getAttribute("title")||F.title;if("string"==typeof t&&t){var n=it(O.bridge);n&&n.setAttribute("title",t)}var a=F.forceHandCursor===!0||"pointer"===mt(e,"cursor");xt(a),Ct()}},U=function(){var e=it(O.bridge);e&&(e.removeAttribute("title"),e.style.left="0px",e.style.top="-9999px",e.style.width="1px",e.style.top="1px"),r&&(vt(r,F.hoverClass),vt(r,F.activeClass),r=null)},G=function(e){return"string"==typeof e&&e&&/^[A-Za-z][A-Za-z0-9_:\-\.]*$/.test(e)},J=function(e){var t;if("string"==typeof e&&e?(t=e,e={}):"object"==typeof e&&e&&"string"==typeof e.type&&e.type&&(t=e.type),t){C(e,{type:t.toLowerCase(),target:e.target||r||null,relatedTarget:e.relatedTarget||null,currentTarget:O&&O.bridge||null,timeStamp:e.timeStamp||k()||null});var n=S[e.type];return"error"===e.type&&e.name&&n&&(n=n[e.name]),n&&(e.message=n),"ready"===e.type&&C(e,{target:null,version:O.version}),"error"===e.type&&(/^flash-(disabled|outdated|unavailable|deactivated|overdue)$/.test(e.name)&&C(e,{target:null,minimumVersion:N}),/^flash-(outdated|unavailable|deactivated|overdue)$/.test(e.name)&&C(e,{version:O.version})),"copy"===e.type&&(e.clipboardData={setData:jt.setData,clearData:jt.clearData}),"aftercopy"===e.type&&(e=ut(e,_)),e.target&&!e.relatedTarget&&(e.relatedTarget=W(e.target)),e=q(e)}},W=function(e){var t=e&&e.getAttribute&&e.getAttribute("data-clipboard-target");return t?i.getElementById(t):null},q=function(e){if(e&&/^_(?:click|mouse(?:over|out|down|up|move))$/.test(e.type)){var t=e.target,r="_mouseover"===e.type&&e.relatedTarget?e.relatedTarget:n,o="_mouseout"===e.type&&e.relatedTarget?e.relatedTarget:n,l=wt(t),s=a.screenLeft||a.screenX||0,u=a.screenTop||a.screenY||0,c=i.body.scrollLeft+i.documentElement.scrollLeft,f=i.body.scrollTop+i.documentElement.scrollTop,p=l.left+("number"==typeof e._stageX?e._stageX:0),d=l.top+("number"==typeof e._stageY?e._stageY:0),h=p-c,y=d-f,v=s+h,g=u+y,m="number"==typeof e.movementX?e.movementX:0,b="number"==typeof e.movementY?e.movementY:0;delete e._stageX,delete e._stageY,C(e,{srcElement:t,fromElement:r,toElement:o,screenX:v,screenY:g,pageX:p,pageY:d,clientX:h,clientY:y,x:h,y:y,movementX:m,movementY:b,offsetX:0,offsetY:0,layerX:0,layerY:0})}return e},Q=function(e){var t=e&&"string"==typeof e.type&&e.type||"";return!/^(?:(?:before)?copy|destroy)$/.test(t)},et=function(e,t,n,r){r?l(function(){e.apply(t,n)},0):e.apply(t,n)},tt=function(e){if("object"==typeof e&&e&&e.type){var t=Q(e),n=L["*"]||[],r=L[e.type]||[],i=n.concat(r);if(i&&i.length){var o,l,s,u,c,f=this;for(o=0,l=i.length;l>o;o++)s=i[o],u=f,"string"==typeof s&&"function"==typeof a[s]&&(s=a[s]),"object"==typeof s&&s&&"function"==typeof s.handleEvent&&(u=s,s=s.handleEvent),"function"==typeof s&&(c=C({},e),et(s,u,[c],t))}return this}},nt=function(e){var t=e.target||r||null,n="swf"===e._source;switch(delete e._source,e.type){case"error":w(e.name,["flash-disabled","flash-outdated","flash-deactivated","flash-overdue"])&&C(O,{disabled:"flash-disabled"===e.name,outdated:"flash-outdated"===e.name,unavailable:"flash-unavailable"===e.name,deactivated:"flash-deactivated"===e.name,overdue:"flash-overdue"===e.name,ready:!1});break;case"ready":var a=O.deactivated===!0;C(O,{disabled:!1,outdated:!1,unavailable:!1,deactivated:!1,overdue:a,ready:!a});break;case"copy":var i,o,l=e.relatedTarget;!z["text/html"]&&!z["text/plain"]&&l&&(o=l.value||l.outerHTML||l.innerHTML)&&(i=l.value||l.textContent||l.innerText)?(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",i),o!==i&&e.clipboardData.setData("text/html",o)):!z["text/plain"]&&e.target&&(i=e.target.getAttribute("data-clipboard-text"))&&(e.clipboardData.clearData(),e.clipboardData.setData("text/plain",i));break;case"aftercopy":jt.clearData(),t&&t!==ht()&&t.focus&&t.focus();break;case"_mouseover":jt.activate(t),F.bubbleEvents===!0&&n&&(rt(C({},e,{type:"mouseover"})),rt(C({},e,{type:"mouseenter",bubbles:!1})));break;case"_mouseout":jt.deactivate(),F.bubbleEvents===!0&&n&&(rt(C({},e,{type:"mouseout"})),rt(C({},e,{type:"mouseleave",bubbles:!1})));break;case"_mousedown":yt(t,F.activeClass),F.bubbleEvents===!0&&n&&rt(C({},e,{type:e.type.slice(1)}));break;case"_mouseup":vt(t,F.activeClass),F.bubbleEvents===!0&&n&&rt(C({},e,{type:e.type.slice(1)}));break;case"_click":case"_mousemove":F.bubbleEvents===!0&&n&&rt(C({},e,{type:e.type.slice(1)}))}return/^_(?:click|mouse(?:over|out|down|up|move))$/.test(e.type)?!0:void 0},rt=function(e){if(e&&"string"==typeof e.type&&e){var t,n=e.target||e.srcElement||null,r=n&&n.ownerDocument||i,o={view:r.defaultView||a,canBubble:!0,cancelable:!0,detail:"click"===e.type?1:0,button:"number"==typeof e.which?e.which-1:"number"==typeof e.button?e.button:r.createEvent?0:1},l=C(o,e);n&&(r.createEvent&&n.dispatchEvent?(l=[l.type,l.canBubble,l.cancelable,l.view,l.detail,l.screenX,l.screenY,l.clientX,l.clientY,l.ctrlKey,l.altKey,l.shiftKey,l.metaKey,l.button,l.relatedTarget],t=r.createEvent("MouseEvents"),t.initMouseEvent&&(t.initMouseEvent.apply(t,l),n.dispatchEvent(t))):r.createEventObject&&n.fireEvent&&(t=r.createEventObject(l),n.fireEvent("on"+l.type,t)))}},at=function(){var e=i.createElement("div");return e.id=F.containerId,e.className=F.containerClass,e.style.position="absolute",e.style.left="0px",e.style.top="-9999px",e.style.width="1px",e.style.height="1px",e.style.zIndex=""+Et(F.zIndex),e},it=function(e){for(var t=e&&e.parentNode;t&&"OBJECT"===t.nodeName&&t.parentNode;)t=t.parentNode;return t||null},ot=function(){var e,t=O.bridge,n=it(t);if(!t){var r=dt(a.location.host,F),o="never"===r?"none":"all",l=ft(F),s=F.swfPath+ct(F.swfPath,F);n=at();var u=i.createElement("div");n.appendChild(u),i.body.appendChild(n);var c=i.createElement("div"),f="activex"===O.pluginType;c.innerHTML='<object id="'+F.swfObjectId+'" name="'+F.swfObjectId+'" width="100%" height="100%" '+(f?'classid="clsid:d27cdb6e-ae6d-11cf-96b8-444553540000"':'type="application/x-shockwave-flash" data="'+s+'"')+">"+(f?'<param name="movie" value="'+s+'"/>':"")+'<param name="allowScriptAccess" value="'+r+'"/><param name="allowNetworking" value="'+o+'"/><param name="menu" value="false"/><param name="wmode" value="transparent"/><param name="flashvars" value="'+l+'"/></object>',t=c.firstChild,c=null,t.ZeroClipboard=jt,n.replaceChild(t,u)}return t||(t=i[F.swfObjectId],t&&(e=t.length)&&(t=t[e-1]),!t&&n&&(t=n.firstChild)),O.bridge=t||null,t},lt=function(){var e=O.bridge;if(e){var t=it(e);t&&("activex"===O.pluginType&&"readyState"in e?(e.style.display="none",function n(){if(4===e.readyState){for(var r in e)"function"==typeof e[r]&&(e[r]=null);e.parentNode&&e.parentNode.removeChild(e),t.parentNode&&t.parentNode.removeChild(t)}else l(n,10)}()):(e.parentNode&&e.parentNode.removeChild(e),t.parentNode&&t.parentNode.removeChild(t))),O.ready=null,O.bridge=null,O.deactivated=null}},st=function(e){var t={},n={};if("object"==typeof e&&e){for(var r in e)if(r&&g.call(e,r)&&"string"==typeof e[r]&&e[r])switch(r.toLowerCase()){case"text/plain":case"text":case"air:text":case"flash:text":t.text=e[r],n.text=r;break;case"text/html":case"html":case"air:html":case"flash:html":t.html=e[r],n.html=r;break;case"application/rtf":case"text/rtf":case"rtf":case"richtext":case"air:rtf":case"flash:rtf":t.rtf=e[r],n.rtf=r}return{data:t,formatMap:n}}},ut=function(e,t){if("object"!=typeof e||!e||"object"!=typeof t||!t)return e;var n={};for(var r in e)if(g.call(e,r)){if("success"!==r&&"data"!==r){n[r]=e[r];continue}n[r]={};var a=e[r];for(var i in a)i&&g.call(a,i)&&g.call(t,i)&&(n[r][t[i]]=a[i])}return n},ct=function(e,t){var n=null==t||t&&t.cacheBust===!0;return n?(-1===e.indexOf("?")?"?":"&")+"noCache="+k():""},ft=function(e){var t,n,r,i,o="",l=[];if(e.trustedDomains&&("string"==typeof e.trustedDomains?i=[e.trustedDomains]:"object"==typeof e.trustedDomains&&"length"in e.trustedDomains&&(i=e.trustedDomains)),i&&i.length)for(t=0,n=i.length;n>t;t++)if(g.call(i,t)&&i[t]&&"string"==typeof i[t]){if(r=pt(i[t]),!r)continue;if("*"===r){l=[r];break}l.push.apply(l,[r,"//"+r,a.location.protocol+"//"+r])}return l.length&&(o+="trustedOrigins="+f(l.join(","))),e.forceEnhancedClipboard===!0&&(o+=(o?"&":"")+"forceEnhancedClipboard=true"),"string"==typeof e.swfObjectId&&e.swfObjectId&&(o+=(o?"&":"")+"swfObjectId="+f(e.swfObjectId)),o},pt=function(e){if(null==e||""===e)return null;if(e=e.replace(/^\s+|\s+$/g,""),""===e)return null;var t=e.indexOf("//");e=-1===t?e:e.slice(t+2);var n=e.indexOf("/");return e=-1===n?e:-1===t||0===n?null:e.slice(0,n),e&&".swf"===e.slice(-4).toLowerCase()?null:e||null},dt=function(){var e=function(e,t){var n,r,a;if(null!=e&&"*"!==t[0]&&("string"==typeof e&&(e=[e]),"object"==typeof e&&"number"==typeof e.length))for(n=0,r=e.length;r>n;n++)if(g.call(e,n)&&(a=pt(e[n]))){if("*"===a){t.length=0,t.push("*");break}-1===w(a,t)&&t.push(a)}};return function(t,n){var r=pt(n.swfPath);null===r&&(r=t);var a=[];e(n.trustedOrigins,a),e(n.trustedDomains,a);var i=a.length;if(i>0){if(1===i&&"*"===a[0])return"always";if(-1!==w(t,a))return 1===i&&t===r?"sameDomain":"always"}return"never"}}(),ht=function(){try{return i.activeElement}catch(e){return null}},yt=function(e,t){if(!e||1!==e.nodeType)return e;if(e.classList)return e.classList.contains(t)||e.classList.add(t),e;if(t&&"string"==typeof t){var n=(t||"").split(/\s+/);if(1===e.nodeType)if(e.className){for(var r=" "+e.className+" ",a=e.className,i=0,o=n.length;o>i;i++)r.indexOf(" "+n[i]+" ")<0&&(a+=" "+n[i]);e.className=a.replace(/^\s+|\s+$/g,"")}else e.className=t}return e},vt=function(e,t){if(!e||1!==e.nodeType)return e;if(e.classList)return e.classList.contains(t)&&e.classList.remove(t),e;if("string"==typeof t&&t){var n=t.split(/\s+/);if(1===e.nodeType&&e.className){for(var r=(" "+e.className+" ").replace(/[\n\t]/g," "),a=0,i=n.length;i>a;a++)r=r.replace(" "+n[a]+" "," ");e.className=r.replace(/^\s+|\s+$/g,"")}}return e},gt=function(){var e=/\-([a-z])/g,t=function(e,t){return t.toUpperCase()};return function(n){return n.replace(e,t)}}(),mt=function(e,t){var n,r,i;return a.getComputedStyle?n=a.getComputedStyle(e,null).getPropertyValue(t):(r=gt(t),n=e.currentStyle?e.currentStyle[r]:e.style[r]),"cursor"!==t||n&&"auto"!==n||(i=e.tagName.toLowerCase(),"a"!==i)?n:"pointer"},bt=function(){var e,t,n,r=1;return"function"==typeof i.body.getBoundingClientRect&&(e=i.body.getBoundingClientRect(),t=e.right-e.left,n=i.body.offsetWidth,r=p.round(t/n*100)/100),r},wt=function(e){var t={left:0,top:0,width:0,height:0};if(e.getBoundingClientRect){var n,r,o,l=e.getBoundingClientRect();"pageXOffset"in a&&"pageYOffset"in a?(n=a.pageXOffset,r=a.pageYOffset):(o=bt(),n=p.round(i.documentElement.scrollLeft/o),r=p.round(i.documentElement.scrollTop/o));var s=i.documentElement.clientLeft||0,u=i.documentElement.clientTop||0;t.left=l.left+n-s,t.top=l.top+r-u,t.width="width"in l?l.width:l.right-l.left,t.height="height"in l?l.height:l.bottom-l.top}return t},Ct=function(){var e;if(r&&(e=it(O.bridge))){var t=wt(r);C(e.style,{width:t.width+"px",height:t.height+"px",top:t.top+"px",left:t.left+"px",zIndex:""+Et(F.zIndex)})}},xt=function(e){O.ready===!0&&(O.bridge&&"function"==typeof O.bridge.setHandCursor?O.bridge.setHandCursor(e):O.ready=!1)},Et=function(e){if(/^(?:auto|inherit)$/.test(e))return e;var t;return"number"!=typeof e||c(e)?"string"==typeof e&&(t=Et(s(e,10))):t=e,"number"==typeof t?t:"auto"},Tt=function(e){function t(e){var t=e.match(/[\d]+/g);return t.length=3,t.join(".")}function n(e){return!!e&&(e=e.toLowerCase())&&(/^(pepflashplayer\.dll|libpepflashplayer\.so|pepperflashplayer\.plugin)$/.test(e)||"chrome.plugin"===e.slice(-13))}function r(e){e&&(s=!0,e.version&&(p=t(e.version)),!p&&e.description&&(p=t(e.description)),e.filename&&(f=n(e.filename)))}var a,i,l,s=!1,c=!1,f=!1,p="";if(o.plugins&&o.plugins.length)a=o.plugins["Shockwave Flash"],r(a),o.plugins["Shockwave Flash 2.0"]&&(s=!0,p="2.0.0.11");else if(o.mimeTypes&&o.mimeTypes.length)l=o.mimeTypes["application/x-shockwave-flash"],a=l&&l.enabledPlugin,r(a);else if("undefined"!=typeof e){c=!0;try{i=new e("ShockwaveFlash.ShockwaveFlash.7"),s=!0,p=t(i.GetVariable("$version"))}catch(d){try{i=new e("ShockwaveFlash.ShockwaveFlash.6"),s=!0,p="6.0.21"}catch(h){try{i=new e("ShockwaveFlash.ShockwaveFlash"),s=!0,p=t(i.GetVariable("$version"))}catch(y){c=!1}}}}O.disabled=s!==!0,O.outdated=p&&u(p)<u(N),O.version=p||"0.0.0",O.pluginType=f?"pepper":c?"activex":s?"netscape":"unknown"};Tt(h);var jt=function(){return this instanceof jt?("function"==typeof jt._createClient&&jt._createClient.apply(this,b(arguments)),void 0):new jt};jt.version="2.0.0",I(jt,"version"),jt.config=function(){return X.apply(this,b(arguments))},jt.state=function(){return A.apply(this,b(arguments))},jt.isFlashUnusable=function(){return Y.apply(this,b(arguments))},jt.on=function(){return $.apply(this,b(arguments))},jt.off=function(){return B.apply(this,b(arguments))},jt.handlers=function(){return M.apply(this,b(arguments))},jt.emit=function(){return H.apply(this,b(arguments))},jt.create=function(){return P.apply(this,b(arguments))},jt.destroy=function(){return Z.apply(this,b(arguments))},jt.setData=function(){return R.apply(this,b(arguments))},jt.clearData=function(){return V.apply(this,b(arguments))},jt.activate=function(){return K.apply(this,b(arguments))},jt.deactivate=function(){return U.apply(this,b(arguments))};var Dt=0,It={},kt=0,Ot={},Nt={};C(F,{autoActivate:!0});var Lt=function(e){var t=this;t.id=""+Dt++,It[t.id]={instance:t,elements:[],handlers:{}},e&&t.clip(e),jt.on("*",function(e){return t.emit(e)}),jt.on("destroy",function(){t.destroy()}),jt.create()},zt=function(e,t){var n,r,a,i={},o=It[this.id]&&It[this.id].handlers;if("string"==typeof e&&e)a=e.toLowerCase().split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)g.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&this.on(n,e[n]);if(a&&a.length){for(n=0,r=a.length;r>n;n++)e=a[n].replace(/^on/,""),i[e]=!0,o[e]||(o[e]=[]),o[e].push(t);if(i.ready&&O.ready&&this.emit({type:"ready",client:this}),i.error){var l=["disabled","outdated","unavailable","deactivated","overdue"];for(n=0,r=l.length;r>n;n++)if(O[l[n]]){this.emit({type:"error",name:"flash-"+l[n],client:this});break}}}return this},_t=function(e,t){var n,r,a,i,o,l=It[this.id]&&It[this.id].handlers;if(0===arguments.length)i=j(l);else if("string"==typeof e&&e)i=e.split(/\s+/);else if("object"==typeof e&&e&&"undefined"==typeof t)for(n in e)g.call(e,n)&&"string"==typeof n&&n&&"function"==typeof e[n]&&this.off(n,e[n]);if(i&&i.length)for(n=0,r=i.length;r>n;n++)if(e=i[n].toLowerCase().replace(/^on/,""),o=l[e],o&&o.length)if(t)for(a=w(t,o);-1!==a;)o.splice(a,1),a=w(t,o,a);else o.length=0;return this},St=function(e){var t=null,n=It[this.id]&&It[this.id].handlers;return n&&(t="string"==typeof e&&e?n[e]?n[e].slice(0):[]:x(n)),t},Ft=function(e){if(Bt.call(this,e)){"object"==typeof e&&e&&"string"==typeof e.type&&e.type&&(e=C({},e));var t=C({},J(e),{client:this});Mt.call(this,t)}return this},Xt=function(e){e=Ht(e);for(var t=0;t<e.length;t++)if(g.call(e,t)&&e[t]&&1===e[t].nodeType){e[t].zcClippingId?-1===w(this.id,Ot[e[t].zcClippingId])&&Ot[e[t].zcClippingId].push(this.id):(e[t].zcClippingId="zcClippingId_"+kt++,Ot[e[t].zcClippingId]=[this.id],F.autoActivate===!0&&Rt(e[t]));var n=It[this.id]&&It[this.id].elements;-1===w(e[t],n)&&n.push(e[t])}return this},At=function(e){var t=It[this.id];if(!t)return this;var n,r=t.elements;e="undefined"==typeof e?r.slice(0):Ht(e);for(var a=e.length;a--;)if(g.call(e,a)&&e[a]&&1===e[a].nodeType){for(n=0;-1!==(n=w(e[a],r,n));)r.splice(n,1);var i=Ot[e[a].zcClippingId];if(i){for(n=0;-1!==(n=w(this.id,i,n));)i.splice(n,1);0===i.length&&(F.autoActivate===!0&&Vt(e[a]),delete e[a].zcClippingId)}}return this},Yt=function(){var e=It[this.id];return e&&e.elements?e.elements.slice(0):[]},$t=function(){this.unclip(),this.off(),delete It[this.id]},Bt=function(e){if(!e||!e.type)return!1;if(e.client&&e.client!==this)return!1;var t=It[this.id]&&It[this.id].elements,n=!!t&&t.length>0,r=!e.target||n&&-1!==w(e.target,t),a=e.relatedTarget&&n&&-1!==w(e.relatedTarget,t),i=e.client&&e.client===this;return r||a||i?!0:!1},Mt=function(e){if("object"==typeof e&&e&&e.type){var t=Q(e),n=It[this.id]&&It[this.id].handlers["*"]||[],r=It[this.id]&&It[this.id].handlers[e.type]||[],i=n.concat(r);if(i&&i.length){var o,l,s,u,c,f=this;for(o=0,l=i.length;l>o;o++)s=i[o],u=f,"string"==typeof s&&"function"==typeof a[s]&&(s=a[s]),"object"==typeof s&&s&&"function"==typeof s.handleEvent&&(u=s,s=s.handleEvent),"function"==typeof s&&(c=C({},e),et(s,u,[c],t))}return this}},Ht=function(e){return"string"==typeof e&&(e=[]),"number"!=typeof e.length?[e]:e},Pt=function(e,t,n){return e&&1===e.nodeType?(e.addEventListener?e.addEventListener(t,n,!1):e.attachEvent&&e.attachEvent("on"+t,n),e):e},Zt=function(e,t,n){return e&&1===e.nodeType?(e.removeEventListener?e.removeEventListener(t,n,!1):e.detachEvent&&e.detachEvent("on"+t,n),e):e},Rt=function(e){if(e&&1===e.nodeType){var t=function(t){(t||a.event)&&jt.activate(e)};Pt(e,"mouseover",t),Nt[e.zcClippingId]={mouseover:t}}},Vt=function(e){if(e&&1===e.nodeType){var t=Nt[e.zcClippingId];"object"==typeof t&&t&&("function"==typeof t.mouseover&&Zt(e,"mouseover",t.mouseover),delete Nt[e.zcClippingId])}};jt._createClient=function(){Lt.apply(this,b(arguments))},jt.prototype.on=function(){return zt.apply(this,b(arguments))},jt.prototype.off=function(){return _t.apply(this,b(arguments))},jt.prototype.handlers=function(){return St.apply(this,b(arguments))},jt.prototype.emit=function(){return Ft.apply(this,b(arguments))},jt.prototype.clip=function(){return Xt.apply(this,b(arguments))},jt.prototype.unclip=function(){return At.apply(this,b(arguments))},jt.prototype.elements=function(){return Yt.apply(this,b(arguments))},jt.prototype.destroy=function(){return $t.apply(this,b(arguments))},jt.prototype.setText=function(e){return jt.setData("text/plain",e),this},jt.prototype.setHtml=function(e){return jt.setData("text/html",e),this},jt.prototype.setRichText=function(e){return jt.setData("application/rtf",e),this},jt.prototype.setData=function(){return jt.setData.apply(this,b(arguments)),this},jt.prototype.clearData=function(){return jt.clearData.apply(this,b(arguments)),this},jt.prototype.getFlashState=function(){return O},"function"==typeof define&&define.amd?define(function(){return jt}):"object"==typeof module&&module&&"object"==typeof module.exports&&module.exports?module.exports=jt:e.ZeroClipboard=jt}(function(){return this}())}}});
;_.Module.define({path:"common/widget/tbcopy",requires:["common/widget/tbcopy/ZeroClipboard"],sub:{text:"",initial:function(t){var e=$(t.ele),i=t.text,n=this.requireInstance("common/widget/tbcopy/ZeroClipboard"),c=n.get();this.clip=new c(e),this.setText(i)},add:function(t){var e=$(t);return e.length?(this.clip.clip(e),this):!1},remove:function(t){var e=$(t);return"undefined"==typeof t||e.length?(this.clip.unclip(t),this):!1},elements:function(){return $(this.clip.elements())},setText:function(t){var e=this;return this.clip.off("copy"),this.clip.on("copy",function(i){if("function"==typeof t)e.text=t(i);else{if("string"!=typeof t)return!1;e.text=t}i.clipboardData.setData("text/plain",e.text),e.successCallback?e.successCallback():$.dialog.alert("\u590D\u5236\u6210\u529F\uFF01")}),!0},getText:function(){return this.text},getFlashElement:function(){var t=this.clip.getFlashState();return t.bridge},setSuccessCallback:function(t){return this.successCallback=t,!0}}});_.Module.define({path:"common/widget/tbshare",requires:["common/widget/tbshare/tbshare_share","common/widget/tbshare/tbshare_more","common/widget/tbshare/tbshare_all"],sub:{initial:function(e,n){this._addShareComponent(e,n)},_addShareComponent:function(e,n){this.shareInstance=this.requireInstance("common/widget/tbshare/tbshare_share",[n]),this._initMoreInstance(n.moreConfig,n.shareContent);var t=n.moreConfig&&n.moreConfig.position;this._addAllInstanceToContainer(e,t)},_initMoreInstance:function(e,n){e&&(this.moreInstance=this.requireInstance("common/widget/tbshare/tbshare_more",[e]),this.moreInstance.setShareContent(n))},_addMoreInstanceToShareInstance:function(e){if(!this.moreInstance)return!1;if(e){var n=["before","after"],t=$.inArray(e,n);if(0==t)this.shareInstance.$dom.before(this.moreInstance.$dom);else{if(1!=t)throw new Error("moreInstance position error,should be in ["+n.join(",")+"]");this.shareInstance.$dom.after(this.moreInstance.$dom)}}else this.shareInstance.$dom.after(this.moreInstance.$dom)},_addAllInstanceToContainer:function(e,n){var t=$('<div class="tbshare clearfix"></div>');this.shareInstance.$dom.appendTo(t),this._addMoreInstanceToShareInstance(n),t.appendTo(e)},setShareContent:function(e){return this.shareInstance&&this.shareInstance.setShareContent(e),this.moreInstance&&this.moreInstance.setShareContent(e),this},share:function(e){return this.shareInstance?this.shareInstance.share(e):this.moreInstance&&this.moreInstance.shareInstance.share(e),this},showMore:function(){return this.moreInstance?this.moreInstance.showMore():!1},showAll:function(){return this.moreInstance?this.moreInstance.showAll():!1}}});
;var QRCode;!function(){function t(t){this.mode=u.MODE_8BIT_BYTE,this.data=t,this.parsedData=[];for(var e=0,r=this.data.length;r>e;e++){var o=[],n=this.data.charCodeAt(e);n>65536?(o[0]=240|(1835008&n)>>>18,o[1]=128|(258048&n)>>>12,o[2]=128|(4032&n)>>>6,o[3]=128|63&n):n>2048?(o[0]=224|(61440&n)>>>12,o[1]=128|(4032&n)>>>6,o[2]=128|63&n):n>128?(o[0]=192|(1984&n)>>>6,o[1]=128|63&n):o[0]=n,this.parsedData.push(o)}this.parsedData=Array.prototype.concat.apply([],this.parsedData),this.parsedData.length!=this.data.length&&(this.parsedData.unshift(191),this.parsedData.unshift(187),this.parsedData.unshift(239))}function e(t,e){this.typeNumber=t,this.errorCorrectLevel=e,this.modules=null,this.moduleCount=0,this.dataCache=null,this.dataList=[]}function r(t,e){if(void 0==t.length)throw new Error(t.length+"/"+e);for(var r=0;r<t.length&&0==t[r];)r++;this.num=new Array(t.length-r+e);for(var o=0;o<t.length-r;o++)this.num[o]=t[o+r]}function o(t,e){this.totalCount=t,this.dataCount=e}function n(){this.buffer=[],this.length=0}function i(){return"undefined"!=typeof CanvasRenderingContext2D}function a(){var t=!1,e=navigator.userAgent;return/android/i.test(e)&&(t=!0,aMat=e.toString().match(/android ([0-9]\.[0-9])/i),aMat&&aMat[1]&&(t=parseFloat(aMat[1]))),t}function s(t,e){for(var r=1,o=h(t),n=0,i=p.length;i>=n;n++){var a=0;switch(e){case l.L:a=p[n][0];break;case l.M:a=p[n][1];break;case l.Q:a=p[n][2];break;case l.H:a=p[n][3]}if(a>=o)break;r++}if(r>p.length)throw new Error("Too long data");return r}function h(t){var e=encodeURI(t).toString().replace(/\%[0-9a-fA-F]{2}/g,"a");return e.length+(e.length!=t?3:0)}t.prototype={getLength:function(){return this.parsedData.length},write:function(t){for(var e=0,r=this.parsedData.length;r>e;e++)t.put(this.parsedData[e],8)}},e.prototype={addData:function(e){var r=new t(e);this.dataList.push(r),this.dataCache=null},isDark:function(t,e){if(0>t||this.moduleCount<=t||0>e||this.moduleCount<=e)throw new Error(t+","+e);return this.modules[t][e]},getModuleCount:function(){return this.moduleCount},make:function(){this.makeImpl(!1,this.getBestMaskPattern())},makeImpl:function(t,r){this.moduleCount=4*this.typeNumber+17,this.modules=new Array(this.moduleCount);for(var o=0;o<this.moduleCount;o++){this.modules[o]=new Array(this.moduleCount);for(var n=0;n<this.moduleCount;n++)this.modules[o][n]=null}this.setupPositionProbePattern(0,0),this.setupPositionProbePattern(this.moduleCount-7,0),this.setupPositionProbePattern(0,this.moduleCount-7),this.setupPositionAdjustPattern(),this.setupTimingPattern(),this.setupTypeInfo(t,r),this.typeNumber>=7&&this.setupTypeNumber(t),null==this.dataCache&&(this.dataCache=e.createData(this.typeNumber,this.errorCorrectLevel,this.dataList)),this.mapData(this.dataCache,r)},setupPositionProbePattern:function(t,e){for(var r=-1;7>=r;r++)if(!(-1>=t+r||this.moduleCount<=t+r))for(var o=-1;7>=o;o++)-1>=e+o||this.moduleCount<=e+o||(this.modules[t+r][e+o]=r>=0&&6>=r&&(0==o||6==o)||o>=0&&6>=o&&(0==r||6==r)||r>=2&&4>=r&&o>=2&&4>=o?!0:!1)},getBestMaskPattern:function(){for(var t=0,e=0,r=0;8>r;r++){this.makeImpl(!0,r);var o=f.getLostPoint(this);(0==r||t>o)&&(t=o,e=r)}return e},createMovieClip:function(t,e,r){var o=t.createEmptyMovieClip(e,r),n=1;this.make();for(var i=0;i<this.modules.length;i++)for(var a=i*n,s=0;s<this.modules[i].length;s++){var h=s*n,u=this.modules[i][s];u&&(o.beginFill(0,100),o.moveTo(h,a),o.lineTo(h+n,a),o.lineTo(h+n,a+n),o.lineTo(h,a+n),o.endFill())}return o},setupTimingPattern:function(){for(var t=8;t<this.moduleCount-8;t++)null==this.modules[t][6]&&(this.modules[t][6]=t%2==0);for(var e=8;e<this.moduleCount-8;e++)null==this.modules[6][e]&&(this.modules[6][e]=e%2==0)},setupPositionAdjustPattern:function(){for(var t=f.getPatternPosition(this.typeNumber),e=0;e<t.length;e++)for(var r=0;r<t.length;r++){var o=t[e],n=t[r];if(null==this.modules[o][n])for(var i=-2;2>=i;i++)for(var a=-2;2>=a;a++)this.modules[o+i][n+a]=-2==i||2==i||-2==a||2==a||0==i&&0==a?!0:!1}},setupTypeNumber:function(t){for(var e=f.getBCHTypeNumber(this.typeNumber),r=0;18>r;r++){var o=!t&&1==(e>>r&1);this.modules[Math.floor(r/3)][r%3+this.moduleCount-8-3]=o}for(var r=0;18>r;r++){var o=!t&&1==(e>>r&1);this.modules[r%3+this.moduleCount-8-3][Math.floor(r/3)]=o}},setupTypeInfo:function(t,e){for(var r=this.errorCorrectLevel<<3|e,o=f.getBCHTypeInfo(r),n=0;15>n;n++){var i=!t&&1==(o>>n&1);6>n?this.modules[n][8]=i:8>n?this.modules[n+1][8]=i:this.modules[this.moduleCount-15+n][8]=i}for(var n=0;15>n;n++){var i=!t&&1==(o>>n&1);8>n?this.modules[8][this.moduleCount-n-1]=i:9>n?this.modules[8][15-n-1+1]=i:this.modules[8][15-n-1]=i}this.modules[this.moduleCount-8][8]=!t},mapData:function(t,e){for(var r=-1,o=this.moduleCount-1,n=7,i=0,a=this.moduleCount-1;a>0;a-=2)for(6==a&&a--;;){for(var s=0;2>s;s++)if(null==this.modules[o][a-s]){var h=!1;i<t.length&&(h=1==(t[i]>>>n&1));var u=f.getMask(e,o,a-s);u&&(h=!h),this.modules[o][a-s]=h,n--,-1==n&&(i++,n=7)}if(o+=r,0>o||this.moduleCount<=o){o-=r,r=-r;break}}}},e.PAD0=236,e.PAD1=17,e.createData=function(t,r,i){for(var a=o.getRSBlocks(t,r),s=new n,h=0;h<i.length;h++){var u=i[h];s.put(u.mode,4),s.put(u.getLength(),f.getLengthInBits(u.mode,t)),u.write(s)}for(var l=0,h=0;h<a.length;h++)l+=a[h].dataCount;if(s.getLengthInBits()>8*l)throw new Error("code length overflow. ("+s.getLengthInBits()+">"+8*l+")");for(s.getLengthInBits()+4<=8*l&&s.put(0,4);s.getLengthInBits()%8!=0;)s.putBit(!1);for(;;){if(s.getLengthInBits()>=8*l)break;if(s.put(e.PAD0,8),s.getLengthInBits()>=8*l)break;s.put(e.PAD1,8)}return e.createBytes(s,a)},e.createBytes=function(t,e){for(var o=0,n=0,i=0,a=new Array(e.length),s=new Array(e.length),h=0;h<e.length;h++){var u=e[h].dataCount,l=e[h].totalCount-u;n=Math.max(n,u),i=Math.max(i,l),a[h]=new Array(u);for(var g=0;g<a[h].length;g++)a[h][g]=255&t.buffer[g+o];o+=u;var d=f.getErrorCorrectPolynomial(l),c=new r(a[h],d.getLength()-1),p=c.mod(d);s[h]=new Array(d.getLength()-1);for(var g=0;g<s[h].length;g++){var m=g+p.getLength()-s[h].length;s[h][g]=m>=0?p.get(m):0}}for(var v=0,g=0;g<e.length;g++)v+=e[g].totalCount;for(var _=new Array(v),C=0,g=0;n>g;g++)for(var h=0;h<e.length;h++)g<a[h].length&&(_[C++]=a[h][g]);for(var g=0;i>g;g++)for(var h=0;h<e.length;h++)g<s[h].length&&(_[C++]=s[h][g]);return _};for(var u={MODE_NUMBER:1,MODE_ALPHA_NUM:2,MODE_8BIT_BYTE:4,MODE_KANJI:8},l={L:1,M:0,Q:3,H:2},g={PATTERN000:0,PATTERN001:1,PATTERN010:2,PATTERN011:3,PATTERN100:4,PATTERN101:5,PATTERN110:6,PATTERN111:7},f={PATTERN_POSITION_TABLE:[[],[6,18],[6,22],[6,26],[6,30],[6,34],[6,22,38],[6,24,42],[6,26,46],[6,28,50],[6,30,54],[6,32,58],[6,34,62],[6,26,46,66],[6,26,48,70],[6,26,50,74],[6,30,54,78],[6,30,56,82],[6,30,58,86],[6,34,62,90],[6,28,50,72,94],[6,26,50,74,98],[6,30,54,78,102],[6,28,54,80,106],[6,32,58,84,110],[6,30,58,86,114],[6,34,62,90,118],[6,26,50,74,98,122],[6,30,54,78,102,126],[6,26,52,78,104,130],[6,30,56,82,108,134],[6,34,60,86,112,138],[6,30,58,86,114,142],[6,34,62,90,118,146],[6,30,54,78,102,126,150],[6,24,50,76,102,128,154],[6,28,54,80,106,132,158],[6,32,58,84,110,136,162],[6,26,54,82,110,138,166],[6,30,58,86,114,142,170]],G15:1335,G18:7973,G15_MASK:21522,getBCHTypeInfo:function(t){for(var e=t<<10;f.getBCHDigit(e)-f.getBCHDigit(f.G15)>=0;)e^=f.G15<<f.getBCHDigit(e)-f.getBCHDigit(f.G15);return(t<<10|e)^f.G15_MASK},getBCHTypeNumber:function(t){for(var e=t<<12;f.getBCHDigit(e)-f.getBCHDigit(f.G18)>=0;)e^=f.G18<<f.getBCHDigit(e)-f.getBCHDigit(f.G18);return t<<12|e},getBCHDigit:function(t){for(var e=0;0!=t;)e++,t>>>=1;return e},getPatternPosition:function(t){return f.PATTERN_POSITION_TABLE[t-1]},getMask:function(t,e,r){switch(t){case g.PATTERN000:return(e+r)%2==0;case g.PATTERN001:return e%2==0;case g.PATTERN010:return r%3==0;case g.PATTERN011:return(e+r)%3==0;case g.PATTERN100:return(Math.floor(e/2)+Math.floor(r/3))%2==0;case g.PATTERN101:return e*r%2+e*r%3==0;case g.PATTERN110:return(e*r%2+e*r%3)%2==0;case g.PATTERN111:return(e*r%3+(e+r)%2)%2==0;default:throw new Error("bad maskPattern:"+t)}},getErrorCorrectPolynomial:function(t){for(var e=new r([1],0),o=0;t>o;o++)e=e.multiply(new r([1,d.gexp(o)],0));return e},getLengthInBits:function(t,e){if(e>=1&&10>e)switch(t){case u.MODE_NUMBER:return 10;case u.MODE_ALPHA_NUM:return 9;case u.MODE_8BIT_BYTE:return 8;case u.MODE_KANJI:return 8;default:throw new Error("mode:"+t)}else if(27>e)switch(t){case u.MODE_NUMBER:return 12;case u.MODE_ALPHA_NUM:return 11;case u.MODE_8BIT_BYTE:return 16;case u.MODE_KANJI:return 10;default:throw new Error("mode:"+t)}else{if(!(41>e))throw new Error("type:"+e);switch(t){case u.MODE_NUMBER:return 14;case u.MODE_ALPHA_NUM:return 13;case u.MODE_8BIT_BYTE:return 16;case u.MODE_KANJI:return 12;default:throw new Error("mode:"+t)}}},getLostPoint:function(t){for(var e=t.getModuleCount(),r=0,o=0;e>o;o++)for(var n=0;e>n;n++){for(var i=0,a=t.isDark(o,n),s=-1;1>=s;s++)if(!(0>o+s||o+s>=e))for(var h=-1;1>=h;h++)0>n+h||n+h>=e||(0!=s||0!=h)&&a==t.isDark(o+s,n+h)&&i++;i>5&&(r+=3+i-5)}for(var o=0;e-1>o;o++)for(var n=0;e-1>n;n++){var u=0;t.isDark(o,n)&&u++,t.isDark(o+1,n)&&u++,t.isDark(o,n+1)&&u++,t.isDark(o+1,n+1)&&u++,(0==u||4==u)&&(r+=3)}for(var o=0;e>o;o++)for(var n=0;e-6>n;n++)t.isDark(o,n)&&!t.isDark(o,n+1)&&t.isDark(o,n+2)&&t.isDark(o,n+3)&&t.isDark(o,n+4)&&!t.isDark(o,n+5)&&t.isDark(o,n+6)&&(r+=40);for(var n=0;e>n;n++)for(var o=0;e-6>o;o++)t.isDark(o,n)&&!t.isDark(o+1,n)&&t.isDark(o+2,n)&&t.isDark(o+3,n)&&t.isDark(o+4,n)&&!t.isDark(o+5,n)&&t.isDark(o+6,n)&&(r+=40);for(var l=0,n=0;e>n;n++)for(var o=0;e>o;o++)t.isDark(o,n)&&l++;var g=Math.abs(100*l/e/e-50)/5;return r+=10*g}},d={glog:function(t){if(1>t)throw new Error("glog("+t+")");return d.LOG_TABLE[t]},gexp:function(t){for(;0>t;)t+=255;for(;t>=256;)t-=255;return d.EXP_TABLE[t]},EXP_TABLE:new Array(256),LOG_TABLE:new Array(256)},c=0;8>c;c++)d.EXP_TABLE[c]=1<<c;for(var c=8;256>c;c++)d.EXP_TABLE[c]=d.EXP_TABLE[c-4]^d.EXP_TABLE[c-5]^d.EXP_TABLE[c-6]^d.EXP_TABLE[c-8];for(var c=0;255>c;c++)d.LOG_TABLE[d.EXP_TABLE[c]]=c;r.prototype={get:function(t){return this.num[t]},getLength:function(){return this.num.length},multiply:function(t){for(var e=new Array(this.getLength()+t.getLength()-1),o=0;o<this.getLength();o++)for(var n=0;n<t.getLength();n++)e[o+n]^=d.gexp(d.glog(this.get(o))+d.glog(t.get(n)));return new r(e,0)},mod:function(t){if(this.getLength()-t.getLength()<0)return this;for(var e=d.glog(this.get(0))-d.glog(t.get(0)),o=new Array(this.getLength()),n=0;n<this.getLength();n++)o[n]=this.get(n);for(var n=0;n<t.getLength();n++)o[n]^=d.gexp(d.glog(t.get(n))+e);return new r(o,0).mod(t)}},o.RS_BLOCK_TABLE=[[1,26,19],[1,26,16],[1,26,13],[1,26,9],[1,44,34],[1,44,28],[1,44,22],[1,44,16],[1,70,55],[1,70,44],[2,35,17],[2,35,13],[1,100,80],[2,50,32],[2,50,24],[4,25,9],[1,134,108],[2,67,43],[2,33,15,2,34,16],[2,33,11,2,34,12],[2,86,68],[4,43,27],[4,43,19],[4,43,15],[2,98,78],[4,49,31],[2,32,14,4,33,15],[4,39,13,1,40,14],[2,121,97],[2,60,38,2,61,39],[4,40,18,2,41,19],[4,40,14,2,41,15],[2,146,116],[3,58,36,2,59,37],[4,36,16,4,37,17],[4,36,12,4,37,13],[2,86,68,2,87,69],[4,69,43,1,70,44],[6,43,19,2,44,20],[6,43,15,2,44,16],[4,101,81],[1,80,50,4,81,51],[4,50,22,4,51,23],[3,36,12,8,37,13],[2,116,92,2,117,93],[6,58,36,2,59,37],[4,46,20,6,47,21],[7,42,14,4,43,15],[4,133,107],[8,59,37,1,60,38],[8,44,20,4,45,21],[12,33,11,4,34,12],[3,145,115,1,146,116],[4,64,40,5,65,41],[11,36,16,5,37,17],[11,36,12,5,37,13],[5,109,87,1,110,88],[5,65,41,5,66,42],[5,54,24,7,55,25],[11,36,12],[5,122,98,1,123,99],[7,73,45,3,74,46],[15,43,19,2,44,20],[3,45,15,13,46,16],[1,135,107,5,136,108],[10,74,46,1,75,47],[1,50,22,15,51,23],[2,42,14,17,43,15],[5,150,120,1,151,121],[9,69,43,4,70,44],[17,50,22,1,51,23],[2,42,14,19,43,15],[3,141,113,4,142,114],[3,70,44,11,71,45],[17,47,21,4,48,22],[9,39,13,16,40,14],[3,135,107,5,136,108],[3,67,41,13,68,42],[15,54,24,5,55,25],[15,43,15,10,44,16],[4,144,116,4,145,117],[17,68,42],[17,50,22,6,51,23],[19,46,16,6,47,17],[2,139,111,7,140,112],[17,74,46],[7,54,24,16,55,25],[34,37,13],[4,151,121,5,152,122],[4,75,47,14,76,48],[11,54,24,14,55,25],[16,45,15,14,46,16],[6,147,117,4,148,118],[6,73,45,14,74,46],[11,54,24,16,55,25],[30,46,16,2,47,17],[8,132,106,4,133,107],[8,75,47,13,76,48],[7,54,24,22,55,25],[22,45,15,13,46,16],[10,142,114,2,143,115],[19,74,46,4,75,47],[28,50,22,6,51,23],[33,46,16,4,47,17],[8,152,122,4,153,123],[22,73,45,3,74,46],[8,53,23,26,54,24],[12,45,15,28,46,16],[3,147,117,10,148,118],[3,73,45,23,74,46],[4,54,24,31,55,25],[11,45,15,31,46,16],[7,146,116,7,147,117],[21,73,45,7,74,46],[1,53,23,37,54,24],[19,45,15,26,46,16],[5,145,115,10,146,116],[19,75,47,10,76,48],[15,54,24,25,55,25],[23,45,15,25,46,16],[13,145,115,3,146,116],[2,74,46,29,75,47],[42,54,24,1,55,25],[23,45,15,28,46,16],[17,145,115],[10,74,46,23,75,47],[10,54,24,35,55,25],[19,45,15,35,46,16],[17,145,115,1,146,116],[14,74,46,21,75,47],[29,54,24,19,55,25],[11,45,15,46,46,16],[13,145,115,6,146,116],[14,74,46,23,75,47],[44,54,24,7,55,25],[59,46,16,1,47,17],[12,151,121,7,152,122],[12,75,47,26,76,48],[39,54,24,14,55,25],[22,45,15,41,46,16],[6,151,121,14,152,122],[6,75,47,34,76,48],[46,54,24,10,55,25],[2,45,15,64,46,16],[17,152,122,4,153,123],[29,74,46,14,75,47],[49,54,24,10,55,25],[24,45,15,46,46,16],[4,152,122,18,153,123],[13,74,46,32,75,47],[48,54,24,14,55,25],[42,45,15,32,46,16],[20,147,117,4,148,118],[40,75,47,7,76,48],[43,54,24,22,55,25],[10,45,15,67,46,16],[19,148,118,6,149,119],[18,75,47,31,76,48],[34,54,24,34,55,25],[20,45,15,61,46,16]],o.getRSBlocks=function(t,e){var r=o.getRsBlockTable(t,e);if(void 0==r)throw new Error("bad rs block @ typeNumber:"+t+"/errorCorrectLevel:"+e);for(var n=r.length/3,i=[],a=0;n>a;a++)for(var s=r[3*a+0],h=r[3*a+1],u=r[3*a+2],l=0;s>l;l++)i.push(new o(h,u));return i},o.getRsBlockTable=function(t,e){switch(e){case l.L:return o.RS_BLOCK_TABLE[4*(t-1)+0];case l.M:return o.RS_BLOCK_TABLE[4*(t-1)+1];case l.Q:return o.RS_BLOCK_TABLE[4*(t-1)+2];case l.H:return o.RS_BLOCK_TABLE[4*(t-1)+3];default:return void 0}},n.prototype={get:function(t){var e=Math.floor(t/8);return 1==(this.buffer[e]>>>7-t%8&1)},put:function(t,e){for(var r=0;e>r;r++)this.putBit(1==(t>>>e-r-1&1))},getLengthInBits:function(){return this.length},putBit:function(t){var e=Math.floor(this.length/8);this.buffer.length<=e&&this.buffer.push(0),t&&(this.buffer[e]|=128>>>this.length%8),this.length++}};var p=[[17,14,11,7],[32,26,20,14],[53,42,32,24],[78,62,46,34],[106,84,60,44],[134,106,74,58],[154,122,86,64],[192,152,108,84],[230,180,130,98],[271,213,151,119],[321,251,177,137],[367,287,203,155],[425,331,241,177],[458,362,258,194],[520,412,292,220],[586,450,322,250],[644,504,364,280],[718,560,394,310],[792,624,442,338],[858,666,482,382],[929,711,509,403],[1003,779,565,439],[1091,857,611,461],[1171,911,661,511],[1273,997,715,535],[1367,1059,751,593],[1465,1125,805,625],[1528,1190,868,658],[1628,1264,908,698],[1732,1370,982,742],[1840,1452,1030,790],[1952,1538,1112,842],[2068,1628,1168,898],[2188,1722,1228,958],[2303,1809,1283,983],[2431,1911,1351,1051],[2563,1989,1423,1093],[2699,2099,1499,1139],[2809,2213,1579,1219],[2953,2331,1663,1273]],m=function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){function e(t,e){var r=document.createElementNS("http://www.w3.org/2000/svg",t);for(var o in e)e.hasOwnProperty(o)&&r.setAttribute(o,e[o]);return r}{var r=this._htOption,o=this._el,n=t.getModuleCount();Math.floor(r.width/n),Math.floor(r.height/n)}this.clear();var i=e("svg",{viewBox:"0 0 "+String(n)+" "+String(n),width:"100%",height:"100%",fill:r.colorLight});i.setAttributeNS("http://www.w3.org/2000/xmlns/","xmlns:xlink","http://www.w3.org/1999/xlink"),o.appendChild(i),i.appendChild(e("rect",{fill:r.colorDark,width:"1",height:"1",id:"template"}));for(var a=0;n>a;a++)for(var s=0;n>s;s++)if(t.isDark(a,s)){var h=e("use",{x:String(a),y:String(s)});h.setAttributeNS("http://www.w3.org/1999/xlink","href","#template"),i.appendChild(h)}},t.prototype.clear=function(){for(;this._el.hasChildNodes();)this._el.removeChild(this._el.lastChild)},t}(),v="svg"===document.documentElement.tagName.toLowerCase(),_=v?m:i()?function(){function t(){this._elImage.src=this._elCanvas.toDataURL("image/png"),this._elImage.style.display="block",this._elCanvas.style.display="none"}function e(t,e){var r=this;if(r._fFail=e,r._fSuccess=t,null===r._bSupportDataURI){var o=document.createElement("img"),n=function(){r._bSupportDataURI=!1,r._fFail&&_fFail.call(r)},i=function(){r._bSupportDataURI=!0,r._fSuccess&&r._fSuccess.call(r)};return o.onabort=n,o.onerror=n,o.onload=i,o.src="data:image/gif;base64,iVBORw0KGgoAAAANSUhEUgAAAAUAAAAFCAYAAACNbyblAAAAHElEQVQI12P4//8/w38GIAXDIBKE0DHxgljNBAAO9TXL0Y4OHwAAAABJRU5ErkJggg==",void 0}r._bSupportDataURI===!0&&r._fSuccess?r._fSuccess.call(r):r._bSupportDataURI===!1&&r._fFail&&r._fFail.call(r)}if(this._android&&this._android<=2.1){var r=1/window.devicePixelRatio,o=CanvasRenderingContext2D.prototype.drawImage;CanvasRenderingContext2D.prototype.drawImage=function(t,e,n,i,a,s,h,u){if("nodeName"in t&&/img/i.test(t.nodeName))for(var l=arguments.length-1;l>=1;l--)arguments[l]=arguments[l]*r;else"undefined"==typeof u&&(arguments[1]*=r,arguments[2]*=r,arguments[3]*=r,arguments[4]*=r);o.apply(this,arguments)}}var n=function(t,e){this._bIsPainted=!1,this._android=a(),this._htOption=e,this._elCanvas=document.createElement("canvas"),this._elCanvas.width=e.width,this._elCanvas.height=e.height,t.appendChild(this._elCanvas),this._el=t,this._oContext=this._elCanvas.getContext("2d"),this._bIsPainted=!1,this._elImage=document.createElement("img"),this._elImage.alt="Scan me!",this._elImage.style.display="none",this._el.appendChild(this._elImage),this._bSupportDataURI=null};return n.prototype.draw=function(t){var e=this._elImage,r=this._oContext,o=this._htOption,n=t.getModuleCount(),i=o.width/n,a=o.height/n,s=Math.round(i),h=Math.round(a);e.style.display="none",this.clear();for(var u=0;n>u;u++)for(var l=0;n>l;l++){var g=t.isDark(u,l),f=l*i,d=u*a;r.strokeStyle=g?o.colorDark:o.colorLight,r.lineWidth=1,r.fillStyle=g?o.colorDark:o.colorLight,r.fillRect(f,d,i,a),r.strokeRect(Math.floor(f)+.5,Math.floor(d)+.5,s,h),r.strokeRect(Math.ceil(f)-.5,Math.ceil(d)-.5,s,h)}this._bIsPainted=!0},n.prototype.makeImage=function(){this._bIsPainted&&e.call(this,t)},n.prototype.isPainted=function(){return this._bIsPainted},n.prototype.clear=function(){this._oContext.clearRect(0,0,this._elCanvas.width,this._elCanvas.height),this._bIsPainted=!1},n.prototype.round=function(t){return t?Math.floor(1e3*t)/1e3:t},n}():function(){var t=function(t,e){this._el=t,this._htOption=e};return t.prototype.draw=function(t){for(var e=this._htOption,r=this._el,o=t.getModuleCount(),n=Math.floor(e.width/o),i=Math.floor(e.height/o),a=['<table style="border:0;border-collapse:collapse;">'],s=0;o>s;s++){a.push("<tr>");for(var h=0;o>h;h++)a.push('<td style="border:0;border-collapse:collapse;padding:0;margin:0;width:'+n+"px;height:"+i+"px;background-color:"+(t.isDark(s,h)?e.colorDark:e.colorLight)+';"></td>');a.push("</tr>")}a.push("</table>"),r.innerHTML=a.join("");var u=r.childNodes[0],l=(e.width-u.offsetWidth)/2,g=(e.height-u.offsetHeight)/2;l>0&&g>0&&(u.style.margin=g+"px "+l+"px")},t.prototype.clear=function(){this._el.innerHTML=""},t}();QRCode=function(t,e){if(this._htOption={width:256,height:256,typeNumber:4,colorDark:"#000000",colorLight:"#ffffff",correctLevel:l.H},"string"==typeof e&&(e={text:e}),e)for(var r in e)this._htOption[r]=e[r];"string"==typeof t&&(t=document.getElementById(t)),this._android=a(),this._el=t,this._oQRCode=null,this._oDrawing=new _(this._el,this._htOption),this._htOption.text&&this.makeCode(this._htOption.text)},QRCode.prototype.makeCode=function(t){this._oQRCode=new e(s(t,this._htOption.correctLevel),this._htOption.correctLevel),this._oQRCode.addData(t),this._oQRCode.make(),this._el.title=t,this._oDrawing.draw(this._oQRCode),this.makeImage()},QRCode.prototype.makeImage=function(){"function"==typeof this._oDrawing.makeImage&&(!this._android||this._android>=3)&&this._oDrawing.makeImage()},QRCode.prototype.clear=function(){this._oDrawing.clear()},QRCode.CorrectLevel=l}();
;_.Module.define({path:"common/widget/tbshare/tbshare_share",requires:["common/widget/tbcopy"],sub:{_baseConfig:{Parnter:{qqzone:{title:"QQ\u7A7A\u95F4",urlTmp:["http://sns.qzone.qq.com/cgi-bin/qzshare/cgi_qzshare_onekey?","url=#{url}&title=#{text}&desc=#{desc}","&summary=#{summary}&site=#{site}&pics=#{pics}"].join("")},tsina:{title:"\u65B0\u6D6A\u5FAE\u535A",urlTmp:["http://service.weibo.com/share/share.php?","url=#{url}&title=#{text}","&pic=#{pics}"].join("")},renren:{title:"\u4EBA\u4EBA\u7F51",urlTmp:["http://widget.renren.com/dialog/share?","resourceUrl=#{url}&srcUrl=#{url}&title=#{text}&description=","&pic=#{pics}"].join("")},tieba:{title:"\u767E\u5EA6\u8D34\u5427",urlTmp:["http://tieba.baidu.com/f/commit/share/openShareApi?","url=#{url}&title=#{text}&desc=#{desc}","&comment=#{summary}&pic=#{pics}"].join("")},weixin:{title:"\u5FAE\u4FE1",urlTmp:[].join("")},copy:{title:"\u590D\u5236\u94FE\u63A5",urlTmp:[].join(""),attr:'onclick="return false;"'},douban:{title:"\u8C46\u74E3",urlTmp:["http://www.douban.com/share/service?","href=#{url}&name=#{text}&text=#{desc}","&image=#{pics}"].join("")},tsohu:{title:"\u641C\u72D0\u5FAE\u535A",urlTmp:["http://t.sohu.com/third/post.jsp?","url=#{url}&title=#{text}","&pic=#{pics}"].join("")}},tmp:{base:['<ul class="">#{share_btns}</ul>'].join(""),btn:['<div class="tbshare_#{short_name} tbshare_icon" #{attr} title="#{title}" data-share="#{short_name}">',"#{text}",'<div class="tbshare_title_box">#{title}</div>',"</div>"].join(""),qrcode:['<div class="tbshare_qrcode_mask">','<div class="tbshare_qrcode_outer">','<div class="tbshare_qrcode_wrapper">',"<h6>\u626B\u4E00\u626B\u5206\u4EAB\u5230\u5FAE\u4FE1</h6>",'<div class="tbshare_qrcode_content"></div>','<div class="tbshare_qrcode_instruction">',"<p>\u6253\u5F00\u5FAE\u4FE1\uFF0C\u70B9\u51FB\u5E95\u90E8\u7684\u201C\u53D1\u73B0\u201D\uFF0C<br/>\u4F7F\u7528\u201C\u626B\u4E00\u626B\u201D\u5373\u53EF\u5C06\u7F51\u9875\u5206\u4EAB\u81F3\u670B\u53CB\u5708\u3002</p>","</div>",'<div class="tbshare_qrcode_close">&#215;</div>',"</div>","</div>",'<div class="tbshare_qrcode_triangle"></div>',"</div>"].join("")},common:{text:document.title,desc:document.title,url:$.tb.location.getHref(),pics:""}},qrcodeSize:90,classList:{normal:"tbshare_wrapper",coco:"tbshare_wrapper_theme_coco"},typeClassList:{normal:"",vertical:"vertical"},initial:function(t){if(t=$.extend({theme:"normal",type:"normal",initialQrcode:!0},t),this.className=this.classList[t.theme],this.typeClass=this.typeClassList[t.type],!t)throw new Error("no tbShare args provided");if($.getPageData("forum.forum_name",null)){var e="http://tieba.baidu.com/f?ie=utf-8&kw=";this._baseConfig.common.url=e+$.getPageData("forum.forum_name",null)}this.shareContent=$.extend({},this._baseConfig.common,t.shareContent),this.$dom=this._createShareComponent(t.targets),t.initialQrcode&&(this.$qrcode=this._createQrcodeWrapper(),this.$qrcode.appendTo(this.$dom)),this._bindEvents()},getQrcode:function(){return this.$qrcode||(this.$qrcode=this._createQrcodeWrapper(),this.$qrcode.appendTo(this.$dom)),this.$qrcode},share:function(t){if("weixin"==t)return this.getQrcode().show(),!1;if("copy"==t)return prompt("\u8BF7\u6309\u4E0B Ctrl+C \u590D\u5236\u94FE\u63A5\u5230\u9ECF\u8D34\u677F",$.tb.location.getHref()),!1;var e=this._baseConfig.Parnter[t],i=this.shareContent||this._baseConfig.common;i=this._dataEncodeURI(i),i=$.extend({},i),i.url+=encodeURIComponent("&sharefrom="+t);var r=$.tb.format(e.urlTmp,i);return window.open(r),!1},_createShareComponent:function(t){for(var e="",i="",r="",o=0,n=t.length;n>o;o++)"[object Array]"==Object.prototype.toString.call(t[o])?(i=t[o][0],r=t[o][1]):(i=t[o],r=""),this._baseConfig.Parnter[i]&&(e+=["<li>",$.tb.format(this._baseConfig.tmp.btn,{short_name:i,text:r,title:this._baseConfig.Parnter[i].title,attr:this._baseConfig.Parnter[i].attr||""}),"</li>"].join(""));var s=$.tb.format(this._baseConfig.tmp.base,{share_btns:e}),a=$("<div></div>").addClass(this.className).addClass(this.typeClass).append(s);return a},_createQrcodeWrapper:function(){var t=$(this._baseConfig.tmp.qrcode),e=$.tb.location.getHref(),i=this.qrcodeSize;return $.JsLoadManager.use("http://tb1.bdstatic.com/tb/_/qrcode_f84ab06.js",function(){new window.QRCode(t.find(".tbshare_qrcode_content")[0],{text:e||"http://tieba.baidu.com",width:i,height:i})}),t.on("click",".tbshare_qrcode_mask",function(){t.hide()}),t.on("click",".tbshare_qrcode_close",function(){t.hide()}),t},setQrcodeContent:function(t){var e=this.getQrcode().find(".tbshare_qrcode_content"),i=this.qrcodeSize,r=e.find("img"),o=this;r.length?(r.remove(),e.find("canvas").remove(),new window.QRCode(e[0],{text:t,width:i,height:i})):setTimeout(function(t){o.setQrcodeContent(t)},500,t)},_dataEncodeURI:function(t){var e={};for(var i in t)e[i]=encodeURIComponent(t[i]);return e},_bindEvents:function(){var t=this;this.$dom.on("click",".tbshare_icon",function(){var e=$(this).data("share");return e=e||"tieba",t.share(e)})},_lazyAddTbcopyOnce:function(t){this.tbcopy=this.requireInstance("common/widget/tbcopy",{ele:t,text:$.tb.location.getHref()})},_AddTbcopyOnce:function(){var t=this.$dom.find(".tbshare_copy");this.tbcopy=this.requireInstance("common/widget/tbcopy",{ele:t,text:$.tb.location.getHref()}),this.copyElement=this.tbcopy.getFlashElement()},_getPageImgSrc:function(t){var e=[];return $("img").each(function(i){t>i&&e.push($(this).tbattr("src"))}),e},setShareContent:function(t){return"[object Object]"==Object.prototype.toString.call(t)&&$.extend(this.shareContent,t),t&&t.url!=this.shareContent.url&&this.setQrcodeContent(this.shareContent.url),this.shareContent},hideQrcode:function(){this.getQrcode().hide()}}});
;_.Module.define({path:"common/widget/tbshare/tbshare_more",requires:["common/widget/tbshare/tbshare_share","common/widget/tbshare/tbshare_all"],sub:{_tmp:['<div class="tbshare_more_wrapper">','<a class="tbshare_more_enter" href="#" title="\u66F4\u591A">#{text}</a>','<div class="tbshare_float_wrapper tbshare_more_right"></div>','<div class="tbshare_slide_main">','<div class="tbshare_more_main">','<div class="tbshare_header">',"<h6>\u5206\u4EAB\u5230</h6>","</div>",'<div class="tbshare_main clearfix">',"</div>",'<div class="tbshare_footer"></div>',"</div>","</div>",'<div class="tbshare_float_wrapper tbshare_more_left"></div>',"</div>"].join(""),moreColumnWidth:[120,218],_args:{targets:[["qqzone","QQ\u7A7A\u95F4"],["tieba","\u767E\u5EA6\u8D34\u5427"],["renren","\u4EBA\u4EBA\u7F51"],["tsina","\u65B0\u6D6A\u5FAE\u535A"],["weixin","\u5FAE\u4FE1"],["douban","\u8C46\u74E3"],["tsohu","\u641C\u72D0\u5FAE\u535A"],["copy","\u590D\u5236"]]},initial:function(t){if(!t)throw new Error("no tbMore args provided");this.args=$.extend({text:"",columnNum:2,$container:null,show:!0,noAll:!1},t),this.$dom=this._createBaseDom(this.args.text),this.$moreWrapper=this._createBaseMoreWrapper(this.args.shareContent,this.args.targets),this.columnNum=this.args.columnNum,this.initMoreWrapperWidth(this.args.columnNum),this.args.slide&&-1!=$.inArray(this.args.slide.type,["left","right"])?(this.slide=this.args.slide,this._initSlide()):(this.args.noAll||(this.allInstance=this.requireInstance("common/widget/tbshare/tbshare_all",[]),this.allInstance.setShareContent(this.args.shareContent)),this._bindNormalEvents()),this._addToContainer()},_createBaseDom:function(t){t=t||"";var e=$.tb.format(this._tmp,{text:t});return $(e)},_createBaseMoreWrapper:function(t,e){return this._args.shareContent=t||{},"undefined"!=typeof e&&(this._args.targets=e),this.shareInstance=this.requireInstance("common/widget/tbshare/tbshare_share",[this._args]),this.shareInstance.$dom.appendTo(this.$dom.find(".tbshare_main")),this.$dom.find(".tbshare_more_main")},_bindNormalEvents:function(){var t=this;this.$dom.on("mouseenter",".tbshare_more_enter",function(){t.showMoreInNicePosition()}).on("click",".tbshare_more_enter",function(){return t.showAll()}).mouseleave(function(e){return $(e.relatedTarget)[0]?(t.hideMore(),void 0):!1})},_initSlide:function(){this.slideStatus="hide",this.$slideMain=this.$dom.find(".tbshare_slide_main"),this._setSlideStyle(),this._bindSlideEvents()},_setSlideStyle:function(){var t=this.slide.type,e=this.slide.position||"fixed";if(this.$slideBtn=this.$dom.find(".tbshare_more_"+t),this.$slideBtn.show(),this.showMore(),this.$slideMain.css({width:0}),this.$moreWrapper.css({position:"static"}),this.$dom.addClass("tbshare_slide_wrapper"),this.$dom.find(".tbshare_more_enter").hide(),"right"==t?this.$dom.css({right:0}):this.$dom.css({left:0}),!$.inArray(e,["absolute","fixed"]))throw new Error("The position setting not be supported");this.$dom.css({position:e})},_bindSlideEvents:function(){var t=this;this.$slideBtn.mouseenter(function(){"show"!=t.slideStatus&&(t.slideStatus="show",t.slideShowMore(t.slide.type))}),this.$dom.mouseleave(function(e){return $(e.relatedTarget)[0]?(t.slideStatus="hide",t.slideHideMore(t.slide.type),void 0):!1})},_addToContainer:function(){this.args.$container&&this.$dom.appendTo(this.args.$container),this.args.show&&this.show()},show:function(){this.$dom.show()},hide:function(){this.$dom.hide()},showMore:function(t,e){return"undefined"!=typeof t&&"undefined"!=typeof e&&this.$moreWrapper.css({left:t,top:e}),this.$moreWrapper.show(),this.$moreWrapper},showMoreInNicePosition:function(){var t=$(document).scrollTop()+$(window).height(),e=$(document).scrollLeft()+$(window).width(),i={top:this.$dom.offset().top,left:this.$dom.offset().left,width:this.$moreWrapper.width(),height:this.$moreWrapper.height()},s=0,r=0;i.top+i.height>t?r=-i.height:s+=16,i.left+i.width>e&&(s=-i.width,r+=20),this.showMore(s,r)},initMoreWrapperWidth:function(t){if(t&&t>0&&t<=this.moreColumnWidth.length+1){this.columnNum=t;var e=this.moreColumnWidth[this.columnNum-1];this.$moreWrapper.css({width:e})}},slideShowMore:function(t,e){var i=parseInt(this.$moreWrapper.css("width"));if("left"==t);else if("right"!=t)return!1;e&&this.$moreWrapper.css({top:e}),this.columnNum&&(i=this.moreColumnWidth[this.columnNum-1]+2,this.$slideMain.animate({width:i},100,"linear"))},slideHideMore:function(){this.$slideMain.animate({width:0},100,"linear")},hideMore:function(){this.$moreWrapper.hide()},showAll:function(){return this.allInstance&&this.allInstance.showAll(),!1},setShareContent:function(t){return this.shareInstance.setShareContent(t),this.allInstance&&this.allInstance.setShareContent(t),this}}});
;_.Module.define({path:"common/widget/tbshare/tbshare_popup",requires:["common/widget/tbshare/tbshare_share"],sub:{_tmp:['<div class="tbshare_popup_wrapper">','<div class="tbshare_popup_enter"></div>','<div class="tbshare_popup_main clearfix"></div>',"</div>"].join(""),_sharebase_args:{theme:"coco",targets:["tieba","weixin","tsina","qqzone","copy"],initialQrcode:!1},_popup_args:{$container:null,type:"cross",itemIconPosition:"origin"},initial:function(e){if(!e)throw new Error("no tbMore args provided");this._popup_args=$.extend(this._popup_args,{$container:e.$container,type:e.type,itemIconPosition:e.itemIconPosition}),this._sharebase_args=$.extend(this._sharebase_args,{shareContent:e.shareContent||{},targets:e.targets,type:e.type}),this.$dom=this._createBaseDom(),this.$popupWrapper=this._createBaseMoreWrapper(),this._bindEvents(),this._popup_args.$container.append(this.$dom)},_createBaseDom:function(e){e=e||"";var t=this._tmp,s=$(t);return"vertical"==this._popup_args.type&&s.addClass("popup_vertical"),"left"==this._popup_args.itemIconPosition&&s.addClass("popup_icon_left"),s},_createBaseMoreWrapper:function(){return this.shareInstance=this.requireInstance("common/widget/tbshare/tbshare_share",[this._sharebase_args]),this.shareInstance.$dom.appendTo(this.$dom.find(".tbshare_popup_main")),this.$dom.find(".tbshare_popup_main")},_qrcodeShow:function(){this.shareInstance.getQrcode().show(),this.shareInstance.$dom.find(".tbshare_weixin").addClass("hover_on_qrcode")},_qrcodeHide:function(){this.shareInstance.getQrcode().hide(),this.shareInstance.$dom.find(".tbshare_weixin").removeClass("hover_on_qrcode")},_bindEvents:function(){var e=this;this.$dom.on("mouseenter",".tbshare_popup_main li",function(){$(this).find(".tbshare_weixin").length?e._qrcodeShow():e._qrcodeHide()}),this.$dom.on("mouseenter",function(t){$(this).find($(t.relatedTarget)).length||!$(t.relatedTarget).parent().length,e._qrcodeHide(),e.$popupWrapper.show()}),this.mouseenterInFlash=!1,this.$dom.on("mouseleave",function(t){var s=t.relatedTarget;if(s){if(s==e.shareInstance.copyElement)return e.mouseenterInFlash=!0,void 0}else if(e.mouseenterInFlash)return;e.$popupWrapper.hide(),e._reinitialCopy()});var t=$(this.shareInstance.copyElement);t.parent().on("mouseleave",function(t){var s=t.relatedTarget;e.args.$container.removeClass("copy_mouse_hover"),e.$dom.find($(s))||(e.mouseenterInFlash=!1)}),t.parent().on("mouseenter",function(){e.args.$container.addClass("copy_mouse_hover")})},_reinitialCopy:function(){this.$dom.find(".tbshare_copy .tbshare_title_box").removeClass("copy_done"),this.$dom.find(".tbshare_copy .tbshare_title_box").html("\u590D\u5236\u94FE\u63A5")},_setCopyCallback:function(){var e=this;e.shareInstance.tbcopy.setSuccessCallback(function(){e.$dom.find(".tbshare_copy .tbshare_title_box").addClass("copy_done"),e.$dom.find(".tbshare_copy .tbshare_title_box").html("\u5DF2\u590D\u5236\u94FE\u63A5")})},show:function(){this.$dom.show()},hide:function(){this.$dom.hide()},showMore:function(e,t){return"undefined"!=typeof e&&"undefined"!=typeof t&&this.$moreWrapper.css({left:e,top:t}),this.$moreWrapper.show(),this.$moreWrapper},hideMore:function(){this.$moreWrapper.hide()},setShareContent:function(e){return this.shareInstance.setShareContent(e),this}}});
;_.Module.define({path:"common/widget/tbshare/tbshare_all",requires:["common/widget/tbshare/tbshare_share"],sub:{_tmp:['<div class="tbshare_all_wrapper">',"<h5>\u5206\u4EAB\u5230",'<p class="j_tbshare_all_close"></p>',"</h5>",'<div class="tbshare_all_main"></div>','<div class="tbshare_all_footer"></div>',"</div>"].join(""),_args:{targets:[["qqzone","QQ\u7A7A\u95F4"],["tieba","\u767E\u5EA6\u8D34\u5427"],["renren","\u4EBA\u4EBA\u7F51"],["tsina","\u65B0\u6D6A\u5FAE\u535A"],["weixin","\u5FAE\u4FE1"],["douban","\u8C46\u74E3"],["tsohu","\u641C\u72D0\u5FAE\u535A"],["copy","\u590D\u5236"]]},initial:function(t){t=t||{},this.args=$.extend({show:!1,$container:$("body")},t),this.$container=this.args.$container,this._createElement(),this._bindEvents(),this._addToContainer()},_createElement:function(){this.$dom=$(this._tmp),this.$share_all_main=this.$dom.find(".tbshare_all_main"),this.share=this.requireInstance("common/widget/tbshare/tbshare_share",[this._args]),this.share.$dom.appendTo(this.$share_all_main)},_bindEvents:function(){var t=this;this.$dom.on("click",".j_tbshare_all_close",function(){t.hideAll()})},_addToContainer:function(){this.$container&&this.$container.append(this.$dom),this.args.show&&this.showAll()},setShareContent:function(t){return this.share.setShareContent(t),this},showAll:function(){return this.$dom.show(),this},hideAll:function(){return this.$dom.hide(),this}}});_.Module.define({path:"album/widget/imgLikeAction",requires:["album/component/initApiConfig","common/widget/tbshare"],sub:{_defaultConfig:{sourceURL:"http://tieba.baidu.com/p/"+PageData.thread.thread_id,tags:"\u767E\u5EA6\u8D34\u5427,"+PageData.forum.forum_name+"\u5427",descript:$.tb.subByte(PageData.thread.title,40,""),no_pic_pb:PageData.isPicBa?!1:!0,area:[{container:"#j_p_postlist",tag:".BDE_Image",offset:{x:-4,y:5},minSize:{width:170,height:80}},{container:"#j_p_postlist",tag:".j_user_sign",offset:{x:-4,y:5},minSize:{width:170,height:80}}]},initial:function(){var t=this;t.isLogin=PageData.user.is_login,t.hasNoUn=PageData.user.no_un,t.conf=t._defaultConfig,t.isEnabled=!0,t.initApiConf(),t.createLikeButton(),t.initEvent()},initApiConf:function(){var t=this;t.favConfig=t.use("album/component/initApiConfig",{isLogin:t.isLogin,hasNoUn:t.hasNoUn,conf:t.conf})},initEvent:function(){var t=this;t.bindImgEvent(),t.bindPostEvent(),t.addShareButton(),t.mobileDownloadClick(),t.initCustomEmotion()},initCustomEmotion:function(){var t=this,e=$.cookie("tb_lab"),a={};e&&(a=$.json.decode(e)),a.custom_emotion&&(t.favConfig.likeButton.find(".emotion").show(),t.favConfig.likeButton.on("click",".emotion",function(){this.requireInstanceAsync("common/component/CustomEmotion",{},function(e){e.openDialog({forumId:PageData.forum.forum_id,url:t.favConfig.imgUrl})})}))},bindImgEvent:function(){var t=this;$.each(t.favConfig.area,function(e,a){var i=a.container||document.body,n=a.tag;$(i).on("mouseover",n,{index:e},function(e){t.containerMouseover(e)}),$(i).on("mouseleave",n,function(e){t.containerMouseout(e)})})},bindPostEvent:function(){var t=this,e=t.favConfig,a=e.likeButton;a.delegate(".mark","click",function(){if(!e.hasLogin)return e.loginEvent(),void 0;if(e.currentUpImgUrl==e.imgUrl)return!1;var i=e.uploadUrl+"opencom/picture/fav/upload?app_id="+e.appid+"&descript="+encodeURIComponent(e.descript)+"&uid="+PageData.user.user_id+"&source_url="+encodeURIComponent(e.sourceURL)+"&tags="+encodeURIComponent(e.tags)+"&url="+encodeURIComponent(e.imgUrl)+"&callback=?",n={top:parseInt(a.css("top"),10)-e.area[e.currentIndex].offset.y,left:a.offset().left+40};setTimeout(function(){a.addClass("done")},200),$.stats.sendRequest("st_mod=fav_img&fr=tb0_forum&st_type=fav_btn_click"),e.currentUpImgUrl=e.imgUrl,$.getJSON(i,function(a){switch(a.errno){case 0:t.markSuccess(n);break;case 20026:return e.loginEvent(),void 0;case 20028:return t.markFail(n,".n20028"),void 0;default:return t.markFail(n,".ndefault"),void 0}})}).mouseover(function(){if("undefined"==typeof bdRes2Exe){var t=document.getElementsByTagName("body").item(0),a=document.createElement("script");a.type="text/javascript",a.id="bdres2exejs",a["data-proxy"]="http://tieba.baidu.com/tb/static-album/proxy.html",a.src="http://m.baidu.com/static/as/res2exe/js/res2exe_1.0.4.min.js",a.setAttribute("data-proxy","http://tieba.baidu.com/tb/static-album/proxy.html"),t.appendChild(a)}e.showLikeButton()}).mouseout(function(){e.hideLikeButton()}),$("body").delegate(".sr-bdimgshare-layer","mouseover",function(){e.showLikeButton()}).delegate(".sr-bdimgshare-layer","mouseout",function(){e.hideLikeButton()})},markSuccess:function(t){var e=this;e.favConfig.cache[e.favConfig.imgUrl]=1,"1"!=$.cookie("ablum_hls")&&e.favConfig.likeButton.parent().find(".fav-success").fadeIn("fast",function(){var t=$(this);$.cookie("ablum_hls","1",{expires:30}),setTimeout(function(){t.fadeOut()},3e3)}).css(t)},markFail:function(t,e){var a=this,i=a.favConfig.likeButton.parent().find(".fav-fail");i.find(".text").hide(),i.find(e).show(),i.fadeIn("fast",function(){var t=$(this);setTimeout(function(){t.fadeOut()},2e3)}).css(t)},addShareButton:function(){if(PageData&&("v3"==PageData.page||"pb_bright"==PageData.page)){var t=this,e=t.favConfig,a=this.requireInstance("common/widget/tbshare/tbshare_popup",[{$container:e.likeButton.find(".share"),type:"vertical"}]);e.likeButton.find(".share").mouseover(function(){a.setShareContent({pics:e.imgUrl})})}},containerMouseover:function(t){var e=this;if(e.isEnabled){var a=t.currentTarget,i=t.data.index;e.favConfig.resetAndshowLikeButton(a,i)}},containerMouseout:function(){var t=this;t.favConfig.timer&&clearTimeout(t.favConfig.timer),t.favConfig.hideLikeButton()},mobileDownloadClick:function(){var t=this;$(".fav-toolbar .download").click(function(){$(this).tbattr({data_name:(new Date).getTime(),data_url:t.favConfig.imgUrl,data_size:1024,data_icon:t.favConfig.imgUrl});var e=[];$(".mobile_res").each(function(t,a){var i=bdRes2Exe.getPackageByDom(a);i&&e.push(i)}),bd_app_dl(e),$.stats.sendRequest("fr=tb0_forum&st_mod=picMobile&st_type=imgLikeAction")})},createLikeButton:function(){var t=this,e=['<div class="fav-wrapper" style="">','<div class="fav-toolbar" style="display:none">','<a href="#" class="share j_shareImg" onclick="return false"></a>','<a class="download mobile_res"  title="\u4E0B\u8F7D\u56FE\u7247\u5230\u624B\u673A"  href="javascript:;" hidefocus="true" data_type="picture" data_url="" data_name="" data_icon="" data_size="1048576" data_from="1001714x" ></a>','<a class="mobile_res" data_type="apk" data_url="http://tb1.bdstatic.com/client/operate/android/tieba_pc_picdownload.apk" data_name="\u767E\u5EA6\u8D34\u5427" data_icon="http://static.tieba.baidu.com/tb/static-album/img/tieba_client.png" data_size="12488145"  data_from="1001714x"  data_versionname="4.4.1"  data_versioncode="4" data_package="com.baidu.tieba" data_detail_type="soft" style="display:none" ></a>','<a href="javascript:void(0)" style="display: none;" class="emotion" title="\u6DFB\u52A0\u5230\u81EA\u5B9A\u4E49\u8868\u60C5"></a>',"</div>",'<div class="fav-success" style="display:none;">','<span class="ico"></span>','<span class="text">\u4F7F\u7528\u4E91\u76F8\u518C\u6536\u85CF\u5DE5\u5177\uFF0C\u6279\u91CF\u6536\u85CF\u7CBE\u7F8E\u56FE\u7247\uFF01<a target="_blank" href="http://xiangce.baidu.com/tool/shoucang/">\u7ACB\u5373\u5B89\u88C5</a></span>',"</div>",'<div class="fav-fail" style="display:none;">','<span class="ico"></span>','<span class="text ndefault">\u7CFB\u7EDF\u7E41\u5FD9\uFF0C\u8BF7\u7A0D\u540E\u518D\u8BD5\uFF01</span>','<span class="text n20028">\u62B1\u6B49\uFF0C\u60A8\u6CA1\u6709\u6743\u9650\u8FDB\u884C\u8BE5\u9879\u64CD\u4F5C</span>',"</div>",'<div id="album_hl_container" style="display:none;"></div>',"</div>"].join("");t.favConfig.likeButton=$(e).appendTo(document.body).find(".fav-toolbar")},getMouseHoverDirection:function(t){var e=t.target,a=e.offsetWidth,i=e.offsetHeight,n=$(e).offset(),o=(t.pageX-n.left-a/2)*(a>i?i/a:1),s=(t.pageY-n.top-i/2)*(i>a?a/i:1),r=Math.round((Math.atan2(s,o)*(180/Math.PI)+180)/90+3)%4,c=new Array("up","right","bottom","left");return c[r]||"bottom"},enableSelf:function(t){var e=this;e.isEnabled=t,t||e.favConfig.hideLikeButton()}}});_.Module.define({path:"pb/widget/bindHover",requires:[],sub:{initial:function(){try{var e=this;e.bindZanHover()}catch(n){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:n.message||n.description,path:"pb:widget/bind_hover/bind_hover.js",method:"",ln:12}),n}},bindZanHover:function(){$(".j_niceThread").hover(function(){0==$(this).siblings(".j_complient_number").tbattr("title")&&$(this).siblings(".j_complient_number").find(".zan_word").removeClass("zan_word").addClass("changeColor")},function(e){0==$(e.target).siblings(".j_complient_number").tbattr("title")&&$(e.target).siblings(".j_complient_number").find(".changeColor").removeClass("changeColor").addClass("zan_word")})}}});_.Module.define({path:"pb/widget/postList/FeedBack",sub:{initial:function(){try{this.autoResponseHelp(),this.autoResponseForNotLouzhu(),this.autoResponseClickEvt()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/feedback.js",method:"",ln:13}),e}},autoResponseForNotLouzhu:function(){0!=$(".not-louzhu-response").length&&$(".not-louzhu-response").each(function(e,l){var t=$(l).data("replyHelp"),p="",a={content:"",arrow_dir:"up",bubble_css:{top:0,left:0,right:10,width:280},arrow_pos:{left:30},attr:" id='tb_message_tip_n' ",wrap:$(l),closeBtn:!1,level:1,arrowReq:!0};1==t?p='<div class="reply-help-tips">\u697C\u4E3B\u6682\u672A\u5BF9\u6B64\u7B54\u590D\u8FDB\u884C\u8BC4\u4EF7\u54E6~</div>':2==t?p='<div class="reply-help-tips">\u697C\u4E3B\u5BF9\u6B64\u7B54\u590D\u8BC4\u4EF7\u4E3A\u201C\u6709\u5E2E\u52A9\u201D\u54E6~</div>':t>2&&(p='<div class="reply-help-tips">\u697C\u4E3B\u5BF9\u6B64\u7B54\u590D\u8BC4\u4EF7\u4E3A\u201C\u65E0\u5E2E\u52A9\u201D\u54E6~\u5C0F\u52A9\u624B\u4F1A\u7EE7\u7EED\u52AA\u529B\u54D2~</div>',a.bubble_css.width=345),a.content=p;var i=new UiBubbleTipBase(a);i.showBubble()})},autoResponseHelp:function(){if(0!=$("#plReplyHelpBubble").length){var e={content:"",arrow_dir:"up",bubble_css:{top:0,left:0,right:10,width:280},arrow_pos:{left:30},attr:" id='tb_message_tip_n' ",wrap:$("#plReplyHelpBubble"),closeBtn:!1,level:1,arrowReq:!0},l=$("#plReplyHelpBubble").data("replyHelp");1==l?e.content='<div class="reply-help-tips">\u4EB2\uFF0C\u4EE5\u4E0A\u5185\u5BB9\u662F\u5426\u89E3\u51B3\u4E86\u60A8\u7684\u95EE\u9898\u5462\uFF1F</div><div class="reply-help-tips"><label>\u662F<input type="radio" name="p-is-helpable" value="2"/></label><label>\u5426<input type="radio" name="p-is-helpable" value="0"/></label></div><ul class="p-not-helpable"><li><label><input type="radio" value="4" name="why-nothelp"/>\u592A\u7B80\u5355\u7528\u4E0D\u4E0A</li></label><li><label><input type="radio" value="8" name="why-nothelp"/>\u5B57\u592A\u591A\u4E0D\u60F3\u770B</li></label><li><label><input type="radio" value="16" name="why-nothelp"/>\u592A\u590D\u6742\u770B\u4E0D\u61C2</li></label><li><label><input type="radio" value="32" name="why-nothelp"/>\u641C\u7D22\u5230\u7684\u5185\u5BB9\u4E0D\u5339\u914D</li></label></ul>':l>1&&(e.content='<div class="reply-help-tips">\u611F\u8C22\u60A8\u7684\u53CD\u9988\uFF0C\u5C0F\u52A9\u624B\u4F1A\u7EE7\u7EED\u52AA\u529B\u54D2~</div>');var t=new UiBubbleTipBase(e);t.showBubble(),this.autoResponseClickEvt()}},autoResponseClickEvt:function(){var e=this;$("#plReplyHelpBubble").on("click",".reply-help-tips input",function(){try{var l=$(this).val(),t={};2==l?($("#plReplyHelpBubble .p-not-helpable").hide(),t={thread_id:$("#plReplyHelpBubble").data("threadId"),reply_pid:$("#plReplyHelpBubble").data("postId"),reply_help:l},e.autoResponsePost(t)):$("#plReplyHelpBubble .p-not-helpable").show()}catch(p){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:p.message||p.description,path:"pb:widget/post_list/feedback.js",method:"",ln:105}),p}}).on("click",".p-not-helpable li input",function(){try{var l={thread_id:$("#plReplyHelpBubble").data("threadId"),reply_pid:$("#plReplyHelpBubble").data("postId"),reply_help:$(this).val()};e.autoResponsePost(l)}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/feedback.js",method:"",ln:112}),t}})},autoResponsePost:function(e){var l=this;$.post("/hermes/commit/help",e,function(e){e.errno||($("#plReplyHelpBubble").html("").data("replyHelp",2),l.autoResponseHelp())},"json")}}});
;_.Module.define({path:"pb/widget/postList/PostPic",sub:{initial:function(){try{"album_pb"!=PageData.pageType&&this._bindOpenImg()}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/post_pic.js",method:"",ln:15}),t}},_isAlbumImg:function(t){var e=/^http:\/\/[^\/\?]*?\.baidu\.com[:8090]*\/(\w+)\/([^\/\?]+)\/([^\/\?]+)\/(\w+?)\.(?:webp|jpg)/;return e.test(t)},_bindOpenImg:function(){for(var t,e,a,i,s=this,o=$("#j_p_postlist").find(".BDE_Image"),p=($.browser.msie&&$.browser.version<=7,0),n=o.length;n>p;p++){var d=o[p];if(d&&(t=$(d),a=t.height(),i=t.width(),s._isAlbumImg(d.src)&&a>=80&&i>=80&&a*i>=1e4&&t.click(function(t){try{var a=t.target||t.srcElement,i=1,s=$(a).tbattr("src"),o=$(a).closest(".j_l_post");if(o){postData=o.getData(),postData.author.user_name!=PageData.thread.author&&(i=0),e=s.substring(s.lastIndexOf("/")+1,s.lastIndexOf("."));var p=$(a).closest(".j_d_post_content").find("#j_pb_repost"),n="";if(0==p.length)n="http://tieba.baidu.com/photo/p?kw="+encodeURIComponent($.tb.escapeHTML(PageData.forum.forum_name))+"&flux=1&tid="+PageData.thread.thread_id+"&pic_id="+e+"&pn=1&fp=2&see_lz="+i;else{var d=p.getData();n="http://tieba.baidu.com/photo/p?kw="+encodeURIComponent($.tb.escapeHTML(d.fname))+"&flux=1&tid="+d.tid+"&pic_id="+e+"&pn=1&fp=2&see_lz="+i}window.open(n,"_blank")}}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/post_pic.js",method:"",ln:62}),t}}),a>999)){var c=$(document.createElement("div")),r=$(document.createElement("div"));html=i>160?'<i class="icon-expand"></i>\u70B9\u51FB\u5C55\u5F00\uFF0C\u67E5\u770B\u5B8C\u6574\u56FE\u7247':'<i class="icon-expand"></i>',r.html(html),c.addClass("replace_div").css("width",i),r.addClass("replace_tip").css("width",i-2);var l=t.clone(!0);c.append(l),c.append(r),t.replaceWith(c)}}}}});
;_.Module.define({path:"pb/widget/postList/HidePost",sub:{initial:function(){try{1==PageData.forum.shield_post&&this._bindEvent()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/hide_post.js",method:"",ln:13}),e}},_bindEvent:function(){var e,t,s,o,a=$('<div class="user-hide-post-down"></div>'),i=$('<div class="user-hide-post-action"><a href="javascript:void(0)" class="hide-author">\u5BF9\u6211\u9690\u85CF\u8BE5\u7528\u6237\u7684\u6240\u6709\u8D34\u5B503\u5929</a></div>'),n=!1,d=!1,l={110000:"\u4F60\u8FD8\u6CA1\u6709\u767B\u5F55\uFF0C\u8BF7\u5148\u767B\u5F55\u3002",210009:"\u7CFB\u7EDF\u51FA\u73B0\u9519\u8BEF\u3002",210004:"\u7CFB\u7EDF\u51FA\u73B0\u9519\u8BEF\u3002","000000":"\u64CD\u4F5C\u6210\u529F\u3002"},r=function(r){var p={},h=d?void 0:o.content.post_no;1==h?"hide-post"==r?(p.type=2,p.fname=PageData.forum.forum_name,p.tid=PageData.thread.thread_id):(p.type=1,p.hide_un=t):"hide-post"==r?(p.type=3,p.pid=d?o.spid:o.content.post_id,p.tid=PageData.thread.thread_id):(p.type=1,p.hide_un=t),p.ie="utf-8",$.ajax({url:"/tphide/add",data:p,type:"post",dataType:"json",success:function(o){if(0==o.no)if(n=!1,1==h)$.tb.location.setHref("/f?kw="+PageData.forum.forum_name);else if("hide-post"==r)if(s.close(),a.hide(),i.hide(),$("body").append(a).append(i),d===!1)e.parents(".j_l_post").remove();else{var p=e.parent().find("li.lzl_single_post");if(p.length<2){e.parents("div.j_lzl_container").hide().find("li.lzl_li_pager").remove();var c=e.parents("div.j_lzl_wrapper");c.find("a.lzl_link_unfold").show().text("\u56DE\u590D"),c.find("span.lzl_link_fold").hide()}e.remove()}else t==PageData.thread.author?$.tb.location.setHref("/f?kw="+PageData.forum.forum_name):$.tb.location.reload();else{s.close();var u=new $.dialog({html:'<div class="user-hide-post-tip center-text">'+(l[o.no]||"\u7CFB\u7EDF\u51FA\u73B0\u9519\u8BEF\u3002")+"</div>",title:"\u63D0\u793A",width:400,closeable:!0,draggable:!1,show:!0});setTimeout(function(){u.close(),n=!1},4500)}}})};$("#pb_content").delegate(".user-hide-post-action","click",function(e){try{var a,i=$(e.target).tbattr("class"),l=d?void 0:o.content.post_no;if("hide-post"==i)a=1==l?"\u9690\u85CF1\u697C\u8D34\u5B50\uFF0C\u8BE5\u4E3B\u9898\u7684\u5168\u90E8\u56DE\u590D\u4E5F\u5C06\u88AB\u9690\u85CF<br />\u786E\u8BA4\u8981\u9690\u85CF\u8FD9\u4E2A\u8D34\u5B50\u5417\uFF1F":"\u64CD\u4F5C\u4E4B\u540E\uFF0C\u5C06\u65E0\u6CD5\u6062\u590D\u8FD9\u6761\u8D34\u5B50\u7684\u9690\u85CF\u72B6\u6001<br />\u786E\u8BA4\u8981\u9690\u85CF\u8FD9\u6761\u8D34\u5B50\u5417\uFF1F";else{if("hide-author"!=i)return;a=t==PageData.thread.author?'\u9690\u85CF\u7684\u7528\u6237\u4E3A\u672C\u8D34\u7684\u697C\u4E3B\uFF0C\u64CD\u4F5C\u4E4B\u540E\uFF1A\u8BE5\u4E3B\u9898\u7684\u5168\u90E8\u56DE\u590D\u4E5F\u5C06\u88AB\u9690\u85CF\uFF0C\u4E14<span style="color:red">3\u5929\u5185</span>\u5C06\u65E0\u6CD5\u770B\u5230\u8BE5\u7528\u6237\u53D1\u5E03\u7684\u6240\u6709\u8D34\u5B50<br />\u786E\u8BA4\u8981\u9690\u85CF'+t+"\u7684\u6240\u6709\u8D34\u5B50\u5417\uFF1F":'\u64CD\u4F5C\u4E4B\u540E\uFF0C<span style="color:red">3\u5929\u5185</span>\u5C06\u65E0\u6CD5\u770B\u5230\u8BE5\u7528\u6237\u53D1\u5E03\u7684\u6240\u6709\u8D34\u5B50<br />\u786E\u8BA4\u8981\u9690\u85CF'+t+"\u7684\u6240\u6709\u8D34\u5B50\u5417\uFF1F"}a+='<div class="user-hide-post-confirm"><button class="btn-sub btn-small confirm">\u786E\u8BA4</button>&nbsp;&nbsp;<button class="btn-sub btn-small cancel">\u53D6\u6D88</button></div>',s=new $.dialog({html:'<div class="user-hide-post-tip center-text">'+a+"</div>",title:"\u63D0\u793A",width:400,closeable:!1,draggable:!1,show:!0}),$(".user-hide-post-confirm").on("click","button",function(e){try{$(this).hasClass("cancel")?s.close():$(this).hasClass("confirm")&&n===!1&&(n=!0,r(i))}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/hide_post.js",method:"",ln:144}),e}})}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/hide_post.js",method:"",ln:145}),e}}).delegate(".user-hide-post-down","click",function(){try{var s=$(this);s.tbattr("class","user-hide-post-up"),i.css({top:parseInt(s.css("top"))+15,right:parseInt(s.css("right"))+2}).appendTo(e),d===!1?(o=e.parents(".j_l_post").getData(),t=o.author.user_name):(o=e.getData(),t=o.user_name),i.show()}catch(s){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:s.message||s.description,path:"pb:widget/post_list/hide_post.js",method:"",ln:161}),s}}).delegate(".user-hide-post-up","click",function(){try{var e=$(this);e.tbattr("class","user-hide-post-down"),i.hide()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/hide_post.js",method:"",ln:165}),e}}).delegate(".p_content","mouseenter",function(){var t=$(this).parents(".j_l_post"),s=t.getData();return""==PageData.user.user_name||PageData.user.user_name==(s&&s.author&&s.author.user_name)?!1:(e=$(this),d=!1,window.postDown=$(this).find(".user-hide-post-down"),window.postDown.show(),void 0)}).delegate(".p_content","mouseleave",function(){var e=window.postDown;return"undefined"==typeof e?!1:(e.hasClass("user-hide-post-up")&&e.tbattr("class","user-hide-post-down"),e.hide(),$(this).find(".user-hide-post-action").hide(),void 0)}).find("li.lzl_single_post").live("mouseenter","li.lzl_single_post",function(){e=$(this);var t=e.getData();if(""==PageData.user.user_name||PageData.user.user_name==t.user_name)return!1;a.appendTo(e);var s={};PageData.is_posts_admin||PageData.is_thread_admin?(s=e.find(".j_lzl_o_l").position(),a.css({top:s.top,right:543-s.left}).show()):(s=e.find(".lzl_time").position(),a.css({top:s.top,right:543-s.left+38}).show()),d=!0}).live("mouseleave","li.lzl_single_post",function(){a.hasClass("user-hide-post-up")&&a.tbattr("class","user-hide-post-down"),a.hide(),i.hide()}),window.global=window.global||{},window.global.shieldPost=function(){$("body").append(a).append(i)}}}});
;_.Module.define({path:"pb/widget/postList/TbmallGuide",requires:["common/component/Card"],sub:{initial:function(){try{this._bindEvent()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/tbmall_guide.js",method:"",ln:12}),e}},_private_guide_card:"",_guideTimeoutId:"",_bindEvent:function(){var e=this;$("#j_p_postlist").delegate(".j_tbmall_guide","click",function(){try{e.preventDefault(),$(window).scrollTop($("[name='sub']").offset().top),$(".edui-btn-medal").click(),e.stopPropagation()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/tbmall_guide.js",method:"",ln:22}),e}}).delegate(".j_nameplate","mouseenter",function(){clearTimeout(e._guideTimeoutId),e._showTip($(this))}).delegate(".j_nameplate","mouseleave",function(){clearTimeout(e._guideTimeoutId),e._guideTimeoutId=setTimeout(function(){e._hideTip($(this))},300)})},_showTip:function(e){var t=this;t._private_guide_card&&t._private_guide_card.closeCard();var a=e.offset(),i=(e.hasClass("j_nameplate")||e.hasClass("p_mall_tail")?a.top:a.top+43,e.hasClass("p_mall_tail")?a.left+132:a.left+105,""),l=180;e.hasClass("j_self_has_nameplate")?(i='<a class="pb_nameplate_recast_guide" href="/tbmall/propslist?category=112&ps=24" target="_blank" style="color: #1d53bf;">\u94ED\u724C\u73B0\u5728\u53EF\u4EE5\u91CD\u94F8\u4E86\u54E6~</a>',l=140):e.hasClass("j_self_nameplate")?(i='<a class="pb_nameplate_recast j_nameplate_recast" href="javascript:;" data-nameplate="'+$.json.encode(e.data("field")).replace(/\"/g,"&quot;")+'">\u91CD\u94F8\u94ED\u724C</a>',l=100):i=e.hasClass("j_self_no_nameplate")?'<div style="height: 28px; line-height:28px"><img style="width: 18px; height: 18px; vertical-align:middle;float:left;margin:5px;" src="/tb/static-pb/img/t_show_icon.png?v=0318" /><span style="float:left;margin-right: 5px; color:#1d53bf;">\u8D34\u5427\u7279\u6743</span><a href="/tbmall/tshow" target="_blank" class=" ui_btn ui_btn_s" style="margin-top: 2px;"><span><em>\u4F1A\u5458\u514D\u8D39\u4F7F\u7528</em></span></a></div>':'<div style="height: 28px; line-height:28px"><img style="width: 18px; height: 18px; vertical-align:middle;float:left;margin:5px;" src="/tb/static-pb/img/t_show_icon.png?v=0318" /><span style="float:left;margin-right: 5px; color:#1d53bf;">\u8D34\u5427\u7279\u6743</span><a href="/tbmall/home" target="_blank" class=" ui_btn ui_btn_s" style="margin-top: 2px;"><span><em>\u4F1A\u5458\u514D\u8D39\u4F7F\u7528</em></span></a></div>',t._private_guide_card=t.use("common/component/Card",{content:i,arrow_dir:"left",arrow_pos:{left:-7,top:9},card_css:{top:a.top+(e.outerHeight()-34)/2,left:a.left+e.outerWidth()+7,width:l,height:50}}),t._private_guide_card.showCard(),t._private_guide_card._j_card.on("mouseenter",function(){clearTimeout(t._guideTimeoutId)}).on("mouseleave",function(){t._private_guide_card.closeCard()}).on("click",".ui_btn",function(){try{$.stats.track("\u94ED\u724C","\u4F1A\u5458\u5065\u5EB7\u7EDF\u8BA1","","click",{obj_name:"PB\u9875\u94ED\u724C\u5F39\u51FA\u5C42\u70B9\u51FB"})}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/tbmall_guide.js",method:"",ln:76}),e}})},_hideTip:function(){self._private_guide_card&&self._private_guide_card.closeCard()}}});
;_.Module.define({path:"pb/widget/postList",requires:["pb/widget/Posts","album/widget/imgLikeAction","pb/widget/sub_list/subListTotal","common/widget/tbshare","pb/widget/complientThread","pb/widget/bindHover"],sub:{initial:function(e){try{var t=this;if(this.params=e,this.posts=t.requireInstance("pb/widget/Posts"),this._bindOperatePower(),this._getCommentList(e),this.requireInstance("pb/widget/postList/FeedBack"),this.requireInstance("pb/widget/postList/PostPic"),Page.checkLoadedModules("forumList"))return;this.requireInstance("pb/widget/postList/HidePost"),this.requireInstance("pb/widget/postList/TbmallGuide"),this.requireInstance("album/widget/imgLikeAction"),this.requireInstance("pb/widget/complientThread"),this.requireInstance("pb/widget/bindHover"),this._bindEvents(),this._initPbShare()}catch(i){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:i.message||i.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:47}),i}},_loadCommentList:function(e,t){var i=this;i.requireInstance("pb/widget/postList/Lzl"),i._loadSubList=i.requireInstance("pb/widget/sub_list/subListTotal",[{commentData:e,searchCid:t}]),this.require.async(["datalazyload"],function(e){window.datalazyload=new e($(document.body),{diff:500,autoDestroy:!1,subListOnloadCallback:function(e){i._loadSubList.showLzlPost(e)}})})},_getCommentList:function(e){var t=this,i=e.searchCid||0,n=e.pn||1,s=e.isSeeLz||0,o="/p/totalComment?t="+(new Date).getTime();$.getJSON(o,{tid:PageData.thread.thread_id,fid:PageData.forum.forum_id,pn:n,see_lz:s},function(e){0==e.errno&&t._loadCommentList(e.data,i)})},_bindEvents:function(){var e=this;$("#pb_content").delegate(".j_quick_reply, a.p_reply_first","click",function(t){try{return t.preventDefault(),t.stopPropagation(),PageData.user.is_login?setTimeout(function(){e.fire("wanna_post")},50):TbCom.process("User","buildLoginFrame",null,null,null,"quick_reply"),!1}catch(t){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:t.message||t.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:106}),t}}).delegate(".j_louzhubiaoshi","mouseenter",function(){var e=$(this),t=e.position(),i={content:"\u70B9\u51FB\u5373\u53EF\u201C\u53EA\u770B\u697C\u4E3B\u201D\u54DF~",arrow_dir:"up",arrow_pos:{left:20},bubble_css:{top:t.top+36,left:t.left,width:140},wrap:e.parent(),closeBtn:!1},n=new UiBubbleTipBase(i);n.showBubble({zIndex:$.getcurzIndex()}),e.one("mouseleave",function(){n.closeBubble()})}).delegate(".j_voice_ad_gif","click",function(){try{$.stats.track("voice_ad_gif","voice"),$("body").trigger("showvoicedialog",!0)}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:133}),e}}).delegate(".replace_tip","click",function(){try{$(this).hide().parent(".replace_div").css("height","auto"),$(this).closest(".j_d_post_content").find(".cnt_act_vote_area").css("z-index",10)}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:136}),e}}).delegate(".j_lzl_forbidden_tip_close","click",function(){try{$(this).parent().parent().slideUp()}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:138}),e}}).on("click",".j_go_my_achievement_page",function(e){try{e.preventDefault(),PageData.user.is_login?window.open("/home/achievement?un="+encodeURIComponent(PageData.user.user_name)+"&ie=utf8&fr=pb_achievement_btn"):TbCom.process("User","buildLoginFrame",null,null,null,"j_go_my_achievement_page")}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:146}),e}}).delegate(".d_author .icon_tbworld","click",function(){try{$.stats.track("\u7687\u51A0","\u4F1A\u5458\u5065\u5EB7\u7EDF\u8BA1","","click",{obj_name:"PB\u697C\u5C42\u5DE6\u4FA7\u7687\u51A0\u70B9\u51FB"})}catch(e){throw"undefined"!=typeof alog&&alog("exception.fire","catch",{msg:e.message||e.description,path:"pb:widget/post_list/post_list_main.js",method:"",ln:150}),e}})},_bindOperatePower:function(){Page.checkLoadedModules("pbAdmin")||(PageData.is_thread_admin||PageData.is_posts_admin)&&this.requireInstanceAsync("pb/widget/Admin",[{needPaypostAgree:this.params.needPaypostAgree}],function(e){e.loadThreadManage(),e.bindAdminEvents(),e.bindLzlAdminEvents()})},_initPbShare:function(){return this.requireInstance("common/widget/tbshare/tbshare_popup",[{$container:$("#pb_tbshare_container")}]),!0}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,_=t.Parr_scores,u=0;_&&(u=_.scores_money+_.scores_other);var s=u>=e.tdou_num,c=0;s||(c=e.tdou_num-u);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,_=0;d||(_=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this,o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain()})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,_=t.Parr_scores,u=0;_&&(u=_.scores_money+_.scores_other);var s=u>=e.tdou_num,c=0;s||(c=e.tdou_num-u);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,_=0;d||(_=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this,o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain()})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"tbmall/widget/forumMemberDialog",requires:["tbmall/widget/tbean_safe_ajax","common/widget/cashierDialog","common/widget/messenger","common/widget/baseUserData","common/widget/payMember"],sub:{opts:{},initial:function(e){var t=this,s={is_show_features:!0,is_show_forum:!0,current_time_order:1,current_option:null,current_time_unit:3,current_forum_id:"",current_forum_name:""};this.opts=$.extend({},s,e),this.tpl_data.forums=this.opts.forums,this.opts.scores=this.opts.scores||PageData.scores,this.forumMemberTitle=this.opts.is_celebrity_forum?"\u5427\u4F1A\u5458":"\u5427\u7279\u6743\u5305",this.safeAjax=this.use("tbmall/widget/tbean_safe_ajax"),this.showDialog({showTitle:!1,width:886,height:t.opts.cnt_height||295,html:t.buildInitHtml()}),t.opts.current_option=$($(".sel_time .j_pertime_unit")[t.opts.current_time_order]),t.opts.current_option.addClass("current_time_unit"),t.bindEvents()},bindEvents:function(){var e=this,t=$(".excharge_bd"),s=$("#customForum");t.delegate(".j_charge_tdou","click",function(t){var i=e.getTimeValue(),o=e.opts.scores,r=0;o&&(r=o.scores_money+o.scores_other);var a=parseInt(5e3*i),n=$("#customTime").val();return t.preventDefault(),e.opts.is_show_forum?e.util._isEmpty($("#customForum").val())?(e.showErrorForum("empty"),void 0):$.trim(n).length>0&&!e.util._isPositiveDigital(n)?(e._printTimeErrorInfo("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6570\u503C"),void 0):parseInt($.trim(n),10)>120?(e._printTimeErrorInfo("\u6700\u591A\u5145\u503C120\u4E2A\u6708"),$(this).val(120),void 0):e.opts.isClickByUser?a>r?(e.initTdouNotEnough(r,a),void 0):(e.initBuyMember(),void 0):(e.checkHasForum(s.val(),function(t){e.opts.current_forum_id=t.data.forum_id,e.opts.current_forum_name=t.data.forum_name,a>r?e.initTdouNotEnough(r,a):e.initBuyMember()}),void 0):a>r?(e.initTdouNotEnough(r,a),void 0):(e.initBuyMember(),void 0)}),$(".j_close_excharge").on("click",function(t){t.preventDefault(),e.closeDialog()}),$(".excharge_bd").delegate(".j_pertime_unit","click",function(t){t.preventDefault(),e.changeCurrentOpt($(this),"current_time_unit"),e._close_tip_bubble(),e.changeTdouNum(),$("#customTime").val("")}),$(".excharge_bd").delegate("#customTime","focus",function(){e.changeCurrentOpt($(this).closest(".j_customTime_unit"),"current_time_unit"),e.changeTdouNum()}),$(".excharge_bd").delegate("#customTime","keyup",function(){var t=$(this).val();return $.trim(t).length>0&&!e.util._isPositiveDigital(t)?(e._printTimeErrorInfo("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6570\u503C"),void 0):parseInt($.trim(t),10)>120?(e._printTimeErrorInfo("\u6700\u591A\u5145\u503C120\u4E2A\u6708"),$(this).val(120),e.changeTdouNum(),void 0):(e._close_tip_bubble(),e.changeTdouNum(),void 0)}),$(".sel_forum").delegate(".j_forum_unit","click",function(t){t.preventDefault();var i=$(this),o=i.data("forumid"),r=decodeURIComponent(i.text());e.hideErrorForum(),e.opts.current_forum_id=o,e.opts.current_forum_name=r,e.opts.isClickByUser=!0,s.val(r),$(".j_show_more").hasClass("show_more_forums_list")&&$(".j_show_more").removeClass("show_more_forums_list")}),$(".sel_forum").delegate("#customForum","keyup",function(){var t=e.opts.current_forum_name,i=$.trim(s.val());t!==i&&(e.opts.isClickByUser=!1),""===i&&e.hideErrorForum()}),$(".sel_forum").delegate("#customForum","blur",function(){var t=s.val();return e.util._isEmpty(t)?(e.showErrorForum("empty"),void 0):$.trim(t).length>0&&!e.util._isPositiveDigital(t)?(e._printTimeErrorInfo("\u8BF7\u8F93\u5165\u6B63\u786E\u7684\u6570\u503C"),void 0):parseInt($.trim(t),10)>120?(e._printTimeErrorInfo("\u6700\u591A\u5145\u503C120\u4E2A\u6708"),$(this).val(120),void 0):(e._close_tip_bubble(),e.checkHasForum(t),void 0)}),$(".sel_forum").delegate(".j_get_more_f","click",function(e){e.preventDefault(),$(".j_show_more").toggleClass("show_more_forums_list")}),$(".excharge_bd").delegate(".j_get_tdou","click",function(t){t.preventDefault(),e.closeDialog(),_.Module.use("common/widget/JoinVipDialog",[],function(e){e.getMemberDialog()})})},initTdouNotEnough:function(e,t){var s=this,i=s.getTimeValue(),o={month:i,baidu_charge:t,tdou_num:e};s.closeDialog(),s.chargeFailFn($.extend({},o,{f_name:s.opts.current_forum_name}))},initBuyMember:function(){var e=this,t=e.getTimeValue(),s=PageData.user?PageData.user.mParr_props?PageData.user.mParr_props.forum_member?PageData.user.mParr_props.forum_member[e.opts.current_forum_id]:null:null:null,i=function(){e.safeAjax.ajax({url:"/tbmall/mall/buyForumMember",data:{tbs:PageData.tbs,forum_id:e.opts.current_forum_id,buy_num:t},success:function(t){e.closeDialog(),e.chargeSuccessFn(t)}})},o=PageData.user?PageData.user.mParr_props?PageData.user.mParr_props.level?2===PageData.user.mParr_props.level.props_id?PageData.user.mParr_props.level.end_time:0:null:null:null,r=s?s.end_time:0,a=r||o,a=Math.max(Math.max(r,o),1*new Date/1e3);if(t>=24||a&&parseInt(a)+31*t*24*60*60-1*new Date/1e3>=64281600){var n=new $.dialog({html:['<a class="outpage_close j_close_excharge" href="#"></a>','<div class="long_time_area">','<p class="long_time_msg">\u5F00\u901A<b>\u3010'+e.opts.current_forum_name+e.forumMemberTitle+"\u3011</b></p>",'<p class="long_time_msg"><b>\u7279\u6743\u65F6\u957F\u6700\u591A\u8FDE\u7EED\u5151\u636224\u4E2A\u6708\uFF0C\u8D85\u51FA\u90E8\u5206\u53EA\u8D60\u9001\u7ECF\u9A8C\u548C\u9053\u5177\u3002</b></p>','<p class="long_time_msg">\u672C\u6B21\u5151\u6362\u9700\u8981<span class="tdou_num">'+5e3*t+"</span></p>",'<div class="long_time_operation">','<a href="#" class="long_time_cancel_btn j_close_excharge">\u53D6&nbsp;\u6D88</a>','<a href="#" class="long_time_accept_btn j_accept_excharge">\u786E&nbsp;\u8BA4</a>',"</div>","</div>"].join(""),width:460,height:170,showTitle:!1}),l=n.element;l.on("click",".j_close_excharge",function(e){e.preventDefault(),n.close()}).on("click",".j_accept_excharge",function(e){e.preventDefault(),i(),n.close()})}else i()},changeCurrentOpt:function(e,t){var s=this;s.opts.current_option&&s.opts.current_option.removeClass(t),s.opts.current_option=e,s.opts.current_option.addClass(t)},changeTdouNum:function(){var e=this;$(".sel_tdou .tdou_num").text(5e3*e.getTimeValue())},getTimeValue:function(){var e=$.trim($("#customTime").val());return this.opts.current_option&&this.opts.current_option.data("value")?this.opts.current_option.data("value"):0===e.length&&""===e?0:e},chargeSuccessFn:function(e){var t=this,s={0:{html:t.buildSuccessHtml(e.data),height:456},2270046:{html:t.buildEnoughHtml(),height:216}};0==e.no&&(t.opts.scores=$.extend(t.opts.scores,e.data.left_scores)),t.showDialog({width:537,height:s[e.no].height,showTitle:!1,html:s[e.no].html}),$(".j_close_excharge, .j_excharge_confirm").on("click",function(e){e.preventDefault(),t.closeDialog(),$.tb.location.reload()})},chargeFailFn:function(e){var t=this;t.showDialog({width:537,height:226,showTitle:!1,html:t.buildFailHtml(e)}),$(".j_close_excharge").on("click",function(e){e.preventDefault(),t.closeDialog()}),$(".j_get_tdou").on("click",function(e){e.preventDefault(),t.closeDialog(),_.Module.use("common/widget/tcharge_dialog")})},buildInitHtml:function(){var e=this,t=baidu.template,s=e.opts.is_show_forum?"\u5151\u6362"+e.forumMemberTitle:"\u5151\u6362\u3010"+e.opts.current_forum_name+"\u5427\u3011"+e.forumMemberTitle;return['<a class="outpage_close j_close_excharge" href="#"></a>','<div class="excharge_hd">',$.tb.format(e.tpl.hd,{title:s}),"</div>",'<div class="excharge_bd">','<div class="lp">',t(e.tpl.bd_lp_t,{forum_member_title:e.forumMemberTitle}),e.opts.is_show_features?t(e.tpl.features,e.tpl_data):"","</div>",'<div class="rp">',e.opts.is_show_forum?t(e.tpl.bd_rp_forum,e.tpl_data):"",t(e.tpl.bd_rp_time,e.tpl_data),'<p class="long_time_warning" ',e.opts.is_celebrity_forum?'style="visibility: hidden;"':"",">\u7279\u6743\u5305\u65F6\u957F(\u7D2F\u8BA1\u8D85\u7EA7\u4F1A\u5458)\u6700\u591A\u8FDE\u7EED24\u4E2A\u6708\uFF0C\u8D85\u51FA\u90E8\u5206\u53EA\u8D60\u9001\u7ECF\u9A8C\u548C\u9053\u5177\u3002</p>",$.tb.format(e.tpl.bd_rp_tdou,{tdou_num:5e3*e.opts.current_time_unit}),t(e.tpl.bd_rp_btn,{tip:e.opts.is_celebrity_forum?"\u8D85\u7EA7\u4F1A\u5458\u514D\u8D39\u62E5\u6709":"\u8D85\u7EA7\u4F1A\u5458\u514D\u8D39\u4F7F\u7528\u7279\u6743"}),"</div>","</div>"].join("")},buildSuccessHtml:function(e){{var t=this;baidu.template}return['<a class="outpage_close j_close_excharge" href="#"></a>','<div class="excharge_hd">',$.tb.format(t.tpl.hd,{title:"\u5151\u6362\u3010"+t.opts.current_forum_name+"\u5427\u3011"+t.forumMemberTitle}),"</div>",'<div class="excharge_bd excharge_succ_bd">',$.tb.format(t.tpl.charge_success,$.extend(e,{end_time:t.util._getDate(e.end_time),forum_member_title:t.forumMemberTitle})),"</div>"].join("")},buildEnoughHtml:function(){return['<a class="outpage_close j_close_excharge" href="#"></a>','<div class="excharge_bd excharge_enough_bd">','<p class="main_intro">\u60A8\u5DF2\u5F00\u901A25\u4E2A\u5427\u7684\u7279\u6743\u5305\uFF0C\u8FBE\u5230\u7279\u6743\u5305\u6570\u91CF\u4E0A\u9650</p>','<p class="sub_intro">\u7ACB\u5373\u5F00\u901A\u8D34\u5427\u4F1A\u5458\uFF0C\u5C3D\u4EAB\u8D34\u5427\u7279\u6743\u65E0\u4E0A\u9650</p>','<a class="j_charge_confirm charge_tdou btn_default btn_small" href="#">\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458</a>',"</div>"].join("")},buildFailHtml:function(e){var t=this,s=baidu.template;return['<a class="outpage_close j_close_excharge" href="#"></a>','<div class="excharge_hd">',$.tb.format(t.tpl.hd,{title:"\u5151\u6362\u3010"+t.opts.current_forum_name+"\u5427\u3011"+t.forumMemberTitle}),"</div>",'<div class="excharge_bd excharge_fail_bd">','<div class="lp">',s(t.tpl.bd_lp_t,{forum_member_title:t.forumMemberTitle}),"<p>\u65F6\u957F\uFF1A"+e.month+"\u4E2A\u6708</p>","</div>",'<div class="rp">',$.tb.format(t.tpl.charge_fail,e),"</div>","</div>"].join("")},tpl_data:{forums:null,features:[{type:"\u7EA2\u8272\u6807\u9898"},{type:"\u7ECF\u9A8C\u52A0\u901F"},{type:"\u76F4\u9001\u7ECF\u9A8C"},{type:"\u8865\u7B7E\u5361",num:"1"},{type:"\u9B54\u62DC",num:"1"},{type:"\u9B54\u86CB",num:"1"}],bd_rp_time:[1,3,6,12]},tpl:{hd:'<p class="title">#{title}</p>',bd_lp_t:['<div class="intro">',"<h5>\u3010<%=forum_member_title%>\u3011</h5>",'<span class="forum_img_box"></span>','<p class="tdou_num"><strong>5000</strong>/\u6708</p>',"</div>"].join(""),features:['<ul class="features">',"<%for(var i = 0; i< features.length; i++){%>",'<li class="feature_<%=i%>"><%=features[i].type%>',"<%if (!!features[i].num) {%>","<strong>X<%= features[i].num %></strong>","<%}%>","</li>","<%}%>","</ul>"].join(""),bd_rp_forum:['<div class="sel_forum">','<span class="sel_label">\u8BF7\u9009\u62E9\u5427:</span>','<div class="sel_cnt">','<input id="customForum" type="text" value=""/>\u5427','<span class="error_forum_tip empty_forum_tip">\u8BF7\u9009\u62E9\u4E00\u4E2A\u5427</span>','<span class="error_forum_tip hasNot_forum_tip">\u8BE5\u5427\u4E0D\u5B58\u5728</span>',"</div>",'<div class="forum_lists j_show_more">',"<%if (forums.length <= 6) {%>","<%for(var i = 0; i < forums.length; i++) {%>",'<a class="per_forum_unit j_forum_unit" data-forumId="<%=forums[i].id%>" href="#"><%=forums[i]["f_name"]%></a>',"<%}%>","<%}else {%>",'<a class="j_get_more_f">','<span class="more_forum_btn"><ins></ins>\u66F4\u591A</span>','<span class="less_forum_btn"><ins></ins>\u5173\u95ED</span>',"</a>","<%for(var i = 0; i < 6; i++) {%>",'<a class="per_forum_unit j_forum_unit" data-forumId="<%=forums[i].id%>" href="#"><%=forums[i]["f_name"]%></a>',"<%}%>",'<div class="more_forums">',"<%for(var i = 6; i < forums.length; i++) {%>",'<a class="j_forum_unit per_forum_unit" data-forumId="<%=forums[i].id%>" href="#"><%=forums[i].f_name%></a>',"<%}%>","</div>","<%}%>","</div>","</div>"].join(""),bd_rp_time:['<div class="sel_time">','<span class="sel_label">\u8BF7\u9009\u62E9\u65F6\u957F:</span>','<span class="sel_cnt">',"<%for(var i = 0; i< bd_rp_time.length; i++){%>",'<a class="j_pertime_unit per_time_unit" data-value="<%=bd_rp_time[i]%>">',"<strong><%=bd_rp_time[i]%></strong>\u4E2A\u6708",'<span class="decorate_icon"></span>',"</a>","<%}%>",'<a class="j_customTime_unit per_time_unit custom_time">','<input id="customTime" type="text" value=""/><span>\u4E2A\u6708</span>','<span class="decorate_icon"></span>',"</a>","</span>","</div>"].join(""),bd_rp_tdou:['<div class="sel_tdou">','<span class="sel_label">\u9700\u8981T\u8C46:</span>','<span class="tdou_num">#{tdou_num}</span>',"</div>"].join(""),bd_rp_btn:['<a class="j_charge_tdou btn_default btn_small charge_tdou" href="#">\u7ACB\u5373\u5151\u6362</a>','<p class="be_svip"><a class="j_get_tdou" href="#"><%=tip%></a></p>'].join(""),charge_success:['<div class="charge_success_info">','<p class="charge_month_num">\u60A8\u5DF2\u7ECF\u6210\u529F\u5151\u6362<strong class="forum_name">\u3010#{forum_name}#{forum_member_title}\u3011</strong></p>','<p class="expire_date">\u6709\u6548\u671F\u81F3#{end_time}</p>',"</div>",'<ul class="charge_success_feature">','<li class="s_feature_1">',"<p>\u7EA2\u8272\u6807\u9898</p>","<span></span>","</li>",'<li class="s_feature_2">',"<p>\u7ECF\u9A8C\u52A0\u901F</p>","<span></span>","</li>",'<li class="s_feature_3">',"<p>\u76F4\u9001\u7ECF\u9A8C</p>","<span></span>","</li>",'<li class="s_feature_4">',"<p>\u9053\u5177\u8D60\u9001</p>",'<span class="props_1">\u8865\u7B7E\u5361X1</span>','<span class="props_2">\u9B54\u62DCX1</span>','<span class="props_3">\u9B54\u86CBX1</span>',"</li>","</ul>",'<p class="success_btns">','<a class="charge_tdou btn_default btn_small" href="/tbmall/mall/forumMember">\u8BE6\u7EC6\u4E86\u89E3\u7279\u6743</a>','<a class="j_excharge_confirm charge_tdou btn_default btn_small" href="#">\u5173\u95ED</a>',"</p>"].join(""),charge_fail:['<div class="fail_cnt">','<p>\u5F00\u901A<strong class="forum_name">\u3010#{f_name}\u3011</strong>#{month}\u4E2A\u6708</p>','<p>\u8BE5\u7279\u6743\u9700\u8981<span class="orange_num">#{baidu_charge}</span></p>','<p>\u5F53\u524D\u60A8\u4EC5\u6709<span class="orange_num">#{tdou_num}</span></p>',"</div>",'<a class="j_get_tdou charge_tdou btn_default  btn_small" href="#">\u83B7\u53D6T\u8C46</a>'].join("")},showErrorForum:function(e){$(".error_forum_tip").hide(),$("."+e+"_forum_tip").css("display","inline-block")},hideErrorForum:function(){$(".error_forum_tip").hide()},checkHasForum:function(e,t){var s=this;$.post("../get/checkForum",{forum_name:encodeURIComponent(e),tbs:PageData.tbs}).done(function(e){0===e.no&&(0===e.data.forum_id&&null===e.data.forum_name?s.showErrorForum("hasNot"):(s.hideErrorForum(),$.isFunction(t)&&t(e)))})},showDialog:function(e){this._dialog=new $.dialog(e)},closeDialog:function(){this._dialog&&this._dialog.close()},_build_tip_bubble:function(e){var t=this,s={content:e,arrow_dir:"up",bubble_css:{top:t.opts.is_show_forum?124:52,right:45,width:130,"z-index":9999},arrow_pos:{left:10},attr:"",wrap:$(".sel_time"),closeBtn:!0};this.opts.tip_bubble=new UiBubbleTipBase(s);var i=this.opts.tip_bubble;i.showBubble(),i.bind("onclose",function(){t._close_tip_bubble()})},_close_tip_bubble:function(){this.opts.tip_bubble&&this.opts.tip_bubble.hideBubble()},_show_tip_bubble:function(){this.opts.tip_bubble&&this.opts.tip_bubble.showBubble()},_printTimeErrorInfo:function(e){this.opts.tip_bubble?this._show_tip_bubble():this._build_tip_bubble(e)},util:{_isEmpty:function(e){return 0===$.trim(e).length},_isPositiveDigital:function(e){return/^[1-9]+[0-9]*]*$/.test(e)},_getDate:function(e){var t=new Date(1e3*e),s=t.getFullYear(),i=t.getMonth()+1,o=t.getDate();return s+"\u5E74"+i+"\u6708"+o+"\u65E5"}}}});_.Module.define({path:"user/widget/celebrity_forum_dialog",requires:["tbmall/widget/forumMemberDialog"],sub:{initial:function(i){this._params=i,this._user=PageData.user,this._bindEvents()},_bindEvents:function(){var i=this._params.$root,s=this;i.on("click",function(){if(!s._user.is_login)return s.requireInstanceAsync("common/widget/LoginDialog"),void 0;var i=$(this).data("forumid")||s._params.forumId||PageData.forum.id;$.post("/celebrity/submit/getForumSupport",{forum_id:i,tbs:PageData.tbs},function(i){if(i.data&&i.data.length>0){var t=s.formatForumSupportData(i.data[0]);s._showDialog(t)}})})},formatForumSupportData:function(i){var s,t=i.npc_info.level_id;return s=3>=t?"1":t>3&&5>=t?"2":t>5&&7>=t?"2_1":t>7&&9>=t?"2_2":t>9&&11>=t?"3":t>11&&13>=t?"3_1":t>13&&15>=t?"3_2":"4",i.npc_info.lvStyle=s,i},_showDialog:function(i){var s='<div class="celebrity_forum_dialog_wrap">  <div class="dialog_content">   <div class="dialog_left">    <div class="npc_info">     <a href="/celebrity/rankHome" target="_blank">     <img src="http://himg.baidu.com/sys/portraitm/item/<%=npc_info.npc_avatar%>" width="140" height="140" />     </a>     <div class="user_level">      <p class="uname"><a href="/celebrity/rankHome" target="_blank"><%=npc_info.npc_name%></a><i class="icon_red"></i></p>      <a href="/f/like/level?kw=<%=encodeURIComponent(npc_info.npc_forum_name)%>&ie=utf-8" target="_blank" title="\u672C\u5427\u5934\u8854<%=npc_info.level_id%>\u7EA7\uFF0C\u7ECF\u9A8C\u503C<%=npc_info.cur_score%>\uFF0C\u70B9\u51FB\u8FDB\u5165\u672C\u5427\u5934\u8854\u8BF4\u660E\u9875" class="badge_f badge badge_lv<%=npc_info.lvStyle%>">       <div class="badge_name"><%=npc_info.level_name%></div>       <div class="badge_index"><%=npc_info.level_id%></div>      </a>      <div class="exp">       <div class="exp_lable">\u7ECF\u9A8C\uFF1A</div>       <a class="exp_bar exp_bar_f" href="/f/like/level?kw=<%=encodeURIComponent(npc_info.npc_forum_name)%>&ie=utf-8" target="_blank">        <div class="exp_bar_current exp_bar_current_f" style="width:<%=(npc_info.cur_score * 100) / (npc_info.cur_score + npc_info.score_left)%>%;"></div>        <div class="exp_num">         <span class="exp_current_num"><%=npc_info.cur_score%></span>         <span>/<%=npc_info.cur_score + npc_info.score_left%></span>        </div>       </a>      </div>      <p>\u540D\u4EBA\u699C\u6392\u540D\uFF1A<span class="red_text"><%=npc_info.npc_rank%></span></p>      <p><a href="/celebrity/rankHome" target="_blank">\u67E5\u770B\u540D\u4EBA\u699C>></a></p>     </div>    </div>    <div class="npc_sign_info">     <div class="info_top">      \u52A9\u653B\u8BE6\u60C5     </div>     <div class="info_content">      <p class="today">\u4ECA\u65E5\u52A9\u653B\u4EBA\u6570\uFF1A<b><%=npc_info.total_person%></b></p>      <div class="detail">       <div class="col2_left">        <p class="orange_text"><%=user.my_continue_days%></p>        <p>\u6211\u8FDE\u7EED\u52A9\u653B</p>       </div>       <div class="col2_right">        <p class="orange_text"><%=user.my_total_days%></p>        <p>\u6211\u7D2F\u79EF\u52A9\u653B</p>       </div>      </div>     </div>    </div>    <div class="npc_sign">     <a href="javascript:;" data-forumid="<%=npc_info.npc_forum_id%>" data-npcid="<%=npc_info.npc_id%>" class="sign_btn j_sign_btn <% if (user.is_signed) { %> disable <% } %>"><% if (user.is_signed) { %>\u4ECA\u65E5\u5DF2\u52A9\u653B<% } else { %>\u70B9\u6211\u52A9\u653B<% } %></a>    </div>   </div>   <div class="dialog_right">    <div class="scroll_wrapper">    <ul>     <% for (var i = 0, l = props.length; i < l; i++) { %>     <li class="npc_prop_item">      <div class="item_pic">       <img src="<%=props[i].logo_picurl%>" width="70" height="70" />       <% if (props[i].is_unlock == 0) { %>        <div class="lock" style="height: <%=100 - props[i].lock_npc_percent %>%"></div>        <div class="lock_num">        <% if (props[i].lock_npc_percent == 0) { %>         <i class="icon_lock"></i>        <% } else { %>         <%= props[i].lock_npc_percent %>%        <% } %>        </div>       <% } %>      </div>      <div class="item_intro">        <h4><%=props[i].title%></h4>        <p>\u89E3\u9501\u6761\u4EF6\uFF1A         <%=npc_info[\'npc_name\']%>\u8D26\u53F7\u8FBE\u5230<b><%=props[i].lock_npc_level%></b>\u7EA7</p>        <p>\u9886\u53D6\u6761\u4EF6\uFF1A        <% if (props[i].props_category == 300) { %>         \u6BCF\u5929\u53EF\u4F7F\u75281\u6B21\uFF0C\u672C\u5427\u4F1A\u5458\u4F7F\u7528\u6B21\u6570\u4E0D\u9650        <% } else { %>         <% if (props[i].limit_sign_level == 0 && props[i].lock_need_vip == 0) { %>          \u65E0         <% }         if (props[i].limit_sign_level > 0) { %>          <%=npc_info[\'npc_fans_name\']%>\u8FDE\u7EED\u52A9\u653B<b><%=props[i].limit_sign_level%></b>\u6B21         <% }          if ( props[i].lock_need_vip == 1 ) {            if (props[i].limit_sign_level > 0) {%>\uFF0C<% } %>          <span class="red_text">\u672C\u5427\u4F1A\u5458\u4E13\u5C5E</span>         <% }         }        %>       </p>      </div>      <div class="item_action">       <% if (props[i].is_unlock == 0) { %>        <button class="btn_sub btn_middle btn_disable">\u5F85\u89E3\u9501</button>       <% } else if (props[i].can_get == 0) { %>        <button class="btn_sub btn_middle btn_disable">\u5F85\u9886\u53D6</button>       <% } else if (props[i].is_used == 0) { %>        <button class="btn_default btn_middle j_btn_get" data-propsid="<%=props[i].props_id%>">&nbsp;\u9886&nbsp;&nbsp;\u53D6&nbsp;</button>       <% } else if (props[i].props_category == 200 || props[i].props_category == 113 || props[i].props_category == 300) { %>        <button class="btn_sub btn_middle btn_disable" data-propsid="<%=props[i].props_id%>">\u5DF2\u83B7\u5F97</button>       <% } else { %>        <button class="btn_sub btn_middle j_btn_unuse" data-propsid="<%=props[i].props_id%>">\u53D6\u6D88\u4F7F\u7528</button>       <% } %>       </div>     </li>     <% } %>    </ul>    </div>   </div>  </div>  <div class="dialog_footer">   <p>    <span class="grey_text">\u52A9\u653B\u8BF4\u660E: </span>    \u666E\u901A\u52A9\u653B,\u672C\u5427\u7ECF\u9A8C<span class="orange_text">+1</span>,    \u540D\u4EBA\u7ECF\u9A8C<span class="orange_text">+0.01</span>    &nbsp;&nbsp;    <%=npc_info.npc_forum_name%>\u5427\u4F1A\u5458\u52A9\u653B,\u672C\u5427\u7ECF\u9A8C<span class="orange_text">+2</span>,    \u540D\u4EBA\u7ECF\u9A8C<span class="orange_text">+0.1</span>    &nbsp;&nbsp;    <a class="btn_default btn_small j_buy_npc_member" data-fid="<%=npc_info[\'npc_forum_id\']%>" data-fname="<%=npc_info[\'npc_forum_name\']%>" href="javascript:;">\u5151\u6362\u672C\u5427\u4F1A\u5458</a>   </p>  </div> </div>',t=baidu.template(s,i),a=i.npc_info||{};this._dialog=new $.dialog({holderClassName:"celebrity_forum_dialog",html:t,width:715,height:526,title:"\u52A0\u5165"+a.npc_fans_name+",\u53C2\u52A0"+a.npc_forum_name+"\u517B\u6210\u8BA1\u5212",draggable:!1}),this._bindDialogEvents(this._dialog)},_bindDialogEvents:function(i){var s=this,t=$(i.element);t.find(".j_sign_btn").on("click",function(){if(!$(this).hasClass("disable")){var i=$(this).data("npcid"),t=$(this).data("forumid");$.post("/celebrity/submit/support",{forum_id:t,npc_id:i,tbs:PageData.tbs},function(i){switch(i.no){case 0:s._dialog.close();var t=s.formatForumSupportData(i.data);s._showDialog(t);break;case 340027:$.dialog.alert("\u5F88\u62B1\u6B49\uFF0C\u5C01\u7981\u7528\u6237\u65E0\u6CD5\u52A9\u653B",{title:"\u63D0\u793A"});break;default:$.dialog.alert("\u62BD\u98CE\u4E86~",{title:"\u63D0\u793A"})}})}}),t.find(".j_buy_npc_member").on("click",function(){var i=$(this).data("fid"),t=$(this).data("fname"),a={scores_money:0,scores_other:0};s.requireInstance("tbmall/widget/forumMemberDialog",{is_show_features:!1,is_show_forum:!1,current_forum_id:i,current_forum_name:t,scores:s._user.Parr_scores?s._user.Parr_scores:a,cnt_height:225,is_celebrity_forum:!0,callback:function(){$.tb.location.reload()}}),s._dialog.close()}),t.on("click",".j_btn_get",function(){var i=this,s=$(this).data("propsid");$.post("/celebrity/submit/getNpcProps",{props_id:s,tbs:PageData.tbs},function(s){0==s.no?200==s.data.props_category||300==s.data.props_category||113==s.data.props_category?$(i).text("\u5DF2\u83B7\u5F97").tbattr("class","btn_sub btn_middle btn_disable"):$(i).text("\u53D6\u6D88\u4F7F\u7528").tbattr("class","btn_sub btn_middle j_btn_unuse"):$.dialog.alert("\u62BD\u98CE\u4E86")})}),t.on("click",".j_btn_unuse",function(){var i=this,s=$(this).data("propsid");$.post("/tbmall/post/closeProps",{props_id:s,tbs:PageData.tbs},function(s){0==s.no?$(i).html("&nbsp;\u9886&nbsp;&nbsp;\u53D6&nbsp;").tbattr("class","btn_default btn_middle j_btn_get"):$.dialog.alert("\u62BD\u98CE\u4E86")})})}}});_.Module.define({path:"tbmall/component/NetProxy",requires:["tbmall/widget/TbeanSafeAjax"],sub:{_buyPropUrl:"/tbmall/post/buyprops",_mBuyPropUrl:"/tbmall/post/mbuyprops",_usePropUrl:"/tbmall/post/openProps",_mUsePropUrl:"/tbmall/post/mopenProps",_cancelPropUrl:"/tbmall/post/closeProps",initial:function(){},buyProp:function(t,o){var r=this;t.tbs=PageData.tbs;var s=this.requireInstance("tbmall/widget/TbeanSafeAjax");s.post(r._buyPropUrl,t,o)},mBuyProp:function(t,o){var r=this;t.tbs=PageData.tbs,$.tb.post(r._mBuyPropUrl,t,o)},useProp:function(t,o){var r=this;$.tb.post(r._usePropUrl,{props_id:t,tbs:PageData.tbs},o)},mUseProp:function(t,o){var r=this;t.tbs=PageData.tbs,$.tb.post(r._mUsePropUrl,t,o)},cancelProp:function(t,o){var r=this;$.tb.post(r._cancelPropUrl,{props_id:t,tbs:PageData.tbs},o)}}});_.Module.define({path:"props/component/Guide",sub:{initial:function(){},initMagicGuide:function(){var i=$.cookie("PROPS_MAGIC_GUIDE");i||($.cookie("PROPS_MAGIC_GUIDE","true",{expires:30}),this.showMagicGuide())},showMagicGuide:function(i){this.propsId=i,this.builGuideUI(),this.buildGuideEvents(),this.initGuideFlash()},initPreviewUI:function(){this.builGuideUI(),this.buildGuideEvents()},builGuideUI:function(){this.$mask=new $.modal({show:!0});var i=$('<div class="guide_wrap"></div>'),e=$('<div class="guide_content"></div>'),s=$('<a href="#" class="guide_close"></a>');i.append(e).append(s),$("body").append(i),i.css({"z-index":$.getzIndex()}),this.$guideWrap=i,this.$guideContent=e,this.$guideClose=s},buildGuideEvents:function(){var i=this;this.$mask.bind("click",function(){i.closeGuide()}),this.$guideClose.bind("click",function(){return i.closeGuide(),!1})},closeGuide:function(){this.$guideWrap.remove(),this.$mask.remove()},initGuideFlash:function(){this.buildFlashUI(),this.buildFlashEvents()},buildFlashUI:function(){this.$guideWrap.addClass("guide_wrap_magic")},buildFlashEvents:function(){var i=this,e={};e.finishPlay=function(){i.closeGuide()},window.MagicProps=e}}});_.Module.define({path:"tbmall/component/UseController",requires:["tbmall/component/NetProxy","tbmall/component/Dialog","tbmall/component/util"],sub:{buy_number:0,initial:function(){this.netProxy=this.use("tbmall/component/NetProxy"),this.dialog=this.use("tbmall/component/Dialog"),this.util=this.use("tbmall/component/util")},doUse:function(a,e){var t;$.isNumeric(a)?t=a:(this.wrap=a,t=e.props_id);var o=this;$.stats.track(t,"\u8D34\u5427\u5546\u57CE",PageData.page,"\u70B9\u51FB\u4F7F\u7528"),o.netProxy.useProp(t,function(a){var e="";if(0==a.no)e="\u4F7F\u7528\u6210\u529F\uFF01";else switch(a.no){case 2270005:e="\u54CE\u5440\uFF0CT\u8C46\u4E0D\u8DB3";break;case 2270001:e="\u5DF2\u7ECF\u4E70\u8FC7\u5566";break;case 2270004:e="\u60A8\u5DF2\u7ECF\u62E5\u6709\u4E86\u66F4\u9AD8\u7EA7\u7684\u52CB\u7AE0\uFF0C\u65E0\u9700\u8D2D\u4E70\u672C\u52CB\u7AE0\uFF01";break;case 2270006:e="\u672C\u9053\u5177\u4E0D\u53EF\u91CD\u590D\u8D2D\u4E70";break;default:e="\u54CE\u5440\uFF0C\u670D\u52A1\u5668\u62BD\u98CE\u4E86\u3002\u8BF7\u7A0D\u7B49\u4E00\u4F1A~~"}o.wrap&&o.wrap.data("clicked",!1),o.dialog.info('<div class="tip">'+e+"</div>"),0==a.no&&o.dialog.bind("onInfoClose",function(){$.tb.location.reload()})})},cancelUse:function(a,e){var t;$.isNumeric(a)?t=a:(this.wrap=a,t=e.props_id);var o=this;$.stats.track(t,"\u8D34\u5427\u5546\u57CE",PageData.page,"\u53D6\u6D88\u4F7F\u7528"),o.netProxy.cancelProp(t,function(a){var e="";if(0==a.no)e="\u53D6\u6D88\u4F7F\u7528\u6210\u529F\uFF01";else switch(a.no){case 2270005:e="\u54CE\u5440\uFF0CT\u8C46\u4E0D\u8DB3";break;case 2270001:e="\u5DF2\u7ECF\u4E70\u8FC7\u5566";break;case 2270004:e="\u60A8\u5DF2\u7ECF\u62E5\u6709\u4E86\u66F4\u9AD8\u7EA7\u7684\u52CB\u7AE0\uFF0C\u65E0\u9700\u8D2D\u4E70\u672C\u52CB\u7AE0\uFF01";break;case 2270006:e="\u672C\u9053\u5177\u4E0D\u53EF\u91CD\u590D\u8D2D\u4E70";break;default:e="\u54CE\u5440\uFF0C\u670D\u52A1\u5668\u62BD\u98CE\u4E86\u3002\u8BF7\u7A0D\u7B49\u4E00\u4F1A~~"}o.wrap.data("clicked",!1),o.dialog.info('<div class="tip">'+e+"</div>"),0==a.no&&o.dialog.bind("onInfoClose",function(){$.tb.location.reload()})})}}});_.Module.define({path:"ihome/widget/Interaction",sub:{initial:function(n){n?(this.dataObj=n,this._bindEvents()):this._bindFloatEvents()},_resetDataObj:function(n){this.dataObj=n},_follow:function(n,t){var o=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.no_un)return TbCom.process("User","buildUnameFrame"),!1;var e=o._addLoading(n,0);$.tb.post("/home/post/follow",{un:t.un,tbs:t.tbs},function(t){t?0==t.no?o._clearLoading(n,e,0):1130036==t.no?o._showError("\u8BE5\u7528\u6237\u4E0D\u5E0C\u671B\u88AB\u4ED6\u4EBA\u5173\u6CE8",n,0):2260001==t.no?o._showError("\u64CD\u4F5C\u592A\u9891\u7E41\uFF0C\u8BF7\u6B47\u6B47\uFF01",n,0):o._showError("\u5173\u6CE8\u5931\u8D25",n,0):o._showError("\u5173\u6CE8\u5931\u8D25",n,0)})},_showError:function(n,t,o){var e=new $.dialog({html:'<p style="text-align:center">'+n+"<p>",width:300,height:30});e.bind("onclose",function(){var n=1==o?"btn-sub btn-middle btn_concern_done":"btn_concern btn-attention btn-middle",e=1==o?"\u53D6\u6D88\u5173\u6CE8":"\u5173\u6CE8";t.text(e).removeClass().addClass(n)})},_addLoading:function(n,t){var o=$("<span></span>"),e="",r=0,a=[".","..","..."],i=["\u5173\u6CE8\u4E2D","\u53D6\u6D88\u4E2D"],s=setInterval(function(){e=a[r++%3],o.text(e)},400);return n.text(i[t]).append(o),s},_clearLoading:function(n,t,o){var e=1==o?"btn_concern btn-attention btn-small":"btn_concern_done btn-sub btn-small",r=1==o?"\u5173\u6CE8":"\u53D6\u6D88\u5173\u6CE8";n.text(r).removeClass().addClass(e),clearInterval(t)},_unfollow:function(n,t){var o=this;if(!PageData.user.is_login)return TbCom.process("User","buildLoginFrame"),!1;if(PageData.user.no_un)return TbCom.process("User","buildUnameFrame"),!1;var e=o._addLoading(n,1);$.tb.post("/home/post/unfollow",{un:t.un,tbs:t.tbs},function(t){t&&0==t.no?o._clearLoading(n,e,1):2260001==t.no?o._showError("\u64CD\u4F5C\u592A\u9891\u7E41\uFF0C\u8BF7\u6B47\u6B47\uFF01",n,0):o._showError("\u53D6\u6D88\u5173\u6CE8\u5931\u8D25",n,1)})},_bindEvents:function(){var n=this;$("#userinfo_wrap").delegate(".btn_concern","click",function(){return n._follow($(this),n.dataObj),!1}),$("#userinfo_wrap").delegate(".btn_concern_done","click",function(){return n._unfollow($(this),n.dataObj),!1})},_bindFloatEvents:function(){var n=this;$("body").delegate(".card_headinfo_wrap .btn_concern","click",function(){return n._follow($(this),n.dataObj),!1}),$("body").delegate(".card_headinfo_wrap .btn_concern_done","click",function(){return n._unfollow($(this),n.dataObj),!1})}}});_.Module.define({path:"ihome/widget/MonthIcon",sub:{iconTitle:{"01":"\u6469\u7FAF\u5EA7","02":"\u6C34\u74F6\u5EA7","03":"\u53CC\u9C7C\u5EA7","04":"\u767D\u7F8A\u5EA7","05":"\u91D1\u725B\u5EA7","06":"\u53CC\u5B50\u5EA7","07":"\u5DE8\u87F9\u5EA7","08":"\u72EE\u5B50\u5EA7","09":"\u5904\u5973\u5EA7",10:"\u5929\u79E4\u5EA7",11:"\u5929\u874E\u5EA7",12:"\u5C04\u624B\u5EA7"},initial:function(){},getMonthIcon:function(i,n){i=i||{},n=n||1;var t='<div class="month_icon_theme_'+n+'">',o="",e={};for(var a in i){var c=a.length;if(6==c){var h=a.substr(c-2,2);e[h]=i[a]}else 2==c&&(e[a]=i[a])}for(var l in this.iconTitle)o=e&&e[l]?" month_icon_"+l:" month_icon_gray_"+l,t+='<a href="/tbmall/monthicon" target="_blank" title="'+this.iconTitle[l]+'" class="'+o+'"></a>';return t+="</div>"}}});_.Module.define({path:"ihome/widget/UserVisitCard",requires:["common/widget/Card","UserVisitCardBase","ihome/widget/Interaction","props/widget/Residual","common/widget/JoinVipDialog"],sub:{_visit_card:null,_visit_card_ajax:null,_option:{width:370},initial:function(i,a){window.Page&&Page.checkLoadedModules("UserVisitCard")||(this.dataObj=i,this._wrap=$("body"),this._util=this.use("userVisitCardBase"),this._interaction=this.use("ihome/widget/Interaction"),this._residual=this.use("props/widget/Residual"),a||this.bindEvents())},bindEvents:function(){var i=this;this._wrap.delegate(".j_user_card","mouseenter",function(){return i.buildCard($(this)),!1}),this._wrap.delegate(".j_user_card","mouseleave",function(){return i._visit_card_ajax&&i._visit_card_ajax.abort(),i._visit_card&&i._visit_card.closeCard({type:"delayClose",time:200}),i._visit_card=null,!1}),this._wrap.on("click","[j-user-visit-card-marriage-propose]",function(){var a=$(this);i.marryDialog={},i.marryDialog.hide=i.marryDialog.show=function(){};var t=a.tbattr("data-username");i.requireInstanceAsync("encourage/widget/post_marry",{type:"float",propose_name:t},function(a){i.marryDialog=a})}),this._wrap.delegate(".card_userinfo_close","click",function(){return $("#user_visit_card").remove(),!1})},buildCard:function(i){var a=this;a._visit_card&&(a._visit_card.closeCard(),a._visit_card=null);var t='<div class="user_card_loading"><img src="http://tb2.bdstatic.com/tb/static-ihome/img/loading2.gif"/>\u6B63\u5728\u52A0\u8F7D\uFF0C\u8BF7\u7A0D\u540E...</div>',e={content:t,card_css:{width:a._option.width,zIndex:$.getcurzIndex()},auto_positon:!0,event_target:i,attr:"id='user_visit_card'",wrap:$("body")};a._visit_card=a.use("common/widget/Card",e),a._visit_card.showCard({type:"delayShow",time:200}),a.buildVisitCard(i)},getVisitCardContent:function(i){var a=this,t={ie:"utf-8"};i.un?t.un=i.un:t.id=i.id,$.ajax({type:"get",url:"/home/get/panel",data:t,dataType:"json"}).success(function(t){if(t&&0===t.no){var e=t.data;e.bg_id=i.bg_id;var r=a._util.getVisitCardTpl(1,e,!0);i.wrap.html(r)}else{var r='<div class="user_card_loading">\u7F51\u7EDC\u9519\u8BEF<a href="#" id="user_card_reload" class="user_card_reload">\u5237\u65B0</a></div>';i.wrap.html(r)}i.callBack&&$.isFunction(i.callBack)&&i.callBack()})},buildVisitCard:function(i){var a=this,t={ie:"utf-8"};i.getData().un?t.un=i.getData().un:t.id=i.getData().id,a._visit_card_ajax&&a._visit_card_ajax.abort(),a._visit_card_ajax=$.ajax({type:"get",url:"/home/get/panel",data:t,dataType:"json"}).success(function(t){if(t&&0===t.no){var e=t.data,r=e.name==a.dataObj.uname,s=a._util.getVisitCardTpl(r,e,!0);a._visit_card.setContent(s),a._visit_card._j_card.bindData({un:e.name}),a._visit_card.showCard(),a._interaction._resetDataObj({is_login:PageData.user.is_login,un:e.name,tbs:PageData.tbs}),a._residual.showUI({wrap:$("#user_visit_card .userinfo_head_wrap"),props:e.appraise||{}}),a._visit_card._j_card.find(".j_user_visit_card_joinvip").on("click",function(){_.Module.use("common/widget/JoinVipDialog",[],function(i){i.getMemberDialog()})}),$.stats.track("cardinfo","ihome_v1")}else{var s='<div class="user_card_loading">\u7F51\u7EDC\u9519\u8BEF<a href="#" id="user_card_reload" class="user_card_reload">\u5237\u65B0</a></div>';a._visit_card.setContent(s),$("#user_card_reload").on("click",function(){return a.buildCard(i),!1})}})},bindVisitCardEvent:function(){var i=this;i._visit_card.showCard({type:"delayShow",time:200}),$.stats.track("cardinfo","ihome_v1")}}});
;_.Module.define({path:"ihome/widget/UserVisitCard/UserVisitCardBase",requires:["user/widget/Icons","common/widget/UserHead","common/widget/MemberApi","ihome/widget/MonthIcon"],sub:{countLen:0,initial:function(){},getVisitCardTpl:function(e,a,r){var i=PageData.product||"",t=this.use("user/widget/Icons"),n=this.use("common/widget/UserHead"),s=this.use("ihome/widget/MonthIcon"),o=this.use("common/widget/MemberApi"),_=n.getHeadFrameStyle(a,"105"),c={head_img:"/tb/static-ihome/img/panel_"+a.bg_id+".jpg",concernClass:"0"==a.can_followed?"btn_concern_done btn-sub":"btn_concern btn-attention",concernText:"0"==a.can_followed?"\u53D6\u6D88\u5173\u6CE8":"\u5173\u6CE8",un:encodeURIComponent(a.name),btn_group:r?this.getBtnGroup(a):"",frameClass:_.hasFrame?"card_userinfo_left_frame":"",frameStyle:_.stylestr,portrait:n.getHeadUrl(a),fr:i,icon_pre:t.getPreIconHtml(a.mParr_props,a.free_flag),member_class:o.getMemberNameClass(a.mParr_props,a.free_flag),name:a.profession_manager_nick_name||a.name_show,icon:t.getIconsHtml(a),sex:a.sex,tb_age:"-"==a.tb_age?a.tb_age:a.tb_age+"\u5E74",post_num:a.post_num,good_num:a.good_num,honor:s.getMonthIcon(a.tbmall_month_icon,2),honor_margin:this.getHonorMargin(),vip_tips:this.getVipTips(a),userId:a.id};a.is_verify&&"0"!==a.is_verify&&(c.verify_info=this.getVerifyHTML(a.identify_info));var l="",m="",d="";!a.marriage||1!=a.marriage.status&&3!=a.marriage.status&&4!=a.marriage.status?a.marriage&&0!=a.marriage.length&&2!=a.marriage.status||(d='<a class="btn-attention btn-small  user-visit-card-marriage-propose" data-username="'+a.name+'" j-user-visit-card-marriage-propose ><i></i>\u5411TA\u6C42\u5A5A</a>'):(c.marriage_date=$.dateFormat(new Date(1e3*a.marriage.time),"yyyy-MM-dd"),c.marriage_user_name=a.marriage.user_name,l=['<div class="card_userinfo_marry clearfix">','<span class="userinfo_marry_lover">\u7231\u4EBA:#{marriage_user_name}</span>',"</div>"].join(""),m=['<div class="card_userinfo_marry clearfix">','<span class="userinfo_marry_date">\u7ED3\u5A5A\u7EAA\u5FF5\u65E5: #{marriage_date}</span>',"</div>"].join(""));var f="";e||(f='<div class="interaction_wrap interaction_wrap_theme2">'+d+'<a class="btn-small #{concernClass}" target="_blank" href="#" onclick="return false">#{concernText}</a><a class="btn-small btn-default" target="sixin" href="/im/pcmsg?from=#{userId}">\u79C1\u4FE1</a></div>');var u=['<div class="card_headinfo_wrap" id="card_headinfo_wrap">','<img class="card_userinfo_img" src="#{head_img}"/>','<a class="card_userinfo_guide" target="_blank" href="/tbmall/propslist?category=113"></a>',f,"</div>",'<div class="card_userinfo_wrap clearfix">','<div class="card_userinfo_left #{frameClass}">','<div class="userinfo_head_wrap">','<div class="userinfo_head" style="#{frameStyle}"></div>','<a href="/home/main?un=#{un}&fr=#{fr}&ie=utf-8" class="j_avatar" target="_blank"><img src="#{portrait}"/></a>',"</div>","</div>",'<div class="card_userinfo_middle">','<div class="card_userinfo_title clearfix">','#{icon_pre}<a href="/home/main?un=#{un}&fr=#{fr}&ie=utf-8" target="_blank" class="userinfo_username #{member_class}">#{name}</a>#{icon}',"</div>",l,'<div class="card_userinfo_num clearfix">','<span class="userinfo_sex userinfo_sex_#{sex}"></span>',"<span>\u5427\u9F84:#{tb_age}</span>",'<span class="userinfo_split"></span>',"<span>\u53D1\u8D34:#{post_num}</span>","</div>",m,'<div class="card_userinfo_honor honor_margin_#{honor_margin} clearfix">',"#{honor}","</div>","#{vip_tips}","</div>","</div>","#{verify_info}"].join("");return $.tb.format(u,c)},getBtnGroup:function(e){var a="";if(e.id!==PageData.user.id){var r=e.can_begcard,i="";0==r?i='<a class="btn_begcard j_begcard" href="#"></a>':1==r?i='<a class="btn_begcard btn_forbidden">\u5DF2\u7533\u8BF7</a>':2==r&&(i='<a class="btn_begcard btn_forbidden">\u5DF2\u4EA4\u6362</a>');var t={private_msg:"http://msg.baidu.com/ms?ct=21&cm=1&tn=bmSendMessage&un="+encodeURIComponent(e.name),btn_begcard:i};a=['<div class="card_btn_grounps">','<a class="btn_privatemsg" target="_blank" href="#{private_msg}"></a>',"#{btn_begcard}","</div>"].join(""),a=$.tb.format(a,t)}return a},getIcon:function(e){var a="";return e.identity&&(a+='<span title="\u8D34\u5427\u5B9E\u540D\u8BA4\u8BC1" class="card_userinfo_icon card_icon_verify"></span>'),e.meizhi_level>0&&(a+='<a href="/p/'+e.meizhi_thread_id+'" target="_blank" title="\u8D34\u5427\u59B9\u7EB8\u8BA4\u8BC1" class="card_userinfo_icon meizhi_vip card_icon_meizhi_vip'+e.meizhi_level+'"></a>'),a},getHonor:function(e){if(e.novice)return'<div class="grade_level grade_level_novice" title="\u8D34\u5427\u83DC\u9E1F">\u8D34\u5427\u83DC\u9E1F</div>';var a={manager:{title:"\u5427\u4E3B",level:19},assist:{title:"\u5C0F\u5427\u4E3B",level:20},picadmin:{title:"\u56FE\u7247\u5C0F\u7F16",level:21},videoadmin:{title:"\u89C6\u9891\u5C0F\u7F16",level:22},novice:{title:"\u83DC\u9E1F",level:23}},r=e.manager,i=null,t="",n="";this.countLen=0;for(var s in r){i=r[s];var o=i.forum_list.join("\u3001"),_=a[s];o=i.count>2?o+"\u7B49\u5427"+_.title:o+"\u5427"+_.title,t+=this.getHonorItem(_.level,i.count,o),this.countLen+=String(i.count).length}var c=e.grade,l=[];for(var m in c)l.push(m);l.sort(function(e,a){return a-e});for(var d=0,f=l.length;f>d;d++){i=c[l[d]];var o=i.forum_list.join("\u3001");i.count>2&&(o+="\u5427\u7B49"),n+=this.getHonorItem(l[d],i.count,o),this.countLen+=String(i.count).length}return t+n},getHonorMargin:function(){var e={2:"8px",3:"6px",4:"4px"},a=this.countLen-4;return e[a]||""},getHonorItem:function(e,a,r){var i={level:e,title:r,count:a},t=['<div class="grade_level grade_level_#{level}" title="#{title}">',"<span>#{count}</span>","</div>"].join("");return $.tb.format(t,i)},getVerifyHTML:function(e){for(var a={verify_reason:e[0]&&e[0].v_reason,verify_forums:""},r=['<div class="verify_wrap">','<div class="verify_content">','<div class="verify_desc">',"<span>\u5B98\u65B9\u8BA4\u8BC1\uFF1A</span>","<span>#{verify_reason}</span>","</div>",'<div class="verify_forum">','<a class="verify_home" href="http://v.tieba.baidu.com/" target="_blank">\u7533\u8BF7\u4F01\u4E1A\u5B98\u65B9\u5427</a>',"<span>\u5165\u9A7B\u5427\uFF1A</span>","#{verify_forums}","<span>\u5B98\u65B9\u5427\u4E3B</span>","</div>","</div>","</div>"].join(""),i=0;i<e.length;i++)a.verify_forums+=this.getVForumItem(i,e[i].forum_name);return $.tb.format(r,a)},getVForumItem:function(e,a){var r="",i={},t=[];return a.length>5?(r=a.substring(0,5),r+="..."):r=a,i={index:e,verify_forum_name:r,origin_forum_name:encodeURIComponent(a)},t=['<span class="verify_forum_info">','<a target="_blank" class="verify_forum_name_#{index}" href="/f?ie=utf-8&kw=#{origin_forum_name}">#{verify_forum_name}</a>','<a target="_blank" href="http://v.tieba.baidu.com/">','<img class="verify_forum_icon" src="http://tb2.bdstatic.com/tb/static-ihome/img/platform_blue_icon14.gif" alt="\u5B98\u65B9\u8BA4\u8BC1\u56FE\u6807" title="\u767E\u5EA6\u8D34\u5427\u5B98\u65B9\u5E73\u53F0\u8BA4\u8BC1">',"</a>","</span>"].join(""),$.tb.format(t,i)},getVipTips:function(e){var a="",r=(new Date).getTime()/1e3;return e.mParr_props&&e.mParr_props.level&&e.mParr_props.level.end_time>r&&(a='<p class="user_card_vip_tips"><a href="javascript:;" class="j_user_visit_card_joinvip" target="_blank">\u5F00\u901A\u4F1A\u5458</a>\u5C0A\u4EAB\u6635\u79F0\u7EA2\u540D\u7279\u6743 <a href="/tbmall/tshow?tab=detail&c=15" target="_blank">\u4E86\u89E3\u7279\u6743</a> </p>'),a}}});_.Module.define({path:"tbmall/component/HeadPreview",requires:["common/widget/UserHead","tbmall/component/util","props/component/Guide","tbmall/component/UseController","ihome/widget/UserVisitCard"],sub:{initial:function(){this.initUI(),this.initFlashCallbacks(),this.guide=this.use("props/component/Guide"),this.visitCard=this.use("ihome/widget/UserVisitCard"),this.useC=this.use("tbmall/component/UseController"),this.util=this.use("tbmall/component/util")},options:{pngCount:{1090001:3,1090002:5,1090003:5,1090004:4,1090005:5,1090006:5,1090007:5,1090008:4,1090009:5,1090010:5,1090011:5,1090012:4,1090013:5},propIdForProp:{101:"bub",104:"font",108:"card",116:"card",117:"card",118:"card",114:"card",103:"printer"},stylesForAllPreview:{110:"frame",109:"frame"}},_centerElement:function(e){var t=e.height(),i=e.width();e.css({width:i,height:t,top:"50%",left:"50%","margin-left":-(i/2),"margin-top":-(t/2)})},_getData:function(e){$.json.encode($(e).closest("li.item").data("field"));return $(e).closest("li.item").getData()},doPreview:function(e){{var t=this,i=$.json.encode($(e).closest("li.item").data("field")),a=t._getData(e),r=a.props_category,s=a.props_id;t.options.stylesForAllPreview[r]}switch(r){case"107":t.$loading.remove(),t.guide.showMagicGuide(s);break;case"109":t._buildPreviewUI(t.getHtmlFor109(a.props_id)),t.guide.$guideWrap.css({"margin-left":"-175px","margin-top":"-150px"}),t.hasFrame&&t.guide.$guideWrap.css({width:350,height:205,backgroundPosition:"105px 40px"});break;case"110":t._buildPreviewUI(t.getHtmlFor110(a.props_id));break;case"113":if(!PageData.user.is_login)return _.Module.use("common/widget/LoginDialog"),void 0;t._buildPreviewUI(t.getHtmlForOther(a.props_id)),t.guide.$guideWrap.css({"margin-left":"-200px"}),t.visitCard.getVisitCardContent({un:PageData.user.user_name,id:PageData.user.portrait,wrap:t.guide.$guideContent.find(".card_preview"),bg_id:a.props_id,callBack:function(){t.guide.$guideContent.find(".card_userinfo_img").one("load",function(){t._centerElement(t.guide.$guideWrap)})}});break;default:t._buildPreviewUI(t.getHtmlForOther(a.props_id))}t._buildChargeInfo(i,a),this.initToBuy(),this.initUse()},_buildChargeInfo:function(e,t){var i=this,a=("0"==t.props_type?t.free_user_level:2,i.util.getFreeInfo(t)),r=i.initBuyInfo(e);i.guide.$guideContent.append(r),"107"!=t.props_category&&i.guide.$guideContent.append(a)},_buildPreviewUI:function(e){var t=this;this.guide.initPreviewUI(),this.guide.$guideContent.html(e);var i=$(e).find(".j_resource_loading");i.length>0&&this.guide.$guideWrap.hide(),i.length>0&&i.one("load",function(){t._centerElement(t.guide.$guideWrap),t.guide.$guideWrap.show()})},initUI:function(){this.$portraitWrap=$('<div id="portrait_wrap" class="portrait_wrap"></div>'),this.$portraitFlash=$('<div class="portrait_flash"></div>'),this.$loading=$('<img class="portrait_loading" src="/tb/static-tbmall/img/loading.gif"/>'),this.$portraitWrap.append(this.$portraitFlash).append(this.$loading)},getHtmlForOther:function(e){var t=this,i=e.slice(0,3),a="",r="png",s={1170001:"-1~2",1170002:"0~3",1170003:"2~5",1170004:"5~8",1170005:"10~15"},o={108:'<p class="prop_intro">\u8FDE\u7EED\u7B7E\u5230\u795E\u5668\u3002\u9EBB\u9EBB\u518D\u4E5F\u4E0D\u7528\u62C5\u5FC3\u6211\u6F0F\u7B7E\u4E86\uFF01</p>',117:'<p class="prop_intro">\u4E3A\u697C\u4E3B\u633D\u5C0A\uFF0C\u88AB\u633D\u5C0A\u7528\u6237\u7ECF\u9A8C\u503C\u589E\u52A0('+(s[e]||"")+")\u3002</p>",116:'<p class="prop_intro">\u7ED9\u5973\u795E\u544A\u767D\uFF0C\u53EB\u57FA\u53CB\u56DE\u5BB6\u5403\u996D\uFF0C\u8BA9\u4F60\u7684\u53D1\u8A00\u63B7\u5730\u6709\u58F0\uFF01</p>',118:'<p class="prop_intro">\u4F1A\u5458\u5427\u4E3B\u4E13\u5C5E\u91D1\u8272\u7F6E\u9876\uFF0C\u4E0D\u53EF\u9690\u85CF\uFF0C\u5C0A\u8D35\u8EAB\u4EFD\uFF0C\u7ACB\u523B\u5F70\u663E\u3002</p>'};("1040003"===e||"1040011"===e||"1080002"===e)&&(r="gif");var n=["http://tb1.bdstatic.com/tb/cms/tbmall/",t.options.propIdForProp[i],"/pc/"+e,"."+r].join("");return a+="113"===i?['<div class="card_preview">','<img class="card_loading" src="/tb/static-tbmall/img/loading.gif"/>','</div><div class="card_mask">'].join(""):['<div class="preview">','<img class="j_resource_loading" src="'+n+'" alt="\u56FE\u7247\u9884\u89C8" />'].join(""),a+=o[i]||"",a+="</div>"},_initUserHead:function(){this.userHead||(this.userHead=this.use("common/widget/UserHead"))},getHtmlFor109:function(e){var t=this,i="portrait="+PageData.user.portrait+"&props_id="+e+"&png_count="+t.options.pngCount[e],a="/tb/static-tbmall/swf/GIFMaker.swf?t=14010902",r='<embed width="150" height="150" pluginspage="http://www.macromedia.com/go/getflashplayer" flashvars="'+i+'" allowfullscreen="true" wmode="transparent" allowscriptaccess="always" quality="high" bgcolor="#FFFFFF" src="'+a+'" type="application/x-shockwave-flash">';this.$portraitFlash.html(r),t._initUserHead();var s=this.userHead.getHeadFrameStyle(PageData.user,"150");s.hasFrame&&t.$portraitFlash.css({position:"static"});var o=t.$portraitWrap[0].outerHTML;return s.hasFrame&&(o='<div style="'+s.stylestr+'" class="head_preview_wrap">'+o+"</div>",t.hasFrame=!0),o},getHtmlFor110:function(e){this._initUserHead();var t=this.userHead,i=t.getImgFormat(e),a=["background-image: url(/tb/static-common/img/props/150/"+e+"."+i+")","background-repeat: no-repeat","background-position: center 0"],r=a.join(";");return'<a style="'+r+'" class="head_preview_wrap"><img class="j_resource_loading" src="'+t.getHeadUrl(PageData.user||{})+'"/></a>'},initFlashCallbacks:function(){window.finishMerge=function(){$("#portrait_wrap .portrait_loading").remove()}},initBuyInfo:function(e){var t=this,i=$.json.decode(e),a=PageData.user.is_login?t._buyInfoTpl(i):['<a class="ui_btn ui_btn_sub_s j_buy_button1">',"<span><em>\u5151&nbsp;&nbsp;\u6362</em></span>","</a>"].join(""),r="0"===i.props_type?t.util.convertToDay(i.time_interval):"1\u4E2A";return['<div class="j_buy_wrapper" data-field = '+e+">",'<p class="cost_info">',i.scores,"T\u8C46/",r,"</p>",a,"</div>"].join("")},_buyInfoTpl:function(e){var t=this.util.getBuyInfo(e);return t},initToBuy:function(){var e=this;$(".guide_wrap").delegate(".j_buy_button1","click",function(t){t.preventDefault();var i=$(this).closest(".j_buy_wrapper").getData();e.guide.closeGuide(),e.use("tbmall/component/BuyController",$(this),i)})},initUse:function(){var e=this;$(".guide_wrap").delegate(".j_use","click",function(t){var i=$(this).closest(".j_buy_wrapper").getData();e.guide.closeGuide(),e.useC.doUse($(this),i),t.preventDefault()}),$(".guide_wrap").delegate(".j_cancle_use","click",function(t){var i=$(this).closest(".j_buy_wrapper").getData();e.guide.closeGuide(),e.useC.cancelUse($(this),i),t.preventDefault()}),$(".guide_wrap").delegate(".j_get_button1","click",function(t){e.guide.closeGuide(),e.use("tbmall/widget/getProp",$(this)),t.preventDefault()}),$(".guide_wrap").delegate(".j_tbmall_join_vip_btn","click",function(t){e.requireInstance("common/widget/JoinVipDialog",[]).getMemberDialog();var i=$(this).closest(".guide_content").find("div.j_buy_wrapper").getData();e._statClick(i),t.preventDefault()})},_statClick:function(e){switch(parseInt(e.props_category)){case 110:this._postTrack("\u5934\u50CF\u8FB9\u6846",e.props_id);break;case 109:this._postTrack("\u52A8\u6001\u5934\u50CF",e.props_id);break;case 113:this._postTrack("\u540D\u7247\u80CC\u666F",e.props_id);break;case 104:this._postTrack("\u70AB\u5F69\u5B57\u4F53",e.props_id);break;case 101:this._postTrack("\u53D1\u5E16\u6C14\u6CE1",e.props_id);break;case 103:this._postTrack("\u56FE\u7247\u6C34\u5370",e.props_id);break;case 108:this._postTrack("\u8865\u7B7E\u795E\u5668",e.props_id);break;case 117:this._postTrack("\u633D\u5C0A\u5361",e.props_id);break;case 107:this._postTrack("\u9B54\u6CD5\u5F39",e.props_id);break;case 118:this._postTrack("\u7F6E\u9876\u5361",e.props_id)}},_postTrack:function(e,t){$.stats.track(e,"\u4F1A\u5458\u5065\u5EB7\u7EDF\u8BA1","","click",{obj_name:"\u5F00\u901A\u7684\u70B9\u51FB\u91CF3",obj_id:t})}}});_.Module.define({path:"tbmall/component/BuyController",requires:["tbmall/component/captcha_payment","tbmall/component/NetProxy","tbmall/component/Dialog","tbmall/widget/ContSignCard","tbmall/component/util","tbmall/component/HeadPreview","tbmall/component/UseController","tbmall/widget/paykey_dialog","tbmall/widget/TbeanSafe"],sub:{buy_number:0,set_pass_tpl:'<div class="buy_tpl_set_pass"><p><a class="buy_tpl_setpass_link" href="/tbmall/pass/set" target="_blank">\u7ACB\u5373\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801</a>\uFF0C\u964D\u4F4ET\u8C46\u88AB\u76D7\u98CE\u9669!</p></div>',buy_tpl0:'<div class="buy_tpl clearfix"> <div class="buy_tpl_left"><div class="prop_img"><img src="#{imgsrc}"></div><div class="title">#{title}</div><div class="price">#{price_unit}</div></div> <div class="buy_tpl_right"><div class="price_tip">\u60A8\u9700\u8981<span class="strong_txt">#{price}</span>T\u8C46\u5151\u6362\u9053\u5177</div> #{TbeanCharge}<a class="ui_btn ui_btn_sub_m j_confirm_buy j_buy_button"><span><em>\u786E\u8BA4\u5151\u6362</em></span></a><div class="buy_tpl_set_pass"><p><a class="buy_tpl_setpass_link" href="/tbmall/pass/set" target="_blank">\u7ACB\u5373\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801</a>\uFF0C\u964D\u4F4ET\u8C46\u88AB\u76D7\u98CE\u9669!</p></div></div></div> ',buy_tpl1:['<div class="buy_tpl buy_count_tpl clearfix">',' <div class="buy_tpl_left"><div class="prop_img"><img src="#{imgsrc}"></div><div class="title">#{title}</div><div class="price">#{price_unit}</div>','</div> <div class="buy_tpl_right">','<p class="count_tip">\u60A8\u8981\u5151\u6362\u7684\u6570\u91CF</p>','<div class="count_wrap clearfix"><span class="count_number">\u6570\u91CF\uFF1A</span>','<span class="counter"><button class="j_minus minus"></button><input type="text" class="j_count" value="1"/><button class="j_plus plus"></button></span><span>\u4E2A</span>',"</div>",'<div class="count_tip count_sub_tip">\u9700\u8981T\u8C46\uFF1A<span class="t_dou_needed strong_txt">#{price}</span>\u4E2A  \u60A8\u76EE\u524DT\u8C46\uFF1A<span class="cur_t_dou">#{cur_t_dou}</span>\u4E2A</div>',"#{TbeanCharge}",'<div class="buy_and_tip"><a class="ui_btn ui_btn_sub_m j_confirm_buy j_buy_button"><span><em>\u786E\u8BA4\u5151\u6362</em></span></a><span class="error_tip"></span></div>','<div class="buy_tpl_set_pass"><p><a class="buy_tpl_setpass_link" href="/tbmall/pass/set" target="_blank">\u7ACB\u5373\u8BBE\u7F6E\u652F\u4ED8\u5BC6\u7801</a>\uFF0C\u964D\u4F4ET\u8C46\u88AB\u76D7\u98CE\u9669!</p></div>'," </div></div> "].join(""),initial:function(e,t){this.data=t;$.stats.track(this.data.props_id,"\u8D34\u5427\u5546\u57CE",PageData.page,"\u70B9\u51FB\u5151\u6362"),this.netProxy=this.use("tbmall/component/NetProxy"),this.dialog=this.use("tbmall/component/Dialog"),this.util=this.use("tbmall/component/util"),this.headPreview=this.use("tbmall/component/HeadPreview"),this.useController=this.use("tbmall/component/UseController"),this.isAvailable()&&this.doBuy(e),$(e).data("clicked",!1)},isAvailable:function(){var e=this.data,t=this,a=PageData.scores,s=null!=a.scores_money?parseInt(a.scores_money):0,n=null!=a.scores_other?parseInt(a.scores_other):0,i=s+n,o=Math.min(parseInt(a.scores_fetch),parseInt(t.data.fetch_scores_limit||0)),c=parseInt(i+o);return PageData.user.is_login?PageData.user.no_un?(TbCom.process("User","BuildUnameFrame","\u586B\u5199\u7528\u6237\u540D","\u6709\u7528\u6237\u540D\u624D\u53EF\u4EE5\u5728T\u8C46\u5546\u57CE\u8D2D\u7269\u5662~"),!1):c<parseInt(e.scores)?(t.dialog.dialog("<p class='dialog_content'>T\u8C46\u4F59\u989D\u4E0D\u8DB3\uFF0C\u5151\u6362\u9053\u5177\u9700\u8981<span class='charge_bean_interaction_orange_tip' >"+e.scores+"</span>T\u8C46</p><div class='charge_bean_interaction_dialog_btn_wrap'><a class='charge_bean_interaction_charge_btns charge_bean_interaction_j_charge_btn' id='j_tcharge_dialog_tbmall'>\u83B7\u53D6T\u8C46</a><a class='charge_bean_interaction_charge_btns charge_bean_interaction_j_close_dialog'>\u53D6\u6D88</a></div>"),$("#j_tcharge_dialog_tbmall").on("click",function(){var t={consumption_path:"12",desc:"\u5151\u6362\u9053\u5177",current_need_tdou:parseInt(e.scores)-i,is_direct_cashier:!0,is_iframe:!0};_.Module.use("common/widget/tcharge_dialog",t)}),!1):!0:(TbCom.process("User","buildLoginFrame"),!1)},bindCountEvent:function(e){var t=this,a=t._buyDialog,s=a.element.find(".j_count");a.element.on("click",".j_minus",function(){var a=parseInt(s.val())||1;a=Math.max(1,a-1),a=Math.min(999,a),s.val(a),$(".t_dou_needed").text(e*a);var n=Math.min(PageData.scores.scores_fetch,(t.data.fetch_scores_limit||0)*a);$(".Tbean_num").text(n),t.checkCountError()}).on("click",".j_plus",function(){var a=parseInt(s.val())||1;a++,a=Math.min(999,a),s.val(a),$(".t_dou_needed").text(e*a);var n=Math.min(PageData.scores.scores_fetch,(t.data.fetch_scores_limit||0)*a);$(".Tbean_num").text(n),t.checkCountError()}),s.on("input propertychange",function(){var a=/^[1-9]\d*$/,n=s.val();(n&&!a.test(n)||a.test(n)&&n>999)&&(n=n.replace(/\D/g,"").replace(/^0(\d*)$/,"$1"),n=Math.min(999,n),s.val(n)),$(".t_dou_needed").text(e*n),t.checkCountError()}).on("blur",function(){var a=s.val()&&parseInt(s.val())>0&&parseInt(s.val())||1;a=Math.min(999,a),s.val(a),$(".t_dou_needed").text(e*a),t.checkCountError()})},checkCountError:function(){var e=this,t=e._buyDialog,a=t.element.find(".t_dou_needed"),s=t.element.find(".error_tip"),n=t.element.find(".j_count"),i=n.val(),o=t.element.find(".j_buy_button"),c=PageData.scores,l=parseInt(c.scores_money+c.scores_other),r=Math.min(parseInt(c.scores_fetch),parseInt(e.data.fetch_scores_limit||0)),_=parseInt(l+r);return 999==i?(s.text("\u5355\u6B21\u9650\u5151999\u4E2A"),s.show()):s.hide(),_<parseInt(a.text())?(s.text("T\u8C46\u4F59\u989D\u4E0D\u8DB3"),s.show(),o.addClass("ui_btn_disable ui_btn_m_disable").removeClass("ui_btn ui_btn_sub_m j_confirm_buy"),!1):(s.hide(),o.addClass("ui_btn ui_btn_sub_m j_confirm_buy").removeClass("ui_btn_disable ui_btn_m_disable"),!0)},doBuy:function(){var e,t=this.data,a=this,s="",n="",i=parseInt(t.fetch_scores_limit,10)||0,o=PageData.scores.scores_fetch;n=0===i||0===o?"":['<div class="TbeanCharge_container">','<input id="j_charge_checked" type="checkbox" name="TbeanCharge_check" />','\u53EF\u4F7F\u7528<span class="icon_Tbean_num"></span><span class="Tbean_num">',Math.min(o,i),"</span>\u8C46\u7968\u62B5\u7528T\u8C46","</div>"].join(""),"0"==t.props_type?(PageData.user.setpass&&(a.buy_tpl0=a.buy_tpl0.replace("buy_tpl_set_pass","buy_tpl_set_none")),s=$.tb.format(a.buy_tpl0,{price:t.scores,price_unit:t.scores+"T\u8C46/"+a.util.convertToDay(t.time_interval),title:t.name,imgsrc:t.imgsrc,level:t.free_user_level,TbeanCharge:n}),e=480):"1"==t.props_type&&(PageData.user.setpass&&(a.buy_tpl1=a.buy_tpl1.replace("buy_tpl_set_pass","buy_tpl_set_none")),s=$.tb.format(a.buy_tpl1,{price:t.scores,price_unit:t.scores+"T\u8C46/1\u4E2A",title:t.name,imgsrc:t.imgsrc,cur_t_dou:PageData.scores.scores_total,level:2,TbeanCharge:n}),e=560);var c=220;PageData.user.setpass&&(c=200),a._buyDialog=new $.dialog({html:s,title:"\u5151\u6362\u9053\u5177",width:e,height:c}),PageData.user.setpass?a._buyDialog.element.find(".buy_tpl_right").append(a.util.getFreeInfo(t)):a._buyDialog.element.find(".buy_tpl_left").append(a.util.getFreeInfo(t)),"1"==t.props_type&&a.bindCountEvent(t.scores),a._buyDialog.element.one("click",".j_confirm_buy",function(){var e={props_id:t.props_id};if("1"==t.props_type&&!a.checkCountError())return a._buyDialog.element.one("click",".j_confirm_buy",arguments.callee),void 0;"1"==t.props_type&&(e.buy_num=a._buyDialog.element.find(".j_count").val()),i>0&&$("#j_charge_checked").length&&$("#j_charge_checked")[0].checked&&(e.use_fetch_scores=$(".Tbean_num").text()),$.stats.track(t.props_id,"\u8D34\u5427\u5546\u57CE",PageData.page,"\u786E\u5B9A\u5151\u6362");var s=function(n){n&&$.extend(e,n),a.netProxy.buyProp(e,function(n){var i="",o="",c=a.use("tbmall/widget/TbeanSafe",{json:n,sucCallback:s,content:a});if(!c.needCheck()){if(0==n.no){switch(t.props_category){case"107":o='\u5728\u8D34\u5427\u8BE6\u60C5\u9875\u70B9\u51FB<img style="vertical-align:middle;" src="/tb/static-tbmall/img/magic_show_icon.png" />\u4F7F\u7528';break;case"108":"1080001"==t.props_id&&(o="\u5728\u7B7E\u5230\u9875\u9762\u4F7F\u7528");break;case"101":o="\u4F60\u53EF\u4EE5\u5728\u8FD9\u91CC\u4F7F\u7528\u4F60\u7684\u53D1\u8D34\u6C14\u6CE1";break;case"104":o="\u5728\u53D1\u8D34\u6846\u4E2D\u4F7F\u7528";break;case"105":o="\u60A8\u5DF2\u6210\u529F\u62E5\u6709\u8BE5\u52CB\u7AE0\u5BF9\u5E94\u7684\u9053\u5177\u7279\u6743\uFF0C\u5FEB\u53BB\u4F7F\u7528\u5427\uFF01";break;case"109":case"110":o="\u5728\u5F53\u524D\u9875\u9762\u4F7F\u7528";break;case"113":o="\u5728\u4E2A\u4EBA\u4E2D\u5FC3\u4F7F\u7528"}i="1"==t.props_type?"\u5151\u6362"+e.buy_num+"\u4E2A<span class='orange_txt'>"+n.data.title+"</span>\u6210\u529F\uFF01<br>"+o:"\u5151\u6362<span class='orange_txt'>"+n.data.title+"</span>\u6210\u529F\uFF01\u6709\u6548\u671F\u81F3<span class='orange_txt'>"+a.util.formatDate(n.data.end_time)+"</span><br>"+o}else switch(n.no){case 2270005:i="\u54CE\u5440\uFF0CT\u8C46\u4E0D\u8DB3";break;case 2270001:i="\u9886\u53D6\u6210\u529F`(*\u2229_\u2229*)\u2032";break;case 2270004:i="\u60A8\u5DF2\u7ECF\u62E5\u6709\u4E86\u66F4\u9AD8\u7EA7\u7684\u52CB\u7AE0\uFF0C\u65E0\u9700\u5151\u6362\u672C\u52CB\u7AE0\uFF01";break;case 2270006:i="\u672C\u9053\u5177\u4E0D\u53EF\u91CD\u590D\u5151\u6362";break;case 360007:case 2150040:var l=a.use("tbmall/component/captcha_payment",{data:n});return l.showCaptcha(s),void 0;case 2270018:case 1990005:case 2190005:n.data=n.data||{};var r=a.use("tbmall/widget/paykey_dialog",{showType:2,errType:n.no,errTime:n.data.wrongtime});return r.showDialog(s,function(){},a),void 0;default:i="\u54CE\u5440\uFF0C\u670D\u52A1\u5668\u62BD\u98CE\u4E86\u3002\u8BF7\u7A0D\u7B49\u4E00\u4F1A~~"}0==n.no&&($.inArray(t.props_category,["109","110","114"])>-1||"1080002"==t.props_id)?a.dialog.confirm('<div class="tip">'+i+"</div>",{button:[{txt:"\u7ACB\u5373\u4F7F\u7528",extraclass:"j_nameplate_recast1",callback:function(){a.dialog.close(),"1080002"==t.props_id?a.use("tbmall/widget/ContSignCard"):"1140001"==t.props_id?$(".j_nameplate_recast").trigger("click"):a.useController.doUse(parseInt(n.data.props_id))}},{txt:"\u7A0D\u540E\u4F7F\u7528",callback:function(){a.dialog.close(),$.tb.location.reload()}}]}):0==n.no&&$.inArray(t.props_category,["101"])>-1?(a.dialog.info('<div class="tip tip_center">'+i+'</div><div class="tip_bubble_intro"></div><div class="tip_operation"><input type="checkbox" class="tip_check_box"/>\u8BBE\u7F6E\u4E3A\u9ED8\u8BA4\u6C14\u6CE1</div>',{title:"\u8D2D\u4E70\u6210\u529F",width:475,height:365,button:"\u6211\u77E5\u9053\u4E86"}),a.dialog.bind("onInfoClose",function(){$(".tip_operation .tip_check_box").tbattr("checked")?$.ajax({url:"/tbmall/submit/setBub",type:"post",dataType:"json",data:{props_id:t.props_id,tbs:PageData.tbs||PageData.user.tbs},success:function(){$.tb.location.reload()},error:function(){$.tb.location.reload()}}):$.tb.location.reload()})):(a.dialog.info('<div class="tip">'+i+"</div>"),0==n.no&&a.dialog.bind("onInfoClose",function(){$.tb.location.reload()}))}})};a._buyDialog.close(),s()})}}});_.Module.define({requires:["tbmall/component/BuyController","tbmall/widget/TbeanSafeAjax","common/widget/Tdou/TdouViewPay","tbmall/widget/forumMemberDialog","common/widget/payMember"],path:"encourage/widget/celebrity_expball",sub:{resources:{expballPropsCategoryId:119,expballPropsId:1190001,buyprops:"/tbmall/post/buyprops",voteNpc:"/celebrity/submit/voteNpc"},initial:function(e){this.opt=e,this.parrProps=PageData.user.Parr_props||{},this.forum=PageData.forum||{},this.user=PageData.user||{},this.bindEvent()},bindEvent:function(){var e=$("#celebrity"),t=this;e.on("click","[j-celebrity-vote-btn]",function(){var e=$(this);if(t.checkLogin()){var l=e.tbattr("data-id");t.hasExpBall(t.parrProps)?(t.showVoteConfirmDialog(),t.dialog.element.on("click","[j-celebrity-expball-vote-use-btn]",function(){t.vote(l,1)}).on("click","[j-celebrity-expball-vote-no-use-btn]",function(){t.vote(l,0)})):t.vote(l,0)}}).on("click","[j-celebrity-expball-show]",function(){t.showExpBallDialog()})},hasExpBall:function(e){return e&&e["119"]&&e["119"]["1190001"]&&e["119"]["1190001"].left_num>0?e["119"]["1190001"].left_num:!1},vote:function(e,t){var l={id:e,use_num:t,tbs:PageData.tbs},a=this;$.post(this.resources.voteNpc,l,function(e){if(e)switch(e.no){case 0:t>0&&a.hasExpBall(this.parrProps)&&(a.parrProps["119"]["1190001"].left_num-=t),a.showVoteSuccessDialog(e.data);break;case 952710:a.showAlert("\u60A8\u672A\u5173\u6CE8\u672C\u5427");break;case 11e4:a.requireInstanceAsync("common/widget/LoginDialog");break;case 952711:a.showAlert("\u5427\u7B49\u7EA7\u8FBE\u5230"+(e.data+1)+"\u7EA7\u624D\u80FD\u652F\u6301\u672C\u5427\u54E6");break;case 952712:a.showAlert("\u60A8\u7533\u8BF7\u7684\u540D\u4EBA\u5DF2\u522B\u7533\u8BF7\u8FC7\u4E86~");break;case 952713:a.showAlert("\u672C\u671F\u6295\u7968\u7ED3\u675F\uFF0C\u4E0B\u4E00\u671F\u5373\u5C06\u542F\u52A8\uFF0C\u656C\u8BF7\u671F\u5F85");break;case 952709:a.showAlert("\u5F53\u524D\u7528\u6237\u4E0D\u662F\u5427\u4E3B");break;case 65534:a.showAlert("\u6BCF\u5929\u53EA\u80FD\u7ED93\u4E2A\u5427\u6295\u7968 \u0CA5_\u0CA5");break;case 65533:a.showAlert("\u6BCF\u5929\u53EA\u80FD\u7ED9\u4E00\u4E2A\u5427\u62951\u7968\uFF0C\u8BF7\u660E\u5929\u7EE7\u7EED\u652F\u6301");break;case 65532:a.showAlert("IP\u4E00\u5929\u8D85\u8FC7500");break;default:a.showAlert("\u64CD\u4F5C\u5931\u8D25,"+e.error)}})},tbmallBuy:function(e){var t={props_id:this.resources.expballPropsId,props_category:this.resources.expballPropsCategoryId,props_type:"1",scores:"1000",name:"\u53CC\u500D\u7403",imgsrc:"http://tb2.bdstatic.com/tb/static-encourage/widget/celebrity_expball/images/expball_buy_icon_552acff.jpg",free_user_level:"0",time_interval:"0",fetch_scores_limit:"0",is_default_usedd:"0"};PageData.scores=PageData.user.Parr_scores,this.requireInstance("tbmall/component/BuyController",[$(e),t])},genOrder:function(){var e=this.requireInstance("tbmall/widget/TbeanSafeAjax"),t=this,l={props_id:this.resources.expballPropsId,buy_num:1,tbs:PageData.tbs};e.post(this.resources.buyprops,l,function(e){if(0==e.no&&e.data){var l=t.requireInstance("common/widget/Tdou/TdouViewPay",function(e){e.data&&!e.data.no&&setTimeout(function(){$.tb.location.reload()},1e3)});l.createMain(e.data)}else t.showAlert("\u8BA2\u5355\u51FA\u9519\uFF0C\u8BF7\u91CD\u8BD5","\u793C\u7269\u8D60\u9001"),setTimeout(function(){$.tb.location.reload()},1e3)})},showExpBallDialog:function(){var e='  <div class="celebrity-expball" >      <div class="celebrity-expball-top">          <div class="celebrity-expball-top-left"></div>          <div class="celebrity-expball-top-right" >              <h3>\u53CC\u500D\u7403\u53EF\u4EE5\u5E2E\u4F60\u7FFB\u500D\u6295\u7968\u7ECF\u9A8C\uFF01</h3>              <button class="celebrity-expball-buy-btn btn-encourage btn-large" j-celebrity-expball-buy-btn >\u53BB\u4E70\u9053\u5177</button>          </div>            </div>      <div class="celebrity-expball-bottom">          <p>\u66F4\u591A\u7FFB\u500D\u7968\u6570\u7279\u6743</p>          <p>\u672C\u5427\u4F1A\u5458\uFF1A\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570+2; <a href="javascript:;" j-celebrity-expball-local-vip >\u5F00\u901A>> </a><p>          <p>\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458\uFF1A\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570+3\u3002<a  href="javascript:;" j-celebrity-expball-super-vip >\u5F00\u901A>> </a><p>       </div>        <div>';this.showDialog(e);var t=this;t.dialog.element.on("click","[j-celebrity-expball-buy-btn]",function(){t.tbmallBuy(this)}).on("click","[j-celebrity-expball-local-vip]",function(){var e={scores_money:0,scores_other:0};t.requireInstance("tbmall/widget/forumMemberDialog",{is_show_features:!1,is_show_forum:!1,current_forum_id:t.forum.forum_id,current_forum_name:t.forum.forum_name,scores:t.user.Parr_scores?t.user.Parr_scores:e,cnt_height:225,is_celebrity_forum:!0,callback:function(){$.tb.location.reload()}})}).on("click","[j-celebrity-expball-super-vip]",function(){var e=t.requireInstance("common/widget/payMember"),l={fr:"celebrity"};e.showCashier(l)})},showVoteSuccessDialog:function(e){e.left_vote_times=e.left_vote_times?e.left_vote_times:-1;var t='  <div class="celebrity-expball" >      <div class="celebrity-expball-top">          <div class="celebrity-expball-vote">              <h3><i class="celebrity-expball-vote-icon"></i>\u6295\u7968\u6210\u529F\uFF0C<span class="orange-text">\u540D\u4EBA\u7968\u6570+<%=add_vote_num %></span></h3>              <% if (left_vote_times != -1) { %>              <p class="celebrity-expball-vote-tip" >\u4ECA\u65E5\u8FD8\u5269<a><%=left_vote_times %></a>\u6B21\u6295\u7968\u673A\u4F1A</p>              <% } %>          </div>                </div>      <div class="celebrity-expball-bottom">          <p>\u7FFB\u500D\u7968\u6570\u7279\u6743</p>          <ul class="celebrity-expball-bottom-list">              <li>                  <span>\u53CC\u500D\u7403</span><span class="celebrity-expball-bottom-list-right">\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570*2 <a href="javascript:;" j-celebrity-expball-buy-btn >\u53BB\u8D2D\u4E70>> </a></span>              </li>              <li>                  <span>\u672C\u5427\u4F1A\u5458</span><span class="celebrity-expball-bottom-list-right">\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570+2 <a  href="javascript:;" j-celebrity-expball-local-vip >\u5F00\u901A>> </a></span>              </li>              <li>                  <span>\u8D34\u5427\u8D85\u7EA7\u4F1A\u5458</span><span class="celebrity-expball-bottom-list-right">\u6295\u7968\u4E00\u6B21\uFF0C\u7968\u6570+3 <a  href="javascript:;" j-celebrity-expball-super-vip >\u5F00\u901A>> </a></span>              </li>                    </ul>      </div>        <div>';this.showDialog(_.template(t)(e));var l=this;l.dialog.element.on("click","[j-celebrity-expball-buy-btn]",function(){l.tbmallBuy(this)}).on("click","[j-celebrity-expball-local-vip]",function(){var e={scores_money:0,scores_other:0};l.requireInstance("tbmall/widget/forumMemberDialog",{is_show_features:!1,is_show_forum:!1,current_forum_id:l.forum.forum_id,current_forum_name:l.forum.forum_name,scores:l.user.Parr_scores?l.user.Parr_scores:e,cnt_height:225,is_celebrity_forum:!0,callback:function(){$.tb.location.reload()}})}).on("click","[j-celebrity-expball-super-vip]",function(){var e=l.requireInstance("common/widget/payMember"),t={fr:"celebrity"};e.showCashier(t)})},showVoteConfirmDialog:function(){var e='<div class="celebrity-expball" >      <div class="celebrity-expball-vote">          <h3>\u53CC\u500D\u7403\u53EF\u4EE5\u5E2E\u4F60\u7FFB\u500D\u7968\u6570\u54E6!</h3>          <div class="celebrity-expball-vote-confirm-btn-wrapper">              <button class="btn-default celebrity-expball-vote-confirm-btn btn-middle" j-celebrity-expball-vote-use-btn>\u4F7F\u7528\u9053\u5177(\u8FD8\u5269<%=left_num %>\u4E2A)</button>              <button class="btn-sub celebrity-expball-vote-confirm-btn btn-middle"  j-celebrity-expball-vote-no-use-btn>\u76F4\u63A5\u6295\u7968</button>          </div>      </div>  <div>';this.showDialog(_.template(e)({left_num:this.hasExpBall(this.parrProps)}))},showAlert:function(e){$.dialog.alert(e,{title:"\u8D34\u5427\u63D0\u793A",acceptValue:"\u77E5\u9053\u5566",onaccept:function(){return!0}})},showDialog:function(e,t){this.dialog&&(this.dialog.close(),this.dialog=null),this.dialog=new $.dialog({title:t,html:e,width:430})},checkLogin:function(){return PageData.user.is_login?!0:(this.requireInstanceAsync("common/widget/LoginDialog"),!1)}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,_=t.Parr_scores,u=0;_&&(u=_.scores_money+_.scores_other);var s=u>=e.tdou_num,c=0;s||(c=e.tdou_num-u);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,_=0;d||(_=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this,o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain()})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"user/widget/celebrity",requires:["tbmall/widget/forumMemberDialog","encourage/widget/npc_vote/npc_vote_action","user/widget/celebrity_forum_dialog"],sub:{initial:function(e){this.$root=$("#celebrity"),this.forum=PageData.forum,this.user=PageData.user,this.opt=e,this._bindEvents()},_bindEvents:function(){var e=this;this.$root.find(".j-gift-buy").on("click",function(){var r={scores_money:0,scores_other:0};e.requireInstance("tbmall/widget/forumMemberDialog",{is_show_features:!1,is_show_forum:!1,current_forum_id:e.forum.forum_id,current_forum_name:e.forum.forum_name,scores:e.user.Parr_scores?e.user.Parr_scores:r,cnt_height:225,is_celebrity_forum:!0,callback:function(){$.tb.location.reload()}})}),this.requireInstance("encourage/widget/npc_vote/npc_vote_action",{$root:e.$root}),this.requireInstance("user/widget/celebrity_forum_dialog",{$root:e.$root.find(".j-btn-celebrity"),celebrity:e.opt.celebrity})}}});_.Module.define({path:"common/widget/Tdou/TdouViewPay",requires:["common/widget/Tdou/TdouBuilder","common/widget/Tdou/TdouData","common/widget/Tdou/TdouViewUtil","common/widget/Tdou/TdouViewAutoRedirect","common/widget/Tdou/TdouViewOperationBootstrap"],sub:{errors:{110000:"\u7528\u6237\u672A\u767B\u9646",2320007:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",210009:"\u7CFB\u7EDF\u9519\u8BEF\uFF0C\u8BF7\u7A0D\u540E\u91CD\u8BD5",2270044:"\u8D26\u53F7\u5F02\u5E38\uFF0C\u8BF7\u91CD\u65B0\u767B\u9646",2270047:"\u652F\u4ED8\u5931\u8D25\u2014\u8BA2\u5355\u5931\u6548",2270050:"\u8BA2\u5355\u72B6\u6001\u5F02\u5E38",2270049:"\u5546\u54C1\u8FC7\u671F\uFF0C\u8BF7\u91CD\u65B0\u8D2D\u4E70",2270015:"\u5546\u54C1\u4E0D\u53EF\u5151\u6362",2270051:"\u7CFB\u7EDF\u7EF4\u62A4\u4E2D..."},order_status:{0:"\u652F\u4ED8\u672A\u5B8C\u6210\uFF01",1:"\u652F\u4ED8\u6210\u529F\uFF0C\u5546\u54C1\u5151\u6362\u4E2D\uFF01",2:"\u5151\u6362\u6210\u529F",3:"\u5151\u6362\u5931\u8D25\uFF0CT\u8C46\u5DF2\u9000\u8FD8",4:"\u5151\u6362\u8D85\u65F6\uFF0C\u8BF7\u8054\u7CFB\u7BA1\u7406\u5458"},tdou_buy_confirm_tag:"tdou_buy_confirm",is_iframe:!0,initial:function(e){this.builder=this.requireInstance("common/widget/Tdou/TdouBuilder"),this.dataProxy=this.requireInstance("common/widget/Tdou/TdouData"),this.viewUtil=this.requireInstance("common/widget/Tdou/TdouViewUtil"),this.message=e,this.autoDirect=this.requireInstance("common/widget/Tdou/TdouViewAutoRedirect")},createMain:function(e){var o=this;o.dataProxy.getPayInfo(e,o.onPayInfo,o)},onPayInfo:function(e){var o=this;if(e&&0===e.no){var t=e.data.goods_info,i=e.data.order_info,r=e.data.user_info;o.pay_info={goods_info:t,order_info:i,user_info:r},o.createUI(t,i,r)}else o.handleError(e.no)},createUI:function(e,o,t){var i=this,r="",n=t.Parr_props;i.dataProxy.setParrProps(n);var a=i.dataProxy.getMemberLevel(),d=2==a,_=t.Parr_scores,u=0;_&&(u=_.scores_money+_.scores_other);var s=u>=e.tdou_num,c=0;s||(c=e.tdou_num-u);var m=e.free_vip_level;if(s&&(o.cpath.pay_cashier||void 0==o.cpath.pay_cashier))return i.pay(!1),void 0;if(!s&&(o.cpath.gettdou_cashier||void 0==o.cpath.gettdou_cashier))return i.getTdou(!1),void 0;var l=i.confirmCount();return s&&l>0?(l-=1,i.confirmCount(l),i.pay(!1),void 0):(d&&m?r=i.createUI_memberGetTdou_free(s,e,o,c):d&&!m?r=i.createUI_memberGetTdou(s,e,o,c):!d&&m?r=i.createUI_nonMemberGetGoodsOwnedMember(s,e,o,c):d||m||(r=i.createUI_nonMemberGetTdouOwnedMember(s,e,o,c)),i.renderMain(r),i.initUIData(),i.bindMainUIEvents(),void 0)},directToCrasher:function(e,o,t){var i=this,r=t.Parr_props;i.dataProxy.setParrProps(r);var n=t.Parr_scores,a=0;n&&(a=n.scores_money+n.scores_other);var d=a>=e.tdou_num,_=0;d||(_=e.tdou_num-a),d?i.pay(!1):i.getTdou(!1)},initUIData:function(){var e=this,o=e.confirmCount(),t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_buy_confirm");t.length>0&&(parseInt(o)>0?t.tbattr("checked",!0):t.tbattr("checked",!1))},createUI_nonMemberGetGoodsOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetGoodsOwnedMember(e,o,t,i);return r},createUI_nonMemberGetTdouOwnedMember:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_nonMemberGetTdouOwnedMember(e,o,t,i);return r},createUI_memberGetTdou:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou(e,o,t,i);return r},createUI_memberGetTdou_free:function(e,o,t,i){o.tdou_pay_from=t.from;var r=this.builder.buildPayTdouMain_memberGetTdou_freeGoods(e,o,t,i);return r},renderMain:function(e){if(!($(".baidu_tb_tdou_payment_dialog").length>0)){var o={modal:!0,showTitle:!1,fixed:!0,width:610,height:275,holderClassName:"baidu_tb_tdou_payment_dialog",draggable:!0};o.html=e,this._dialog=new $.dialog(o),this._dialog.element[0].id="baidu_tb_tdou_payment_dialog",this._dialog.show()}},bindMainUIEvents:function(){var e=this,o=e._dialog.element;o.find(".j_tdou_pay_header_close").on("click",function(){e.closeMain(),e.sendMessage("closed","");var o=e.requireInstance("common/widget/Tdou/TdouViewOperationBootstrap"),t={actionType:"CLOSE_PAYMENT"};o.triggerByScene(t,e.pay_info)}),o.delegate(".j_tb_tdou_pay_btn","click",function(){e.pay()}).delegate(".j_tb_tdou_get_tdou_btn","click",function(){e.getTdou()}).delegate(".j_tdou_enable_member","click",function(){var e=$(".j_baidu_tb_tdou_pay_info_box .j_tb_tdou_get_tdou_btn");$(this).tbattr("checked")?(e.html("\u5F00\u901A\u4F1A\u5458\u5E76\u83B7\u53D6T\u8C46"),e.addClass("tdou_pay_btn_135")):(e.html("\u83B7\u53D6T\u8C46"),e.removeClass("tdou_pay_btn_135"))}).delegate(".j_tdou_buy_confirm","click",function(){$(this).tbattr("checked")?e.confirmCount(30):e.confirmCount(0)}).delegate(".j_tdou_buy_icon","click",function(){e.getIcon()}).delegate(".j_tdou_open_super_member_link","click",function(){e.closeMain()})},pay:function(e){var o=this,t=e;"undefined"==typeof e&&(t=!0);var i={no_ui:t};o.dataProxy.payGoods(o.onPay,o,i)},onPay:function(e,o){var t=this;o&&!o.no_ui?t.wrap=null:(t.wrap=null,t.closeMain());var i=t.dataProxy.getPayInfoCache();if(0===e.no){var r={from:i.order_info.from,goods_name:$.tb.subByte(i.goods_info.goods_name,24,""),order_status:e.data.order_info.status,price:i.goods_info.tdou_num};t.viewUtil.displayPaymentSuccess(t.wrap,r,function(){t.closeMain(),t.sendMessage("paid",e)},t)}else t.viewUtil.displayPaymentFailed(t.wrap,$.tb.subByte(i.goods_info.goods_name,24,""),function(){t.closeMain(),t.sendMessage("paid",e)},t)},getTdou:function(e){var o=this,t=!1,i=e;"undefined"==typeof e&&(i=!0),i?(t=$(".j_baidu_tb_tdou_pay_info_box .j_tdou_enable_member").tbattr("checked"),this.closeMain()):t=!1;var r=o.dataProxy.getPayInfoCache(),n=r.order_info.cpath,a={consumption_path:r.order_info.scene_id,title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u83B7\u53D6T\u8C46",need_tdou:0,third_order_id:r.order_info.order_id,goods_cost_tdou:r.goods_info.tdou_num};t?($.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46",pay_type:7,tbs:r.tbs}),n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u5F00\u901A\u8D85\u7EA7\u4F1A\u5458,\u83B7\u53D6T\u8C46,\u8D2D\u4E70\u5546\u54C1",pay_type:9,tbs:r.tbs})):n&&"1"==n.purchase&&$.extend(a,{title:"\u7B2C\u4E09\u65B9\u652F\u4ED8:\u8D2D\u4E70\u5546\u54C1,\u83B7\u53D6T\u8C46",pay_type:8,third_order_id:r.order_info.order_id,tbs:r.tbs}),o.goCashier(a,i)},goCashier:function(e,o){var t=this,i={consumption_path:e.consumption_path,title:e.desc,need_tdou:e.current_need_tdou,goods_cost_tdou:e.goods_cost_tdou||0,pay_type:e.pay_type||6,tbs:e.tbs,order_id:e.third_order_id,is_dialog:!o,pay_info:t.pay_info};this.autoDirect.display_type="third_app",this.autoDirect.third_order_id=e.third_order_id,this.autoDirect.createMain(i)},getIcon:function(){var e=this;e.closeMain();var o=e.dataProxy.getPayInfoCache();e.view=this.requireInstance("common/widget/Tdou/TdouView"),e.view.bind("after_buy_icon",function(t,i){var r=o.goods_info,n=o.order_info,a=o.user_info;null!=i&&(a.Parr_scores=i),e.createUI(r,n,a)},e);var t=o.order_info.scene_id,i="\u7B2C\u4E09\u65B9\u8D2D\u4E70icon",r=o.goods_info.tdou_num;e.view.createMain(t,i,r)},closeMain:function(){this._dialog&&this._dialog.close(),this.dialog=null},confirmCount:function(){var e=this,o=arguments[0],t=0,i=new Date,r=i.getFullYear()+""+(i.getMonth()+1)+i.getDate();if("undefined"!=typeof o){t=parseInt(o);var n=r+"#"+t;$.tb.Storage.set(e.tdou_buy_confirm_tag,n)}else{if(o=$.tb.Storage.get(e.tdou_buy_confirm_tag),null==o)return 0;var a=o.split("#");t=a&&2==a.length&&a[0]==r?parseInt(a[1]):0}return t},sendMessage:function(e,o){var t=this,i=null;"closed"==e?i={command:"encourage_dialog_closed",data:o}:"paid"==e&&(i={command:"encourage_paid",data:o}),t.message&&t.message(i)},handleError:function(e){if(e){var o=this,t=o.errors[e];return 11e4==e?(o.viewUtil.OpenLoginDialog(),void 0):(t?o.viewUtil.displayPaymentError(t):o.viewUtil.displayPaymentError("\u672A\u77E5\u9519\u8BEF"),void 0)}}}});_.Module.define({path:"encourage/widget/npc_vote/npc_vote_action",sub:{initial:function(e){this._opt=e,this._bindEvents()},_bindEvents:function(){var e=this,t=this._opt.$root;t.on("click",".j-btn-vote",function(){if(!PageData.user.is_login)return e.requireInstanceAsync("common/widget/LoginDialog"),void 0;var a=$(this).data("id"),n=$(this).data("forumname");$.post("/celebrity/submit/voteNpc",{tbs:PageData.tbs,id:a},function(a){switch(a.no){case 0:t.find(".j_vote_npc_"+a.data.id).find(".j_vote_num").text(a.data.vote_num),e._success();break;case 952710:e._attention(n);break;case 11e4:e.requireInstanceAsync("common/widget/LoginDialog");break;case 952711:e._alert({msg:"\u5427\u7B49\u7EA7\u8FBE\u5230"+(a.data+1)+"\u7EA7\u624D\u80FD\u652F\u6301\u672C\u5427\u54E6"});break;case 952712:e._alert({msg:"\u60A8\u7533\u8BF7\u7684\u540D\u4EBA\u5DF2\u522B\u7533\u8BF7\u8FC7\u4E86~"});break;case 952713:e._alert({msg:"\u672C\u671F\u6295\u7968\u7ED3\u675F\uFF0C\u4E0B\u4E00\u671F\u5373\u5C06\u542F\u52A8\uFF0C\u656C\u8BF7\u671F\u5F85"});break;case 952709:e._alert({msg:"\u5F53\u524D\u7528\u6237\u4E0D\u662F\u5427\u4E3B"});break;case 65534:e._alert({msg:"\u6BCF\u5929\u53EA\u80FD\u7ED93\u4E2A\u5427\u6295\u7968 \u0CA5_\u0CA5"});break;case 65533:e._alert({msg:"\u6BCF\u5929\u53EA\u80FD\u7ED9\u4E00\u4E2A\u5427\u62951\u7968\uFF0C\u8BF7\u660E\u5929\u7EE7\u7EED\u652F\u6301"});break;case 65532:e._alert({msg:"IP\u4E00\u5929\u8D85\u8FC7500"});break;default:$.dialog.alert(a.error,{title:"\u63D0\u793A"})}})})},_success:function(){var e='<div class="npc-vote-dialog"><p>\u6295\u7968\u6210\u529F</p><div class="btn-group"><a href="/celebrity/rankHome#npc_vote" class="btn-default btn-small mr10 j-see-rank">\u67E5\u770B\u699C\u5355</a> <a href="javascript:;" class="btn-sub btn-small j_close">\u53D6 \u6D88</a></div></div>',t=this._alert({html:e});$(t.element).find(".j-see-rank").on("click",function(){t.close()})},_alert:function(e){var t=e.html||'<div class="npc-vote-dialog"><p>'+e.msg+'</p><div class="btn-group">  <a href="#" class="btn-default btn-small j_close">\u786E \u8BA4</a></div></div>',a=new $.dialog({width:380,html:t,title:"\u63D0\u793A",draggable:!1});return $(a.element).find(".j_close").on("click",function(){return a.close(),!1}),a},_attention:function(e){var t='<div class="npc-vote-dialog"><p>\u672A\u5173\u6CE8\u672C\u5427\u4E0D\u80FD\u6295\u7968\u54E6~</p><div class="btn-group"> <a href="/f?kw='+encodeURIComponent(e)+'" class="btn-default btn-small">\u53BB\u5173\u6CE8</a></div></div>';new $.dialog({width:350,html:t,title:"\u63D0\u793A",draggable:!1})}}});_.Module.define({path:"encourage/widget/myApp",sub:{MY_APP_THEME_KEY:"my_app_theme_cls",initial:function(a){var t=this;t._root=$("#encourage_entry"),$.extend(t,a),$.tb.Storage.remove("my_app_theme_cls"),"1"==t.is_pull_recommendation&&t.pullRecommendation(),t._stats()},_stats:function(){var a=this,t=a._root.find(".list50").length>0;a._root.on("click","a",function(){var e=$(this).data("log"),n=$(this).closest(".j_app_item").find(".j_app_recommend").length>0||"1"!=a.is_pull_recommendation,p={is_recommendation:n,is_50:t};$.stats.track(e,"\u53F3\u4FA7\u5165\u53E3-\u6211\u7684\u5E94\u7528",PageData.product,"click",p)}),a._viewStats(a._root,{is_50:t})},_viewStats:function(a,t){var e=!1,n=null,p=function(){e||($.stats.track("\u5C55\u73B0","\u53F3\u4FA7\u5165\u53E3-\u6211\u7684\u5E94\u7528",PageData.product,"show",t),e=!0)},i=function(){var t=a.offset().top,e=a.offset().top+a.height(),n=$("body").scrollTop(),p=$(window).height()+n,i=!1;return(t>n&&p>=t||e>n&&p>=e)&&(i=!0),i};i()?p():$(window).on("scroll",function(){i()&&(clearTimeout(n),n=setTimeout(p,200))})},setTheme:function(){var a=this,t="list50",e="list60",n=$.tb.Storage.get(a.MY_APP_THEME_KEY);n||(n="1"==a.is_pull_recommendation?a.user_id%2==0?t:e:a.random(0,99)%2==0?t:e,$.tb.Storage.set(a.MY_APP_THEME_KEY,n)),a._root.find(".j_app_list").addClass(n)},random:function(a,t){return null==t&&(t=a,a=0),a+Math.floor(Math.random()*(t-a+1))},pullRecommendation:function(){var a=this,t={ie:"utf-8",tbs:PageData.tbs};a._ajax&&a._ajax.abort(),a._ajax=$.ajax({type:"post",url:"/tbapp/user/getRecommendApp",data:t,dataType:"json"}).success(function(t){t&&0===t.no&&a.renderAppList(t.data)})},renderAppList:function(a){var t=this,e=0;t.wrapper=$("#encourage_entry");for(var n="",p='<li  class="media_vertical app_icon_wrap j_app_item #{last_app_item}"><div class="media_top"><a href="/f?ie=utf-8&kw=#{app_name}" data-log="#{app_name}" target="_blank" class="app_icon_link"  title="#{app_name}"><img src="#{app_img}"></a>#{recommend_title}</div><a href="/f?ie=utf-8&kw=#{app_name}" data-log="#{app_name}" target="_blank"  class="media_bottom text_overflow"  title="#{app_name}">#{app_name}</a></li>',i=0,o=a.length;o>i&&12>i;i++){var _=a[i],r={last_app_item:(i+1)%3===0?"last_app_item":"",app_name:_.forum_name,app_img:_.forum_portrait_image,recommend_title:1==_.type?(e++,'<span  class="j_app_recommend media_caption app_recommend">\u8350</span>'):""};n+=$.tb.format(p,r)}var s=t.wrapper.find(".j_add_app_item");12==a.length?s.hide():s.show(),t.wrapper.find(".j_app_list").prepend(n),e==a.length?(t.wrapper.find(".j_encourage_title").html("\u63A8\u8350\u5E94\u7528"),t.wrapper.find(".j_app_recommend").hide()):(t.wrapper.find(".j_encourage_title").html("\u6211\u7684\u5E94\u7528"),t.wrapper.find(".j_app_recommend").show())}}});_.Module.define({path:"comforum/widget/u9Aside",requires:[],sub:{initial:function(e){this.gameName=e.game_name||"",this.gameType=e.game_type||"",this.viewData=e.view_data||[],this.bindEvents()},bindEvents:function(){if(this.gameType){var e=this,a=0,i=this.viewData.length,t=[],s=1==this.gameType?"U9\u5B9A\u5236\u7248":"U9\u901A\u7528\u7248";if(i>0)for(this.gameName=this.viewData[0].summary,a;i>a;a++)t.push(this.viewData[a].summary);$.stats.track("\u53F3\u4FA7",s,"","view",{obj_type:"U9",obj_name:e.gameName,obj_game:t}),$(".u9_aside").on("click",".u9_aside_list a",function(){$.stats.track("\u793C\u5305","U9\u901A\u7528\u7248","","click",{obj_type:"U9",obj_name:$(this).data("code")})})}}}});